<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Example</title>
    <link rel="stylesheet" href="./styles.css">
    <script src="../bundle/jsext.js">
        // this will also include the sub-modules and augmentations
    </script>
    <script type="module">
        import { alert, confirm, prompt, progress, openFile, saveFile } from "../esm/dialog.js";
        import { sleep } from "../esm/async.js";
        import { isREPL } from "../esm/runtime.js";

        self.onload = () => {
            const alertBtn = document.getElementById('alert');
            alertBtn.addEventListener('click', () => {
                alert('Hello, World!');
            });

            const confirmBtn = document.getElementById('confirm');
            confirmBtn.addEventListener('click', () => {
                confirm('Are you sure?').then((result) => {
                    alert("You clicked " + (result ? "OK" : "Cancel"));
                });
            });

            const promptBtn = document.getElementById('prompt');
            promptBtn.addEventListener('click', () => {
                prompt('Enter your name:').then((result) => {
                    alert("You entered: " + result);
                });
            });

            const promptPasswordBtn = document.getElementById('prompt-password');
            promptPasswordBtn.addEventListener('click', () => {
                prompt('Enter your password:', { type: 'password' }).then((result) => {
                    alert("You entered: " + result);
                });
            });

            const promptDefaultBtn = document.getElementById('prompt-default');
            promptDefaultBtn.addEventListener('click', () => {
                prompt('Enter your name:', 'John Doe').then((result) => {
                    alert("You entered: " + result);
                });
            });

            const progressBtn = document.getElementById('progress');
            progressBtn.addEventListener('click', async () => {
                const result = await progress('Loading...', async () => {
                    await sleep(1000);
                    return "Done!";
                });
                await alert("Progress completed: " + result);
            });

            const progress2Btn = document.getElementById('progress-2');
            progress2Btn.addEventListener('click', async () => {
                const result = await progress('Loading...', async (update) => {
                    for (let i = 0; i <= 100; i += 10) {
                        await sleep(500);

                        if (i === 50) {
                            update({ percent: i, message: "Halfway there..." });
                        } else {
                            update({ percent: i });
                        }
                    }

                    return "Done!";
                });
                await alert("Progress completed: " + result);
            });

            const openFileBtn = document.getElementById('open-file');
            openFileBtn.addEventListener('click', async () => {
                const file = await openFile();
                alert("You selected: " + file?.name);
                console.log(file);
            });

            const openFilesBtn = document.getElementById('open-files');
            openFilesBtn.addEventListener('click', async () => {
                const files = await openFile({ multiple: true });
                console.log(files);
            });

            const openDirBtn = document.getElementById('open-directory');
            openDirBtn.addEventListener('click', async () => {
                const dir = await openFile({ directory: true });
                console.log(dir);
            });

            const downloadFileBtn = document.getElementById('download-file');
            downloadFileBtn.addEventListener('click', async () => {
                const file = await openFile();
                await saveFile(file, { defaultName: file.name });
            });

            const isReplBtn = document.getElementById('is-repl');
            isReplBtn.addEventListener('click', async () => {
                const yes = isREPL();

                if (yes) {
                    await alert("当前程序在 REPL 中");
                } else {
                    await alert("当前程序不在 REPL 中");
                }
            });
        }
    </script>
</head>

<body>
    <div class="button-list">
        <button id="alert">Alert</button>
        <button id="confirm">Confirm</button>
        <button id="prompt">Prompt</button>
        <button id="prompt-password">Prompt (Password)</button>
        <button id="prompt-default">Prompt (With defaults)</button>
        <button id="progress">Progress</button>
        <button id="progress-2">Progress (With percentage)</button>
        <button id="open-file">Open File</button>
        <button id="open-files">Open Files</button>
        <button id="open-directory">Open Directory</button>
        <button id="download-file">Download File</button>
        <button id="is-repl">Is REPL</button>
    </div>
</body>

</html>
