{"version":3,"file":"web.js","sources":["../../dialog/web.ts"],"sourcesContent":["/**\n * The implementation of `dialog` module for the browser.\n *\n * Normally, we should just use the `dialog` module, however, if we don't want\n * to include other parts that are not needed in the browser, we can use this\n * module instead.\n * @module\n */\nimport CancelButton, { getCancelText } from \"./web/CancelButton.ts\";\nimport Dialog, { closeDialog } from \"./web/Dialog.ts\";\nimport Footer from \"./web/Footer.ts\";\nimport Input from \"./web/Input.ts\";\nimport OkButton, { getOkText } from \"./web/OkButton.ts\";\nimport Progress from \"./web/Progress.ts\";\nimport Text from \"./web/Text.ts\";\nimport { isValid } from \"../object.ts\";\nexport * from \"./web/file.ts\";\nexport async function alert(message, options = {}) {\n    await new Promise(_resolve => {\n        const resolve = () => {\n            timer && clearTimeout(timer);\n            _resolve();\n        };\n        const button = OkButton();\n        const dialog = Dialog({\n            onCancel: () => resolve(),\n            onOk: () => resolve(),\n        }, Text(message), Footer(button));\n        let remains = (options === null || options === void 0 ? void 0 : options.timeout) ? Math.max(1, Math.round(options.timeout / 1000)) : 0;\n        const timer = remains\n            ? setInterval(() => {\n                button.textContent = `${getOkText()} (${--remains})`;\n                if (remains === 0) {\n                    closeDialog(dialog, \"OK\");\n                }\n            }, 1000)\n            : undefined;\n        if (remains) {\n            button.textContent = `${getOkText()} (${remains})`;\n        }\n        document.body.appendChild(dialog);\n    });\n}\nexport async function confirm(message, options = {}) {\n    return new Promise(_resolve => {\n        const resolve = (value) => {\n            timer && clearInterval(timer);\n            _resolve(value);\n        };\n        const cancelButton = CancelButton();\n        const dialog = Dialog({\n            onCancel: () => resolve(false),\n            onOk: () => resolve(true),\n        }, Text(message), Footer(cancelButton, OkButton()));\n        let remains = (options === null || options === void 0 ? void 0 : options.timeout) ? Math.max(1, Math.round(options.timeout / 1000)) : 0;\n        const timer = remains\n            ? setInterval(() => {\n                cancelButton.textContent = `${getCancelText()} (${--remains})`;\n                if (remains === 0) {\n                    closeDialog(dialog, \"Cancel\");\n                }\n            }, 1000)\n            : undefined;\n        if (remains) {\n            cancelButton.textContent = `${getCancelText()} (${remains})`;\n        }\n        document.body.appendChild(dialog);\n    });\n}\nexport async function prompt(message, options = {}) {\n    const { type, defaultValue } = options;\n    return new Promise(_resolve => {\n        const inputDiv = Input({ type, value: defaultValue });\n        const cancelButton = CancelButton();\n        const okButton = OkButton();\n        const dialog = Dialog({\n            onCancel: () => resolve(null),\n            onOk: (dialog) => {\n                const input = dialog.querySelector(\"input\");\n                resolve(input.value);\n            },\n        }, Text(message), inputDiv, Footer(cancelButton, okButton));\n        const hasDefaultValue = isValid(defaultValue); // in case of `null`\n        let remains = (options === null || options === void 0 ? void 0 : options.timeout) ? Math.max(1, Math.round(options.timeout / 1000)) : 0;\n        let timer = remains\n            ? setInterval(() => {\n                if (hasDefaultValue) {\n                    okButton.textContent = `${getOkText()} (${--remains})`;\n                    if (remains === 0) {\n                        closeDialog(dialog, \"OK\");\n                    }\n                }\n                else {\n                    cancelButton.textContent = `${getCancelText()} (${--remains})`;\n                    if (remains === 0) {\n                        closeDialog(dialog, \"Cancel\");\n                    }\n                }\n            }, 1000)\n            : undefined;\n        const resolve = (value) => {\n            timer && clearInterval(timer);\n            _resolve(value);\n        };\n        if (timer) {\n            const input = inputDiv.querySelector(\"input\");\n            input === null || input === void 0 ? void 0 : input.addEventListener(\"input\", () => {\n                clearInterval(timer);\n                timer = undefined;\n                if (hasDefaultValue) {\n                    okButton.textContent = getOkText();\n                }\n                else {\n                    cancelButton.textContent = getCancelText();\n                }\n            });\n        }\n        if (remains) {\n            if (hasDefaultValue) {\n                okButton.textContent = `${getOkText()} (${remains})`;\n            }\n            else {\n                cancelButton.textContent = `${getCancelText()} (${remains})`;\n            }\n        }\n        document.body.appendChild(dialog);\n    });\n}\nexport async function progress(message, fn, onAbort = undefined) {\n    const ctrl = new AbortController();\n    const signal = ctrl.signal;\n    let fallback = null;\n    const abort = !onAbort ? undefined : async () => {\n        try {\n            const result = await onAbort();\n            fallback = { value: result };\n            ctrl.abort();\n        }\n        catch (err) {\n            ctrl.abort(err);\n        }\n    };\n    const listenForAbort = !onAbort ? undefined : () => new Promise((resolve, reject) => {\n        signal.addEventListener(\"abort\", () => {\n            if (fallback) {\n                resolve(fallback.value);\n            }\n            else {\n                reject(signal.reason);\n            }\n        });\n    });\n    const text = Text(message);\n    const { element: progressBar, setValue } = Progress();\n    const dialog = Dialog({ onCancel: abort }, text);\n    const set = (state) => {\n        if (signal.aborted) {\n            return;\n        }\n        if (state.message) {\n            text.innerHTML = state.message.replace(/ /g, \"&nbsp;\").replace(/\\n/g, \"<br />\");\n        }\n        if (state.percent !== undefined) {\n            setValue(state.percent);\n        }\n    };\n    if (abort) {\n        dialog.appendChild(Footer(progressBar, CancelButton()));\n    }\n    else {\n        dialog.appendChild(progressBar);\n    }\n    document.body.appendChild(dialog);\n    let job = fn(set, signal);\n    if (listenForAbort) {\n        job = Promise.race([job, listenForAbort()]);\n    }\n    try {\n        return await job;\n    }\n    finally {\n        signal.aborted || closeDialog(dialog, \"OK\");\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":[],"mappings":"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"}