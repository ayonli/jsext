{"version":3,"file":"mac.js","sources":["../../../../dialog/terminal/file/mac.ts"],"sourcesContent":["import { lines } from \"../../../string.ts\";\nimport { run } from \"../util.ts\";\nimport { UTIMap } from \"../constants.ts\";\nfunction htmlAcceptToAppleType(accept) {\n    const entries = Object.entries(UTIMap);\n    return accept.split(/\\s*,\\s*/).map(type => {\n        const _type = type.toLowerCase();\n        for (const [uti, types] of entries) {\n            if (types.includes(_type)) {\n                return uti;\n            }\n        }\n        return type;\n    }).join(\",\");\n}\nfunction createAppleScript(mode, title = \"\", options = {}) {\n    const { type, save, defaultName } = options;\n    if (mode === \"file\") {\n        if (save) {\n            return \"tell application (path to frontmost application as text)\\n\" +\n                \"  set myFile to choose file name\" + (title ? ` with prompt \"${title}\"` : \"\") +\n                (defaultName ? ` default name \"${defaultName}\"` : \"\") +\n                \"\\n  POSIX path of myFile\\n\" +\n                \"end\";\n        }\n        else {\n            const _type = type ? htmlAcceptToAppleType(type) : \"\";\n            return \"tell application (path to frontmost application as text)\\n\" +\n                \"  set myFile to choose file\" + (title ? ` with prompt \"${title}\"` : \"\") +\n                (_type ? ` of type {${_type.split(/\\s*,\\s*/).map(s => `\"${s}\"`)}}` : \"\") +\n                \" invisibles false\" +\n                \"\\n  POSIX path of myFile\\n\" +\n                \"end\";\n        }\n    }\n    else if (mode === \"files\") {\n        const _type = type ? htmlAcceptToAppleType(type) : \"\";\n        return \"tell application (path to frontmost application as text)\\n\" +\n            \"  set myFiles to choose file\" + (title ? ` with prompt \"${title}\"` : \"\") +\n            (_type ? ` of type {${_type.split(/\\s*,\\s*/).map(s => `\"${s}\"`)}}` : \"\") +\n            \" invisibles false\" +\n            \" multiple selections allowed true\" +\n            \"\\n\" +\n            \"  set theList to {}\\n\" +\n            \"  repeat with aItem in myFiles\\n\" +\n            \"    set end of theList to POSIX path of aItem\\n\" +\n            \"  end repeat\\n\" +\n            `  set my text item delimiters to \"\\\\n\"\\n` +\n            `  return theList as text\\n` +\n            \"end\";\n    }\n    else {\n        return \"tell application (path to frontmost application as text)\\n\" +\n            \"  set myFolder to choose folder\" + (title ? ` with prompt \"${title}\"` : \"\") +\n            \" invisibles false\" +\n            \"\\n  POSIX path of myFolder\\n\" +\n            \"end\";\n    }\n}\nexport async function macPickFile(title = \"\", options = {}) {\n    const { code, stdout, stderr } = await run(\"osascript\", [\n        \"-e\",\n        createAppleScript(\"file\", title, options)\n    ]);\n    if (!code) {\n        const path = stdout.trim();\n        return path || null;\n    }\n    else {\n        if (stderr.includes(\"User canceled\")) {\n            return null;\n        }\n        else {\n            throw new Error(stderr.trim());\n        }\n    }\n}\nexport async function macPickFiles(title = \"\", type = \"\") {\n    const { code, stdout, stderr } = await run(\"osascript\", [\n        \"-e\",\n        createAppleScript(\"files\", title, { type })\n    ]);\n    if (!code) {\n        const output = stdout.trim();\n        return output ? lines(stdout.trim()) : [];\n    }\n    else {\n        if (stderr.includes(\"User canceled\")) {\n            return [];\n        }\n        else {\n            throw new Error(stderr.trim());\n        }\n    }\n}\nexport async function macPickFolder(title = \"\") {\n    const { code, stdout, stderr } = await run(\"osascript\", [\n        \"-e\",\n        createAppleScript(\"folder\", title)\n    ]);\n    if (!code) {\n        const dir = stdout.trim();\n        return dir || null;\n    }\n    else {\n        if (stderr.includes(\"User canceled\")) {\n            return null;\n        }\n        else {\n            throw new Error(stderr.trim());\n        }\n    }\n}\n//# sourceMappingURL=mac.js.map"],"names":[],"mappings":"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"}