{"version":3,"file":"windows.js","sources":["../../../../dialog/terminal/file/windows.ts"],"sourcesContent":["import { lines } from \"../../../string.ts\";\nimport { run } from \"../util.ts\";\nimport { UTIMap } from \"../constants.ts\";\nimport { extname } from \"../../../path.ts\";\nfunction htmlAcceptToFileFilter(accept) {\n    const list = Object.values(UTIMap);\n    return accept.split(/\\s*,\\s*/).map(type => {\n        const _type = type.toLowerCase();\n        for (const types of list) {\n            if (types.includes(_type)) {\n                return types.filter(t => t.startsWith(\".\")).map(t => `*${t}|*${t}`).join(\"|\");\n            }\n        }\n        return type;\n    }).join(\"|\");\n}\nfunction createPowerShellScript(mode, title = \"\", options = {}) {\n    const { type, forSave, defaultName } = options;\n    if (mode === \"file\") {\n        if (forSave) {\n            let filter = type ? htmlAcceptToFileFilter(type) : \"\";\n            if (!filter && defaultName) {\n                const ext = extname(defaultName);\n                ext && (filter = htmlAcceptToFileFilter(ext));\n            }\n            return `Add-Type -AssemblyName System.Windows.Forms` +\n                \"\\n\" +\n                \"$saveFileDialog = [System.Windows.Forms.SaveFileDialog]::new()\" +\n                \"\\n\" +\n                \"$saveFileDialog.Title = '\" + title + \"'\" +\n                \"\\n\" +\n                (defaultName ? \"$saveFileDialog.FileName = '\" + defaultName + \"'\\n\" : \"\") +\n                (filter ? \"$saveFileDialog.Filter = '\" + filter + \"'\\n\" : \"\") +\n                \"if ($saveFileDialog.ShowDialog() -eq 'OK') {\\n\" +\n                \"  $saveFileDialog.FileName\\n\" +\n                \"}\\n\";\n        }\n        else {\n            const filter = type ? htmlAcceptToFileFilter(type) : \"\";\n            return `Add-Type -AssemblyName System.Windows.Forms` +\n                \"\\n\" +\n                \"$openFileDialog = [System.Windows.Forms.OpenFileDialog]::new()\" +\n                \"\\n\" +\n                \"$openFileDialog.Title = '\" + title + \"'\" +\n                \"\\n\" +\n                (filter ? \"$openFileDialog.Filter = '\" + filter + \"'\\n\" : \"\") +\n                \"$openFileDialog.Multiselect = $false\" +\n                \"\\n\" +\n                \"$openFileDialog.ShowDialog() | Out-Null\" +\n                \"\\n\" +\n                \"$openFileDialog.FileName\";\n        }\n    }\n    else if (mode === \"files\") {\n        const filter = type ? htmlAcceptToFileFilter(type) : \"\";\n        return `Add-Type -AssemblyName System.Windows.Forms` +\n            \"\\n\" +\n            \"$openFileDialog = [System.Windows.Forms.OpenFileDialog]::new()\" +\n            \"\\n\" +\n            \"$openFileDialog.Title = '\" + title + \"'\" +\n            \"\\n\" +\n            (filter ? \"$openFileDialog.Filter = '\" + filter + \"'\\n\" : \"\") +\n            \"$openFileDialog.Multiselect = $true\" +\n            \"\\n\" +\n            \"$openFileDialog.ShowDialog() | Out-Null\" +\n            \"\\n\" +\n            \"$openFileDialog.FileNames -join \\\"`n\\\"\";\n    }\n    else {\n        return `Add-Type -AssemblyName System.Windows.Forms` +\n            \"\\n\" +\n            \"$folderBrowserDialog = [System.Windows.Forms.FolderBrowserDialog]::new()\" +\n            \"\\n\" +\n            \"$folderBrowserDialog.Description = '\" + title + \"'\" +\n            \"\\n\" +\n            \"$folderBrowserDialog.ShowDialog() | Out-Null\" +\n            \"\\n\" +\n            \"$folderBrowserDialog.SelectedPath\";\n    }\n}\nexport async function windowsPickFile(title = \"\", options = {}) {\n    const { code, stdout, stderr } = await run(\"powershell\", [\n        \"-c\",\n        createPowerShellScript(\"file\", title, options)\n    ]);\n    if (!code) {\n        const path = stdout.trim();\n        return path || null;\n    }\n    else {\n        throw new Error(stderr);\n    }\n}\nexport async function windowsPickFiles(title = \"\", type = \"\") {\n    const { code, stdout, stderr } = await run(\"powershell\", [\n        \"-c\",\n        createPowerShellScript(\"files\", title, { type })\n    ]);\n    if (!code) {\n        const output = stdout.trim();\n        return output ? lines(stdout.trim()) : [];\n    }\n    else {\n        throw new Error(stderr);\n    }\n}\nexport async function windowsPickFolder(title = \"\") {\n    const { code, stdout, stderr } = await run(\"powershell\", [\n        \"-c\",\n        createPowerShellScript(\"folder\", title)\n    ]);\n    if (!code) {\n        const dir = stdout.trim();\n        return dir || null;\n    }\n    else {\n        throw new Error(stderr);\n    }\n}\n//# sourceMappingURL=windows.js.map"],"names":[],"mappings":"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"}