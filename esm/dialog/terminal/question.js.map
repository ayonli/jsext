{"version":3,"file":"question.js","sources":["../../../dialog/terminal/question.ts"],"sourcesContent":["import bytes, { concat, equals } from \"../../bytes.ts\";\nimport { chars } from \"../../string.ts\";\nimport { BS, CLR_RIGHT, CR, DEL, DOWN, END, LEFT, LF, RIGHT, START, UP, } from \"./constants.ts\";\nimport { isCancelEvent, read, toLeft, toRight, write, } from \"./util.ts\";\nfunction getMasks(mask, length) {\n    return new Array(length).fill(mask).join(\"\");\n}\nexport default async function question(message, options) {\n    const { stdin, stdout, defaultValue = \"\", mask } = options;\n    const buf = [];\n    let cursor = 0;\n    await write(stdout, bytes(message));\n    if (defaultValue) {\n        const _chars = chars(defaultValue);\n        buf.push(..._chars);\n        cursor += _chars.length;\n        if (mask === undefined) {\n            await write(stdout, bytes(defaultValue));\n        }\n        else if (mask) {\n            await write(stdout, bytes(getMasks(mask, _chars.length)));\n        }\n    }\n    while (true) {\n        const input = await read(stdin);\n        if (!input.length || equals(input, UP) || equals(input, DOWN)) {\n            continue;\n        }\n        else if (equals(input, LEFT)) {\n            if (cursor > 0) {\n                const char = buf[--cursor];\n                if (mask === undefined) {\n                    await write(stdout, toLeft(char));\n                }\n                else if (mask) {\n                    await write(stdout, toLeft(mask));\n                }\n            }\n        }\n        else if (equals(input, RIGHT)) {\n            if (cursor < buf.length) {\n                const char = buf[cursor++];\n                if (mask === undefined) {\n                    await write(stdout, toRight(char));\n                }\n                else if (mask) {\n                    await write(stdout, toRight(mask));\n                }\n            }\n        }\n        else if (equals(input, START)) {\n            const left = buf.slice(0, cursor);\n            if (left.length) {\n                cursor = 0;\n                if (mask === undefined) {\n                    await write(stdout, toLeft(left.join(\"\")));\n                }\n                else if (mask) {\n                    await write(stdout, toLeft(getMasks(mask, left.length)));\n                }\n            }\n        }\n        else if (equals(input, END)) {\n            const right = buf.slice(cursor);\n            if (right.length) {\n                cursor = buf.length;\n                if (mask === undefined) {\n                    await write(stdout, toRight(right.join(\"\")));\n                }\n                else if (mask) {\n                    await write(stdout, toRight(getMasks(mask, right.length)));\n                }\n            }\n        }\n        else if (isCancelEvent(input)) {\n            await write(stdout, LF);\n            return null;\n        }\n        else if (equals(input, CR) || equals(input, LF)) {\n            await write(stdout, LF);\n            return buf.join(\"\");\n        }\n        else if (equals(input, BS) || equals(input, DEL)) {\n            if (cursor > 0) {\n                cursor--;\n                const [char] = buf.splice(cursor, 1);\n                const rest = buf.slice(cursor);\n                if (mask === undefined) {\n                    await write(stdout, toLeft(char));\n                    await write(stdout, CLR_RIGHT);\n                    if (rest.length) {\n                        const output = rest.join(\"\");\n                        await write(stdout, bytes(output));\n                        await write(stdout, toLeft(output));\n                    }\n                }\n                else if (mask) {\n                    await write(stdout, toLeft(mask));\n                    await write(stdout, CLR_RIGHT);\n                    if (rest.length) {\n                        const output = getMasks(mask, rest.length);\n                        await write(stdout, bytes(output));\n                        await write(stdout, toLeft(output));\n                    }\n                }\n            }\n        }\n        else {\n            const _chars = chars(String(input));\n            if (cursor === buf.length) {\n                buf.push(..._chars);\n                cursor += _chars.length;\n                if (mask === undefined) {\n                    await write(stdout, input);\n                }\n                else if (mask) {\n                    await write(stdout, bytes(getMasks(mask, _chars.length)));\n                }\n            }\n            else {\n                buf.splice(cursor, 0, ..._chars);\n                cursor += _chars.length;\n                if (mask === undefined) {\n                    const rest = buf.slice(cursor).join(\"\");\n                    await write(stdout, concat(input, bytes(rest)));\n                    await write(stdout, toLeft(rest));\n                }\n                else if (mask) {\n                    const output = getMasks(mask, _chars.length);\n                    const rest = getMasks(mask, buf.slice(cursor).length);\n                    await write(stdout, bytes(output + rest));\n                    await write(stdout, toLeft(rest));\n                }\n            }\n        }\n    }\n}\n//# sourceMappingURL=question.js.map"],"names":[],"mappings":"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"}