{"version":3,"file":"encoding.js","sources":["../encoding.ts"],"sourcesContent":["/**\n * Utilities for encoding and decoding binary representations like hex and\n * base64 strings.\n * @module\n */\nconst encoder = new TextEncoder();\nfunction asUint8Array(data) {\n    let bytes;\n    if (typeof data === \"string\") {\n        bytes = encoder.encode(data);\n    }\n    else if (!(data instanceof Uint8Array)) {\n        if (ArrayBuffer.isView(data)) {\n            bytes = new Uint8Array(data.buffer, data.byteOffset, data.byteLength);\n        }\n        else {\n            bytes = new Uint8Array(data);\n        }\n    }\n    else {\n        bytes = data;\n    }\n    return bytes;\n}\n/**\n * Encodes the given data to a hex string.\n *\n * @example\n * ```ts\n * import { encodeHex } from \"@ayonli/jsext/encoding\";\n *\n * const hex = encodeHex(\"Hello, World!\");\n * console.log(hex); // \"48656c6c6f2c20576f726c6421\"\n *\n * const hex2 = encodeHex(new Uint8Array([72, 101, 108, 108, 111, 44, 32, 87, 111, 114, 108, 100, 33]));\n * console.log(hex2); // \"48656c6c6f2c20576f726c6421\"\n * ```\n */\nexport function encodeHex(data) {\n    const bytes = asUint8Array(data);\n    if (typeof Buffer === \"function\" && bytes instanceof Buffer) {\n        return bytes.toString(\"hex\");\n    }\n    return bytes.reduce((str, byte) => {\n        return str + byte.toString(16).padStart(2, \"0\");\n    }, \"\");\n}\n/**\n * Decodes the given hex string to a byte array.\n *\n * @example\n * ```ts\n * import { decodeHex } from \"@ayonli/jsext/encoding\";\n *\n * const data = decodeHex(\"48656c6c6f2c20576f726c6421\");\n * console.log(data); // Uint8Array(13) [ 72, 101, 108, 108, 111, 44, 32, 87, 111, 114, 108, 100, 33 ]\n */\nexport function decodeHex(hex) {\n    const bytes = new Uint8Array(hex.length / 2);\n    for (let i = 0; i < hex.length; i += 2) {\n        bytes[i / 2] = parseInt(hex.slice(i, i + 2), 16);\n    }\n    return bytes;\n}\nconst base64Chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n/**\n * Encodes the given data to a base64 string.\n *\n * Unlike the built-in `btoa` function, this function is not limited to the\n * Latin1 range.\n *\n * @example\n * ```ts\n * import { encodeBase64 } from \"@ayonli/jsext/encoding\";\n *\n * const base64 = encodeBase64(\"Hello, World!\");\n * console.log(base64); // \"SGVsbG8sIFdvcmxkIQ==\"\n *\n * const base64_2 = encodeBase64(\"你好，世界！\");\n * console.log(base64_2); // \"5L2g5aW977yM5LiW55WM77yB\"\n * ```\n */\nexport function encodeBase64(data) {\n    const bytes = asUint8Array(data);\n    if (typeof Buffer === \"function\" && bytes instanceof Buffer) {\n        return bytes.toString(\"base64\");\n    }\n    let result = \"\";\n    let i;\n    const l = bytes.length;\n    for (i = 2; i < l; i += 3) {\n        result += base64Chars[(bytes[i - 2]) >> 2];\n        result += base64Chars[(((bytes[i - 2]) & 0x03) << 4) |\n            ((bytes[i - 1]) >> 4)];\n        result += base64Chars[(((bytes[i - 1]) & 0x0f) << 2) |\n            ((bytes[i]) >> 6)];\n        result += base64Chars[(bytes[i]) & 0x3f];\n    }\n    if (i === l + 1) {\n        // 1 octet yet to write\n        result += base64Chars[(bytes[i - 2]) >> 2];\n        result += base64Chars[((bytes[i - 2]) & 0x03) << 4];\n        result += \"==\";\n    }\n    if (i === l) {\n        // 2 octets yet to write\n        result += base64Chars[(bytes[i - 2]) >> 2];\n        result += base64Chars[(((bytes[i - 2]) & 0x03) << 4) |\n            ((bytes[i - 1]) >> 4)];\n        result += base64Chars[((bytes[i - 1]) & 0x0f) << 2];\n        result += \"=\";\n    }\n    return result;\n}\n/**\n * Decodes the given base64 string to a byte array.\n *\n * Unlike the built-in `atob` function, this function is not limited to the\n * Latin1 range.\n *\n * @example\n * ```ts\n * import { decodeBase64 } from \"@ayonli/jsext/encoding\";\n *\n * const data = decodeBase64(\"SGVsbG8sIFdvcmxkIQ==\");\n * console.log(new TextDecoder().decode(data)); // \"Hello, World!\"\n *\n * const data2 = decodeBase64(\"5L2g5aW977yM5LiW55WM77yB\");\n * console.log(new TextDecoder().decode(data2)); // \"你好，世界！\"\n * ```\n */\nexport function decodeBase64(base64) {\n    if (typeof Buffer === \"function\" && typeof Buffer.from === \"function\") {\n        const buf = Buffer.from(base64, \"base64\");\n        const buffer = buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.byteLength);\n        return new Uint8Array(buffer);\n    }\n    const binString = atob(base64);\n    const size = binString.length;\n    const bytes = new Uint8Array(size);\n    for (let i = 0; i < size; i++) {\n        bytes[i] = binString.charCodeAt(i);\n    }\n    return bytes;\n}\n//# sourceMappingURL=encoding.js.map"],"names":[],"mappings":"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"}