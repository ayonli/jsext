{"version":3,"file":"runtime.js","sources":["../runtime.ts"],"sourcesContent":["/**\n * Utility functions to retrieve runtime information or modify runtime behaviors.\n * @module\n */\nimport { isBrowser, isBun, isDeno, isNode } from \"./env.ts\";\n/**\n * A universal symbol that can be used to customize the inspection behavior of\n * an object, supports Node.js, Bun, Deno and any runtime that has\n * Node.js-compatible `util.inspect` function.\n */\nexport const customInspect = (() => {\n    if (isBrowser) {\n        return Symbol.for(\"Symbol.customInspect\");\n    }\n    else if (isDeno) {\n        return Symbol.for(\"Deno.customInspect\");\n    }\n    else {\n        return Symbol.for(\"nodejs.util.inspect.custom\");\n    }\n})();\nexport function env(name = undefined, value = undefined) {\n    var _a;\n    if (typeof Deno === \"object\") {\n        if (name === undefined) {\n            return Deno.env.toObject();\n        }\n        else if (value === undefined) {\n            return Deno.env.get(name);\n        }\n        else {\n            Deno.env.set(name, String(value));\n        }\n    }\n    else if (typeof process === \"object\" && typeof process.env === \"object\") {\n        if (name === undefined) {\n            return process.env;\n        }\n        else if (value === undefined) {\n            return process.env[name];\n        }\n        else {\n            process.env[name] = String(value);\n        }\n    }\n    else {\n        // @ts-ignore\n        const env = globalThis[\"__env__\"];\n        // @ts-ignore\n        if (env === undefined || env === null || typeof env === \"object\") {\n            if (name === undefined) {\n                return env !== null && env !== void 0 ? env : {};\n            }\n            else if (value === undefined) {\n                return (env === null || env === void 0 ? void 0 : env[name]) ? String(env[name]) : undefined;\n            }\n            else {\n                // @ts-ignore\n                ((_a = globalThis[\"__env__\"]) !== null && _a !== void 0 ? _a : (globalThis[\"__env__\"] = {}))[name] = String(value);\n            }\n        }\n        else {\n            throw new Error(\"Unsupported runtime\");\n        }\n    }\n}\nexport const CommonRuntimes = [\n    \"node\",\n    \"deno\",\n    \"bun\",\n    \"chromium\",\n    \"firefox\",\n    \"safari\",\n];\n/**\n * Returns the information of the runtime environment in which the program is\n * running.\n */\nexport default function runtime() {\n    var _a;\n    if (isDeno) {\n        return {\n            identity: \"deno\",\n            version: Deno.version.deno,\n            tsSupport: true,\n        };\n    }\n    else if (isBun) {\n        return {\n            identity: \"bun\",\n            version: Bun.version,\n            tsSupport: true,\n        };\n    }\n    else if (isNode) {\n        return {\n            identity: \"node\",\n            version: process.version.slice(1),\n            tsSupport: process.execArgv.some(arg => /\\b(tsx|ts-node|vite|swc-node|tsimp)\\b/.test(arg))\n                || /\\.tsx?$|\\bvite\\b/.test((_a = process.argv[1]) !== null && _a !== void 0 ? _a : \"\")\n        };\n    }\n    else if (isBrowser) {\n        const ua = navigator.userAgent.match(/(Firefox|Edg?e|Safari|Chrom(e|ium))\\/(\\d+(\\.\\d+)+)/g);\n        if (ua) {\n            const list = ua.map(part => {\n                const [name, version] = part.split(\"/\");\n                return { name, version };\n            });\n            const safari = list.find(({ name }) => name === \"Safari\");\n            const firefox = list.find(({ name }) => name === \"Firefox\");\n            const chrome = list.find(({ name }) => name === \"Chrome\" || name === \"Chromium\");\n            if (safari && !chrome && !firefox) {\n                return {\n                    identity: \"safari\",\n                    version: safari.version,\n                    tsSupport: false,\n                };\n            }\n            else if (firefox && !chrome && !safari) {\n                return {\n                    identity: \"firefox\",\n                    version: firefox.version,\n                    tsSupport: false,\n                };\n            }\n            else if (chrome) {\n                return {\n                    identity: \"chromium\",\n                    version: chrome.version,\n                    tsSupport: false,\n                };\n            }\n        }\n    }\n    return { identity: \"others\", version: undefined, tsSupport: false };\n}\n/**\n * Detects if the program is running in a REPL environment.\n *\n * NOTE: This function currently returns `true` when in:\n * - Node.js REPL\n * - Deno REPL\n * - Bun REPL\n * - Google Chrome Console\n */\nexport function isREPL() {\n    return (\"_\" in globalThis && \"_error\" in globalThis)\n        || (\"$0\" in globalThis && \"$1\" in globalThis)\n        || (typeof $0 === \"object\" || typeof $1 === \"object\");\n}\n/**\n * Make the timer block the event loop from finishing again after it has been\n * unrefed.\n *\n * Only available in Node.js/Bun and Deno, in the browser, this function is a\n * no-op.\n */\nexport function refTimer(timer) {\n    if (typeof timer === \"object\" && typeof timer.ref === \"function\") {\n        timer.ref();\n    }\n    else if (typeof timer === \"number\"\n        && typeof Deno === \"object\"\n        && typeof Deno.refTimer === \"function\") {\n        Deno.refTimer(timer);\n    }\n}\n/**\n * Make the timer not block the event loop from finishing.\n *\n * Only available in Node.js/Bun and Deno, in the browser, this function is a\n * no-op.\n */\nexport function unrefTimer(timer) {\n    if (typeof timer === \"object\" && typeof timer.unref === \"function\") {\n        timer.unref();\n    }\n    else if (typeof timer === \"number\"\n        && typeof Deno === \"object\"\n        && typeof Deno.unrefTimer === \"function\") {\n        Deno.unrefTimer(timer);\n    }\n}\n//# sourceMappingURL=runtime.js.map"],"names":[],"mappings":"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"}