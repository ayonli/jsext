{"version":3,"file":"result.js","sources":["../result.ts"],"sourcesContent":["import { getReadonly, setReadonly } from \"./class/util.ts\";\nimport wrap from \"./wrap.ts\";\n/**\n * Represents the result of an operation that may succeed or fail.\n *\n * @example\n * ```ts\n * import { Result, Ok, Err } from \"@ayonli/jsext/result\";\n *\n * function divide(a: number, b: number): Result<number, RangeError> {\n *     if (b === 0) {\n *         return Err(new RangeError(\"division by zero\"));\n *     }\n *\n *     return Ok(a / b);\n * }\n *\n * const result = divide(10, 0);\n * if (result.ok) {\n *     console.log(result.value);\n * } else {\n *     console.error(result.error); // RangeError: division by zero\n * }\n *\n * // provide a fallback value if failed\n * const value = result.catch(() => 0);\n * console.log(value); // 0\n *\n * // make the result optional\n * const value2 = result.optional();\n * console.log(value2); // undefined\n *\n * // propagate the error and wrap it into a Result object\n * function divAndSub(a: number, b: number): Result<number, RangeError> {\n *     return Result.wrap(() => {\n *         const value = divide(a, b).value; // This throws if b is 0, but\n *                                           // it will be caught and wrapped.\n *         return Ok(value - b);\n *     });\n * }\n *\n * // use `wrap` as a decorator\n * class Calculator {\n *     \\@Result.wrap()\n *     divAndSub(a: number, b: number): Result<number, RangeError> {\n *         const value = divide(a, b).value; // This throws if b is 0, but\n *                                           // it will be caught and wrapped.\n *         return Ok(value - b);\n *     }\n * }\n * ```\n */\nexport class Result {\n    constructor(result) {\n        if (result.ok) {\n            setReadonly(this, \"ok\", true);\n            setReadonly(this, \"value\", result.value);\n        }\n        else {\n            setReadonly(this, \"ok\", false);\n            setReadonly(this, \"error\", result.error);\n        }\n    }\n    /**\n     * Whether the result is successful.\n     */\n    get ok() {\n        return getReadonly(this, \"ok\");\n    }\n    /**\n     * The value of the result if `ok` is `true`, otherwise throws the error if\n     * `ok` is `false`, allowing the error to propagate.\n     */\n    get value() {\n        if (!this.ok) {\n            throw this.error;\n        }\n        return getReadonly(this, \"value\");\n    }\n    /**\n     * The error of the result if `ok` is `false`, otherwise it is `undefined`.\n     */\n    get error() {\n        return getReadonly(this, \"error\");\n    }\n    /**\n     * Handles the result if failed, logs the error or provides a fallback value.\n     */\n    catch(fn) {\n        return this.ok ? this.value : fn(this.error);\n    }\n    /**\n     * Returns the value if the result is successful, otherwise returns\n     * `undefined`.\n     */\n    optional() {\n        return this.ok ? this.value : undefined;\n    }\n    /**\n     * Constructs a successful result.\n     */\n    static ok(value) {\n        return new Result({ ok: true, value });\n    }\n    /**\n     * Constructs a failed result.\n     */\n    static err(error) {\n        return new Result({ ok: false, error });\n    }\n    static wrap(fn = undefined) {\n        if (typeof fn === \"function\") {\n            try {\n                const res = fn();\n                if (typeof (res === null || res === void 0 ? void 0 : res.then) === \"function\") {\n                    return Promise.resolve(res)\n                        .then(value => value instanceof Result ? value : this.ok(value))\n                        .catch(error => this.err(error));\n                }\n                else {\n                    return res instanceof Result ? res : this.ok(res);\n                }\n            }\n            catch (error) {\n                return this.err(error);\n            }\n        }\n        else { // as a decorator\n            const _Result = this;\n            return (...args) => {\n                if (typeof args[1] === \"object\") { // new ES decorator since TypeScript 5.0\n                    const [fn] = args;\n                    return wrap(fn, function (fn, ...args) {\n                        return _Result.wrap(() => fn.call(this, ...args));\n                    });\n                }\n                else {\n                    const [_ins, _prop, desc] = args;\n                    desc.value = wrap(desc.value, function (fn, ...args) {\n                        return _Result.wrap(() => fn.call(this, ...args));\n                    });\n                    return;\n                }\n            };\n        }\n    }\n}\n/**\n * A shorthand for `Result.ok`.\n */\nexport const Ok = Result.ok;\n/**\n * A shorthand for `Result.err`.\n */\nexport const Err = Result.err;\n//# sourceMappingURL=result.js.map"],"names":[],"mappings":"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"}