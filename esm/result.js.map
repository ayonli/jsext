{"version":3,"file":"result.js","sources":["../result.ts"],"sourcesContent":["import wrap from \"./wrap.ts\";\nexport var Result = function Result(result) {\n    if (!new.target) {\n        return new Result(result);\n    }\n    const ins = this;\n    ins.ok = result.ok;\n    if (result.ok) {\n        ins.value = result.value;\n    }\n    else {\n        ins.error = result.error;\n    }\n};\nResult.prototype.unwrap = function () {\n    if (this.ok) {\n        return this.value;\n    }\n    else {\n        throw this.error;\n    }\n};\nResult.prototype.catch = function (fn) {\n    if (this.ok) {\n        return this.value;\n    }\n    else {\n        return fn(this.error);\n    }\n};\nResult.prototype.optional = function () {\n    if (this.ok) {\n        return this.value;\n    }\n    else {\n        return undefined;\n    }\n};\nResult.wrap = function (fn = undefined) {\n    if (typeof fn === \"function\") {\n        try {\n            const res = fn();\n            if (typeof (res === null || res === void 0 ? void 0 : res.then) === \"function\") {\n                return Promise.resolve(res)\n                    .then(value => value instanceof Result ? value : Ok(value))\n                    .catch(error => Err(error));\n            }\n            else {\n                return res instanceof Result ? res : Ok(res);\n            }\n        }\n        catch (error) {\n            return Err(error);\n        }\n    }\n    else { // as a decorator\n        return (...args) => {\n            if (typeof args[1] === \"object\") { // new ES decorator since TypeScript 5.0\n                const [fn] = args;\n                return wrap(fn, function (fn, ...args) {\n                    return Result.wrap(() => fn.call(this, ...args));\n                });\n            }\n            else {\n                const [_ins, _prop, desc] = args;\n                desc.value = wrap(desc.value, function (fn, ...args) {\n                    return Result.wrap(() => fn.call(this, ...args));\n                });\n                return;\n            }\n        };\n    }\n};\n/**\n * Constructs a successful result with the given value.\n */\nexport const Ok = (value) => new Result({ ok: true, value });\n/**\n * Constructs a failed result with the given error.\n */\nexport const Err = (error) => new Result({ ok: false, error });\n//# sourceMappingURL=result.js.map"],"names":[],"mappings":"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"}