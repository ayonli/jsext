{"version":3,"file":"jsext.js","sources":["../external/event-target-polyfill/index.ts","../array/base.ts","../encoding.ts","../math.ts","../bytes.ts","../string/constants.ts","../string.ts","../number.ts","../augment/string.ts","../class.ts","../augment/number.ts","../array.ts","../object.ts","../augment/array.ts","../augment/uint8array.ts","../env.ts","../augment/object.ts","../augment/math.ts","../event.ts","../http/user-agent.ts","../runtime.ts","../error/Exception.ts","../async.ts","../augment/promise.ts","../collections/BiMap.ts","../collections/CiMap.ts","../error.ts","../augment/collections.ts","../augment/error.ts","../json.ts","../augment/json.ts","../pipe.ts","../augment/pipe.ts","../types.ts","../external/check-iterable/index.mjs","../augment/types.ts","../augment.ts","../external/thenable-generator/index.ts","../try.ts","../wrap.ts","../mixin.ts","../throttle.ts","../debounce.ts","../chan.ts","../queue.ts","../lock.ts","../path/util.ts","../path.ts","../filetype/constants.ts","../filetype.ts","../fs/util.ts","../fs/util/server.ts","../reader/util.ts","../reader.ts","../fs/web.ts","../fs.ts","../module/util.ts","../module/web.ts","../module.ts","../parallel/module.ts","../parallel/channel.ts","../parallel/threads.ts","../parallel.ts","../run.ts","../deprecate.ts","../index.ts","../func.ts","../archive/Tarball.ts","../cli/constants.ts","../archive/tar.ts","../archive/untar.ts","../external/code-point-utils/index.ts","../cli/common.ts","../cli.ts","../dialog.ts","../dialog/file.ts","../dialog/progress.ts","../hash/util.ts","../hash/web.ts","../hash.ts","../sse.ts","../class/util.ts","../http/server.ts","../http/internal.ts","../http/cookie.ts","../http/util.ts","../ws/base.ts","../ws/client.ts","../ws.ts","../http.ts","../net.ts","../result.ts","../bundle.ts","../dialog/web/util.ts","../dialog/web/Dialog.ts","../dialog/web/CancelButton.ts","../dialog/web/Footer.ts","../dialog/web/Input.ts","../dialog/web/OkButton.ts","../dialog/web/Progress.ts","../dialog/web/Text.ts","../dialog/web/file.ts","../dialog/web.ts","../dialog/cli/progress.ts","../dialog/cli/file/linux.ts","../dialog/cli/util.ts","../dialog/cli/file/mac.ts","../dialog/cli/file/windows.ts","../dialog/cli/file.ts","../dialog/cli/question.ts","../dialog/cli/alert.ts","../dialog/cli/confirm.ts","../dialog/cli/prompt.ts"],"sourcesContent":["\"use strict\";\nvar _a;\nif (typeof globalThis.Event !== \"function\") {\n    // @ts-ignore\n    globalThis.Event = (_a = class Event {\n            constructor(type, eventInitDict = {}) {\n                this.type = type;\n                this.eventInitDict = eventInitDict;\n                this.bubbles = false;\n                this.cancelable = false;\n                this.cancelBubble = false;\n                this.composed = false;\n                this.currentTarget = null;\n                this.defaultPrevented = false;\n                this.eventPhase = _a.NONE;\n                this.isTrusted = false;\n                this.returnValue = true;\n                this.target = null;\n                this.timeStamp = Date.now();\n                this.srcElement = null;\n                this.AT_TARGET = 2;\n                this.BUBBLING_PHASE = 3;\n                this.CAPTURING_PHASE = 1;\n                this.NONE = 0;\n                if (eventInitDict.bubbles !== undefined) {\n                    this.bubbles = eventInitDict.bubbles;\n                }\n                if (eventInitDict.cancelable !== undefined) {\n                    this.cancelable = eventInitDict.cancelable;\n                }\n                if (eventInitDict.composed !== undefined) {\n                    this.composed = eventInitDict.composed;\n                }\n            }\n            composedPath() {\n                return [];\n            }\n            preventDefault() {\n                if (this.cancelable) {\n                    this.defaultPrevented = true;\n                }\n            }\n            stopImmediatePropagation() {\n                // Do nothing\n            }\n            stopPropagation() {\n                this.cancelBubble = true;\n            }\n            initEvent(type, bubbles = undefined, cancelable = undefined) {\n                this.type = type;\n                this.bubbles = bubbles !== null && bubbles !== void 0 ? bubbles : false;\n                this.cancelable = cancelable !== null && cancelable !== void 0 ? cancelable : false;\n            }\n        },\n        _a.AT_TARGET = 2,\n        _a.BUBBLING_PHASE = 3,\n        _a.CAPTURING_PHASE = 1,\n        _a.NONE = 0,\n        _a);\n}\nif (typeof globalThis.EventTarget !== \"function\") {\n    // @ts-ignore\n    globalThis.EventTarget = class EventTarget {\n        constructor() {\n            this.listeners = {};\n        }\n        addEventListener(type, callback, options = {}) {\n            var _b;\n            if (!(type in this.listeners)) {\n                this.listeners[type] = [];\n            }\n            // @ts-ignore\n            this.listeners[type].push({ callback, once: (_b = options === null || options === void 0 ? void 0 : options.once) !== null && _b !== void 0 ? _b : false });\n        }\n        removeEventListener(type, callback) {\n            if (!(type in this.listeners)) {\n                return;\n            }\n            const stack = this.listeners[type];\n            for (let i = 0, l = stack.length; i < l; i++) {\n                if (stack[i].callback === callback) {\n                    stack.splice(i, 1);\n                    return;\n                }\n            }\n            if (stack.length === 0) {\n                delete this.listeners[type];\n            }\n        }\n        dispatchEvent(event) {\n            if (!(event.type in this.listeners)) {\n                return true;\n            }\n            Object.defineProperties(event, {\n                currentTarget: { configurable: true, value: this },\n                target: { configurable: true, value: this },\n            });\n            const stack = this.listeners[event.type].slice();\n            for (let i = 0, l = stack.length; i < l; i++) {\n                const listener = stack[i];\n                try {\n                    listener.callback.call(this, event);\n                }\n                catch (err) {\n                    setTimeout(() => {\n                        throw err;\n                    });\n                }\n                if (listener.once) {\n                    this.removeEventListener(event.type, listener.callback);\n                }\n            }\n            return !event.defaultPrevented;\n        }\n    };\n}\n//# sourceMappingURL=index.js.map","/** Counts the occurrence of the element in the array-like object. */\nexport function count(arr, item) {\n    let count = 0;\n    for (let i = 0; i < arr.length; i++) {\n        if (arr[i] === item) {\n            count++;\n        }\n    }\n    return count;\n}\n/**\n * Performs a shallow compare to another array and see if it contains the same elements as\n * this array-like object.\n */\nexport function equals(arr1, arr2) {\n    if (arr1 === arr2) {\n        return true;\n    }\n    else if (arr1.length !== arr2.length) {\n        return false;\n    }\n    for (let i = 0; i < arr1.length; i++) {\n        if (arr1[i] !== arr2[i]) {\n            return false;\n        }\n    }\n    return true;\n}\n/** Checks if the array-like object contains another array as a slice of its contents. */\nexport function includeSlice(arr, slice) {\n    if (arr === slice || !slice.length) {\n        return true;\n    }\n    const limit = arr.length;\n    const subLimit = slice.length;\n    if (subLimit > limit) {\n        return false;\n    }\n    for (let i = 0; i < limit; i++) {\n        if (arr[i] === slice[0]) {\n            let j = 1;\n            while (j < subLimit && arr[i + j] === slice[j]) {\n                j++;\n            }\n            if (j === subLimit) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n/** Checks if the array-like object starts with the given prefix. */\nexport function startsWith(arr, prefix) {\n    if (arr === prefix || !prefix.length) {\n        return true;\n    }\n    const limit = arr.length;\n    const preLimit = prefix.length;\n    if (preLimit > limit) {\n        return false;\n    }\n    for (let i = 0; i < preLimit; i++) {\n        if (arr[i] !== prefix[i]) {\n            return false;\n        }\n    }\n    return true;\n}\n/** Checks if the array-like object ends with the given suffix. */\nexport function endsWith(arr, suffix) {\n    if (arr === suffix || !suffix.length) {\n        return true;\n    }\n    const limit = arr.length;\n    const sufLimit = suffix.length;\n    const offset = limit - sufLimit;\n    if (offset < 0) {\n        return false;\n    }\n    for (let i = 0; i < sufLimit; i++) {\n        if (arr[offset + i] !== suffix[i]) {\n            return false;\n        }\n    }\n    return true;\n}\n/** Breaks the array-like object into smaller chunks according to the given delimiter. */\nexport function split(arr, delimiter) {\n    const chunks = [];\n    const limit = arr.length;\n    let offset = 0;\n    for (let i = 0; i < limit; i++) {\n        if (arr[i] === delimiter) {\n            chunks.push(arr.slice(offset, i));\n            offset = i + 1;\n        }\n    }\n    if (offset < limit) {\n        chunks.push(arr.slice(offset, limit));\n    }\n    else if (offset === limit) {\n        const ctor = arr.constructor;\n        if (typeof ctor.from === \"function\") {\n            chunks.push(ctor.from([]));\n        }\n        else {\n            chunks.push(new ctor([]));\n        }\n    }\n    return chunks;\n}\n/** Breaks the array-like object into smaller chunks according to the given length. */\nexport function chunk(arr, length) {\n    const limit = arr.length;\n    const size = Math.ceil(limit / length);\n    const chunks = new Array(size);\n    let offset = 0;\n    let idx = 0;\n    while (offset < limit) {\n        chunks[idx] = arr.slice(offset, offset + length);\n        offset += length;\n        idx++;\n    }\n    return chunks;\n}\n//# sourceMappingURL=base.js.map","/**\n * Utilities for encoding and decoding binary representations like hex and\n * base64 strings.\n * @module\n */\nconst encoder = new TextEncoder();\nfunction asUint8Array(data) {\n    let bytes;\n    if (typeof data === \"string\") {\n        bytes = encoder.encode(data);\n    }\n    else if (!(data instanceof Uint8Array)) {\n        if (ArrayBuffer.isView(data)) {\n            bytes = new Uint8Array(data.buffer, data.byteOffset, data.byteLength);\n        }\n        else {\n            bytes = new Uint8Array(data);\n        }\n    }\n    else {\n        bytes = data;\n    }\n    return bytes;\n}\n/**\n * Encodes the given data to a hex string.\n *\n * @example\n * ```ts\n * import { encodeHex } from \"@ayonli/jsext/encoding\";\n *\n * const hex = encodeHex(\"Hello, World!\");\n * console.log(hex); // \"48656c6c6f2c20576f726c6421\"\n *\n * const hex2 = encodeHex(new Uint8Array([72, 101, 108, 108, 111, 44, 32, 87, 111, 114, 108, 100, 33]));\n * console.log(hex2); // \"48656c6c6f2c20576f726c6421\"\n * ```\n */\nexport function encodeHex(data) {\n    const bytes = asUint8Array(data);\n    if (typeof Buffer === \"function\" && bytes instanceof Buffer) {\n        return bytes.toString(\"hex\");\n    }\n    return bytes.reduce((str, byte) => {\n        return str + byte.toString(16).padStart(2, \"0\");\n    }, \"\");\n}\n/**\n * Decodes the given hex string to a byte array.\n *\n * @example\n * ```ts\n * import { decodeHex } from \"@ayonli/jsext/encoding\";\n *\n * const data = decodeHex(\"48656c6c6f2c20576f726c6421\");\n * console.log(data); // Uint8Array(13) [ 72, 101, 108, 108, 111, 44, 32, 87, 111, 114, 108, 100, 33 ]\n */\nexport function decodeHex(hex) {\n    const bytes = new Uint8Array(hex.length / 2);\n    for (let i = 0; i < hex.length; i += 2) {\n        bytes[i / 2] = parseInt(hex.slice(i, i + 2), 16);\n    }\n    return bytes;\n}\nconst base64Chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n/**\n * Encodes the given data to a base64 string.\n *\n * Unlike the built-in `btoa` function, this function is not limited to the\n * Latin1 range.\n *\n * @example\n * ```ts\n * import { encodeBase64 } from \"@ayonli/jsext/encoding\";\n *\n * const base64 = encodeBase64(\"Hello, World!\");\n * console.log(base64); // \"SGVsbG8sIFdvcmxkIQ==\"\n *\n * const base64_2 = encodeBase64(\"你好，世界！\");\n * console.log(base64_2); // \"5L2g5aW977yM5LiW55WM77yB\"\n * ```\n */\nexport function encodeBase64(data) {\n    const bytes = asUint8Array(data);\n    if (typeof Buffer === \"function\" && bytes instanceof Buffer) {\n        return bytes.toString(\"base64\");\n    }\n    let result = \"\";\n    let i;\n    const l = bytes.length;\n    for (i = 2; i < l; i += 3) {\n        result += base64Chars[(bytes[i - 2]) >> 2];\n        result += base64Chars[(((bytes[i - 2]) & 0x03) << 4) |\n            ((bytes[i - 1]) >> 4)];\n        result += base64Chars[(((bytes[i - 1]) & 0x0f) << 2) |\n            ((bytes[i]) >> 6)];\n        result += base64Chars[(bytes[i]) & 0x3f];\n    }\n    if (i === l + 1) {\n        // 1 octet yet to write\n        result += base64Chars[(bytes[i - 2]) >> 2];\n        result += base64Chars[((bytes[i - 2]) & 0x03) << 4];\n        result += \"==\";\n    }\n    if (i === l) {\n        // 2 octets yet to write\n        result += base64Chars[(bytes[i - 2]) >> 2];\n        result += base64Chars[(((bytes[i - 2]) & 0x03) << 4) |\n            ((bytes[i - 1]) >> 4)];\n        result += base64Chars[((bytes[i - 1]) & 0x0f) << 2];\n        result += \"=\";\n    }\n    return result;\n}\n/**\n * Decodes the given base64 string to a byte array.\n *\n * Unlike the built-in `atob` function, this function is not limited to the\n * Latin1 range.\n *\n * @example\n * ```ts\n * import { decodeBase64 } from \"@ayonli/jsext/encoding\";\n *\n * const data = decodeBase64(\"SGVsbG8sIFdvcmxkIQ==\");\n * console.log(new TextDecoder().decode(data)); // \"Hello, World!\"\n *\n * const data2 = decodeBase64(\"5L2g5aW977yM5LiW55WM77yB\");\n * console.log(new TextDecoder().decode(data2)); // \"你好，世界！\"\n * ```\n */\nexport function decodeBase64(base64) {\n    if (typeof Buffer === \"function\" && typeof Buffer.from === \"function\") {\n        const buf = Buffer.from(base64, \"base64\");\n        const buffer = buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.byteLength);\n        return new Uint8Array(buffer);\n    }\n    const binString = atob(base64);\n    const size = binString.length;\n    const bytes = new Uint8Array(size);\n    for (let i = 0; i < size; i++) {\n        bytes[i] = binString.charCodeAt(i);\n    }\n    return bytes;\n}\n//# sourceMappingURL=encoding.js.map","/**\n * Functions for mathematical calculations.\n * @module\n */\n/**\n * Returns the sum value of the given values.\n *\n * @example\n * ```ts\n * import { sum } from \"@ayonli/jsext/math\";\n *\n * console.log(sum(1, 2, 3)); // 6\n * console.log(sum(1, 2, 3, 4, 5)); // 15\n * ```\n */\nexport function sum(...values) {\n    return values.reduce((sum, value) => sum + value, 0);\n}\n;\n/**\n * Returns the average value of the given values.\n *\n * @example\n * ```ts\n * import { avg } from \"@ayonli/jsext/math\";\n *\n * console.log(avg(1, 2, 3)); // 2\n * console.log(avg(1, 2, 3, 4, 5)); // 3\n * ```\n */\nexport function avg(...values) {\n    return sum(...values) / values.length;\n}\n;\n/**\n * Returns a the product value multiplied by the given values.\n *\n * @example\n * ```ts\n * import { product } from \"@ayonli/jsext/math\";\n *\n * console.log(product(1, 2, 3)); // 6\n * console.log(product(1, 2, 3, 4, 5)); // 120\n * ```\n */\nexport function product(...values) {\n    var _a;\n    return values.slice(1).reduce((sum, value) => sum * value, (_a = values[0]) !== null && _a !== void 0 ? _a : 0);\n}\n;\nconst _round = Math.round;\n/**\n * Returns the rounded value of the given number.\n *\n * @example\n * ```ts\n * import { round } from \"@ayonli/jsext/math\";\n *\n * console.log(round(1.2345)); // 1\n * console.log(round(1.2345, 2)); // 1.23\n * console.log(round(1.2345, 3)); // 1.235\n * ```\n */\nexport function round(value, precision = 0) {\n    if (precision > 0) {\n        const factor = 10 ** precision;\n        return _round(value * factor) / factor;\n    }\n    else {\n        return _round(value);\n    }\n}\n//# sourceMappingURL=math.js.map","/**\n * Functions for dealing with byte arrays (`Uint8Array`).\n * @module\n */\nimport { equals as _equals, includeSlice as _includesSlice, startsWith as _startsWith, endsWith as _endsWith, split as _split, chunk as _chunk, } from \"./array/base.ts\";\nimport { decodeBase64, decodeHex, encodeBase64, encodeHex } from \"./encoding.ts\";\nimport { sum } from \"./math.ts\";\nconst defaultEncoder = new TextEncoder();\nconst defaultDecoder = new TextDecoder();\n/**\n * A byte array is a `Uint8Array` that can be coerced to a string with `utf8`\n * encoding.\n */\nexport class ByteArray extends Uint8Array {\n    toString() {\n        return text(this);\n    }\n    toJSON() {\n        return {\n            type: \"ByteArray\",\n            data: Array.from(this),\n        };\n    }\n}\nexport default function bytes(data, encoding = \"utf8\") {\n    if (typeof data === \"number\") {\n        return new ByteArray(data);\n    }\n    else if (typeof data === \"string\") {\n        let _data;\n        if (encoding === \"hex\") {\n            _data = decodeHex(data);\n        }\n        else if (encoding === \"base64\") {\n            _data = decodeBase64(data);\n        }\n        else {\n            _data = defaultEncoder.encode(data);\n        }\n        return new ByteArray(_data.buffer, _data.byteOffset, _data.byteLength);\n    }\n    else if (ArrayBuffer.isView(data)) {\n        return new ByteArray(data.buffer, data.byteOffset, data.byteLength);\n    }\n    else {\n        return new ByteArray(data);\n    }\n}\n/**\n * Converts the byte array (or `Uint8Array`) to a string.\n * @param encoding Default value: `utf8`.\n *\n * @example\n * ```ts\n * import { text } from \"@ayonli/jsext/bytes\";\n *\n * const arr = new Uint8Array([72, 101, 108, 108, 111, 44, 32, 87, 111, 114, 108, 100, 33]);\n *\n * console.log(text(arr)); // \"Hello, World!\"\n * console.log(text(arr, \"hex\")); // \"48656c6c6f2c20576f726c6421\"\n * console.log(text(arr, \"base64\")); // \"SGVsbG8sIFdvcmxkIQ==\"\n * ```\n */\nexport function text(bytes, encoding = \"utf8\") {\n    if (encoding === \"hex\") {\n        return encodeHex(bytes);\n    }\n    else if (encoding === \"base64\") {\n        return encodeBase64(bytes);\n    }\n    else if (typeof Buffer === \"function\" && bytes instanceof Buffer) {\n        return bytes.toString(\"utf8\");\n    }\n    else {\n        return defaultDecoder.decode(bytes);\n    }\n}\n/**\n * Copies bytes from `src` array to `dest` and returns the number of bytes copied.\n *\n * @example\n * ```ts\n * import { copy } from \"@ayonli/jsext/bytes\";\n *\n * const src = new Uint8Array([1, 2, 3, 4, 5]);\n * const dest = new Uint8Array(3);\n *\n * const n = copy(src, dest);\n *\n * console.log(n); // 3\n * console.log(dest); // Uint8Array(3) [ 1, 2, 3 ]\n * ```\n */\nexport function copy(src, dest) {\n    if (src.length > dest.length) {\n        src = src.subarray(0, dest.length);\n    }\n    dest.set(src);\n    return src.length;\n}\n/**\n * Like `Buffer.concat` but for native `Uint8Array`.\n *\n * @example\n * ```ts\n * import { concat } from \"@ayonli/jsext/bytes\";\n *\n * const arr1 = new Uint8Array([1, 2, 3]);\n * const arr2 = new Uint8Array([4, 5, 6]);\n *\n * const result = concat(arr1, arr2);\n *\n * console.log(result); // Uint8Array(6) [ 1, 2, 3, 4, 5, 6 ]\n * ```\n */\nexport function concat(...arrays) {\n    var _a;\n    const length = sum(...arrays.map(arr => arr.length));\n    const ctor = (((_a = arrays[0]) === null || _a === void 0 ? void 0 : _a.constructor) || Uint8Array);\n    const result = typeof Buffer === \"function\" && Object.is(ctor, Buffer)\n        ? Buffer.alloc(length)\n        : new ctor(length);\n    let offset = 0;\n    for (const arr of arrays) {\n        result.set(arr, offset);\n        offset += arr.length;\n    }\n    return result;\n}\n/**\n * Like `Buffer.compare` but for native `Uint8Array`.\n *\n * @example\n * ```ts\n * import { compare } from \"@ayonli/jsext/bytes\";\n *\n * const arr1 = new Uint8Array([1, 2, 3]);\n * const arr2 = new Uint8Array([1, 2, 4]);\n * const arr3 = new Uint8Array([1, 2, 3, 4]);\n * const arr4 = new Uint8Array([1, 2, 3]);\n * const arr5 = new Uint8Array([1, 2]);\n *\n * console.log(compare(arr1, arr2)); // -1\n * console.log(compare(arr1, arr3)); // -1\n * console.log(compare(arr1, arr4)); // 0\n * console.log(compare(arr1, arr5)); // 1\n * ```\n */\nexport function compare(arr1, arr2) {\n    if (arr1 === arr2) {\n        return 0;\n    }\n    for (let i = 0; i < arr1.length; i++) {\n        const ele1 = arr1[i];\n        const ele2 = arr2[i];\n        if (ele2 === undefined) {\n            return 1;\n        }\n        else if (ele1 < ele2) {\n            return -1;\n        }\n        else if (ele1 > ele2) {\n            return 1;\n        }\n    }\n    return arr1.length < arr2.length ? -1 : 0;\n}\n/**\n * Checks if the two byte arrays are equal to each other.\n *\n * @example\n * ```ts\n * import { equals } from \"@ayonli/jsext/bytes\";\n *\n * const arr1 = new Uint8Array([1, 2, 3]);\n * const arr2 = new Uint8Array([1, 2, 3]);\n * const arr3 = new Uint8Array([1, 2, 4]);\n *\n * console.log(equals(arr1, arr2)); // true\n * console.log(equals(arr1, arr3)); // false\n * ```\n */\nexport function equals(arr1, arr2) {\n    if (arr1 === arr2) {\n        return true;\n    }\n    else if (arr1.length !== arr2.length) {\n        return false;\n    }\n    else if (arr1.length < 1000) {\n        return _equals(arr1, arr2);\n    }\n    const len = arr1.length;\n    const compressible = Math.floor(len / 4);\n    const _arr1 = new Uint32Array(arr1.buffer, 0, compressible);\n    const _arr2 = new Uint32Array(arr2.buffer, 0, compressible);\n    for (let i = compressible * 4; i < len; i++) {\n        if (arr1[i] !== arr2[i]) {\n            return false;\n        }\n    }\n    for (let i = 0; i < _arr1.length; i++) {\n        if (_arr1[i] !== _arr2[i]) {\n            return false;\n        }\n    }\n    return true;\n}\n/**\n * Checks if the byte array contains another array as a slice of its contents.\n *\n * @example\n * ```ts\n * import { includesSlice } from \"@ayonli/jsext/bytes\";\n *\n * const arr = new Uint8Array([1, 2, 3, 4, 5]);\n *\n * console.log(includesSlice(arr, new Uint8Array([3, 4]))); // true\n * console.log(includesSlice(arr, new Uint8Array([4, 3]))); // false\n * ```\n */\nexport function includesSlice(arr, slice) {\n    return _includesSlice(arr, slice);\n}\n/**\n * Returns the index of the first occurrence of the slice in the byte array, or\n * -1 if it is not present. Optionally, we can specify where to start the search\n * by providing the `start` parameter.\n *\n * @example\n * ```ts\n * import { indexOfSlice } from \"@ayonli/jsext/bytes\";\n *\n * const arr = new Uint8Array([1, 2, 3, 4, 5]);\n * const slice = new Uint8Array([3, 4]);\n *\n * console.log(indexOfSlice(arr, slice)); // 2\n * console.log(indexOfSlice(arr, slice, 3)); // -1, starts searching from index 3\n * ```\n */\nexport function indexOfSlice(arr, slice, start = 0) {\n    if (start < 0) {\n        start = Math.max(0, arr.length + start);\n    }\n    const limit = arr.length - slice.length;\n    const s = slice[0];\n    for (let i = start; i <= limit; i++) {\n        if (arr[i] !== s) {\n            continue;\n        }\n        let j = 1;\n        while (j < slice.length && arr[i + j] === slice[j]) {\n            j++;\n        }\n        if (j === slice.length) {\n            return i;\n        }\n    }\n    return -1;\n}\n/**\n * Checks if the byte array starts with the given prefix.\n *\n * @example\n * ```ts\n * import { startsWith } from \"@ayonli/jsext/bytes\";\n *\n * const arr = new Uint8Array([1, 2, 3, 4, 5]);\n *\n * console.log(startsWith(arr, new Uint8Array([1, 2]))); // true\n * console.log(startsWith(arr, new Uint8Array([2, 1]))); // false\n * ```\n */\nexport function startsWith(arr, prefix) {\n    return _startsWith(arr, prefix);\n}\n/**\n * Checks if the byte array ends with the given suffix.\n *\n * @example\n * ```ts\n * import { endsWith } from \"@ayonli/jsext/bytes\";\n *\n * const arr = new Uint8Array([1, 2, 3, 4, 5]);\n *\n * console.log(endsWith(arr, new Uint8Array([4, 5]))); // true\n * console.log(endsWith(arr, new Uint8Array([5, 4]))); // false\n * ```\n */\nexport function endsWith(arr, suffix) {\n    return _endsWith(arr, suffix);\n}\n/**\n * Breaks the byte array into smaller chunks according to the given delimiter.\n *\n * @example\n * ```ts\n * import { split } from \"@ayonli/jsext/bytes\";\n *\n * const arr = new Uint8Array([1, 2, 3, 0, 4, 5, 0, 6, 7]);\n *\n * console.log(split(arr, 0));\n * // [\n * //     Uint8Array(3) [ 1, 2, 3 ],\n * //     Uint8Array(2) [ 4, 5 ],\n * //     Uint8Array(2) [ 6, 7 ]\n * // ]\n * ```\n */\nexport function split(arr, delimiter) {\n    return _split(arr, delimiter);\n}\n/**\n * Breaks the byte array into smaller chunks according to the given length.\n *\n * @example\n * ```ts\n * import { chunk } from \"@ayonli/jsext/bytes\";\n *\n * const arr = new Uint8Array([1, 2, 3, 4, 5, 6, 7]);\n *\n * console.log(chunk(arr, 3));\n * // [\n * //     Uint8Array(3) [ 1, 2, 3 ],\n * //     Uint8Array(3) [ 4, 5, 6 ],\n * //     Uint8Array(1) [ 7 ]\n * // ]\n * ```\n */\nexport function chunk(arr, length) {\n    return _chunk(arr, length);\n}\n//# sourceMappingURL=bytes.js.map","export const EMOJI_CHAR = (() => {\n    try {\n        return new RegExp(\"^\\(?:\\\\p{Emoji_Modifier_Base}\\\\p{Emoji_Modifier}?|\\\\p{Emoji_Presentation}|\\\\p{Emoji}\\\\uFE0F)(?:\\\\u200d(?:\\\\p{Emoji_Modifier_Base}\\\\p{Emoji_Modifier}?|\\\\p{Emoji_Presentation}|\\\\p{Emoji}\\\\uFE0F))*$\", \"u\");\n    }\n    catch (_a) {\n        return new RegExp(\"^(\\\\u00a9|\\\\u00ae|[\\\\u25a0-\\\\u27bf]|\\\\ud83c[\\\\ud000-\\\\udfff]|\\\\ud83d[\\\\ud000-\\\\udfff]|\\\\ud83e[\\\\ud000-\\\\udfff])$\");\n    }\n})();\n//# sourceMappingURL=constants.js.map","/**\n * Functions for dealing with strings.\n * @module\n */\nimport { chunk as _chunk } from \"./array/base.ts\";\nimport _bytes from \"./bytes.ts\";\nimport { EMOJI_CHAR } from \"./string/constants.ts\";\nconst _chars = chars;\n/**\n * Compares two strings, returns `-1` if `a < b`, `0` if `a === b` and `1` if `a > b`.\n *\n * NOTE: prefer using `String.prototype.localeCompare` instead.\n *\n * @example\n * ```ts\n * import { compare } from \"@ayonli/jsext/string\";\n *\n * console.log(compare(\"a\", \"b\")); // -1\n * console.log(compare(\"b\", \"a\")); // 1\n * console.log(compare(\"a\", \"a\")); // 0\n * ```\n */\nexport function compare(str1, str2) {\n    if (str1 < str2) {\n        return -1;\n    }\n    else if (str1 > str2) {\n        return 1;\n    }\n    else {\n        return 0;\n    }\n}\n/**\n * Returns a random string restricted by `length` (character-wise).\n *\n * @param chars Default value: `0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ`.\n *\n * @example\n * ```ts\n * import { random } from \"@ayonli/jsext/string\";\n *\n * console.log(random(8)); // \"2n8G3z1A\" for example\n * console.log(random(8, \"01\")); // \"10010101\" for example\n * ```\n */\nexport function random(length, chars = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\") {\n    const arr = _chars(chars);\n    let str = \"\";\n    while (0 < length--) {\n        const i = Math.floor(Math.random() * arr.length);\n        str += arr[i];\n    }\n    return str;\n}\n/**\n * Counts the occurrence of the sub-string in the string.\n *\n * @example\n * ```ts\n * import { count } from \"@ayonli/jsext/string\";\n *\n * console.log(count(\"hello world\", \"o\")); // 2\n * console.log(count(\"hello world\", \"i\")); // 0\n * ```\n */\nexport function count(str, sub) {\n    if (!sub) {\n        return str.length + 1;\n    }\n    else if (!str) {\n        return 0;\n    }\n    return str.split(sub).length - 1;\n}\n/**\n * Capitalizes the string, if `all` is true, all words are capitalized, otherwise only\n * the first word will be capitalized.\n *\n * @example\n * ```ts\n * import { capitalize } from \"@ayonli/jsext/string\";\n *\n * console.log(capitalize(\"hello world\")); // Hello world\n * console.log(capitalize(\"hello world\", true)); // Hello World\n * ```\n */\nexport function capitalize(str, all) {\n    const regex = all ? /\\w+/g : /\\w+/;\n    return str.replace(regex, (match) => {\n        return match[0].toUpperCase() + match.slice(1).toLowerCase();\n    });\n}\n/**\n * Replaces the spaces between non-empty characters of the string with hyphens (`-`).\n *\n * @example\n * ```ts\n * import { hyphenate } from \"@ayonli/jsext/string\";\n *\n * console.log(hyphenate(\"hello world\")); // hello-world\n * console.log(hyphenate(\"hello   world\")); // hello-world\n * ```\n */\nexport function hyphenate(str) {\n    return str.replace(/(\\S)\\s+(\\S)/g, (_, $1, $2) => $1 + \"-\" + $2);\n}\n/**\n * Returns the characters of the string (emojis are supported).\n *\n * @example\n * ```ts\n * import { chars } from \"@ayonli/jsext/string\";\n *\n * console.log(chars(\"Hello, World!\")); // [\"H\", \"e\", \"l\", \"l\", \"o\", \",\", \" \", \"W\", \"o\", \"r\", \"l\", \"d\", \"!\"]\n * console.log(chars(\"你好，世界！\")) // [\"你\", \"好\", \"，\", \"世\", \"界\", \"！\"]\n * console.log(chars(\"😴😄⛔🎠🚓🚇👨‍👨‍👧‍👧👦🏾\")); // [\"😴\", \"😄\", \"⛔\", \"🎠\", \"🚓\", \"🚇\", \"👨‍👨‍👧‍👧\", \"👦🏾\"]\n * ```\n */\nexport function chars(str) {\n    if (typeof Intl === \"object\" && typeof Intl.Segmenter === \"function\") {\n        return Array.from(new Intl.Segmenter().segment(str))\n            .map((x) => x.segment);\n    }\n    else {\n        return Array.from(str);\n    }\n}\n/**\n * Extracts words (in latin characters) from the string.\n *\n * @example\n * ```ts\n * import { words } from \"@ayonli/jsext/string\";\n *\n * console.log(words(\"hello world\")); // [\"hello\", \"world\"]\n * console.log(words(\"hello, world\")); // [\"hello\", \"world\"]\n * console.log(words(\"hello-world\")); // [\"hello\", \"world\"]\n * console.log(words(\"hello_world\")); // [\"hello\", \"world\"]\n * ```\n */\nexport function words(str) {\n    const matches = str.match(/\\w+/g);\n    return matches ? [...matches].map(sub => sub.split(\"_\")).flat() : [];\n}\n/**\n * Splits the string into lines by `\\n` or `\\r\\n`.\n *\n * @example\n * ```ts\n * import { lines } from \"@ayonli/jsext/string\";\n *\n * console.log(lines(\"hello\\nworld\")); // [\"hello\", \"world\"]\n * console.log(lines(\"hello\\r\\nworld\")); // [\"hello\", \"world\"]\n * ```\n */\nexport function lines(str) {\n    return str.split(/\\r?\\n/);\n}\n/**\n * Breaks the string into smaller chunks according to the given length.\n *\n * @example\n * ```ts\n * import { chunk } from \"@ayonli/jsext/string\";\n *\n * console.log(chunk(\"hello world\", 3)); // [\"hel\", \"lo \", \"wor\", \"ld\"]\n * ```\n */\nexport function chunk(str, length) {\n    return _chunk(str, length);\n}\n/**\n * Truncates the string to the given length (including the padding `...`).\n *\n * @example\n * ```ts\n * import { truncate } from \"@ayonli/jsext/string\";\n *\n * console.log(truncate(\"hello world\", 8)); // hello...\n * console.log(truncate(\"hello world\", 11)); // hello world\n * ```\n */\nexport function truncate(str, length, position = \"end\") {\n    if (length <= 0) {\n        return \"\";\n    }\n    else if (length >= str.length) {\n        return str;\n    }\n    else {\n        length -= 3;\n        if (position === \"middle\") {\n            const left = Math.ceil(length / 2);\n            const right = Math.floor(length / 2);\n            return str.slice(0, left) + \"...\" + str.slice(-right);\n        }\n        else if (position === \"start\") {\n            return \"...\" + str.slice(-length);\n        }\n        else {\n            return str.slice(0, length) + \"...\";\n        }\n    }\n}\nconst _trim = String.prototype.trim;\nconst _trimEnd = String.prototype.trimEnd;\nconst _trimStart = String.prototype.trimStart;\n/**\n * Removes leading and trailing spaces or custom characters of the string.\n *\n * @example\n * ```ts\n * import { trim } from \"@ayonli/jsext/string\";\n *\n * console.log(trim(\"  hello world  \")); // \"hello world\"\n * console.log(trim(\"  hello world!  \", \" !\")); // \"hello world\"\n * ```\n */\nexport function trim(str, chars = \"\") {\n    if (!chars) {\n        return _trim.call(str);\n    }\n    else {\n        return trimEnd(trimStart(str, chars), chars);\n    }\n}\n/**\n * Removes trailing spaces or custom characters of the string.\n *\n * @example\n * ```ts\n * import { trimEnd } from \"@ayonli/jsext/string\";\n *\n * console.log(trimEnd(\"  hello world  \")); // \"  hello world\"\n * console.log(trimEnd(\"  hello world!  \", \" !\")); // \"  hello world\"\n * ```\n */\nexport function trimEnd(str, chars = \"\") {\n    if (!chars) {\n        return _trimEnd.call(str);\n    }\n    else {\n        let i = str.length;\n        while (i-- && chars.indexOf(str[i]) !== -1) { }\n        return str.substring(0, i + 1);\n    }\n}\n/**\n * Removes leading spaces or custom characters of the string.\n *\n * @example\n * ```ts\n * import { trimStart } from \"@ayonli/jsext/string\";\n *\n * console.log(trimStart(\"  hello world  \")); // \"hello world  \"\n * console.log(trimStart(\"  !hello world!  \", \" !\")); // \"hello world!  \"\n * ```\n */\nexport function trimStart(str, chars = \"\") {\n    if (!chars) {\n        return _trimStart.call(str);\n    }\n    else {\n        let i = 0;\n        do { } while (chars.indexOf(str[i]) !== -1 && ++i);\n        return str.substring(i);\n    }\n}\n/**\n * Removes the given suffix of the string if present.\n *\n * @example\n * ```ts\n * import { stripEnd } from \"@ayonli/jsext/string\";\n *\n * console.log(stripEnd(\"hello world\", \"world\")); // \"hello \"\n * console.log(stripEnd(\"hello world\", \"hello\")); // \"hello world\"\n * ```\n */\nexport function stripEnd(str, suffix) {\n    if (str.endsWith(suffix)) {\n        return str.slice(0, -suffix.length);\n    }\n    return str;\n}\n/**\n * Removes the given prefix of the string if present.\n *\n * @example\n * ```ts\n * import { stripStart } from \"@ayonli/jsext/string\";\n *\n * console.log(stripStart(\"hello world\", \"hello\")); // \" world\"\n * console.log(stripStart(\"hello world\", \"hi\")); // \"hello world\"\n * ```\n */\nexport function stripStart(str, prefix) {\n    if (str.startsWith(prefix)) {\n        return str.slice(prefix.length);\n    }\n    return str;\n}\nexport function dedent(str, ...values) {\n    if (Array.isArray(str)) {\n        str = str\n            .reduce((acc, cur, i) => acc + cur + (values[i] || \"\"), \"\");\n    }\n    const oldLines = lines(str);\n    const newLines = [];\n    let indent = \"\";\n    for (const line of oldLines) {\n        const match = line.match(/^(\\s+)\\S+/);\n        if (match) {\n            if (!indent || match[1].length < indent.length) {\n                indent = match[1];\n            }\n        }\n    }\n    for (const line of oldLines) {\n        if (line.startsWith(indent)) {\n            newLines.push(line.slice(indent.length));\n        }\n        else {\n            newLines.push(line);\n        }\n    }\n    return newLines.join(\"\\n\").trim();\n}\n/**\n * Returns the byte length of the string.\n *\n * @example\n * ```ts\n * import { byteLength } from \"@ayonli/jsext/string\";\n *\n * console.log(byteLength(\"hello world\")); // 11\n * console.log(byteLength(\"你好，世界！\")); // 18\n * ```\n */\nexport function byteLength(str) {\n    return _bytes(str).byteLength;\n}\n/** Checks if all characters in the string are within the ASCII range. */\nexport function isAscii(str, printableOnly = false) {\n    return printableOnly ? /^[-~]+$/.test(str) : /^[\\x00-\\x7E]+$/.test(str);\n}\n/** Checks if all characters in the string are emojis. */\nexport function isEmoji(str) {\n    return chars(str).every((char) => EMOJI_CHAR.test(char));\n}\n//# sourceMappingURL=string.js.map","/**\n * Functions for dealing with numbers.\n * @module\n */\n/** Returns `true` if the given value is a float number, `false` otherwise. */\nexport function isFloat(value) {\n    return typeof value === \"number\"\n        && !Number.isNaN(value)\n        && (!Number.isFinite(value) || value % 1 !== 0);\n}\n/**\n * Returns `true` if the given value is a numeric value, `false` otherwise. A numeric value is a\n * number, a bigint, or a string that can be converted to a number or bigint.\n *\n * **NOTE:** `NaN` is not considered numeric.\n *\n * @param strict Only returns `true` when the value is of type `number`.\n *\n * @example\n * ```ts\n * import { isNumeric } from \"@ayonli/jsext/number\";\n *\n * console.log(isNumeric(42)); // true\n * console.log(isNumeric(42n)); // true\n * console.log(isNumeric(\"42\")); // true\n *\n * console.log(isNumeric(NaN)); // false\n * console.log(isNumeric(42n, true)); // false\n * console.log(isNumeric(\"42\", true)); // false\n * ```\n */\nexport function isNumeric(value, strict = false) {\n    const type = typeof value;\n    if (strict) {\n        return type === \"number\" && !Number.isNaN(value);\n    }\n    else if (type === \"bigint\") {\n        return true;\n    }\n    else if (type === \"number\") {\n        return !Number.isNaN(value);\n    }\n    else if (type === \"string\" && value) {\n        try {\n            BigInt(value);\n            return true;\n        }\n        catch (_a) {\n            return !Number.isNaN(Number(value));\n        }\n    }\n    return false;\n}\n/**\n * Return `true` if a number is between the given range (inclusive).\n *\n * This function is the same as `value >= min && value <= max`.\n */\nexport function isBetween(value, [min, max]) {\n    return value >= min && value <= max;\n}\n/**\n * Returns a random integer ranged from `min` to `max` (inclusive).\n *\n * @example\n * ```ts\n * import { random } from \"@ayonli/jsext/number\";\n *\n * console.log(random(1, 5)); // 1, 2, 3, 4, or 5\n * ```\n */\nexport function random(min, max) {\n    return min + Math.floor(Math.random() * (max - min + 1));\n}\n/**\n * Generates a sequence of numbers from `min` to `max` (inclusive).\n *\n * @example\n * ```ts\n * import { range } from \"@ayonli/jsext/number\";\n *\n * for (const i of range(1, 5)) {\n *     console.log(i);\n * }\n * // output:\n * // 1\n * // 2\n * // 3\n * // 4\n * // 5\n * ```\n */\nexport function range(min, max, step = 1) {\n    return sequence(min, max, step);\n}\n/**\n * Creates a generator that produces sequential numbers from `1` to\n * `Number.MAX_SAFE_INTEGER`, useful for generating unique IDs.\n *\n * @param loop Repeat the sequence when the end is reached.\n *\n * @example\n * ```ts\n * import { serial } from \"@ayonli/jsext/number\";\n *\n * const idGenerator = serial();\n *\n * console.log(idGenerator.next().value); // 1\n * console.log(idGenerator.next().value); // 2\n * console.log(idGenerator.next().value); // 3\n * ```\n */\nexport function serial(loop = false) {\n    return sequence(1, Number.MAX_SAFE_INTEGER, 1, loop);\n}\n/**\n * Creates a generator that produces sequential numbers from `min` to `max` (inclusive).\n * @inner\n */\nfunction* sequence(min, max, step = 1, loop = false) {\n    let id = min;\n    while (true) {\n        yield id;\n        if ((id += step) > max) {\n            if (loop) {\n                id = min;\n            }\n            else {\n                break;\n            }\n        }\n    }\n}\n//# sourceMappingURL=number.js.map","import { compare, random, capitalize as _capitalize, chunk as _chunk, count as _count, hyphenate as _hyphenate, truncate as _truncate, chars as _chars, words as _words, lines as _lines, trim as _trim, trimEnd as _trimEnd, trimStart as _trimStart, stripEnd as _stripEnd, stripStart as _stripStart, dedent as _dedent, byteLength as _byteLength, isAscii as _isAscii, isEmoji as _isEmoji, } from \"../string.ts\";\nString.compare = compare;\nString.random = random;\nif (typeof String.dedent === \"undefined\") {\n    String.dedent = _dedent;\n}\nString.prototype.count = function count(sub) {\n    return _count(String(this), sub);\n};\nString.prototype.capitalize = function capitalize(all) {\n    return _capitalize(String(this), all);\n};\nString.prototype.hyphenate = function capitalize() {\n    return _hyphenate(String(this));\n};\nString.prototype.chars = function chars() {\n    return _chars(String(this));\n};\nString.prototype.words = function words() {\n    return _words(String(this));\n};\nString.prototype.lines = function lines() {\n    return _lines(String(this));\n};\nString.prototype.chunk = function chunk(length) {\n    return _chunk(String(this), length);\n};\nString.prototype.truncate = function truncate(length, position = \"end\") {\n    return _truncate(String(this), length, position);\n};\nString.prototype.trim = function trim(chars = \"\") {\n    return _trim(String(this), chars);\n};\nString.prototype.trimEnd = function trimEnd(chars = \"\") {\n    return _trimEnd(String(this), chars);\n};\nString.prototype.trimStart = function trimStart(chars = \"\") {\n    return _trimStart(String(this), chars);\n};\nString.prototype.stripEnd = function stripEnd(suffix) {\n    return _stripEnd(String(this), suffix);\n};\nString.prototype.stripStart = function stripStart(prefix) {\n    return _stripStart(String(this), prefix);\n};\nif (typeof String.prototype.dedent === \"undefined\") {\n    String.prototype.dedent = function dedent() {\n        return _dedent(String(this));\n    };\n}\nString.prototype.byteLength = function byteLength() {\n    return _byteLength(String(this));\n};\nString.prototype.isAscii = function isAscii(printableOnly = false) {\n    return _isAscii(String(this), printableOnly);\n};\nString.prototype.isEmoji = function isEmoji() {\n    return _isEmoji(String(this));\n};\n//# sourceMappingURL=string.js.map","/**\n * This module includes functions for dealing with classes.\n * @module\n */\n/**\n * Checks if a value is a class/constructor.\n *\n * @example\n * ```ts\n * import { isClass } from \"@ayonli/jsext/class\";\n *\n * console.assert(isClass(class Foo { }));\n * console.assert(!isClass(function foo() { }));\n * ```\n */\nexport function isClass(value) {\n    if (typeof value !== \"function\")\n        return false;\n    if ([String, Number, Boolean, BigInt, Symbol].includes(value)) {\n        return false;\n    }\n    // async function or arrow function\n    if (value.prototype === undefined)\n        return false;\n    // generator function or malformed inheritance\n    if (value.prototype.constructor !== value)\n        return false;\n    const str = value.toString();\n    // ES6 class\n    if (str.slice(0, 5) === \"class\")\n        return true;\n    const name0 = value.name[0];\n    if (name0 && name0 >= \"A\" && name0 <= \"Z\" && str.includes(\"[native code]\"))\n        return true;\n    return false;\n}\n/**\n * Checks if a class is a subclass of another class.\n *\n * @example\n * ```ts\n * import { isSubclassOf } from \"@ayonli/jsext/class\";\n *\n * class Moment extends Date {}\n *\n * console.assert(isSubclassOf(Moment, Date));\n * console.assert(isSubclassOf(Moment, Object)); // all classes are subclasses of Object\n * ```\n */\nexport function isSubclassOf(ctor1, ctor2) {\n    return typeof ctor1 === \"function\"\n        && typeof ctor2 === \"function\"\n        && ctor1.prototype instanceof ctor2;\n}\n//# sourceMappingURL=class.js.map","import { isBetween, isFloat, isNumeric, random, range, serial } from \"../number.ts\";\nNumber.isFloat = isFloat;\nNumber.isNumeric = isNumeric;\nNumber.isBetween = isBetween;\nNumber.random = random;\nNumber.range = range;\nNumber.serial = serial;\n//# sourceMappingURL=number.js.map","/**\n * Functions for dealing with arrays.\n * @module\n */\nimport { isSubclassOf } from \"./class.ts\";\nimport { random as rand } from \"./number.ts\";\nimport { count as _count, equals as _equals, includeSlice as _includesSlice, startsWith as _startsWith, endsWith as _endsWith, split as _split, chunk as _chunk, } from \"./array/base.ts\";\n/**\n * Returns the first element of the array, or `undefined` if the array is empty.\n * This function is equivalent to `arr[0]` or `arr.at(0)`.\n */\nexport function first(arr) {\n    return arr[0];\n}\n/**\n * Returns the last element of the array, or `undefined` if the array is empty.\n * This function is equivalent to `arr[arr.length - 1]` or `arr.at(-1)`.\n */\nexport function last(arr) {\n    return arr.length > 0 ? arr[arr.length - 1] : undefined;\n}\n/**\n * Returns a random element of the array, or `undefined` if the array is empty.\n * @param remove If `true`, the element will be removed from the array.\n *\n * @example\n * ```ts\n * import { random } from \"@ayonli/jsext/array\";\n *\n * const arr = [1, 2, 3, 4, 5];\n *\n * console.log(random(arr)); // 3 for example\n *\n * console.log(random(arr, true)); // 3 for example\n * console.log(arr); // [1, 2, 4, 5]\n * ```\n */\nexport function random(arr, remove = false) {\n    if (!arr.length) {\n        return undefined;\n    }\n    else if (arr.length === 1) {\n        if (remove) {\n            return arr.splice(0, 1)[0];\n        }\n        else {\n            return arr[0];\n        }\n    }\n    const i = rand(0, arr.length - 1);\n    if (remove) {\n        return arr.splice(i, 1)[0];\n    }\n    else {\n        return arr[i];\n    }\n}\n/**\n * Counts the occurrence of the element in the array.\n *\n * @example\n * ```ts\n * import { count } from \"@ayonli/jsext/array\";\n *\n * const arr = [1, 2, 3, 4, 5, 2, 3, 4, 2];\n *\n * console.log(count(arr, 2)); // 3\n * console.log(count(arr, 6)); // 0\n * ```\n */\nexport function count(arr, item) {\n    return _count(arr, item);\n}\n/**\n * Performs a shallow compare to another array and see if it contains the same elements as\n * this array.\n *\n * NOTE: This function only performs a shallow comparison, to compare nested objects\n * in the array, use the `equals` function from `@ayonli/jsext/object` module instead.\n *\n * @example\n * ```ts\n * import { equals } from \"@ayonli/jsext/array\";\n *\n * const arr1 = [1, 2, 3, 4, 5];\n * const arr2 = [{ foo: \"bar\" }];\n *\n * console.log(equals(arr1, [1, 2, 3, 4, 5])); // true\n * console.log(equals(arr2, [{ foo: \"bar\" }])); // false, object refs are different\n * ```\n */\nexport function equals(arr1, arr2) {\n    return _equals(arr1, arr2);\n}\n/**\n * Checks if the array contains another array as a slice of its contents.\n *\n * @example\n * ```ts\n * import { includesSlice } from \"@ayonli/jsext/array\";\n *\n * const arr = [1, 2, 3, 4, 5];\n *\n * console.log(includesSlice(arr, [2, 3, 4])); // true\n * console.log(includesSlice(arr, [2, 4, 3])); // false\n * ```\n */\nexport function includesSlice(arr, slice) {\n    return _includesSlice(arr, slice);\n}\n/**\n * Checks if the array starts with the given prefix.\n *\n * @example\n * ```ts\n * import { startsWith } from \"@ayonli/jsext/array\";\n *\n * const arr = [1, 2, 3, 4, 5];\n *\n * console.log(startsWith(arr, [1, 2])); // true\n * console.log(startsWith(arr, [2, 1])); // false\n * ```\n */\nexport function startsWith(arr, prefix) {\n    return _startsWith(arr, prefix);\n}\n/**\n * Checks if the array ends with the given suffix.\n *\n * @example\n * ```ts\n * import { endsWith } from \"@ayonli/jsext/array\";\n *\n * const arr = [1, 2, 3, 4, 5];\n *\n * console.log(endsWith(arr, [4, 5])); // true\n * console.log(endsWith(arr, [5, 4])); // false\n * ```\n */\nexport function endsWith(arr, suffix) {\n    return _endsWith(arr, suffix);\n}\n/**\n * Breaks the array into smaller chunks according to the given delimiter.\n *\n * @example\n * ```ts\n * import { split } from \"@ayonli/jsext/array\";\n *\n * const arr = [1, 2, 3, 4, 5, 6, 7, 8, 9];\n *\n * console.log(split(arr, 5)); // [[1, 2, 3, 4], [6, 7, 8, 9]]\n * ```\n */\nexport function split(arr, delimiter) {\n    return _split(arr, delimiter);\n}\n/**\n * Breaks the array into smaller chunks according to the given length.\n *\n * @example\n * ```ts\n * import { chunk } from \"@ayonli/jsext/array\";\n *\n * const arr = [1, 2, 3, 4, 5, 6, 7, 8, 9];\n *\n * console.log(chunk(arr, 5)); // [[1, 2, 3, 4, 5], [6, 7, 8, 9]]\n * ```\n */\nexport function chunk(arr, length) {\n    return _chunk(arr, length);\n}\n/**\n * Returns a subset of the array that contains only unique items.\n *\n * @example\n * ```ts\n * import { unique } from \"@ayonli/jsext/array\";\n *\n * const arr = [1, 2, 3, 4, 5, 2, 3, 4, 2];\n *\n * console.log(unique(arr)); // [1, 2, 3, 4, 5]\n * ```\n */\nexport function unique(arr) {\n    return [...new Set(arr)];\n}\n/**\n * Returns a subset of the array that contains only unique items filtered by the\n * given callback function.\n *\n * @example\n * ```ts\n * import { uniqueBy } from \"@ayonli/jsext/array\";\n *\n * const arr = [\n *     { id: 1, name: \"foo\" },\n *     { id: 2, name: \"bar\" },\n *     { id: 3, name: \"foo\" },\n *     { id: 4, name: \"baz\" },\n *     { id: 5, name: \"bar\" },\n * ];\n *\n * console.log(uniqueBy(arr, item => item.name));\n * // [\n * //     { id: 1, name: \"foo\" },\n * //     { id: 2, name: \"bar\" },\n * //     { id: 4, name: \"baz\" }\n * // ]\n * ```\n */\nexport function uniqueBy(arr, fn) {\n    const map = new Map();\n    for (let i = 0; i < arr.length; i++) {\n        const item = arr[i];\n        const key = fn(item, i);\n        map.has(key) || map.set(key, item);\n    }\n    return [...map.values()];\n}\n/**\n * Reorganizes the elements in the array in random order.\n *\n * This function mutates the array.\n *\n * @example\n * ```ts\n * import { shuffle } from \"@ayonli/jsext/array\";\n *\n * const arr = [1, 2, 3, 4, 5];\n *\n * console.log(shuffle(arr)); // [3, 1, 5, 2, 4] for example\n * console.log(arr); // [3, 1, 5, 2, 4]\n * ```\n */\nexport function shuffle(arr) {\n    for (let i = arr.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [arr[i], arr[j]] = [arr[j], arr[i]];\n    }\n    return arr;\n}\nexport function orderBy(arr, key, order = \"asc\") {\n    const items = arr.slice();\n    if (typeof key === \"function\") {\n        return orderBy(items.map((item, i) => ({\n            key: key(item, i),\n            value: item,\n        })), \"key\", order).map(({ value }) => value);\n    }\n    items.sort((a, b) => {\n        if (typeof a !== \"object\" || typeof b !== \"object\" ||\n            !a || !b ||\n            Array.isArray(a) || Array.isArray(b)) {\n            return -1;\n        }\n        const _a = a[key];\n        const _b = b[key];\n        if (_a === undefined || _b === undefined) {\n            return -1;\n        }\n        if (typeof _a === \"number\" && typeof _b === \"number\") {\n            return _a - _b;\n        }\n        else if ((typeof _a === \"string\" && typeof _b === \"string\")\n            || (typeof _a === \"bigint\" && typeof _b === \"bigint\")) {\n            if (_a < _b) {\n                return -1;\n            }\n            else if (_a > _b) {\n                return 1;\n            }\n            else {\n                return 1;\n            }\n        }\n        else {\n            return -1;\n        }\n    });\n    if (order === \"desc\") {\n        items.reverse();\n    }\n    return items;\n}\n;\nexport function groupBy(arr, fn, type = Object) {\n    if (type === Map || isSubclassOf(type, Map)) {\n        const groups = new type();\n        for (let i = 0; i < arr.length; i++) {\n            const item = arr[i];\n            const key = fn(item, i);\n            const list = groups.get(key);\n            if (list) {\n                list.push(item);\n            }\n            else {\n                groups.set(key, [item]);\n            }\n        }\n        return groups;\n    }\n    else {\n        const groups = {};\n        for (let i = 0; i < arr.length; i++) {\n            const item = arr[i];\n            const key = fn(item, i);\n            const list = groups[key];\n            if (list) {\n                list.push(item);\n            }\n            else {\n                groups[key] = [item];\n            }\n        }\n        return groups;\n    }\n}\n;\nexport function keyBy(arr, fn, type = Object) {\n    if (type === Map || isSubclassOf(type, Map)) {\n        const map = new type();\n        for (let i = 0; i < arr.length; i++) {\n            const item = arr[i];\n            const key = fn(item, i);\n            map.set(key, item);\n        }\n        return map;\n    }\n    else {\n        const record = {};\n        for (let i = 0; i < arr.length; i++) {\n            const item = arr[i];\n            const key = fn(item, i);\n            record[key] = item;\n        }\n        return record;\n    }\n}\n/**\n * Returns a tuple of two arrays with the first one containing all elements in\n * the given array that match the given predicate and the second one containing\n * all that do not.\n *\n * @example\n * ```ts\n * import { partition } from \"@ayonli/jsext/array\";\n *\n * const arr = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];\n * const [even, odd] = partition(arr, item => item % 2 === 0);\n *\n * console.log(even); // [0, 2, 4, 6, 8]\n * console.log(odd); // [1, 3, 5, 7, 9]\n * ```\n */\nexport function partition(arr, predicate) {\n    const match = [];\n    const rest = [];\n    for (let i = 0; i < arr.length; i++) {\n        const item = arr[i];\n        (predicate(item, i) ? match : rest).push(item);\n    }\n    return [match, rest];\n}\n//# sourceMappingURL=array.js.map","/**\n * Functions for dealing with objects.\n * @module\n */\nimport { equals as bytesEquals } from \"./bytes.ts\";\nimport { isClass } from \"./class.ts\";\n/**\n * Returns `true` if the specified object has the indicated property as its own property.\n * If the property is inherited, or does not exist, the function returns `false`.\n *\n * @example\n * ```ts\n * import { hasOwn } from \"@ayonli/jsext/object\";\n *\n * const obj = { foo: \"hello\" };\n *\n * console.log(hasOwn(obj, \"foo\")); // true\n * console.log(hasOwn(obj, \"toString\")); // false\n * ```\n */\nexport function hasOwn(obj, key) {\n    return Object.prototype.hasOwnProperty.call(obj, key);\n}\n/**\n * Returns `true` if the specified object has the indicated method as its own method (in its own\n * prototype). If the method is inherited, or is not in the prototype, or does not exist, this\n * function returns `false`.\n *\n * @example\n * ```ts\n * import { hasOwnMethod } from \"@ayonli/jsext/object\";\n *\n * class MyClass {\n *     foo() {\n *         return \"Hello\";\n *     }\n *\n *     bar = () => \"World\";\n * }\n *\n * const obj = new MyClass();\n *\n * console.log(hasOwnMethod(obj, \"foo\")); // true\n * console.log(hasOwnMethod(obj, \"bar\")); // false\n * console.log(hasOwnMethod(obj, \"toString\")); // false\n * ```\n */\nexport function hasOwnMethod(obj, method) {\n    var _c;\n    const proto = Object.getPrototypeOf(obj);\n    if (!proto || !hasOwn(proto, method)) {\n        return false;\n    }\n    return typeof ((_c = Object.getOwnPropertyDescriptor(proto, method)) === null || _c === void 0 ? void 0 : _c.value) === \"function\";\n}\nexport function patch(target, ...sources) {\n    for (const source of sources) {\n        for (const key of Reflect.ownKeys(source)) {\n            if (!hasOwn(target, key) || target[key] === undefined) {\n                target[key] = source[key];\n            }\n        }\n    }\n    return target;\n}\nexport function pick(obj, keys) {\n    return keys.reduce((result, key) => {\n        if (key in obj && obj[key] !== undefined) {\n            result[key] = obj[key];\n        }\n        return result;\n    }, {});\n}\nexport function omit(obj, keys) {\n    const allKeys = Reflect.ownKeys(obj);\n    const keptKeys = allKeys.filter(key => !keys.includes(key));\n    const result = pick(obj, keptKeys);\n    // special treatment for Error types\n    if (obj instanceof Error) {\n        [\"name\", \"message\", \"stack\", \"cause\"].forEach(key => {\n            if (!keys.includes(key) &&\n                obj[key] !== undefined &&\n                !hasOwn(result, key)) {\n                result[key] = obj[key];\n            }\n        });\n    }\n    return result;\n}\nexport function as(value, type) {\n    if (typeof type !== \"function\") {\n        throw new TypeError(\"type must be a valid constructor\");\n    }\n    let _type;\n    const primitiveMap = {\n        \"string\": String,\n        \"number\": Number,\n        \"bigint\": BigInt,\n        \"boolean\": Boolean,\n        \"symbol\": Symbol\n    };\n    if (value instanceof type) {\n        if ([String, Number, Boolean].includes(type)) {\n            return value.valueOf(); // make sure the primitives are returned.\n        }\n        else {\n            return value;\n        }\n    }\n    else if ((_type = typeof value) && primitiveMap[_type] === type) {\n        return value;\n    }\n    return null;\n}\n/**\n * Returns a string representation or the constructor of the value's type.\n *\n * **NOTE:** This function returns `\"class\"` for ES6 classes.\n *\n * **NOTE:** This function returns `\"null\"` for `null`.\n *\n * **NOTE:** This function returns `Object` for `Object.create(null)`.\n *\n * @example\n * ```ts\n * import { typeOf } from \"@ayonli/jsext/object\";\n *\n * console.log(typeOf(\"Hello\")); // string\n * console.log(typeOf(42)); // number\n * console.log(typeOf(42n)); // bigint\n * console.log(typeOf(true)); // boolean\n * console.log(typeOf(Symbol(\"foo\"))); // symbol\n * console.log(typeOf(() => {})); // function\n * console.log(typeOf(class Foo {})); // class\n * console.log(typeOf(undefined)); // undefined\n * console.log(typeOf(null)); // null\n * console.log(typeOf({ foo: \"bar\" })); // [Function: Object]\n * console.log(typeOf(Object.create(null))); // [Function: Object]\n * console.log(typeOf([1, 2, 3])); // [Function: Array]\n * console.log(typeOf(new Date())); // [Function: Date]\n * ```\n */\nexport function typeOf(value) {\n    var _c, _d;\n    if (value === undefined) {\n        return \"undefined\";\n    }\n    else if (value === null) {\n        return \"null\";\n    }\n    const type = typeof value;\n    if (type === \"function\") {\n        return isClass(value) ? \"class\" : \"function\";\n    }\n    else if (type === \"object\") {\n        return (_d = (_c = Object.getPrototypeOf(value)) === null || _c === void 0 ? void 0 : _c.constructor) !== null && _d !== void 0 ? _d : Object;\n    }\n    else {\n        return type;\n    }\n}\n/**\n * Returns `true` if the given value is valid. The following values are considered invalid:\n *\n * - `undefined`\n * - `null`\n * - `NaN`\n * - `Invalid Date`\n */\nexport function isValid(value) {\n    return value !== undefined\n        && value !== null\n        && !Object.is(value, NaN)\n        && !(value instanceof Date && value.toString() === \"Invalid Date\");\n}\n/**\n * Returns `true` is the given value is a plain object, that is, an object created by\n * the `Object` constructor or one with a `[[Prototype]]` of `null`.\n *\n * @example\n * ```ts\n * import { isPlainObject } from \"@ayonli/jsext/object\";\n *\n * console.log(isPlainObject({ foo: \"bar\" })); // true\n * console.log(isPlainObject(Object.create(null))); // true\n * console.log(isPlainObject(new Map([[\"foo\", \"bar\"]]))); // false\n * ```\n */\nexport function isPlainObject(value) {\n    if (typeof value !== \"object\" || value === null)\n        return false;\n    const proto = Object.getPrototypeOf(value);\n    return proto === null || proto.constructor === Object;\n}\nexport function compare(a, b) {\n    const result = doCompare(a, b);\n    if (typeof result === \"number\") {\n        return result;\n    }\n    else {\n        throw new TypeError(result.description);\n    }\n}\nconst CompareTwoTypes = Symbol(\"Cannot compare values of different types\");\nconst ComparNonComparable = Symbol(\"Cannot compare non-comparable values\");\nconst CompareNaN = Symbol(\"Cannot compare NaN\");\nfunction doCompare(a, b) {\n    if (a === b) {\n        return 0;\n    }\n    else if (typeof a !== typeof b) {\n        return CompareTwoTypes;\n    }\n    else if (typeof a === \"string\") {\n        return a.localeCompare(b);\n    }\n    else if (typeof a === \"number\") {\n        if (Object.is(a, NaN) || Object.is(b, NaN)) {\n            return CompareNaN;\n        }\n        return a === b ? 0 : a < b ? -1 : 1;\n    }\n    else if (typeof a === \"bigint\") {\n        return a === b ? 0 : a < b ? -1 : 1;\n    }\n    else if (typeof a === \"boolean\") {\n        return a === b ? 0 : a ? 1 : -1;\n    }\n    else if (typeof a !== \"object\") {\n        return ComparNonComparable;\n    }\n    else if (typeof a.compareTo === \"function\" && typeof b.compareTo === \"function\") {\n        if (isPlainObject(a) && isPlainObject(b)) {\n            const aKeys = Reflect.ownKeys(a);\n            const bKeys = Reflect.ownKeys(b);\n            if (aKeys.every(k => k in b) && bKeys.every(k => k in a)) {\n                return a.compareTo(b);\n            }\n            else {\n                return CompareTwoTypes;\n            }\n        }\n        else if (a.constructor === b.constructor\n            || getPrototypeBy(a, \"compareTo\") === getPrototypeBy(b, \"compareTo\")) {\n            return a.compareTo(b);\n        }\n        else {\n            return CompareTwoTypes;\n        }\n    }\n    else if (typeof a.valueOf === \"function\" && typeof b.valueOf === \"function\") {\n        a = a.valueOf();\n        b = b.valueOf();\n        if ((a === null && b === null) || (a === undefined && b === undefined)) {\n            return 0;\n        }\n        else if (typeof a !== typeof b) {\n            return ComparNonComparable;\n        }\n        else if (typeof a === \"string\") {\n            return a.localeCompare(b);\n        }\n        else if (typeof a === \"number\") {\n            if (Object.is(a, NaN) || Object.is(b, NaN)) {\n                return ComparNonComparable;\n            }\n            return a === b ? 0 : a < b ? -1 : 1;\n        }\n        else if (typeof a === \"bigint\") {\n            return a === b ? 0 : a < b ? -1 : 1;\n        }\n        else if (typeof a === \"boolean\") {\n            return a === b ? 0 : a ? 1 : -1;\n        }\n        else {\n            return ComparNonComparable;\n        }\n    }\n    else {\n        return ComparNonComparable;\n    }\n}\nfunction getPrototypeBy(obj, prop) {\n    let proto = Object.getPrototypeOf(obj);\n    while (proto) {\n        if (hasOwn(proto, prop)) {\n            return proto;\n        }\n        proto = Object.getPrototypeOf(proto);\n    }\n    return null;\n}\n/**\n * Performs a deep comparison between two values to see if they are equivalent\n * or contain the same data.\n *\n * - Primitive values, functions and circular references are compared using the\n *   `===` operator or the `Object.is` function.\n * - Object wrappers such as `String`, `Number` and `Boolean` are compared both\n *   by their primitive values and their constructors.\n * - Objects should have the same `constructor` in order to be considered potentially\n *   equal, unless they implement the {@link Comparable} interface.\n * - Plain objects are compared by their own enumerable properties, unless they\n *   implement the {@link Comparable} interface.\n * - Arrays are compared one by one by their items.\n * - {@link ArrayBuffer}s and views are compared by their underlying buffers.\n * - {@link Map} and {@link Set} items are compared unordered.\n * - {@link RegExp} `source`, `flags` and `lastIndex` properties are compared.\n * - {@link Error} `name`, `message`, `stack`, `cause`, and `errors` properties are\n *   always compared, if there are other enumerable properties, they are compared\n *   as well.\n * - {@link URL} and {@link URLSearchParams} objects are compared by their string\n *   representations.\n * - {@link Headers} and {@link FormData} are compared by their entries unordered.\n * - Objects that implements the {@link Comparable} interface are compared using\n *   the `compareTo` method.\n * - Objects whose `valueOf` method returns primitive values other than `NaN` are\n *   also supported and use their primitive values for comparison.\n * - In others cases, values are compared using the `===` operator.\n *\n * NOTE: This function returns `true` if the two values are both `NaN`.\n *\n * @example\n * ```ts\n * import { equals } from \"@ayonli/jsext/object\";\n *\n * console.log(equals(\"Hello\", \"Hello\")); // true\n * console.log(equals(42, 42)); // true\n * console.log(equals([1, 2, 3], [1, 2, 3])); // true\n * console.log(equals({ foo: \"bar\" }, { foo: \"bar\" })); // true\n *\n * // deep comparison\n * console.log(equals(\n *     { foo: { bar: \"baz\" } },\n *     { foo: { bar: \"baz\" } }\n * )); // true\n * ```\n */\nexport function equals(a, b) {\n    return isEqual(a, b);\n}\nfunction isEqual(a, b, parents = []) {\n    if (a === null || a === undefined) {\n        return a === b;\n    }\n    else if (a === b || Object.is(a, b)) {\n        return true;\n    }\n    else if (typeof a !== typeof b) {\n        return false;\n    }\n    else if (typeof a !== \"object\") {\n        return a === b;\n    }\n    else if (a.constructor === String && b.constructor === String) {\n        return a.valueOf() === b.valueOf();\n    }\n    else if (a.constructor === Number && b.constructor === Number) {\n        const _a = a.valueOf();\n        const _b = b.valueOf();\n        return _a === _b || Object.is(_a, _b);\n    }\n    else if (a.constructor === Boolean && b.constructor === Boolean) {\n        return a.valueOf() === b.valueOf();\n    }\n    else if ((parents.includes(a) && parents.includes(b))) {\n        return true;\n    }\n    else if (typeof a.compareTo === \"function\" && typeof b.compareTo === \"function\") {\n        return doCompare(a, b) === 0;\n    }\n    else if (a.constructor !== b.constructor) {\n        return false;\n    }\n    else if (a.constructor === Object || !a.constructor) {\n        if (doCompare(a, b) === 0) {\n            return true;\n        }\n        const aKeys = Reflect.ownKeys(a);\n        const bKeys = Reflect.ownKeys(b);\n        if (aKeys.length !== bKeys.length) {\n            return false;\n        }\n        const _parents = [...parents, a, b];\n        return aKeys.every(key => isEqual(a[key], b[key], _parents));\n    }\n    else if (a instanceof Array) {\n        const _parents = [...parents, a, b];\n        return a.length === b.length\n            && a.every((value, i) => isEqual(value, b[i], _parents));\n    }\n    else if (a instanceof ArrayBuffer) {\n        const _a = new Uint8Array(a);\n        const _b = new Uint8Array(b);\n        return bytesEquals(_a, _b);\n    }\n    else if (ArrayBuffer.isView(a)) {\n        if (a instanceof Uint8Array) {\n            return bytesEquals(a, b);\n        }\n        else {\n            const _a = new Uint8Array(a.buffer);\n            const _b = new Uint8Array(b.buffer);\n            return bytesEquals(_a, _b);\n        }\n    }\n    else if (a instanceof Map) {\n        const _parents = [...parents, a, b];\n        return a.size === b.size\n            && [...a].every(([key, value]) => isEqual(value, b.get(key), _parents));\n    }\n    else if (a instanceof Set) {\n        return a.size === b.size\n            && [...a].every(value => b.has(value));\n    }\n    else if (a instanceof RegExp) {\n        const { source: aSource, flags: aFlags, lastIndex: aLastIndex } = a;\n        const { source: bSource, flags: bFlags, lastIndex: bLastIndex } = b;\n        return aSource === bSource\n            && aFlags === bFlags\n            && aLastIndex === bLastIndex;\n    }\n    else if (a instanceof Error) {\n        const { name: aName, message: aMessage, stack: aStack, cause: aCause, errors: aErrors, ...aRest } = a;\n        const { name: bName, message: bMessage, stack: bStack, cause: bCause, errors: bErrors, ...bRest } = b;\n        return aName === bName\n            && aMessage === bMessage\n            && aStack === bStack\n            && isEqual(aCause, bCause, [...parents, a, b])\n            && isEqual(aErrors, bErrors, [...parents, a, b])\n            && isEqual(aRest, bRest, [...parents, a, b]);\n    }\n    else if (a instanceof URL) {\n        return a.href === b.href;\n    }\n    else if (a instanceof URLSearchParams) {\n        return a.toString() === b.toString();\n    }\n    else if (typeof Headers === \"function\" && a instanceof Headers) {\n        const _b = b;\n        const aSetCookies = a.getSetCookie();\n        const bSetCookies = _b.getSetCookie();\n        if (aSetCookies.length !== bSetCookies.length) {\n            return false;\n        }\n        else if (aSetCookies.length && aSetCookies.some(v => !bSetCookies.includes(v))) {\n            return false;\n        }\n        const aEntries = [...a].filter(([key]) => key !== \"set-cookie\");\n        const bEntries = [..._b].filter(([key]) => key !== \"set-cookie\");\n        return aEntries.length === bEntries.length\n            && aEntries.every(([key, value]) => value === _b.get(key));\n    }\n    else if (typeof FormData === \"function\" && a instanceof FormData) {\n        const aEntries = [...a].reduce((map, [key, value]) => {\n            var _c;\n            const list = (_c = map.get(key)) !== null && _c !== void 0 ? _c : [];\n            list.push(value);\n            map.set(key, list);\n            return map;\n        }, new Map());\n        const bEntries = [...b].reduce((map, [key, value]) => {\n            var _c;\n            const list = (_c = map.get(key)) !== null && _c !== void 0 ? _c : [];\n            list.push(value);\n            map.set(key, list);\n            return map;\n        }, new Map());\n        return aEntries.size === bEntries.size\n            && [...aEntries].every(([key, values]) => {\n                const _values = bEntries.get(key);\n                return isEqual(values, _values);\n            });\n    }\n    else if (typeof Storage === \"function\" && a instanceof Storage) {\n        return isEqual({ ...a }, { ...b });\n    }\n    else {\n        return doCompare(a, b) === 0;\n    }\n}\n/**\n * Creates an object base on the original object but without any invalid values\n * (except for `null`), and trims the value if it's a string.\n *\n * **NOTE:** This function only operates on plain objects and arrays.\n *\n * @example\n * ```ts\n * import { sanitize } from \"@ayonli/jsext/object\";\n *\n * const obj = sanitize({\n *     foo: \"Hello\",\n *     bar: \"  World  \",\n *     baz: undefined,\n *     num: NaN,\n * });\n *\n * console.log(obj); // { foo: \"Hello\", bar: \"World\" }\n * ```\n */\nexport function sanitize(obj, deep = false, options = {}) {\n    const { removeNulls, removeEmptyStrings, removeEmptyObjects, removeArrayItems } = options;\n    return (function process(target, depth) {\n        if (typeof target === \"string\") {\n            return target.trim();\n        }\n        else if (Array.isArray(target)) {\n            const arr = !depth || deep ? target.map(item => process(item, depth + 1)) : target;\n            if (removeArrayItems) {\n                return arr.filter(value => {\n                    if (value === null) {\n                        return !removeNulls;\n                    }\n                    else if (value === \"\") {\n                        return !removeEmptyStrings;\n                    }\n                    else if (isValid(value)) {\n                        if (typeof value !== \"object\") {\n                            return true;\n                        }\n                        else if (Array.isArray(value)) {\n                            return value.length > 0 || !removeEmptyObjects;\n                        }\n                        else if (isPlainObject(value)) {\n                            return Reflect.ownKeys(value).length > 0 || !removeEmptyObjects;\n                        }\n                        else {\n                            return true;\n                        }\n                    }\n                    else {\n                        return false;\n                    }\n                });\n            }\n            else {\n                return arr;\n            }\n        }\n        else if (isPlainObject(target)) {\n            return !depth || deep ? Reflect.ownKeys(target).reduce((result, key) => {\n                const value = process(target[key], depth + 1);\n                if (value === null) {\n                    if (!removeNulls) {\n                        result[key] = value;\n                    }\n                }\n                else if (value === \"\") {\n                    if (!removeEmptyStrings) {\n                        result[key] = value;\n                    }\n                }\n                else if (isValid(value)) {\n                    if (typeof value !== \"object\") {\n                        result[key] = value;\n                    }\n                    else if (Array.isArray(value)) {\n                        if (value.length > 0 || !removeEmptyObjects) {\n                            result[key] = value;\n                        }\n                    }\n                    else if (isPlainObject(value)) {\n                        if (Reflect.ownKeys(value).length > 0 || !removeEmptyObjects) {\n                            result[key] = value;\n                        }\n                    }\n                    else {\n                        result[key] = value;\n                    }\n                }\n                return result;\n            }, target.constructor ? {} : Object.create(null)) : target;\n        }\n        else {\n            return target;\n        }\n    })(obj, 0);\n}\n/**\n * Creates an object with sorted keys (in ascending order) of the original object.\n *\n * **NOTE:** Symbol keys are not sorted and remain their original order.\n *\n * **NOTE:** This function only operates on plain objects and arrays.\n *\n * @example\n * ```ts\n * import { sortKeys } from \"@ayonli/jsext/object\";\n *\n * const obj = sortKeys({ foo: \"Hello\", bar: \"World\" });\n *\n * console.log(JSON.stringify(obj)); // { \"bar\": \"World\", \"foo\": \"Hello\" }\n * ```\n */\nexport function sortKeys(obj, deep = false) {\n    return (function process(target, depth) {\n        if (isPlainObject(target)) {\n            return !depth || deep ? [\n                ...Object.getOwnPropertyNames(target).sort(), // sort the string keys\n                ...Object.getOwnPropertySymbols(target)\n            ].reduce((result, key) => {\n                result[key] = process(target[key], depth + 1);\n                return result;\n            }, target.constructor ? {} : Object.create(null)) : target;\n        }\n        else if (Array.isArray(target)) {\n            return !depth || deep ? target.map(item => process(item, depth + 1)) : target;\n        }\n        else {\n            return target;\n        }\n    })(obj, 0);\n}\n/**\n * Create an object with flatted keys of the original object, the children\n * nodes' properties will be transformed to a string-represented path.\n *\n * **NOTE:** This function only operates on plain objects and arrays.\n *\n * @param depth Default value: `1`.\n * @example\n * ```ts\n * import { flatKeys } from \"@ayonli/jsext/object\";\n *\n * const obj = flatKeys({ foo: { bar: \"Hello\", baz: \"World\" } });\n *\n * console.log(obj); // { \"foo.bar\": \"Hello\", \"foo.baz\": \"World\" }\n * ```\n */\nexport function flatKeys(obj, depth = 1, options = {}) {\n    var _c;\n    const maxDepth = depth;\n    const carrier = obj.constructor ? {} : Object.create(null);\n    const flatArrayIndices = (_c = options === null || options === void 0 ? void 0 : options.flatArrayIndices) !== null && _c !== void 0 ? _c : false;\n    if (!isPlainObject(obj) && (!Array.isArray(obj) || !flatArrayIndices)) {\n        return obj;\n    }\n    (function process(target, path, depth) {\n        if (depth === maxDepth) {\n            carrier[path] = target;\n        }\n        else if (Array.isArray(target) && depth) {\n            if (!flatArrayIndices) {\n                carrier[path] = target;\n            }\n            else {\n                target.forEach((value, i) => {\n                    process(value, path ? `${path}.${i}` : String(i), path ? depth + 1 : depth);\n                });\n            }\n        }\n        else if (isPlainObject(target) || (Array.isArray(target) && !depth)) {\n            Reflect.ownKeys(target).forEach(key => {\n                const value = target[key];\n                if (typeof key === \"symbol\") {\n                    if (depth === 0) { // only allow top-level symbol properties\n                        carrier[key] = value;\n                    }\n                }\n                else {\n                    process(value, path ? `${path}.${key}` : key, path ? depth + 1 : depth);\n                }\n            });\n        }\n        else {\n            carrier[path] = target;\n        }\n    })(obj, \"\", 0);\n    return carrier;\n}\n/**\n * Returns a new record with all entries of the given record except the ones\n * that do not match the given predicate.\n *\n * This function is effectively as\n * `Object.fromEntries(Object.entries(obj).filter(predicate))`.\n *\n * @example\n * ```ts\n * import { filterEntries } from \"@ayonli/jsext/object\";\n *\n * const obj = { foo: \"Hello\", bar: \"World\" };\n * const result = filterEntries(obj, ([key]) => key === \"foo\");\n *\n * console.log(result); // { foo: \"Hello\" }\n * ```\n */\nexport function filterEntries(obj, predicate) {\n    return Object.fromEntries(Object.entries(obj).filter(predicate));\n}\n/**\n * Applies the given transformer to all entries in the given record and returns\n * a new record containing the results.\n *\n * This function is effectively as\n * `Object.fromEntries(Object.entries(obj).map(transformer))`.\n *\n * @example\n * ```ts\n * import { mapEntries } from \"@ayonli/jsext/object\";\n *\n * const obj = { foo: \"Hello\", bar: \"World\" };\n * const result = mapEntries(obj, ([key, value]) => [key, value.toUpperCase()]);\n *\n * console.log(result); // { foo: \"HELLO\", bar: \"WORLD\" }\n * ```\n */\nexport function mapEntries(obj, transformer) {\n    return Object.fromEntries(Object.entries(obj).map(transformer));\n}\n/**\n * Returns a tuple of two records with the first one containing all entries of\n * the given record that match the given predicate and the second one containing\n * all that do not.\n *\n * @example\n * ```ts\n * import { partitionEntries } from \"@ayonli/jsext/object\";\n *\n * const obj = { foo: \"Hello\", bar: \"World\" };\n * const [match, rest] = partitionEntries(obj, ([key]) => key === \"foo\");\n *\n * console.log(match); // { foo: \"Hello\" }\n * console.log(rest); // { bar: \"World\" }\n * ```\n */\nexport function partitionEntries(record, predicate) {\n    const match = {};\n    const rest = {};\n    const entries = Object.entries(record);\n    for (const [key, value] of entries) {\n        if (predicate([key, value])) {\n            match[key] = value;\n        }\n        else {\n            rest[key] = value;\n        }\n    }\n    return [match, rest];\n}\n/**\n * Composes a new record with all keys and values inverted.\n *\n * This function is effectively as\n * `Object.fromEntries(Object.entries(record).map(([key, value]) => [value, key]))`.\n *\n * @example\n * ```ts\n * import { invert } from \"@ayonli/jsext/object\";\n *\n * const obj = { foo: \"Hello\", bar: \"World\" };\n * const result = invert(obj);\n *\n * console.log(result); // { Hello: \"foo\", World: \"bar\" }\n * ```\n */\nexport function invert(record) {\n    return Object.fromEntries(Object.entries(record).map(([key, value]) => [value, key]));\n}\n//# sourceMappingURL=object.js.map","import { first as _first, last as _last, chunk as _chunk, count as _count, equals as _equals, includesSlice as _includesSlice, startsWith as _startsWith, endsWith as _endsWith, groupBy as _groupBy, keyBy as _keyBy, orderBy as _orderBy, random as _random, shuffle as _shuffle, split as _split, unique as _unique, uniqueBy as _uniqueBy, partition as _partition, } from \"../array.ts\";\nArray.prototype.first = function first() {\n    return _first(this);\n};\nArray.prototype.last = function last() {\n    return _last(this);\n};\nArray.prototype.random = function random(remove = false) {\n    return _random(this, remove);\n};\nArray.prototype.count = function count(ele) {\n    return _count(this, ele);\n};\nArray.prototype.equals = function equals(another) {\n    return _equals(this, another);\n};\nArray.prototype.includesSlice = function includesSlice(slice) {\n    return _includesSlice(this, slice);\n};\nArray.prototype.startsWith = function startsWith(prefix) {\n    return _startsWith(this, prefix);\n};\nArray.prototype.endsWith = function endsWith(suffix) {\n    return _endsWith(this, suffix);\n};\nArray.prototype.split = function split(delimiter) {\n    return _split(this, delimiter);\n};\nArray.prototype.chunk = function chunk(length) {\n    return _chunk(this, length);\n};\nArray.prototype.unique = function unique() {\n    return _unique(this);\n};\nArray.prototype.uniqueBy = function uniqueBy(fn) {\n    return _uniqueBy(this, fn);\n};\nArray.prototype.shuffle = function shuffle() {\n    return _shuffle(this);\n};\nArray.prototype.toShuffled = function toShuffled() {\n    return this.slice().shuffle();\n};\nif (!Array.prototype.toReversed) {\n    Array.prototype.toReversed = function toReversed() {\n        return this.slice().reverse();\n    };\n}\nif (!Array.prototype.toSorted) {\n    Array.prototype.toSorted = function toSorted(fn) {\n        return this.slice().sort(fn);\n    };\n}\nArray.prototype.orderBy = function orderBy(key, order = \"asc\") {\n    return _orderBy(this, key, order);\n};\nArray.prototype.groupBy = function groupBy(fn, type = Object) {\n    return _groupBy(this, fn, type);\n};\nArray.prototype.keyBy = function keyBy(fn, type = Object) {\n    return _keyBy(this, fn, type);\n};\nArray.prototype.partition = function partition(predicate) {\n    return _partition(this, predicate);\n};\n//# sourceMappingURL=array.js.map","import { compare, equals as _equals, includesSlice as _includesSlice, startsWith as _startsWith, endsWith as _endsWith, split as _split, chunk as _chunk, concat, copy, } from \"../bytes.ts\";\nUint8Array.copy = copy;\nUint8Array.concat = concat;\nUint8Array.compare = compare;\nUint8Array.prototype.equals = function equals(another) {\n    return _equals(this, another);\n};\nUint8Array.prototype.includesSlice = function includesSlice(slice) {\n    return _includesSlice(this, slice);\n};\nUint8Array.prototype.startsWith = function startsWith(prefix) {\n    return _startsWith(this, prefix);\n};\nUint8Array.prototype.endsWith = function endsWith(suffix) {\n    return _endsWith(this, suffix);\n};\nUint8Array.prototype.split = function split(delimiter) {\n    return _split(this, delimiter);\n};\nUint8Array.prototype.chunk = function chunk(length) {\n    return _chunk(this, length);\n};\n//# sourceMappingURL=uint8array.js.map","var _a, _b;\nexport const id = Symbol.for(\"id\");\nexport const isBrowserWindow = typeof window === \"object\"\n    && typeof window.document === \"object\"\n    && typeof window.matchMedia === \"function\";\nexport const isServiceWorker = typeof ServiceWorkerGlobalScope === \"function\"\n    && globalThis instanceof ServiceWorkerGlobalScope;\nexport const isSharedWorker = typeof SharedWorkerGlobalScope === \"function\"\n    && globalThis instanceof SharedWorkerGlobalScope;\nexport const isDedicatedWorker = typeof DedicatedWorkerGlobalScope === \"function\"\n    && globalThis instanceof DedicatedWorkerGlobalScope;\nexport const isWorker = isServiceWorker || isSharedWorker || isDedicatedWorker;\nexport const isDeno = typeof Deno === \"object\" && !!((_a = Deno.version) === null || _a === void 0 ? void 0 : _a.deno);\nexport const isBun = typeof Bun === \"object\" && !!Bun.version;\nexport const isNodeLike = typeof process === \"object\" && !!((_b = process.versions) === null || _b === void 0 ? void 0 : _b.node) && !isDeno;\nexport const isNode = isNodeLike && !isDeno && !isBun;\nexport const isNodeBelow14 = isNode && parseInt(process.version.slice(1)) < 14;\nexport const isNodeBelow16 = isNode && parseInt(process.version.slice(1)) < 16;\nexport const isNodeBelow20 = isNode && parseInt(process.version.slice(1)) < 20;\nconst isNodeWorkerThread = isNode\n    && (process.abort.disabled === true || process.argv.includes(\"--worker-thread\"));\nexport const isMainThread = !isNodeWorkerThread\n    && (isBun ? Bun.isMainThread : typeof WorkerGlobalScope === \"undefined\");\n//# sourceMappingURL=env.js.map","import { hasOwn, hasOwnMethod, omit, patch, pick, as, typeOf, isValid, isPlainObject, sanitize, sortKeys, flatKeys, filterEntries, mapEntries, partitionEntries, invert, compare, equals, } from \"../object.ts\";\nif (!Object.hasOwn) {\n    Object.hasOwn = hasOwn;\n}\nif (!Object.hasOwnMethod) {\n    Object.hasOwnMethod = hasOwnMethod;\n}\nObject.patch = patch;\nObject.pick = pick;\nObject.omit = omit;\nObject.as = as;\nObject.typeOf = typeOf;\nObject.isValid = isValid;\nObject.isPlainObject = isPlainObject;\nObject.compare = compare;\nObject.equals = equals;\nObject.sanitize = sanitize;\nObject.sortKeys = sortKeys;\nObject.flatKeys = flatKeys;\nObject.filterEntries = filterEntries;\nObject.mapEntries = mapEntries;\nObject.partitionEntries = partitionEntries;\nObject.invert = invert;\n//# sourceMappingURL=object.js.map","import { avg, product, sum, round } from \"../math.ts\";\nMath.sum = sum;\nMath.avg = avg;\nMath.product = product;\nMath.round = round;\n//# sourceMappingURL=math.js.map","/**\n * Functions for working with events.\n * @module\n */\nimport \"./external/event-target-polyfill/index.ts\";\nexport function createErrorEvent(type, options = {}) {\n    var _a, _b, _c, _d, _e, _f, _g, _h;\n    if (typeof ErrorEvent === \"function\") {\n        return new ErrorEvent(type, options);\n    }\n    else {\n        const event = new Event(type, {\n            bubbles: (_a = options === null || options === void 0 ? void 0 : options.bubbles) !== null && _a !== void 0 ? _a : false,\n            cancelable: (_b = options === null || options === void 0 ? void 0 : options.cancelable) !== null && _b !== void 0 ? _b : false,\n            composed: (_c = options === null || options === void 0 ? void 0 : options.composed) !== null && _c !== void 0 ? _c : false,\n        });\n        Object.defineProperties(event, {\n            message: { configurable: true, value: (_d = options === null || options === void 0 ? void 0 : options.message) !== null && _d !== void 0 ? _d : \"\" },\n            filename: { configurable: true, value: (_e = options === null || options === void 0 ? void 0 : options.filename) !== null && _e !== void 0 ? _e : \"\" },\n            lineno: { configurable: true, value: (_f = options === null || options === void 0 ? void 0 : options.lineno) !== null && _f !== void 0 ? _f : 0 },\n            colno: { configurable: true, value: (_g = options === null || options === void 0 ? void 0 : options.colno) !== null && _g !== void 0 ? _g : 0 },\n            error: { configurable: true, value: (_h = options === null || options === void 0 ? void 0 : options.error) !== null && _h !== void 0 ? _h : undefined },\n        });\n        return event;\n    }\n}\nexport function createCloseEvent(type, options = {}) {\n    var _a, _b, _c, _d, _e, _f;\n    if (typeof CloseEvent === \"function\") {\n        return new CloseEvent(type, options);\n    }\n    else {\n        const event = new Event(type, {\n            bubbles: (_a = options === null || options === void 0 ? void 0 : options.bubbles) !== null && _a !== void 0 ? _a : false,\n            cancelable: (_b = options === null || options === void 0 ? void 0 : options.cancelable) !== null && _b !== void 0 ? _b : false,\n            composed: (_c = options === null || options === void 0 ? void 0 : options.composed) !== null && _c !== void 0 ? _c : false,\n        });\n        Object.defineProperties(event, {\n            code: { configurable: true, value: (_d = options.code) !== null && _d !== void 0 ? _d : 0 },\n            reason: { configurable: true, value: (_e = options.reason) !== null && _e !== void 0 ? _e : \"\" },\n            wasClean: { configurable: true, value: (_f = options.wasClean) !== null && _f !== void 0 ? _f : false },\n        });\n        return event;\n    }\n}\nexport function createProgressEvent(type, options = {}) {\n    var _a, _b, _c, _d, _e, _f;\n    if (typeof ProgressEvent === \"function\") {\n        return new ProgressEvent(type, options);\n    }\n    else {\n        const event = new Event(type, {\n            bubbles: (_a = options === null || options === void 0 ? void 0 : options.bubbles) !== null && _a !== void 0 ? _a : false,\n            cancelable: (_b = options === null || options === void 0 ? void 0 : options.cancelable) !== null && _b !== void 0 ? _b : false,\n            composed: (_c = options === null || options === void 0 ? void 0 : options.composed) !== null && _c !== void 0 ? _c : false,\n        });\n        Object.defineProperties(event, {\n            lengthComputable: { configurable: true, value: (_d = options === null || options === void 0 ? void 0 : options.lengthComputable) !== null && _d !== void 0 ? _d : false },\n            loaded: { configurable: true, value: (_e = options === null || options === void 0 ? void 0 : options.loaded) !== null && _e !== void 0 ? _e : 0 },\n            total: { configurable: true, value: (_f = options === null || options === void 0 ? void 0 : options.total) !== null && _f !== void 0 ? _f : 0 },\n        });\n        return event;\n    }\n}\n/**\n * Creates a `CustomEvent` instance based on the given options. If the\n * `CustomEvent` constructor is not available, the generic `Event` constructor\n * will be used instead, and the options will be attached to the event as its\n * properties.\n */\nexport function createCustomEvent(type, options = {}) {\n    var _a, _b, _c, _d;\n    if (typeof CustomEvent === \"function\") {\n        return new CustomEvent(type, options);\n    }\n    else {\n        const event = new Event(type, {\n            bubbles: (_a = options === null || options === void 0 ? void 0 : options.bubbles) !== null && _a !== void 0 ? _a : false,\n            cancelable: (_b = options === null || options === void 0 ? void 0 : options.cancelable) !== null && _b !== void 0 ? _b : false,\n            composed: (_c = options === null || options === void 0 ? void 0 : options.composed) !== null && _c !== void 0 ? _c : false,\n        });\n        Object.defineProperties(event, {\n            detail: { configurable: true, value: (_d = options === null || options === void 0 ? void 0 : options.detail) !== null && _d !== void 0 ? _d : null },\n        });\n        return event;\n    }\n}\n//# sourceMappingURL=event.js.map","/**\n * Parses the `User-Agent` header or the `navigator.userAgent` property.\n *\n * @example\n * ```ts\n * const ua = parseUserAgent(\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36\");\n * console.log(ua);\n * // {\n * //     name: \"Chrome\",\n * //     version: \"91.0.4472.124\",\n * //     runtime: { identity: \"chrome\", version: \"91.0.4472.124\" },\n * //     platform: \"windows\",\n * //     mobile: false,\n * //     raw: \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36\",\n * // }\n * ```\n */\nexport function parseUserAgent(str) {\n    var _a, _b, _c, _d, _e;\n    if (!str)\n        throw new TypeError(\"The user agent string cannot be empty.\");\n    const ua = {\n        name: \"\",\n        version: undefined,\n        runtime: undefined,\n        platform: \"unknown\",\n        mobile: /Mobile/i.test(str),\n        raw: str,\n    };\n    let matches = [...str.matchAll(/(\\S+)\\/(\\d+(\\.\\d+)*)(\\s\\((.+?)\\))?/g)].map((match) => {\n        const [, name, version, , , extra] = match;\n        return { name: name, version: version, extra };\n    });\n    if (matches.length === 0 && str.length) {\n        ua.name = str;\n        if (/Cloudflare[-\\s]Workers?/i.test(str)) {\n            ua.runtime = { identity: \"workerd\", version: undefined };\n        }\n        return ua;\n    }\n    const osInfo = (_a = matches.find(match => { var _a; return (_a = match.extra) === null || _a === void 0 ? void 0 : _a.includes(\";\"); })) === null || _a === void 0 ? void 0 : _a.extra;\n    if (osInfo) {\n        if (osInfo.includes(\"Macintosh\") ||\n            osInfo.includes(\"iPhone\") ||\n            osInfo.includes(\"iPad\") ||\n            osInfo.includes(\"iPod\")) {\n            ua.platform = \"darwin\";\n        }\n        else if (osInfo.includes(\"Windows\")) {\n            ua.platform = \"windows\";\n        }\n        else if (osInfo.includes(\"Android\")) {\n            ua.platform = \"android\";\n        }\n        else if (osInfo.includes(\"Linux\")) {\n            ua.platform = \"linux\";\n        }\n        else if (osInfo.includes(\"FreeBSD\")) {\n            ua.platform = \"freebsd\";\n        }\n        else if (osInfo.includes(\"OpenBSD\")) {\n            ua.platform = \"openbsd\";\n        }\n        else if (osInfo.includes(\"NetBSD\")) {\n            ua.platform = \"netbsd\";\n        }\n        else if (osInfo.includes(\"AIX\")) {\n            ua.platform = \"aix\";\n        }\n        else if (osInfo.match(/SunOS|Solaris/)) {\n            ua.platform = \"solaris\";\n        }\n    }\n    let safari = matches.find(match => match.name === \"Safari\");\n    const chrome = matches.find(match => /Chrome|CriOS/i.test(match.name));\n    const firefox = matches.find(match => /Firefox|FxiOS/i.test(match.name));\n    const opera = matches.find(match => /Opera|OPR(iOS)?|OPT|OPR/i.test(match.name));\n    const edge = matches.find(match => /Edg(e|A|iOS)?/i.test(match.name));\n    const duckDuckGo = matches.find(match => /DuckDuckGo|Ddg(A|iOS)?/i.test(match.name));\n    const weChat = (_b = matches.find(match => /(Mac)?WeChat/i.test(match.name))) !== null && _b !== void 0 ? _b : matches.find(match => /MicroMessenger/i.test(match.name));\n    const dingTalk = str.match(/\\b(DingTalk)\\/(\\d+(\\.\\d+)+)/);\n    let node;\n    let deno;\n    let bun;\n    if (ua.mobile && ua.platform === \"darwin\" && !safari && !chrome && !firefox) {\n        safari = matches.find(match => match.name === \"AppleWebKit\"); // fallback to WebKit\n    }\n    if (ua.mobile && ua.platform === \"darwin\" && safari) {\n        // In iOS and iPadOS, browsers are always Safari-based.\n        ua.runtime = { identity: \"safari\", version: safari.version };\n        if (opera) {\n            ua.name = \"Opera\";\n            ua.version = opera.version;\n        }\n        else if (edge) {\n            ua.name = \"Edge\";\n            ua.version = edge.version;\n        }\n        else if (chrome) {\n            ua.name = \"Chrome\";\n            ua.version = chrome.version;\n        }\n        else if (firefox) {\n            ua.name = \"Firefox\";\n            ua.version = firefox.version;\n        }\n        else if (duckDuckGo) {\n            ua.name = \"DuckDuckGo\";\n            ua.version = duckDuckGo.version;\n        }\n        else if (weChat) {\n            ua.name = \"WeChat\";\n            ua.version = weChat.version;\n        }\n        else if (dingTalk) {\n            ua.name = \"DingTalk\";\n            ua.version = dingTalk[2];\n        }\n        else {\n            const last = matches[matches.length - 1];\n            ua.name = last.name;\n            ua.version = last.version;\n        }\n    }\n    else if (safari && !chrome && !firefox) {\n        ua.runtime = { identity: \"safari\", version: safari.version };\n        if (duckDuckGo) {\n            ua.name = \"DuckDuckGo\";\n            ua.version = duckDuckGo.version;\n        }\n        else if (weChat) {\n            ua.name = \"WeChat\";\n            ua.version = weChat.version;\n        }\n        else if (dingTalk) {\n            ua.name = \"DingTalk\";\n            ua.version = dingTalk[2];\n        }\n        else {\n            const index = matches.findIndex(match => match === safari);\n            const next = (_c = matches[index + 1]) !== null && _c !== void 0 ? _c : matches[matches.length - 1];\n            ua.name = next.name;\n            ua.version = next.version;\n        }\n    }\n    else if (chrome && !firefox) {\n        ua.runtime = { identity: \"chrome\", version: chrome.version };\n        if (opera) {\n            ua.name = \"Opera\";\n            ua.version = opera.version;\n        }\n        else if (edge) {\n            ua.name = \"Edge\";\n            ua.version = edge.version;\n        }\n        else if (duckDuckGo) {\n            ua.name = \"DuckDuckGo\";\n            ua.version = duckDuckGo.version;\n        }\n        else if (weChat) {\n            ua.name = \"WeChat\";\n            ua.version = weChat.version;\n        }\n        else if (dingTalk) {\n            ua.name = \"DingTalk\";\n            ua.version = dingTalk[2];\n        }\n        else {\n            const index = matches.findIndex(match => match === chrome);\n            const next = (_d = matches[index + 1]) !== null && _d !== void 0 ? _d : matches[matches.length - 1];\n            if (next.name === \"Safari\") { // Chrome pretending to be Safari\n                ua.name = \"Chrome\";\n                ua.version = chrome.version;\n            }\n            else {\n                ua.name = next.name;\n                ua.version = next.version;\n            }\n        }\n    }\n    else if (firefox && !chrome) {\n        ua.runtime = { identity: \"firefox\", version: firefox.version };\n        const index = matches.findIndex(match => match === firefox);\n        const next = (_e = matches[index + 1]) !== null && _e !== void 0 ? _e : matches[matches.length - 1];\n        if (next.name === \"Safari\") { // Firefox pretending to be Safari\n            ua.name = \"Firefox\";\n            ua.version = firefox.version;\n        }\n        else {\n            ua.name = next.name;\n            ua.version = next.version;\n        }\n    }\n    else if (edge) { // Old Edge\n        ua.name = \"Edge\";\n        ua.version = edge.version;\n        ua.runtime = { identity: \"unknown\", version: edge.version };\n    }\n    else if (duckDuckGo) {\n        ua.name = \"DuckDuckGo\";\n        ua.version = duckDuckGo.version;\n        ua.runtime = { identity: \"unknown\", version: duckDuckGo.version };\n    }\n    else if (node = matches.find(match => match.name === \"Node.js\")) {\n        ua.name = \"Node.js\";\n        ua.version = node.version;\n        ua.runtime = { identity: \"node\", version: node.version };\n    }\n    else if (deno = matches.find(match => match.name === \"Deno\")) {\n        ua.name = \"Deno\";\n        ua.version = deno.version;\n        ua.runtime = { identity: \"deno\", version: deno.version };\n    }\n    else if (bun = matches.find(match => match.name === \"Bun\")) {\n        ua.name = \"Bun\";\n        ua.version = bun.version;\n        ua.runtime = { identity: \"bun\", version: bun.version };\n    }\n    else if (dingTalk) {\n        ua.name = \"DingTalk\";\n        ua.version = dingTalk[2];\n    }\n    else {\n        const last = matches[matches.length - 1];\n        ua.name = last.name;\n        ua.version = last.version;\n    }\n    return ua;\n}\n//# sourceMappingURL=user-agent.js.map","/**\n * Utility functions to retrieve runtime information or configure runtime behaviors.\n * @module\n */\nimport { isBun, isDeno, isNode, isMainThread, isServiceWorker, isSharedWorker, isDedicatedWorker, isNodeLike, } from \"./env.ts\";\nimport { createCloseEvent } from \"./event.ts\";\nimport { parseUserAgent } from \"./http/user-agent.ts\";\n;\n/**\n * Returns the information of the runtime environment in which the program is\n * running.\n *\n * @example\n * ```ts\n * import runtime from \"@ayonli/jsext/runtime\";\n *\n * console.log(runtime());\n *\n * // In Node.js\n * // {\n * //     identity: \"node\",\n * //     version: \"22.0.0\",\n * //     fsSupport: true,\n * //     tsSupport: false,\n * //     worker: undefined\n * // }\n *\n * // In Deno\n * // {\n * //     identity: \"deno\",\n * //     version: \"1.42.0\",\n * //     fsSupport: true,\n * //     tsSupport: true,\n * //     worker: undefined\n * // }\n *\n * // In the browser (Chrome)\n * // {\n * //     identity: \"chrome\",\n * //     version: \"125.0.0.0\",\n * //     fsSupport: true,\n * //     tsSupport: false,\n * //     worker: undefined\n * // }\n *\n * // ...\n * ```\n */\nexport default function runtime() {\n    var _a;\n    if (isDeno) {\n        return {\n            identity: \"deno\",\n            version: Deno.version.deno,\n            fsSupport: true,\n            tsSupport: true,\n            worker: isMainThread ? undefined : \"dedicated\",\n        };\n    }\n    else if (isBun) {\n        return {\n            identity: \"bun\",\n            version: Bun.version,\n            fsSupport: true,\n            tsSupport: true,\n            worker: isMainThread ? undefined : \"dedicated\",\n        };\n    }\n    else if (isNode) {\n        return {\n            identity: \"node\",\n            version: process.version.slice(1),\n            fsSupport: true,\n            tsSupport: process.execArgv.some(arg => /\\b(tsx|ts-node|vite|swc-node|tsimp)\\b/.test(arg))\n                || /\\.tsx?$|\\bvite\\b/.test((_a = process.argv[1]) !== null && _a !== void 0 ? _a : \"\"),\n            worker: isMainThread ? undefined : \"dedicated\",\n        };\n    }\n    const fsSupport = typeof FileSystemHandle === \"function\";\n    const worker = isSharedWorker ? \"shared\"\n        : isServiceWorker ? \"service\"\n            : isDedicatedWorker ? \"dedicated\"\n                : undefined;\n    if (typeof navigator === \"object\" && typeof navigator.userAgent === \"string\") {\n        const ua = parseUserAgent(navigator.userAgent);\n        if (ua.runtime) {\n            const { identity, version } = ua.runtime;\n            if (identity === \"workerd\") {\n                return {\n                    identity,\n                    version,\n                    fsSupport,\n                    tsSupport: (() => {\n                        try {\n                            throw new Error(\"Test error\");\n                        }\n                        catch (err) {\n                            return /[\\\\/]\\.?wrangler[\\\\/]/.test(err.stack);\n                        }\n                    })(),\n                    worker: \"service\",\n                };\n            }\n            else {\n                return {\n                    identity,\n                    version,\n                    fsSupport,\n                    tsSupport: false,\n                    worker,\n                };\n            }\n        }\n        else {\n            return {\n                identity: \"unknown\",\n                version: undefined,\n                fsSupport,\n                tsSupport: false,\n                worker,\n            };\n        }\n    }\n    else if (typeof WorkerLocation === \"function\" && globalThis.location instanceof WorkerLocation) {\n        return {\n            identity: \"fastly\",\n            version: undefined,\n            fsSupport,\n            tsSupport: false,\n            worker: \"service\",\n        };\n    }\n    return {\n        identity: \"unknown\",\n        version: undefined,\n        fsSupport,\n        tsSupport: false,\n        worker,\n    };\n}\nconst WellknownPlatforms = [\n    \"darwin\",\n    \"windows\",\n    \"linux\",\n    \"android\",\n    \"freebsd\",\n    \"openbsd\",\n    \"netbsd\",\n    \"aix\",\n    \"solaris\",\n];\n/**\n * Returns a string identifying the operating system platform in which the\n * program is running.\n */\nexport function platform() {\n    if (isDeno) {\n        if (WellknownPlatforms.includes(Deno.build.os)) {\n            return Deno.build.os;\n        }\n    }\n    else if (isNodeLike) {\n        if (process.platform === \"win32\") {\n            return \"windows\";\n        }\n        else if (process.platform === \"sunos\") {\n            return \"solaris\";\n        }\n        else if (WellknownPlatforms.includes(process.platform)) {\n            return process.platform;\n        }\n    }\n    else if (typeof navigator === \"object\" && typeof navigator.userAgent === \"string\") {\n        return parseUserAgent(navigator.userAgent).platform;\n    }\n    return \"unknown\";\n}\nconst ENV = {};\nexport function env(name = undefined, value = undefined) {\n    var _a, _b;\n    if (isDeno) {\n        if (typeof name === \"object\" && name !== null) {\n            for (const [key, val] of Object.entries(name)) {\n                Deno.env.set(key, String(val));\n            }\n        }\n        else if (name === undefined) {\n            return Deno.env.toObject();\n        }\n        else if (value === undefined) {\n            return Deno.env.get(name);\n        }\n        else {\n            Deno.env.set(name, String(value));\n        }\n    }\n    else if (typeof process === \"object\" // Check process.env instead of isNodeLike for\n        && typeof (process === null || process === void 0 ? void 0 : process.env) === \"object\" // broader adoption.\n    ) {\n        if (typeof name === \"object\" && name !== null) {\n            for (const [key, val] of Object.entries(name)) {\n                process.env[key] = String(val);\n            }\n        }\n        else if (name === undefined) {\n            return process.env;\n        }\n        else if (value === undefined) {\n            return process.env[name];\n        }\n        else {\n            process.env[name] = String(value);\n        }\n    }\n    else if (runtime().identity === \"workerd\") {\n        if (typeof name === \"object\" && name !== null) {\n            for (const [key, val] of Object.entries(name)) {\n                if ([\"string\", \"number\", \"boolean\"].includes(typeof val)) {\n                    ENV[key] = String(val);\n                }\n            }\n        }\n        else if (name === undefined) {\n            if (Object.keys(ENV).length) {\n                return ENV;\n            }\n            else {\n                const keys = Object.keys(globalThis).filter(key => {\n                    return /^[A-Z][A-Z0-9_]*$/.test(key)\n                        // @ts-ignore\n                        && [\"string\", \"number\", \"boolean\"].includes(typeof globalThis[key]);\n                });\n                return keys.reduce((record, key) => {\n                    // @ts-ignore\n                    record[key] = String(globalThis[key]);\n                    return record;\n                }, {});\n            }\n        }\n        else if (value === undefined) {\n            if (ENV[name] !== undefined) {\n                return ENV[name];\n            }\n            else {\n                // @ts-ignore\n                const value = globalThis[name];\n                if ([\"string\", \"number\", \"boolean\"].includes(typeof value)) {\n                    return String(value);\n                }\n                else {\n                    return undefined;\n                }\n            }\n        }\n        else {\n            throw new Error(\"Cannot modify environment variables in the worker.\");\n        }\n    }\n    else {\n        // @ts-ignore\n        const env = globalThis[\"__env__\"];\n        // @ts-ignore\n        if (env === undefined || env === null || typeof env === \"object\") {\n            if (typeof name === \"object\" && name !== null) {\n                for (const [key, val] of Object.entries(name)) {\n                    // @ts-ignore\n                    ((_a = globalThis[\"__env__\"]) !== null && _a !== void 0 ? _a : (globalThis[\"__env__\"] = {}))[key] = String(val);\n                }\n            }\n            else if (name === undefined) {\n                return env !== null && env !== void 0 ? env : {};\n            }\n            else if (value === undefined) {\n                return (env === null || env === void 0 ? void 0 : env[name]) ? String(env[name]) : undefined;\n            }\n            else {\n                // @ts-ignore\n                ((_b = globalThis[\"__env__\"]) !== null && _b !== void 0 ? _b : (globalThis[\"__env__\"] = {}))[name] = String(value);\n            }\n        }\n        else if (typeof name === \"object\" && name !== null) {\n            for (const [key, val] of Object.entries(name)) {\n                ENV[key] = String(val);\n            }\n        }\n        else if (name === undefined) {\n            return ENV;\n        }\n        else if (value === undefined) {\n            return ENV[name];\n        }\n        else {\n            env[name] = String(value);\n        }\n    }\n}\n/**\n * Detects if the program is running in a REPL environment.\n *\n * NOTE: This function currently returns `true` when in:\n * - Node.js REPL\n * - Deno REPL\n * - Bun REPL\n * - Google Chrome Console\n */\nexport function isREPL() {\n    return (\"_\" in globalThis && \"_error\" in globalThis)\n        || (\"$0\" in globalThis && \"$1\" in globalThis)\n        || (typeof $0 === \"object\" || typeof $1 === \"object\");\n}\n/**\n * Make the timer block the event loop from finishing again after it has been\n * unrefed.\n *\n * NOTE: This function is only available in Node.js, Deno and Bun, in other\n * environments, it's a no-op.\n */\nexport function refTimer(timer) {\n    if (typeof timer === \"object\" && typeof timer.ref === \"function\") {\n        timer.ref();\n    }\n    else if (typeof timer === \"number\" && isDeno) {\n        Deno.refTimer(timer);\n    }\n}\n/**\n * Make the timer not block the event loop from finishing.\n *\n * NOTE: This function is only available in Node.js, Deno and Bun, in other\n * environments, it's a no-op.\n *\n * @example\n * ```ts\n * import { unrefTimer } from \"@ayonli/jsext/runtime\";\n *\n * const timer = setTimeout(() => {\n *     console.log(\"Hello, World!\");\n * }, 1000);\n *\n * unrefTimer(timer);\n * ```\n */\nexport function unrefTimer(timer) {\n    if (typeof timer === \"object\" && typeof timer.unref === \"function\") {\n        timer.unref();\n    }\n    else if (typeof timer === \"number\" && isDeno) {\n        Deno.unrefTimer(timer);\n    }\n}\nconst shutdownListeners = [];\n/**\n * Adds a listener function to be called when the program receives a `SIGINT`\n * (`Ctrl+C`) signal, or a `shutdown` message sent by the parent process (a\n * **PM2** pattern for Windows), so that the program can perform a graceful\n * shutdown.\n *\n * This function can be called multiple times to register multiple listeners,\n * they will be executed in the order they were added, and any asynchronous\n * listener will be awaited before the next listener is executed.\n *\n * Inside the listener, there is no need to call `process.exit` or `Deno.exit`,\n * the program will exit automatically after all listeners are executed in order.\n * In fact, calling the `exit` method in a listener is problematic and will\n * cause any subsequent listeners not to be executed.\n *\n * The listener function receives a {@link CloseEvent}, if we don't what the program\n * to exit, we can call `event.preventDefault()` to prevent from exiting.\n *\n * In the browser or unsupported environments, this function is a no-op.\n *\n * @example\n * ```ts\n * import { addShutdownListener } from \"@ayonli/jsext/runtime\";\n * import { serve } from \"@ayonli/jsext/http\";\n *\n * const server = serve({\n *     fetch(req) {\n *         return new Response(\"Hello, World!\");\n *     }\n * });\n *\n * addShutdownListener(async () => {\n *     await server.close();\n * });\n * ```\n */\nexport function addShutdownListener(fn) {\n    if (!isDeno && !isNodeLike) {\n        return;\n    }\n    if (shutdownListeners.length) {\n        shutdownListeners.push(fn);\n        return;\n    }\n    shutdownListeners.push(fn);\n    const shutdownListener = async () => {\n        try {\n            const event = createCloseEvent(\"shutdown\", {\n                cancelable: true,\n                code: 0,\n                reason: \"The program is interrupted.\",\n                wasClean: true,\n            });\n            Object.defineProperties(event, {\n                target: { configurable: true, value: globalThis },\n                currentTarget: { configurable: true, value: globalThis },\n            });\n            for (const listener of shutdownListeners) {\n                await listener(event);\n            }\n            if (!event.defaultPrevented) {\n                if (isDeno) {\n                    Deno.exit(0);\n                }\n                else {\n                    process.exit(0);\n                }\n            }\n        }\n        catch (err) {\n            console.error(err);\n            if (isDeno) {\n                Deno.exit(1);\n            }\n            else {\n                process.exit(1);\n            }\n        }\n    };\n    if (isDeno) {\n        Deno.addSignalListener(\"SIGINT\", shutdownListener);\n    }\n    else {\n        process.on(\"SIGINT\", shutdownListener);\n        if (platform() === \"windows\") {\n            process.on(\"message\", message => {\n                if (message === \"shutdown\") {\n                    shutdownListener();\n                }\n            });\n        }\n    }\n}\nconst rejectionListeners = [];\n/**\n * Adds a listener function to be called when an unhandled promise rejection\n * occurs in the program, this function calls\n * `addEventListener(\"unhandledrejection\")` or `process.on(\"unhandledRejection\")`\n * under the hood.\n *\n * The purpose of this function is to provide a unified way to handle unhandled\n * promise rejections in different environments, and when possible, provide a\n * consistent behavior of the program when an unhandled rejection occurs.\n *\n * By default, when an unhandled rejection occurs, the program will log the\n * error to the console (and exit with a non-zero code in Node.js, Deno and Bun),\n * but this behavior can be customized by calling `event.preventDefault()` in\n * the listener function.\n *\n * In unsupported environments, this function is a no-op.\n *\n * @example\n * ```ts\n * import { addUnhandledRejectionListener } from \"@ayonli/jsext/runtime\";\n *\n * addUnhandledRejectionListener((event) => {\n *     console.error(event.reason);\n *     event.preventDefault(); // Prevent default logging and exiting behavior\n * });\n * ```\n */\nexport function addUnhandledRejectionListener(fn) {\n    const _runtime = runtime().identity;\n    const fireEvent = (reason, promise) => {\n        const event = new Event(\"unhandledrejection\", {\n            cancelable: true,\n        });\n        Object.defineProperties(event, {\n            reason: { configurable: true, value: reason },\n            promise: { configurable: true, value: promise },\n            target: { configurable: true, value: globalThis },\n            currentTarget: { configurable: true, value: globalThis },\n        });\n        rejectionListeners.forEach((listener) => {\n            listener.call(globalThis, event);\n        });\n        return event;\n    };\n    if (_runtime === \"node\" || _runtime === \"bun\") {\n        if (rejectionListeners.length) {\n            rejectionListeners.push(fn);\n            return;\n        }\n        rejectionListeners.push(fn);\n        process.on(\"unhandledRejection\", (reason, promise) => {\n            const event = fireEvent(reason, promise);\n            if (!event.defaultPrevented) {\n                if (_runtime === \"node\") {\n                    console.error(\"\\x1b[1m\\x1b[31merror\\x1b[0m: Uncaught (in promise)\", reason);\n                }\n                else {\n                    console.error(\"Uncaught (in promise)\", reason);\n                }\n                process.exit(1);\n            }\n        });\n    }\n    else if (_runtime === \"workerd\") {\n        if (rejectionListeners.length) {\n            rejectionListeners.push(fn);\n            return;\n        }\n        rejectionListeners.push(fn);\n        addEventListener(\"unhandledrejection\", (event) => {\n            // The `PromiseRejectionEvent` in Cloudflare Workers is incomplete,\n            // so we need to create a workaround to make it work.\n            event = fireEvent(event.reason, event.promise);\n            if (!event.defaultPrevented) {\n                console.error(\"Uncaught (in promise)\", event.reason);\n            }\n        });\n    }\n    else if (typeof addEventListener === \"function\"\n        && _runtime !== \"fastly\" // Fastly Compute doesn't support `unhandledrejection` event\n        && _runtime !== \"unknown\" // Unknown environment, don't know if it supports `unhandledrejection`\n    ) {\n        addEventListener(\"unhandledrejection\", fn);\n    }\n}\n/**\n * A unified symbol that can be used to customize the inspection behavior of an\n * object, currently supports Node.js, Bun and Deno.\n *\n * @example\n * ```ts\n * import { customInspect } from \"@ayonli/jsext/runtime\";\n *\n * class Point {\n *     constructor(public x: number, public y: number) {}\n *\n *    [customInspect]() {\n *        return `Point (${this.x}, ${this.y})`;\n *    }\n * }\n *\n * console.log(new Point(1, 2)); // Point (1, 2)\n * ```\n */\nexport const customInspect = (() => {\n    if (isDeno) {\n        return Symbol.for(\"Deno.customInspect\");\n    }\n    else if (isNodeLike) {\n        return Symbol.for(\"nodejs.util.inspect.custom\");\n    }\n    else {\n        return Symbol.for(\"Symbol.customInspect\");\n    }\n})();\n//# sourceMappingURL=runtime.js.map","/**\n * A generic exception class, which can be used to represent any kind of error.\n * It's similar to the `DOMException`, but for any JavaScript environment.\n *\n * @example\n * ```ts\n * // throw an exception with a name\n * import { Exception } from \"@ayonli/jsext/error\";\n *\n * throw new Exception(\"The resource cannot be found\", \"NotFoundError\");\n * ```\n *\n * @example\n * ```ts\n * // throw an exception with a code\n * import { Exception } from \"@ayonli/jsext/error\";\n *\n * throw new Exception(\"The resource cannot be found\", 404);\n * ```\n *\n * @example\n * ```ts\n * // rethrow an exception with a cause\n * import { Exception } from \"@ayonli/jsext/error\";\n *\n * try {\n *     throw new Error(\"Something went wrong\");\n * } catch (error) {\n *     throw new Exception(\"An error occurred\", { cause: error });\n * }\n * ```\n */\nexport default class Exception extends Error {\n    constructor(message, options = 0) {\n        super(message);\n        this.code = 0;\n        if (typeof options === \"number\") {\n            this.code = options;\n        }\n        else if (typeof options === \"string\") {\n            Object.defineProperty(this, \"name\", {\n                configurable: true,\n                enumerable: false,\n                writable: true,\n                value: options,\n            });\n        }\n        else {\n            if (options.name) {\n                Object.defineProperty(this, \"name\", {\n                    configurable: true,\n                    enumerable: false,\n                    writable: true,\n                    value: options.name,\n                });\n            }\n            if (options.cause) {\n                Object.defineProperty(this, \"cause\", {\n                    configurable: true,\n                    enumerable: false,\n                    writable: true,\n                    value: options.cause,\n                });\n            }\n            if (options.code) {\n                this.code = options.code;\n            }\n        }\n    }\n}\nObject.defineProperty(Exception.prototype, \"name\", {\n    configurable: true,\n    enumerable: false,\n    writable: true,\n    value: \"Exception\",\n});\n//# sourceMappingURL=Exception.js.map","/**\n * Functions for async/promise context handling.\n * @module\n */\nimport { unrefTimer } from \"./runtime.ts\";\nimport Exception from \"./error/Exception.ts\";\n/**\n * Creates a promise that can be resolved or rejected manually.\n *\n * This function is like `Promise.withResolvers` but less verbose.\n *\n * @example\n * ```ts\n * import { asyncTask } from \"@ayonli/jsext/async\";\n *\n * const task = asyncTask<number>();\n *\n * setTimeout(() => task.resolve(42), 1000);\n *\n * const result = await task;\n * console.log(result); // 42\n * ```\n */\nexport function asyncTask() {\n    let resolve;\n    let reject;\n    const promise = new Promise((res, rej) => {\n        resolve = res;\n        reject = rej;\n    });\n    return Object.assign(promise, {\n        resolve: resolve,\n        reject: reject\n    });\n}\nexport function abortable(task, signal) {\n    if (typeof task[Symbol.asyncIterator] === \"function\" &&\n        typeof task.then !== \"function\" // this skips ThenableAsyncGenerator\n    ) {\n        return abortableAsyncIterable(task, signal);\n    }\n    else {\n        return select([task], signal);\n    }\n}\nasync function* abortableAsyncIterable(task, signal) {\n    if (signal.aborted) {\n        throw signal.reason;\n    }\n    const aTask = asyncTask();\n    const handleAbort = () => aTask.reject(signal.reason);\n    signal.addEventListener(\"abort\", handleAbort, { once: true });\n    const it = task[Symbol.asyncIterator]();\n    while (true) {\n        const race = Promise.race([it.next(), aTask]);\n        race.catch(() => {\n            signal.removeEventListener(\"abort\", handleAbort);\n        });\n        const { done, value } = await race;\n        if (done) {\n            signal.removeEventListener(\"abort\", handleAbort);\n            return value; // async iterator may return a value\n        }\n        else {\n            yield value;\n        }\n    }\n}\nfunction createTimeoutError(ms) {\n    if (typeof DOMException === \"function\") {\n        return new DOMException(`Operation timeout after ${ms}ms`, \"TimeoutError\");\n    }\n    else {\n        return new Exception(`Operation timeout after ${ms}ms`, {\n            name: \"TimeoutError\",\n            code: 408,\n        });\n    }\n}\n/**\n * Try to resolve a promise with a timeout limit.\n *\n * @example\n * ```ts\n * import { timeout, sleep } from \"@ayonli/jsext/async\";\n *\n * const task = sleep(1000);\n *\n * await timeout(task, 500); // throws TimeoutError after 500ms\n * ```\n */\nexport async function timeout(task, ms) {\n    const result = await Promise.race([\n        task,\n        new Promise((_, reject) => unrefTimer(setTimeout(() => {\n            reject(createTimeoutError(ms));\n        }, ms)))\n    ]);\n    return result;\n}\n/**\n * Resolves a promise only after the given duration.\n *\n * @example\n * ```ts\n * import { after } from \"@ayonli/jsext/async\";\n *\n * const task = fetch(\"https://example.com\")\n * const res = await after(task, 1000);\n *\n * console.log(res); // the response will not be printed unless 1 second has passed\n * ```\n */\nexport async function after(task, ms) {\n    const [result] = await Promise.allSettled([\n        task,\n        new Promise(resolve => setTimeout(resolve, ms))\n    ]);\n    if (result.status === \"fulfilled\") {\n        return result.value;\n    }\n    else {\n        throw result.reason;\n    }\n}\n/**\n * Blocks the context for a given duration.\n *\n * @example\n * ```ts\n * import { sleep } from \"@ayonli/jsext/async\";\n *\n * console.log(\"Hello\");\n *\n * await sleep(1000);\n * console.log(\"World\"); // \"World\" will be printed after 1 second\n * ```\n */\nexport async function sleep(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n/**\n * Blocks the current routine until the test returns a truthy value, which is\n * not `false`, `null` or `undefined`. If the test throws an error, it will be\n * treated as a falsy value and the check continues.\n *\n * This functions returns the same result as the test function when passed.\n *\n * @example\n * ```ts\n * import { until } from \"@ayonli/jsext/async\";\n *\n * // wait for the header element to be present in the DOM\n * const ele = await until(() => document.querySelector(\"header\"));\n * ```\n */\nexport async function until(test) {\n    return new Promise((resolve) => {\n        let ongoing = false;\n        const timer = setInterval(async () => {\n            if (ongoing)\n                return;\n            try {\n                ongoing = true;\n                const result = await test();\n                if (result !== false && result !== null && result !== undefined) {\n                    clearInterval(timer);\n                    resolve(result);\n                }\n            }\n            catch (_a) {\n                // ignore\n            }\n            finally {\n                ongoing = false;\n            }\n        }, 1);\n    });\n}\n/**\n * Runs multiple tasks concurrently and returns the result of the first task that\n * completes. The rest of the tasks will be aborted.\n *\n * @param tasks An array of promises or functions that return promises.\n * @param signal A parent abort signal, if provided and aborted before any task\n *  completes, the function will reject immediately with the abort reason and\n *  cancel all tasks.\n *\n * @example\n * ```ts\n * // fetch example\n * import { select } from \"@ayonli/jsext/async\";\n *\n * const res = await select([\n *     signal => fetch(\"https://example.com\", { signal }),\n *     signal => fetch(\"https://example.org\", { signal }),\n *     fetch(\"https://example.net\"), // This task cannot actually be aborted, but ignored\n * ]);\n *\n * console.log(res); // the response from the first completed fetch\n * ```\n *\n * @example\n * ```ts\n * // with parent signal\n * import { select } from \"@ayonli/jsext/async\";\n *\n * const signal = AbortSignal.timeout(1000);\n *\n * try {\n *     const res = await select([\n *         signal => fetch(\"https://example.com\", { signal }),\n *         signal => fetch(\"https://example.org\", { signal }),\n *     ], signal);\n * } catch (err) {\n *     if ((err as Error).name === \"TimeoutError\") {\n *         console.error(err); // Error: signal timed out\n *     } else {\n *         throw err;\n *     }\n * }\n * ```\n */\nexport async function select(tasks, signal = undefined) {\n    if (signal === null || signal === void 0 ? void 0 : signal.aborted) {\n        throw signal.reason;\n    }\n    if (signal) {\n        tasks = [\n            ...tasks,\n            new Promise((_, reject) => {\n                signal.addEventListener(\"abort\", () => {\n                    reject(signal.reason);\n                }, { once: true });\n            })\n        ];\n    }\n    const controllers = new Map();\n    const result = await Promise.race(tasks.map((task, index) => {\n        if (typeof task === \"function\") {\n            const ctrl = new AbortController();\n            controllers.set(index, ctrl);\n            task = task(ctrl.signal);\n        }\n        return Promise.resolve(task)\n            .then(value => ({ index, value }))\n            .catch(reason => ({ index, reason }));\n    }));\n    for (const [index, ctrl] of controllers) {\n        if (index !== result.index) {\n            ctrl.signal.aborted || ctrl.abort();\n        }\n    }\n    if (\"reason\" in result) {\n        throw result.reason;\n    }\n    else {\n        return result.value;\n    }\n}\nexport function abortWith(_parent, options = undefined) {\n    let parent;\n    let timeout;\n    if (_parent instanceof AbortSignal) {\n        parent = _parent;\n        timeout = options === null || options === void 0 ? void 0 : options.timeout;\n    }\n    else if (_parent) {\n        parent = _parent.parent;\n        timeout = _parent.timeout;\n    }\n    if (!parent && !timeout) {\n        throw new TypeError(\"Must provide a parent signal or a timeout value, or both.\");\n    }\n    const ctrl = new AbortController();\n    const { signal } = ctrl;\n    if (parent) {\n        if (parent.aborted) {\n            ctrl.abort(parent.reason);\n            return ctrl;\n        }\n        const abort = () => {\n            signal.aborted || ctrl.abort(parent.reason);\n        };\n        parent.addEventListener(\"abort\", abort, { once: true });\n        signal.addEventListener(\"abort\", () => {\n            parent.aborted || parent.removeEventListener(\"abort\", abort);\n        });\n    }\n    if (timeout) {\n        const timer = setTimeout(() => {\n            signal.aborted || ctrl.abort(createTimeoutError(timeout));\n        }, timeout);\n        unrefTimer(timer);\n        signal.addEventListener(\"abort\", () => {\n            clearTimeout(timer);\n        }, { once: true });\n    }\n    return ctrl;\n}\n//# sourceMappingURL=async.js.map","import { after, sleep, timeout, until, select } from \"../async.ts\";\nPromise.timeout = timeout;\nPromise.after = after;\nPromise.sleep = sleep;\nPromise.until = until;\nPromise.select = select;\n//# sourceMappingURL=promise.js.map","const inverse = Symbol(\"inverse\");\n/**\n * Bi-directional map, keys and values are unique and map to each other.\n *\n * @example\n * ```ts\n * import { BiMap } from \"@ayonli/jsext/collections\";\n *\n * const map = new BiMap<string, string>();\n *\n * map.set(\"foo\", \"hello\");\n * map.set(\"bar\", \"world\");\n *\n * console.log(map.get(\"foo\")); // hello\n * console.log(map.getKey(\"world\")); // bar\n *\n * map.delete(\"foo\");\n * console.log(map.hasValue(\"hello\")); // false\n *\n * map.deleteValue(\"world\");\n * console.log(map.has(\"bar\")); // false\n * ```\n */\nexport default class BiMap extends Map {\n    get [Symbol.toStringTag]() {\n        return \"BiMap\";\n    }\n    constructor(iterable = null) {\n        super();\n        this[inverse] = new Map();\n        if (iterable) {\n            for (const [key, value] of iterable) {\n                this.set(key, value);\n            }\n        }\n    }\n    set(key, value) {\n        super.set(key, value);\n        this[inverse].set(value, key);\n        return this;\n    }\n    getKey(value) {\n        return this[inverse].get(value);\n    }\n    hasValue(value) {\n        return this[inverse].has(value);\n    }\n    deleteValue(value) {\n        if (this[inverse].has(value)) {\n            const key = this[inverse].get(value);\n            super.delete(key);\n            this[inverse].delete(value);\n            return true;\n        }\n        return false;\n    }\n    clear() {\n        super.clear();\n        this[inverse].clear();\n    }\n}\n//# sourceMappingURL=BiMap.js.map","/**\n * Case-insensitive map, keys are case-insensitive.\n *\n * @example\n * ```ts\n * import { CiMap } from \"@ayonli/jsext/collections\";\n *\n * const map = new CiMap<string, string>();\n *\n * map.set(\"foo\", \"hello\");\n * map.set(\"bar\", \"world\");\n *\n * console.log(map.get(\"FOO\")); // hello\n * console.log(map.has(\"BAR\")); // true\n * ```\n */\nexport default class CiMap extends Map {\n    get [Symbol.toStringTag]() {\n        return \"CiMap\";\n    }\n    constructor(iterable = null) {\n        super();\n        if (iterable) {\n            for (const [key, value] of iterable) {\n                this.set(key, value);\n            }\n        }\n    }\n    set(key, value) {\n        const id = String(key).toLowerCase();\n        super.set(id, { key, value });\n        return this;\n    }\n    get(key) {\n        var _a;\n        const id = String(key).toLowerCase();\n        return (_a = super.get(id)) === null || _a === void 0 ? void 0 : _a.value;\n    }\n    has(key) {\n        const id = String(key).toLowerCase();\n        return super.has(id);\n    }\n    delete(key) {\n        const id = String(key).toLowerCase();\n        return super.delete(id);\n    }\n    *entries() {\n        for (const { key, value } of super.values()) {\n            yield [key, value];\n        }\n    }\n    *keys() {\n        for (const { key } of super.values()) {\n            yield key;\n        }\n    }\n    *values() {\n        for (const { value } of super.values()) {\n            yield value;\n        }\n    }\n    forEach(callbackfn, thisArg) {\n        super.forEach(({ key, value }) => {\n            callbackfn(value, key, this);\n        }, thisArg);\n    }\n    [Symbol.iterator]() {\n        return this.entries();\n    }\n}\n//# sourceMappingURL=CiMap.js.map","/**\n * Functions for converting errors to/from other types of objects.\n * @module\n */\nimport { isPlainObject, omit } from \"./object.ts\";\nimport Exception from \"./error/Exception.ts\";\nimport { createErrorEvent } from \"./event.ts\";\nexport { Exception };\n/**\n * Transforms the error to a plain object.\n *\n * @example\n * ```ts\n * import { toObject } from \"@ayonli/jsext/error\";\n *\n * const err = new Error(\"Something went wrong.\");\n *\n * const obj = toObject(err);\n * console.log(obj);\n * // {\n * //     \"@@type\": \"Error\",\n * //     name: \"Error\",\n * //     message: \"Something went wrong.\",\n * //     stack: \"Error: Something went wrong.\\n    at <anonymous>:1:13\"\n * // }\n * ```\n */\nexport function toObject(err) {\n    if (!(err instanceof Error) && err[\"name\"] && err[\"message\"]) { // Error-like\n        err = fromObject(err, Error);\n    }\n    const obj = {\n        \"@@type\": err.constructor.name,\n        ...omit(err, [\"toString\", \"toJSON\", \"__callSiteEvals\"]),\n    };\n    if (obj[\"@@type\"] === \"AggregateError\" && Array.isArray(obj[\"errors\"])) {\n        obj[\"errors\"] = obj[\"errors\"].map(item => {\n            return item instanceof Error ? toObject(item) : item;\n        });\n    }\n    return obj;\n}\nexport function fromObject(obj, ctor = undefined) {\n    var _a, _b;\n    // @ts-ignore\n    if (!(obj === null || obj === void 0 ? void 0 : obj.name)) {\n        return null;\n    }\n    // @ts-ignore\n    ctor || (ctor = (globalThis[obj[\"@@type\"] || obj.name] || globalThis[obj.name]));\n    if (!ctor) {\n        if (obj[\"@@type\"] === \"Exception\") {\n            ctor = Exception;\n        }\n        else {\n            ctor = Error;\n        }\n    }\n    let err;\n    if (ctor.name === \"DOMException\" && typeof DOMException === \"function\") {\n        err = new ctor((_a = obj[\"message\"]) !== null && _a !== void 0 ? _a : \"\", obj[\"name\"]);\n    }\n    else {\n        err = Object.create(ctor.prototype, {\n            message: {\n                configurable: true,\n                enumerable: false,\n                writable: true,\n                value: (_b = obj[\"message\"]) !== null && _b !== void 0 ? _b : \"\",\n            },\n        });\n    }\n    if (err.name !== obj[\"name\"]) {\n        Object.defineProperty(err, \"name\", {\n            configurable: true,\n            enumerable: false,\n            writable: true,\n            value: obj[\"name\"],\n        });\n    }\n    if (obj[\"stack\"] !== undefined) {\n        Object.defineProperty(err, \"stack\", {\n            configurable: true,\n            enumerable: false,\n            writable: true,\n            value: obj[\"stack\"],\n        });\n    }\n    if (obj[\"cause\"] != undefined) {\n        Object.defineProperty(err, \"cause\", {\n            configurable: true,\n            enumerable: false,\n            writable: true,\n            value: obj[\"cause\"],\n        });\n    }\n    const otherKeys = Reflect.ownKeys(obj).filter(key => ![\n        \"@@type\",\n        \"name\",\n        \"message\",\n        \"stack\",\n        \"cause\"\n    ].includes(key));\n    otherKeys.forEach(key => {\n        var _a;\n        // @ts-ignore\n        (_a = err[key]) !== null && _a !== void 0 ? _a : (err[key] = obj[key]);\n    });\n    // @ts-ignore\n    if (isAggregateError(err) && Array.isArray(err[\"errors\"])) {\n        err[\"errors\"] = err[\"errors\"].map(item => {\n            return isPlainObject(item) ? fromObject(item) : item;\n        });\n    }\n    return err;\n}\n/**\n * Creates an `ErrorEvent` instance based on the given error.\n *\n * @example\n * ```ts\n * import { toErrorEvent } from \"@ayonli/jsext/error\";\n *\n * const err = new Error(\"Something went wrong.\");\n *\n * const event = toErrorEvent(err);\n * console.log(event);\n * // ErrorEvent {\n * //     error: Error: Something went wrong.\n * //         at <anonymous>:1:13,\n * //     message: \"Something went wrong.\",\n * //     filename: \"\",\n * //     lineno: 1,\n * //     colno: 13\n * // }\n * ```\n */\nexport function toErrorEvent(err, type = \"error\") {\n    let filename = \"\";\n    let lineno = 0;\n    let colno = 0;\n    if (err.stack) {\n        const lines = err.stack.split(\"\\n\").map(line => line.trim());\n        let callSite = lines.find(line => line.startsWith(\"at \"));\n        if (callSite) {\n            callSite = callSite.slice(3);\n        }\n        else if (callSite = lines.find(line => line.includes(\"@\") && line.length > 1)) {\n            callSite = callSite.slice(callSite.indexOf(\"@\") + 1);\n        }\n        if (callSite) {\n            let start = callSite.lastIndexOf(\"(\");\n            let end = 0;\n            if (start !== -1) {\n                start += 1;\n                end = callSite.indexOf(\")\", start);\n                callSite = callSite.slice(start, end);\n            }\n            const matches = callSite.match(/:(\\d+):(\\d+)$/);\n            if (matches) {\n                filename = callSite.slice(0, matches.index);\n                lineno = parseInt(matches[1]);\n                colno = parseInt(matches[2]);\n            }\n        }\n    }\n    return createErrorEvent(type, {\n        error: err,\n        message: err.message,\n        filename,\n        lineno,\n        colno,\n    });\n}\n/**\n * Creates an error instance based on the given `ErrorEvent` instance.\n *\n * @example\n * ```ts\n * import { fromErrorEvent } from \"@ayonli/jsext/error\";\n *\n * const event = new ErrorEvent(\"error\", {\n *     message: \"Something went wrong.\",\n *     filename: \"\",\n *     lineno: 1,\n *     colno: 13,\n * });\n *\n * const err = fromErrorEvent(event);\n * console.log(err);\n * // Error: Something went wrong.\n * //     at <anonymous>:1:13\n * ```\n */\nexport function fromErrorEvent(event) {\n    if (event.error instanceof Error) {\n        return event.error;\n    }\n    let err;\n    let shouldPatchStack = false;\n    if (event.error\n        && typeof event.error === \"object\"\n        && event.error[\"name\"]\n        && event.error[\"message\"]) { // Error-like\n        err = fromObject(event.error, Error);\n        shouldPatchStack = !err.stack;\n    }\n    else if (event.message) {\n        err = new Error(event.message);\n        shouldPatchStack = true;\n    }\n    else {\n        return null;\n    }\n    if (shouldPatchStack) {\n        let stack = \"\";\n        if (typeof navigator === \"object\" && navigator.userAgent.includes(\"Firefox\")) {\n            if (event.filename) {\n                stack = \"@\" + event.filename;\n            }\n            else {\n                stack = \"@debugger eval code\";\n            }\n        }\n        else if (typeof navigator === \"object\"\n            && navigator.userAgent.includes(\"Safari\")\n            && !navigator.userAgent.includes(\"Chrome\") // Chrome likes to pretend it's Safari\n        ) {\n            if (event.filename) {\n                stack = \"@\" + event.filename;\n            }\n            else {\n                stack = \"global code@\";\n            }\n        }\n        else {\n            stack = `${err.name}: ${event.message}\\n    at ${event.filename || \"<anonymous>\"}`;\n        }\n        if (event.lineno && stack !== \"global code@\") {\n            stack += \":\" + event.lineno;\n        }\n        if (event.colno && stack !== \"global code@\") {\n            stack += \":\" + event.colno;\n        }\n        Object.defineProperty(err, \"stack\", {\n            configurable: true,\n            enumerable: false,\n            writable: true,\n            value: stack,\n        });\n    }\n    return err;\n}\n/** @inner */\nexport function isDOMException(value) {\n    return ((typeof DOMException === \"function\") && (value instanceof DOMException))\n        || (value instanceof Error && value.constructor.name === \"DOMException\"); // Node.js v16-\n}\n/** @inner */\nexport function isAggregateError(value) {\n    // @ts-ignore\n    return (typeof AggregateError === \"function\" && value instanceof AggregateError)\n        || (value instanceof Error && value.constructor.name === \"AggregateError\");\n}\n//# sourceMappingURL=error.js.map","import { BiMap, CiMap } from \"../collections.ts\";\n// @ts-ignore\nglobalThis[\"BiMap\"] = BiMap;\n// @ts-ignore\nglobalThis[\"CiMap\"] = CiMap;\n//# sourceMappingURL=collections.js.map","import { Exception, toErrorEvent, fromObject, toObject, fromErrorEvent } from \"../error.ts\";\n//@ts-ignore\nglobalThis[\"Exception\"] = Exception;\nError.toObject = toObject;\nError.fromObject = fromObject;\nError.toErrorEvent = toErrorEvent;\nError.fromErrorEvent = fromErrorEvent;\nError.prototype.toJSON = function toJSON() {\n    return toObject(this);\n};\n//# sourceMappingURL=error.js.map","/**\n * Functions for parsing JSONs to specific structures.\n * @module\n */\nimport { isValid } from \"./object.ts\";\nimport { fromObject } from \"./error.ts\";\nimport bytes from \"./bytes.ts\";\nconst typeRegistry = new Map();\nexport function parseAs(text, type) {\n    const data = JSON.parse(text);\n    return as(data, type);\n}\nexport function as(data, type) {\n    if (data === null || data === undefined) {\n        return null;\n    }\n    else if (typeof type.fromJSON === \"function\") {\n        return type.fromJSON(data);\n    }\n    else if (typeof data === \"boolean\") {\n        if (type === Boolean) {\n            return data;\n        }\n        else {\n            return null;\n        }\n    }\n    else if (typeof data === \"number\") {\n        if (type === Number) {\n            return data;\n        }\n        else if (type === BigInt) {\n            try {\n                return BigInt(data);\n            }\n            catch (_a) {\n                return null;\n            }\n        }\n        else {\n            return null;\n        }\n    }\n    else if (typeof data === \"string\") {\n        if (type === String) {\n            return data;\n        }\n        else if (type === Date) {\n            const date = new Date(data);\n            return isValid(date) ? date : null;\n        }\n        else if (type === BigInt) {\n            try {\n                return BigInt(data);\n            }\n            catch (_b) {\n                return null;\n            }\n        }\n        else {\n            return null;\n        }\n    }\n    else if (Array.isArray(data)) {\n        if (type === Array) { // Array\n            return data;\n        }\n        else if (type.prototype instanceof Array) { // Array-derivative\n            return type.from(data);\n        }\n        else if (typeof type.prototype[Symbol.iterator] === \"function\" &&\n            typeof type[\"from\"] === \"function\") { // ArrayLike or TypedArray\n            try {\n                return type.from(data);\n            }\n            catch (_c) {\n                return null;\n            }\n        }\n        else {\n            return null;\n        }\n    }\n    else if (![String, Number, Boolean, Date, Array].includes(type)) {\n        if (data.type === \"Buffer\" && Array.isArray(data.data)) {\n            // Node.js Buffer\n            if (typeof Buffer === \"function\" && type === Buffer) {\n                try {\n                    return Buffer.from(data.data);\n                }\n                catch (_d) {\n                    return null;\n                }\n            }\n            else if (typeof type.prototype[Symbol.iterator] === \"function\"\n                && typeof type[\"from\"] === \"function\") {\n                try {\n                    // Convert Node.js Buffer to TypedArray.\n                    return type.from(data.data);\n                }\n                catch (_e) {\n                    return null;\n                }\n            }\n            else {\n                return null;\n            }\n        }\n        else if (data.type === \"ByteArray\" && Array.isArray(data.data)) {\n            // ByteArray\n            try {\n                return bytes(data.data);\n            }\n            catch (_f) {\n                return null;\n            }\n        }\n        const keys = Object.getOwnPropertyNames(data);\n        const values = Object.values(data);\n        if (keys.slice(0, 50).map(Number).every(i => !Number.isNaN(i)) &&\n            values.slice(0, 50).map(Number).every(i => !Number.isNaN(i)) &&\n            typeof type.prototype[Symbol.iterator] === \"function\" &&\n            typeof type[\"from\"] === \"function\") {\n            // Assert the data is a TypedArray.\n            try {\n                return type.from(Object.values(data));\n            }\n            catch (_g) {\n                return null;\n            }\n        }\n        else if (type.prototype instanceof Error) {\n            const err = fromObject(data);\n            if (err) {\n                // Support @JSON.type() decorator in Error constructors.\n                const typeRecords = typeRegistry.get(type.prototype);\n                if (typeRecords) {\n                    for (const key of Reflect.ownKeys(data)) {\n                        const ctor = typeRecords[key];\n                        if (ctor) {\n                            err[key] = as(data[key], ctor);\n                        }\n                    }\n                }\n            }\n            return err;\n        }\n        else {\n            const ins = Object.create(type.prototype);\n            const typeRecords = typeRegistry.get(type.prototype);\n            if (typeRecords) {\n                for (const key of Reflect.ownKeys(data)) {\n                    const ctor = typeRecords[key];\n                    ins[key] = ctor ? as(data[key], ctor) : data[key];\n                }\n            }\n            else {\n                Object.assign(ins, data);\n            }\n            return ins;\n        }\n    }\n    else {\n        return null;\n    }\n}\n/**\n * A decorator to instruct that the target property in the class is of a specific type.\n *\n * When parsing JSON via {@link parseAs}, this property is guaranteed to be of the given type.\n *\n * **NOTE:** This decorator only supports TypeScript's `experimentalDecorators`.\n *\n * @example\n * ```ts\n * import { type } from \"@ayonli/jsext/json\";\n *\n * class Example {\n *     \\@type(Date)\n *     date: Date;\n * }\n * ```\n */\nexport function type(ctor) {\n    return (proto, prop) => {\n        const record = typeRegistry.get(proto);\n        if (record) {\n            record[prop] = ctor;\n        }\n        else {\n            typeRegistry.set(proto, { [prop]: ctor });\n        }\n    };\n}\n//# sourceMappingURL=json.js.map","import { as, parseAs, type } from \"../json.ts\";\nJSON.parseAs = parseAs;\nJSON.as = as;\nJSON.type = type;\n//# sourceMappingURL=json.js.map","/**\n * Performs pipe operations through a series of functions upon a value.\n * @module\n */\nconst _value = Symbol.for(\"value\");\n/**\n * Pipeline holds a value and allows you chain operations upon it (and the result\n * of the previous operation) to get the final result, similar to the Unix pipe\n * operator `|` in shell scripting.\n */\nexport class Pipeline {\n    constructor(value) {\n        this[_value] = value;\n    }\n    get [Symbol.toStringTag]() {\n        return \"Pipeline\";\n    }\n    get value() {\n        return this[_value];\n    }\n    /**\n     * Calls a function using the current value as its argument and returns a\n     * new {@link Pipeline} instance that holds the result.\n     */\n    pipe(fn, ...args) {\n        return new Pipeline(fn(this[_value], ...args));\n    }\n    valueOf() {\n        return this[_value];\n    }\n}\n/**\n * Constructs a {@link Pipeline} instance with the given value and performs pipe\n * operations upon it.\n *\n * @example\n * ```ts\n * import pipe from \"@ayonli/jsext/pipe\";\n *\n * const { value } = pipe(\"10\")\n *     .pipe(parseInt)\n *     .pipe(Math.pow, 2)\n *     .pipe(v => v.toFixed(2));\n *\n * console.log(`the value is ${value}`) // the value is 100.00\n * ```\n */\nexport default function pipe(value) {\n    return new Pipeline(value);\n}\n//# sourceMappingURL=pipe.js.map","import { Pipeline } from \"../pipe.ts\";\nfunction pipe(fn, ...args) {\n    if ([String, Number, BigInt, Boolean, Symbol].includes(this.constructor)) {\n        return new Pipeline(this.valueOf()).pipe(fn, ...args);\n    }\n    else {\n        return new Pipeline(this).pipe(fn, ...args);\n    }\n}\n;\nString.prototype.pipe = pipe;\nNumber.prototype.pipe = pipe;\nBigInt.prototype.pipe = pipe;\nBoolean.prototype.pipe = pipe;\nSymbol.prototype.pipe = pipe;\nDate.prototype.pipe = pipe;\nRegExp.prototype.pipe = pipe;\nError.prototype.pipe = pipe;\nMap.prototype.pipe = pipe;\nSet.prototype.pipe = pipe;\nArray.prototype.pipe = pipe;\nInt8Array.prototype.pipe = pipe;\nUint8Array.prototype.pipe = pipe;\nUint8ClampedArray.prototype.pipe = pipe;\nInt16Array.prototype.pipe = pipe;\nUint16Array.prototype.pipe = pipe;\nInt32Array.prototype.pipe = pipe;\nUint32Array.prototype.pipe = pipe;\nFloat32Array.prototype.pipe = pipe;\nFloat64Array.prototype.pipe = pipe;\nBigInt64Array.prototype.pipe = pipe;\nBigUint64Array.prototype.pipe = pipe;\nArrayBuffer.prototype.pipe = pipe;\nif (typeof SharedArrayBuffer === \"function\") {\n    SharedArrayBuffer.prototype.pipe = pipe;\n}\nif (typeof Blob === \"function\") {\n    Blob.prototype.pipe = pipe;\n}\nif (typeof Event === \"function\") {\n    Event.prototype.pipe = pipe;\n}\n//# sourceMappingURL=pipe.js.map","/**\n * The missing utility types for TypeScript.\n * @module\n */\n/**\n * This is the very constructor/class of all async functions.\n *\n * @example\n * ```ts\n * import { AsyncFunction } from \"@ayonli/jsext/types\";\n *\n * async function foo() {\n *       // ...\n * }\n *\n * console.assert(foo instanceof AsyncFunction);\n * ```\n */\nexport const AsyncFunction = (async function () { }).constructor;\n/**\n * This is the very constructor/class of all generator functions.\n *\n * @example\n * ```ts\n * import { GeneratorFunction } from \"@ayonli/jsext/types\";\n *\n * function* foo() {\n *     // ...\n * }\n *\n * console.assert(foo instanceof GeneratorFunction);\n * ```\n */\nexport const GeneratorFunction = (function* () { }).constructor;\n/**\n * This is the very constructor/class of all async generator functions.\n *\n * @example\n * ```ts\n * import { AsyncGeneratorFunction } from \"@ayonli/jsext/types\";\n *\n * async function* foo() {\n *    // ...\n * }\n *\n * console.assert(foo instanceof AsyncGeneratorFunction);\n * ```\n */\nexport const AsyncGeneratorFunction = (async function* () { }).constructor;\n/**\n * This is the superclass of all of all `TypedArray` subclasses, such as `Uint8Array`,\n * `Int16Array`, etc.\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray\n *\n * @example\n * ```ts\n * import { TypedArray } from \"@ayonli/jsext/types\";\n *\n * const arr = new Uint8Array(10);\n * console.assert(arr instanceof TypedArray);\n * ```\n */\nexport const TypedArray = Object.getPrototypeOf(Uint8Array);\n//# sourceMappingURL=types.js.map","if (!Symbol.asyncIterator) {\n    // @ts-ignore\n    Symbol.asyncIterator = Symbol(\"Symbol.asyncIterator\");\n}\n\n/**\n * Checks if the given object is an Iterable (implemented `@@iterator`).\n * @param {any} obj\n * @returns {obj is Iterable<any>}\n */\nexport function isIterable(obj) {\n    return obj !== null\n        && obj !== undefined\n        && typeof obj[Symbol.iterator] === \"function\";\n}\n\n/**\n * Checks if the given object is an AsyncIterable (implemented `@@asyncIterator`).\n * @param {any} obj\n * @returns {obj is AsyncIterable<any>}\n */\nexport function isAsyncIterable(obj) {\n    return obj !== null\n        && obj !== undefined\n        && typeof obj[Symbol.asyncIterator] === \"function\";\n}\n\n/**\n * Checks if the given object is an IteratorLike (implemented `next`).\n * @param {any} obj\n * @returns {obj is { [x: string | symbol]: any; next: Function }}\n */\nexport function isIteratorLike(obj) {\n    // An iterable object has a 'next' method, however including a 'next' method\n    // doesn't ensure the object is an iterator, it is only iterator-like.\n    return typeof obj === \"object\"\n        && obj !== null\n        && typeof obj.next === \"function\";\n}\n\n/**\n * Checks if the given object is an IterableIterator (implemented both\n * `@@iterator` and `next`).\n * @param {any} obj\n */\nexport function isIterableIterator(obj) {\n    return isIteratorLike(obj)\n        && typeof obj[Symbol.iterator] === \"function\";\n}\n\n/**\n * Checks if the given object is an AsyncIterableIterator (implemented\n * both `@@asyncIterator` and `next`).\n * @param {any} obj\n * @returns {obj is AsyncIterableIterator<any>}\n */\nexport function isAsyncIterableIterator(obj) {\n    return isIteratorLike(obj)\n        && typeof obj[Symbol.asyncIterator] === \"function\";\n}\n\n/**\n * Checks if the given object is a Generator.\n * @param {any} obj\n * @returns {obj is Generator}\n */\nexport function isGenerator(obj) {\n    return isIterableIterator(obj)\n        && hasGeneratorSpecials(obj);\n}\n\n/**\n * Checks if the given object is an AsyncGenerator.\n * @param {any} obj\n * @returns {obj is AsyncGenerator}\n */\nexport function isAsyncGenerator(obj) {\n    return isAsyncIterableIterator(obj)\n        && hasGeneratorSpecials(obj);\n}\n\n/**\n * @param {any} obj \n */\nfunction hasGeneratorSpecials(obj) {\n    return typeof obj.return === \"function\"\n        && typeof obj.throw === \"function\";\n}\n","import { AsyncFunction, GeneratorFunction, AsyncGeneratorFunction, TypedArray } from \"../types.ts\";\n// @ts-ignore\nglobalThis[\"AsyncFunction\"] = AsyncFunction;\n// @ts-ignore\nglobalThis[\"GeneratorFunction\"] = GeneratorFunction;\n// @ts-ignore\nglobalThis[\"AsyncGeneratorFunction\"] = AsyncGeneratorFunction;\n// @ts-ignore\nglobalThis[\"TypedArray\"] = TypedArray;\n//# sourceMappingURL=types.js.map","import \"./external/event-target-polyfill/index.ts\";\nimport \"./augment/string.ts\";\nimport \"./augment/number.ts\";\nimport \"./augment/array.ts\";\nimport \"./augment/uint8array.ts\";\nimport \"./augment/object.ts\";\nimport \"./augment/math.ts\";\nimport \"./augment/promise.ts\";\nimport \"./augment/collections.ts\";\nimport \"./augment/error.ts\";\nimport \"./augment/json.ts\";\nimport \"./augment/pipe.ts\";\nimport \"./augment/types.ts\";\nimport { customInspect } from \"./runtime.ts\";\nObject.defineProperty(Symbol, \"customInspec\", { value: customInspect });\n//# sourceMappingURL=augment.js.map","if (!Symbol.asyncIterator) {\n    Object.defineProperty(Symbol, \"asyncIterator\", {\n        value: Symbol(\"Symbol.asyncIterator\")\n    });\n}\nexport const source = Symbol(\"GeneratorSource\");\nexport const status = Symbol(\"GeneratorStatus\");\nexport const result = Symbol(\"GeneratorResult\");\nexport class Thenable {\n    constructor(_source) {\n        this[source] = _source;\n        this[status] = \"suspended\";\n        this[result] = void 0;\n    }\n    then(onfulfilled, onrejected) {\n        let res;\n        if (this[source] === undefined || this[status] === \"closed\") {\n            res = Promise.resolve(this[result]);\n        }\n        else if (this[status] === \"erred\") {\n            res = Promise.reject(this[source]);\n        }\n        else if (typeof this[source].then === \"function\") {\n            res = Promise.resolve(this[source]);\n        }\n        else if (typeof this[source].next === \"function\") {\n            res = processIterator(this[source]);\n        }\n        else {\n            res = Promise.resolve(this[source]);\n        }\n        this[status] = \"closed\";\n        return res\n            .then(value => (this[result] = value))\n            .then(onfulfilled, onrejected);\n    }\n    catch(onrejected) {\n        return Promise.resolve(this).then(null, onrejected);\n    }\n}\nexport class ThenableGenerator extends Thenable {\n    next(...args) {\n        const value = args[0];\n        let res;\n        if (this[source] === undefined || this[status] === \"closed\") {\n            res = { value: void 0, done: true };\n        }\n        else if (this[status] === \"erred\") {\n            return this.throw(this[source]);\n        }\n        else if (typeof this[source].next === \"function\") {\n            res = this[source].next(value);\n        }\n        else {\n            res = { value: this[source], done: true };\n        }\n        if (res.done === true) {\n            this[status] = \"closed\";\n            this[result] = res.value;\n        }\n        return res;\n    }\n    return(value) {\n        this[status] = \"closed\";\n        this[result] = value;\n        if (this[source] && typeof this[source].return === \"function\") {\n            return this[source].return(value);\n        }\n        else {\n            return { value, done: true };\n        }\n    }\n    throw(err) {\n        this[status] = \"closed\";\n        if (this[source] && typeof this[source].throw === \"function\") {\n            return this[source].throw(err);\n        }\n        else {\n            throw err;\n        }\n    }\n    [Symbol.iterator]() {\n        return this;\n    }\n    ;\n}\nexport class ThenableAsyncGenerator extends Thenable {\n    next(...args) {\n        const value = args[0];\n        let res;\n        if (this[source] === undefined || this[status] === \"closed\") {\n            res = Promise.resolve({ value: void 0, done: true });\n        }\n        else if (typeof this[source].next === \"function\") {\n            res = Promise.resolve(this[source].next(value));\n        }\n        else {\n            res = Promise.resolve(this[source]).then(value => {\n                return { value, done: true };\n            });\n        }\n        return res.then(res => {\n            if (res.done === true) {\n                this[status] = \"closed\";\n                this[result] = res.value;\n            }\n            return res;\n        });\n    }\n    return(value) {\n        this[status] = \"closed\";\n        // The input value may be a promise-like object, using Promise.resolve()\n        // to guarantee the value is resolved.\n        return Promise.resolve(value).then(value => {\n            this[result] = value;\n            if (this[source] && typeof this[source].return === \"function\") {\n                return Promise.resolve(this[source].return(value));\n            }\n            else {\n                return Promise.resolve({ value, done: true });\n            }\n        });\n    }\n    throw(err) {\n        this[status] = \"closed\";\n        if (this[source] && typeof this[source].throw === \"function\") {\n            return Promise.resolve(this[source].throw(err));\n        }\n        else {\n            return Promise.reject(err);\n        }\n    }\n    [Symbol.asyncIterator]() {\n        return this;\n    }\n}\nexport const ThenableGeneratorFunction = (function (fn) {\n    if (!(this instanceof ThenableGeneratorFunction)) {\n        return new ThenableGeneratorFunction(fn);\n    }\n    function anonymous(...args) {\n        try {\n            const source = fn.apply(this, args);\n            if (typeof source.then === \"function\" || isAsyncGenerator(source)) {\n                return new ThenableAsyncGenerator(source);\n            }\n            else {\n                return new ThenableGenerator(source);\n            }\n        }\n        catch (err) {\n            return Object.assign(new ThenableGenerator(err), {\n                [status]: \"erred\"\n            });\n        }\n    }\n    // HACK, let the returning function be an instance of\n    // ThenableGeneratorFunction.\n    anonymous.prototype = ThenableGeneratorFunction;\n    anonymous.__proto__ = this;\n    return anonymous;\n});\nObject.setPrototypeOf(ThenableGeneratorFunction, Function);\nObject.setPrototypeOf(ThenableGeneratorFunction.prototype, Function.prototype);\nexport function create(fn) {\n    return new ThenableGeneratorFunction(fn);\n}\nexport default create;\nThenableGeneratorFunction.create = create;\nfunction isAsyncGenerator(obj) {\n    return obj !== null\n        && typeof obj === \"object\"\n        && typeof obj.next === \"function\"\n        && typeof obj.return === \"function\"\n        && typeof obj.throw === \"function\"\n        && typeof obj[Symbol.asyncIterator] === \"function\";\n}\nfunction processIterator(iterator) {\n    return new Promise((resolve, reject) => {\n        function fulfilled(value) {\n            try {\n                step(iterator.next(value));\n            }\n            catch (e) {\n                reject(e);\n            }\n        }\n        function rejected(value) {\n            var _a;\n            try {\n                step((_a = iterator.throw) === null || _a === void 0 ? void 0 : _a.call(iterator, value));\n            }\n            catch (e) {\n                reject(e);\n            }\n        }\n        function step(item) {\n            Promise.resolve(item).then(result => {\n                result.done ? resolve(result.value) : new Promise(resolve => {\n                    resolve(result.value);\n                }).then(fulfilled, rejected);\n            });\n        }\n        step(iterator.next());\n    });\n}\n//# sourceMappingURL=index.js.map","/**\n * Calls a function safely and return errors when captured.\n * @module\n */\n// @ts-ignore\nimport { isAsyncGenerator, isGenerator } from \"./external/check-iterable/index.mjs\";\nimport { ThenableAsyncGenerator } from \"./external/thenable-generator/index.ts\";\nexport default function _try(fn, ...args) {\n    if (typeof fn === \"function\") {\n        try {\n            return _try(fn.apply(void 0, args));\n        }\n        catch (err) {\n            return [err, undefined];\n        }\n    }\n    let returns = fn;\n    // Implementation details should be ordered from complex to simple.\n    if (returns instanceof ThenableAsyncGenerator) {\n        // special case for `ThenableAsyncGenerator`\n        return Promise.resolve(returns)\n            .then((value) => [null, value])\n            .catch((err) => [err, undefined]);\n    }\n    else if (isAsyncGenerator(returns)) {\n        // @ts-ignore\n        return (async function* () {\n            let input;\n            let result;\n            // Use `while` loop instead of `for...of...` in order to\n            // retrieve the return value of a generator function.\n            while (true) {\n                try {\n                    const { done, value } = await returns.next(input);\n                    if (done) {\n                        result = value;\n                        break;\n                    }\n                    else {\n                        // Receive any potential input value that passed\n                        // to the outer `next()` call, and pass them to\n                        // `res.next()` in the next call.\n                        input = yield Promise.resolve([null, value]);\n                    }\n                }\n                catch (err) {\n                    // If any error occurs, yield that error as resolved\n                    // and break the loop immediately, indicating the\n                    // process is forced broken.\n                    yield Promise.resolve([err, undefined]);\n                    break;\n                }\n            }\n            return [null, result];\n        })();\n    }\n    else if (isGenerator(returns)) {\n        return (function* () {\n            let input;\n            let result;\n            while (true) {\n                try {\n                    const { done, value } = returns.next(input);\n                    if (done) {\n                        result = value;\n                        break;\n                    }\n                    else {\n                        input = yield [null, value];\n                    }\n                }\n                catch (err) {\n                    yield [err, undefined];\n                    break;\n                }\n            }\n            return [null, result];\n        })();\n    }\n    else if (typeof (returns === null || returns === void 0 ? void 0 : returns.then) === \"function\") {\n        return Promise.resolve(returns)\n            .then((value) => [null, value])\n            .catch((err) => [err, undefined]);\n    }\n    else {\n        return [null, returns];\n    }\n}\n//# sourceMappingURL=try.js.map","/**\n * Wraps a function for decorator pattern but keep its signature.\n * @module\n */\n/**\n * Wraps a function inside another function and returns a new function that\n * copies the original function's name and other properties.\n *\n * @example\n * ```ts\n * import wrap from \"@ayonli/jsext/wrap\";\n *\n * function log(text: string) {\n *     console.log(text);\n * }\n *\n * const show = wrap(log, function (fn, text) {\n *     return fn.call(this, new Date().toISOString() + \" \" + text);\n * });\n *\n * console.log(show.name); // log\n * console.log(show.length); // 1\n * console.assert(show.toString() === log.toString());\n * ```\n */\nexport default function wrap(fn, wrapper) {\n    const wrapped = function (...args) {\n        return wrapper.call(this, fn, ...args);\n    };\n    Object.defineProperty(wrapped, \"name\", Object.getOwnPropertyDescriptor(fn, \"name\"));\n    Object.defineProperty(wrapped, \"length\", Object.getOwnPropertyDescriptor(fn, \"length\"));\n    Object.defineProperty(wrapped, \"toString\", {\n        configurable: true,\n        enumerable: false,\n        writable: true,\n        value: fn.toString.bind(fn),\n    });\n    return wrapped;\n}\n//# sourceMappingURL=wrap.js.map","/**\n * Declares a class that combines all methods from the base classes.\n * @module\n */\n/**\n * Merges properties and methods only if they're missing in the class.\n */\nfunction mergeIfNotExists(proto, source, mergeSuper = false) {\n    const props = Reflect.ownKeys(source);\n    for (const prop of props) {\n        if (prop === \"constructor\") {\n            continue;\n        }\n        else if (mergeSuper) {\n            // When merging properties from super classes, the properties in the\n            // base class has the first priority and shall not be overwrite.\n            if (!(prop in proto)) {\n                setProp(proto, source, prop);\n            }\n        }\n        else if (!Object.prototype.hasOwnProperty.call(proto, prop)) {\n            setProp(proto, source, prop);\n        }\n    }\n    return proto;\n}\n/**\n * Merges properties and methods across the prototype chain.\n */\nfunction mergeHierarchy(ctor, mixin, mergeSuper = false) {\n    mergeIfNotExists(ctor.prototype, mixin.prototype, mergeSuper);\n    const _super = Object.getPrototypeOf(mixin);\n    // Every user defined class or functions that can be instantiated have their\n    // own names, if no name appears, that means the function has traveled to \n    // the root of the hierarchical tree.\n    if (_super.name) {\n        mergeHierarchy(ctor, _super, true);\n    }\n}\n/**\n * Sets property for prototype based on the given source and prop name properly.\n */\nfunction setProp(proto, source, prop) {\n    const desc = Object.getOwnPropertyDescriptor(source, prop);\n    if (desc) {\n        Object.defineProperty(proto, prop, desc);\n    }\n    else {\n        proto[prop] = source[prop];\n    }\n}\nexport default function mixin(base, ...mixins) {\n    const obj = { ctor: null };\n    obj.ctor = class extends base {\n    }; // make sure this class has no name\n    for (const mixin of mixins) {\n        if (typeof mixin === \"function\") {\n            mergeHierarchy(obj.ctor, mixin);\n        }\n        else if (mixin && typeof mixin === \"object\") {\n            mergeIfNotExists(obj.ctor.prototype, mixin);\n        }\n        else {\n            throw new TypeError(\"Mixin must be a constructor or an object.\");\n        }\n    }\n    return obj.ctor;\n}\n//# sourceMappingURL=mixin.js.map","/**\n * Throttles function calls for frequent access.\n * @module\n */\nconst Cache = new Map();\nexport default function throttle(handler, options) {\n    const key = typeof options === \"number\" ? null : options.for;\n    const duration = typeof options === \"number\" ? options : options.duration;\n    const noWait = typeof options === \"number\" ? false : !!(options === null || options === void 0 ? void 0 : options.noWait);\n    const handleCall = function (cache, ...args) {\n        var _a;\n        if (cache.result && ((cache.pending && noWait) || Date.now() < ((_a = cache.expires) !== null && _a !== void 0 ? _a : 0))) {\n            if (cache.result.error) {\n                throw cache.result.error;\n            }\n            else {\n                return cache.result.value;\n            }\n        }\n        else if (cache.pending) {\n            return cache.pending;\n        }\n        try {\n            const returns = handler.call(this, ...args);\n            if (typeof (returns === null || returns === void 0 ? void 0 : returns.then) === \"function\") {\n                cache.pending = Promise.resolve(returns).finally(() => {\n                    cache.result = { value: cache.pending };\n                    cache.pending = undefined;\n                    cache.expires = Date.now() + duration;\n                });\n                if (noWait && cache.result) {\n                    if (cache.result.error) {\n                        throw cache.result.error;\n                    }\n                    else {\n                        return cache.result.value;\n                    }\n                }\n                else {\n                    return cache.pending;\n                }\n            }\n            else {\n                cache.result = { value: returns };\n                cache.expires = Date.now() + duration;\n                return returns;\n            }\n        }\n        catch (error) {\n            cache.result = { error };\n            cache.expires = Date.now() + duration;\n            throw error;\n        }\n    };\n    if (key === null || key === undefined || key === \"\") {\n        const cache = { for: null };\n        return function (...args) {\n            return handleCall.call(this, cache, ...args);\n        };\n    }\n    else {\n        let cache = Cache.get(key);\n        if (!cache) {\n            cache = { for: key };\n            Cache.set(key, cache);\n        }\n        return function (...args) {\n            return handleCall.call(this, cache, ...args);\n        };\n    }\n}\n//# sourceMappingURL=throttle.js.map","/**\n * Debounces function calls for frequent access.\n * @module\n */\nimport { asyncTask } from \"./async.ts\";\nconst registry = new Map();\nexport default function debounce(handler, options, reducer = undefined) {\n    const signal = typeof options === \"number\" ? undefined : options.signal;\n    const delay = typeof options === \"number\" ? options : options.delay;\n    const key = typeof options === \"number\" ? null : options.for;\n    const hasKey = key !== null && key !== undefined && key !== \"\";\n    let _cache = hasKey ? registry.get(key) : undefined;\n    if (!_cache) {\n        _cache = {\n            for: key,\n            tasks: [],\n            data: undefined,\n            timer: undefined,\n        };\n        if (hasKey) {\n            registry.set(key, _cache);\n        }\n    }\n    const cache = _cache;\n    const getResolvers = (cache) => {\n        // Move tasks and cached data to new variables, so during the middle\n        // of handler running, new calls won't interfere the running process.\n        const _tasks = cache.tasks;\n        const data = cache.data;\n        cache.tasks = [];\n        cache.data = undefined;\n        if (hasKey) {\n            registry.delete(key);\n        }\n        const resolve = (result) => {\n            _tasks.forEach(({ resolve }) => resolve(result));\n        };\n        const reject = (err) => {\n            _tasks.forEach(({ reject }) => reject(err));\n        };\n        return { resolve, reject, data };\n    };\n    signal === null || signal === void 0 ? void 0 : signal.addEventListener(\"abort\", () => {\n        cache.timer && clearTimeout(cache.timer);\n        const { reject } = getResolvers(cache);\n        reject(signal.reason);\n    });\n    return async function (data) {\n        if (signal === null || signal === void 0 ? void 0 : signal.aborted) {\n            throw signal.reason;\n        }\n        if (typeof reducer === \"function\" && cache.data !== undefined) {\n            cache.data = reducer(cache.data, data);\n        }\n        else {\n            cache.data = data;\n        }\n        cache.timer && clearTimeout(cache.timer);\n        cache.timer = setTimeout((cache) => {\n            const { resolve, reject, data } = getResolvers(cache);\n            try {\n                const res = handler.call(this, data);\n                if (typeof (res === null || res === void 0 ? void 0 : res.then) === \"function\") {\n                    Promise.resolve(res).then(resolve, reject);\n                }\n                else {\n                    resolve(res);\n                }\n            }\n            catch (err) {\n                reject(err);\n            }\n        }, delay, cache);\n        const task = asyncTask();\n        cache.tasks.push(task);\n        return await task;\n    };\n}\n//# sourceMappingURL=debounce.js.map","/**\n * A channel implementation that transfers data across routines, even across\n * multiple threads, inspired by Golang.\n * @module\n */\nvar _a;\nimport { serial } from \"./number.ts\";\nimport { id } from \"./env.ts\";\nif (typeof Symbol.dispose === \"undefined\") {\n    Object.defineProperty(Symbol, \"dispose\", { value: Symbol(\"Symbol.dispose\") });\n}\nconst idGenerator = serial(true);\n/**\n * A channel implementation that transfers data across routines, even across\n * multiple threads, inspired by Golang.\n */\nexport class Channel {\n    constructor(capacity = 0) {\n        this[_a] = idGenerator.next().value;\n        this.buffer = [];\n        this.producers = [];\n        this.consumers = [];\n        this.error = null;\n        this.state = 1;\n        if (capacity < 0) {\n            throw new RangeError(\"the capacity of a channel must not be negative\");\n        }\n        this.capacity = capacity;\n    }\n    /**\n     * Pushes data to the channel.\n     *\n     * If there is a receiver, the data will be consumed immediately. Otherwise:\n     *\n     * - If this is an non-buffered channel, this function will block until a\n     *  receiver is available and the data is consumed.\n     *\n     * - If this is a buffered channel, then:\n     *      - If the buffer size is within the capacity, the data will be pushed\n     *        to the buffer.\n     *      - Otherwise, this function will block until there is new space for\n     *        the data in the buffer.\n     */\n    send(data) {\n        if (this.state !== 1) {\n            throw new Error(\"the channel is closed\");\n        }\n        else if (this.consumers.length) {\n            const consume = this.consumers.shift();\n            return Promise.resolve(consume(null, data));\n        }\n        else if (this.capacity && this.buffer.length < this.capacity) {\n            this.buffer.push(data);\n            return Promise.resolve(undefined);\n        }\n        else {\n            return new Promise(resolve => {\n                this.producers.push(() => {\n                    if (this.capacity) {\n                        const _data = this.buffer.shift();\n                        this.buffer.push(data);\n                        resolve();\n                        return _data;\n                    }\n                    else {\n                        resolve();\n                        return data;\n                    }\n                });\n            });\n        }\n    }\n    /**\n     * Retrieves data from the channel.\n     *\n     * If there isn't data available at the moment, this function will block\n     * until new data is available.\n     *\n     * If the channel is closed, then:\n     *\n     * - If there is error set in the channel, this function throws that error\n     *   immediately.\n     * - Otherwise, this function returns `undefined` immediately.\n     */\n    recv() {\n        if (this.buffer.length) {\n            const data = this.buffer.shift();\n            if (this.state === 2 && !this.buffer.length) {\n                this.state = 0;\n            }\n            return Promise.resolve(data);\n        }\n        else if (this.producers.length) {\n            const produce = this.producers.shift();\n            if (this.state === 2 && !this.producers.length) {\n                this.state = 0;\n            }\n            return Promise.resolve(produce());\n        }\n        else if (this.state === 0) {\n            return Promise.resolve(undefined);\n        }\n        else if (this.error) {\n            // Error can only be consumed once, after that, that closure will\n            // be complete.\n            const { error } = this;\n            this.state = 0;\n            this.error = null;\n            return Promise.reject(error);\n        }\n        else if (this.state === 2) {\n            this.state = 0;\n            return Promise.resolve(undefined);\n        }\n        else {\n            return new Promise((resolve, reject) => {\n                this.consumers.push((err, data) => {\n                    if (this.state === 2 && !this.consumers.length) {\n                        this.state = 0;\n                    }\n                    err ? reject(err) : resolve(data);\n                });\n            });\n        }\n    }\n    /**\n     * Closes the channel. If `err` is supplied, it will be captured by the\n     * receiver.\n     *\n     * No more data shall be sent once the channel is closed.\n     *\n     * Explicitly closing the channel is not required, if the channel is no\n     * longer used, it will be automatically released by the GC. However, if\n     * the channel is used in a `for await...of...` loop, closing the channel\n     * will allow the loop to break automatically.\n     *\n     * Moreover, if the channel is used between parallel threads, it will no\n     * longer be able to release automatically, must explicitly call this\n     * function in order to release for GC.\n     */\n    close(err = null) {\n        if (this.state !== 1) {\n            // prevent duplicated call\n            return;\n        }\n        this.state = 2;\n        this.error = err;\n        let consume;\n        while (consume = this.consumers.shift()) {\n            consume(err, undefined);\n        }\n    }\n    [(_a = id, Symbol.asyncIterator)]() {\n        const channel = this;\n        return {\n            async next() {\n                const bufSize = channel.buffer.length;\n                const queueSize = channel.producers.length;\n                const value = await channel.recv();\n                return {\n                    value: value,\n                    done: channel.state === 0 && !bufSize && !queueSize,\n                };\n            }\n        };\n    }\n    [Symbol.dispose]() {\n        this.close();\n    }\n}\n/**\n * Inspired by Golang, cerates a {@link Channel} that can be used to transfer\n * data across routines.\n *\n * If `capacity` is not set, a non-buffered channel will be created. For a\n * non-buffered channel, the sender and receiver must be present at the same\n * time (theoretically), otherwise, the channel will block (non-IO aspect).\n *\n * If `capacity` is set, a buffered channel will be created. For a buffered\n * channel, data will be queued in the buffer first and then consumed by the\n * receiver in FIFO order. Once the buffer size reaches the capacity limit, no\n * more data will be sent unless there is new space available.\n *\n * It is possible to set the `capacity` to `Infinity` to allow the channel to\n * never block and behave like a message queue.\n *\n * Unlike `EventEmitter` or `EventTarget`, `Channel` guarantees the data will\n * always be delivered, even if there is no receiver at the moment.\n *\n * Also, unlike Golang, `await channel.recv()` does not prevent the program from\n * exiting.\n *\n * Channels can be used to send and receive streaming data between main thread\n * and worker threads wrapped by `parallel()`, but once used that way,\n * `channel.close()` must be explicitly called in order to release the channel\n * for garbage collection.\n *\n * @example\n * ```ts\n * // non-buffered\n * import chan from \"@ayonli/jsext/chan\";\n *\n * const channel = chan<number>();\n *\n * (async () => {\n *     await channel.send(123);\n * })();\n *\n * const num = await channel.recv();\n * console.log(num); // 123\n * // output:\n * // 123\n * ```\n *\n * @example\n * ```ts\n * // buffered\n * import chan from \"@ayonli/jsext/chan\";\n *\n * const channel = chan<number>(3);\n *\n * await channel.send(123);\n * await channel.send(456);\n * await channel.send(789);\n *\n * const num1 = await channel.recv();\n * const num2 = await channel.recv();\n * const num3 = await channel.recv();\n *\n * console.log(num1); // 123\n * console.log(num2); // 456\n * console.log(num3); // 789\n * ```\n *\n * @example\n * ```ts\n * // iterable\n * import chan from \"@ayonli/jsext/chan\";\n * import { range } from \"@ayonli/jsext/number\";\n *\n * const channel = chan<number>();\n *\n * (async () => {\n *     for (const num of range(1, 5)) {\n *         await channel.send(num);\n *     }\n *\n *     channel.close();\n * })();\n *\n * for await (const num of channel) {\n *     console.log(num);\n * }\n * // output:\n * // 1\n * // 2\n * // 3\n * // 4\n * // 5\n * ```\n */\nexport default function chan(capacity = 0) {\n    return new Channel(capacity);\n}\n//# sourceMappingURL=chan.js.map","/**\n * This module provides a mechanism to handle tasks sequentially and prevent\n * concurrency conflicts.\n * @module\n */\nimport chan from \"./chan.ts\";\nexport class Queue {\n    constructor(handler, bufferSize = 0) {\n        this.channel = chan(bufferSize);\n        (async () => {\n            var _a;\n            for await (const data of this.channel) {\n                try {\n                    await handler.call(void 0, data);\n                }\n                catch (err) {\n                    (_a = this.errorHandler) === null || _a === void 0 ? void 0 : _a.call(this, err);\n                }\n            }\n        })().catch(err => {\n            var _a;\n            (_a = this.errorHandler) === null || _a === void 0 ? void 0 : _a.call(void 0, err);\n        });\n    }\n    push(data) {\n        return this.channel.send(data);\n    }\n    close() {\n        var _a;\n        (_a = this.channel) === null || _a === void 0 ? void 0 : _a.close();\n    }\n    onError(handler) {\n        this.errorHandler = handler;\n    }\n    [Symbol.dispose]() {\n        this.close();\n    }\n}\n/**\n * Processes data sequentially by the given `handler` function and prevents\n * concurrency conflicts, it returns a {@link Queue} instance that we can push\n * data into.\n *\n * @param bufferSize The maximum capacity of the underlying channel, once\n * reached, the push operation will block until there is new space available.\n * By default, this option is not set and use a non-buffered channel instead.\n *\n * @example\n * ```ts\n * import queue from \"@ayonli/jsext/queue\";\n *\n * const list: string[] = [];\n * const q = queue(async (str: string) => {\n *     await Promise.resolve(null);\n *     list.push(str);\n * });\n *\n * q.onError(err => {\n *     console.error(err);\n * })\n *\n * await q.push(\"foo\");\n * await q.push(\"foo\");\n *\n * console.log(list.length);\n * q.close();\n * // output:\n * // 2\n * ```\n */\nexport default function queue(handler, bufferSize = 0) {\n    return new Queue(handler, bufferSize);\n}\n//# sourceMappingURL=queue.js.map","/**\n * A mutual exclusion mechanism for concurrent operations and protecting shared\n * data.\n * @module\n */\nvar _a;\nimport BiMap from \"./collections/BiMap.ts\";\nif (typeof Symbol.dispose === \"undefined\") {\n    Object.defineProperty(Symbol, \"dispose\", { value: Symbol(\"Symbol.dispose\") });\n}\nconst _queue = Symbol.for(\"queue\");\nconst _value = Symbol.for(\"value\");\nconst _mutex = Symbol.for(\"mutex\");\nconst _unlocked = Symbol.for(\"unlocked\");\n/**\n * Mutual Exclusion prevents multiple coroutines from accessing the same shared\n * resource simultaneously.\n *\n * **NOTE:**\n * Currently, the Mutex instance can not be used across multiple threads, but is\n * considering adding support for `parallel` threads.\n *\n * @example\n * ```ts\n * import { Mutex } from \"@ayonli/jsext/lock\";\n * import { random } from \"@ayonli/jsext/number\";\n * import { sleep } from \"@ayonli/jsext/async\";\n *\n * const mutex = new Mutex(1);\n *\n * async function concurrentOperation() {\n *     using shared = await mutex.lock();\n *     const value1 = shared.value;\n *\n *     await otherAsyncOperations();\n *\n *     shared.value += 1\n *     const value2 = shared.value;\n *\n *     // Without mutex lock, the shared value may have been modified by other\n *     // calls during `await otherAsyncOperation()`, and the following\n *     // assertion will fail.\n *     console.assert(value1 + 1 === value2);\n * }\n *\n * async function otherAsyncOperations() {\n *     await sleep(100 * random(1, 10));\n * }\n *\n * await Promise.all([\n *     concurrentOperation(),\n *     concurrentOperation(),\n *     concurrentOperation(),\n *     concurrentOperation(),\n * ]);\n * ```\n */\nexport class Mutex {\n    /**\n     * @param value The data associated to the mutex instance.\n     */\n    constructor(value) {\n        this[_a] = [];\n        this[_value] = value;\n    }\n    /**\n     * Acquires the lock of the mutex, optionally for modifying the shared\n     * resource.\n     */\n    async lock() {\n        await new Promise(resolve => {\n            if (this[_queue].length) {\n                this[_queue].push(resolve);\n            }\n            else {\n                this[_queue].push(resolve);\n                resolve();\n            }\n        });\n        const lock = Object.create(Mutex.Lock.prototype);\n        lock[_mutex] = this;\n        return lock;\n    }\n}\n_a = _queue;\n(function (Mutex) {\n    var _b;\n    class Lock {\n        constructor(mutex) {\n            this[_b] = false;\n            this[_mutex] = mutex;\n        }\n        /** Accesses the data associated to the mutex instance. */\n        get value() {\n            if (this[_unlocked]) {\n                throw new ReferenceError(\"trying to access data after unlocked\");\n            }\n            return this[_mutex][_value];\n        }\n        set value(v) {\n            if (this[_unlocked]) {\n                throw new ReferenceError(\"trying to access data after unlocked\");\n            }\n            this[_mutex][_value] = v;\n        }\n        /** Releases the current lock of the mutex. */\n        unlock() {\n            this[_unlocked] = true;\n            const queue = this[_mutex][_queue];\n            queue.shift();\n            const next = queue[0];\n            if (next) {\n                next();\n            }\n            else if (registry.hasValue(this[_mutex])) {\n                registry.deleteValue(this[_mutex]);\n            }\n        }\n        [(_b = _unlocked, Symbol.dispose)]() {\n            this.unlock();\n        }\n    }\n    Mutex.Lock = Lock;\n})(Mutex || (Mutex = {}));\nconst registry = new BiMap();\n/**\n * Acquires a mutex lock for the given key in order to perform concurrent\n * operations and prevent conflicts.\n *\n * If the key is currently being locked by other coroutines, this function will\n * block until the lock becomes available again.\n *\n * @example\n * ```ts\n * import lock from \"@ayonli/jsext/lock\";\n *\n * const key = \"lock_key\";\n *\n * export async function concurrentOperation() {\n *     using ctx = await lock(key);\n *     void ctx;\n *\n *     // This block will never be run if there are other coroutines holding\n *     // the lock.\n *     //\n *     // Other coroutines trying to lock the same key will also never be run\n *     // before this function completes.\n * }\n * ```\n */\nexport default async function lock(key) {\n    let mutex = registry.get(key);\n    if (!mutex) {\n        registry.set(key, mutex = new Mutex(void 0));\n    }\n    return await mutex.lock();\n}\n//# sourceMappingURL=lock.js.map","import { includesSlice, startsWith as _startsWith, endsWith as _endsWith, equals as _equals, } from \"../array.ts\";\nimport { trim, trimEnd } from \"../string.ts\";\nexport function isNotQuery(str) {\n    return str[0] !== \"?\" && str[0] !== \"#\";\n}\nexport function isVolume(path, strict = false) {\n    return strict ? /^[a-zA-Z]:$/.test(path) : /^[a-zA-Z]:(\\\\)?$/.test(path);\n}\n/**\n * Checks if the given `path` is a Windows specific path.\n *\n * @example\n * ```ts\n * import { isWindowsPath } from \"@ayonli/jsext/path\";\n *\n * console.assert(isWindowsPath(\"C:\\\\Windows\\\\System32\"));\n * console.assert(isWindowsPath(\"c:\\\\Windows\\\\System32\")); // case-insensitive on volume\n * console.assert(isWindowsPath(\"D:/Program Files\")); // forward slash is also valid\n * console.assert(isWindowsPath(\"E:\")); // volume without path is also valid\n * ```\n */\nexport function isWindowsPath(path) {\n    return /^[a-zA-Z]:/.test(path) && path.slice(1, 4) !== \"://\";\n}\n/**\n * Checks if the given `path` is a Posix specific path.\n *\n * @example\n * ```ts\n * import { isPosixPath } from \"@ayonli/jsext/path\";\n *\n * console.assert(isPosixPath(\"/usr/bin\"));\n * ```\n */\nexport function isPosixPath(path) {\n    return /^\\//.test(path);\n}\n/**\n * Checks if the given `path` is a file system path.\n *\n * @example\n * ```ts\n * import { isFsPath } from \"@ayonli/jsext/path\";\n *\n * console.assert(isFsPath(\"/usr/bin\"));\n * console.assert(isFsPath(\"C:\\\\Windows\\\\System32\"));\n * console.assert(isFsPath(\"./foo/bar\"));\n * console.assert(isFsPath(\"../foo/bar\"));\n * ```\n */\nexport function isFsPath(path) {\n    return /^(\\.[\\/\\\\]|\\.\\.[\\/\\\\]|[a-zA-Z]:|\\/)/.test(path);\n}\n/**\n * Checks if the given string is a URL, whether standard or non-standard.\n *\n * @example\n * ```ts\n * import { isUrl } from \"@ayonli/jsext/path\";\n *\n * console.assert(isUrl(\"http://example.com\"));\n * console.assert(isUrl(\"https://example.com?foo=bar#baz\"));\n * console.assert(isUrl(\"ftp://example.com\")); // ftp url\n * console.assert(isUrl(\"file:///C:/Windows/System32\")); // file url\n * console.assert(isUrl(\"file://localhost/C:/Windows/System32\")); // file url with hostname\n * console.assert(isUrl(\"file:///usr/bin\"));\n * ```\n */\nexport function isUrl(str) {\n    return /^[a-z](([a-z\\-]+)?:\\/\\/\\S+|[a-z\\-]+:\\/\\/$)/i.test(str) || isFileUrl(str);\n}\n/**\n * Checks if the given string or {@link URL} instance is a file URL, whether\n * with or without `//`.\n *\n * @example\n * ```ts\n * import { isFileUrl } from \"@ayonli/jsext/path\";\n *\n * console.assert(isFileUrl(\"file:///C:/Windows/System32\"));\n * console.assert(isFileUrl(\"file://localhost/C:/Windows/System32\"));\n * console.assert(isFileUrl(\"file:///usr/bin\"));\n * console.assert(isFileUrl(\"file:/usr/bin\"));\n * console.assert(isFileUrl(\"file:///usr/bin?foo=bar\"));\n * console.assert(isFileUrl(new URL(\"file:///usr/bin?foo=bar\")));\n * ```\n */\nexport function isFileUrl(path) {\n    return typeof path === \"string\"\n        ? /^file:((\\/\\/|\\/)\\S+|\\/?$)/i.test(path)\n        : path.protocol === \"file:\";\n}\n/**\n * Checks if the given `path` is an absolute path.\n *\n * @example\n * ```ts\n * import { isAbsolute } from \"@ayonli/jsext/path\";\n *\n * console.assert(isAbsolute(\"/usr/bin\"));\n * console.assert(isAbsolute(\"C:\\\\Windows\\\\System32\"));\n * console.assert(isAbsolute(\"http://example.com\"));\n * console.assert(isAbsolute(\"file:///C:/Windows/System32\"));\n * console.assert(isAbsolute(\"file://localhost/C:/Windows/System32?foo=bar#baz\"));\n * ```\n */\nexport function isAbsolute(path) {\n    return isPosixPath(path) || isWindowsPath(path) || isUrl(path);\n}\n/**\n * Splits the `path` into well-formed segments.\n *\n * @example\n * ```ts\n * import { split } from \"@ayonli/jsext/path\";\n *\n * console.log(split(\"/usr/bin\")); // [\"/\", \"usr\", \"bin\"]\n * console.log(split(\"C:\\\\Windows\\\\System32\")); // [\"C:\\\\\", \"Windows\", \"System32\"]\n * console.log(split(\"file:///user/bin\")); // [\"file:///\", \"usr\", \"bin\"]\n *\n * console.log(split(\"http://example.com/foo/bar?foo=bar#baz\"));\n * // [\"http://example.com\", \"foo\", \"bar\", \"?foo=bar\", \"#baz\"]\n * ```\n */\nexport function split(path) {\n    if (!path) {\n        return [];\n    }\n    else if (isUrl(path)) {\n        const { protocol, host, pathname, search, hash } = new URL(path);\n        let origin = protocol + \"//\" + host;\n        if (protocol === \"file:\" && !host) {\n            origin += \"/\";\n        }\n        if (pathname === \"/\") {\n            if (search && hash) {\n                return [origin, search, hash];\n            }\n            else if (search) {\n                return [origin, search];\n            }\n            else if (hash) {\n                return [origin, hash];\n            }\n            else {\n                return [origin];\n            }\n        }\n        else {\n            const segments = trim(decodeURI(pathname), \"/\").split(/[/\\\\]+/);\n            if (search && hash) {\n                return [origin, ...segments, search, hash];\n            }\n            else if (search) {\n                return [origin, ...segments, search];\n            }\n            else if (hash) {\n                return [origin, ...segments, hash];\n            }\n            else {\n                return [origin, ...segments];\n            }\n        }\n    }\n    else if (isWindowsPath(path)) {\n        const [_, volume, ...segments] = split(\"file:///\" + path.replace(/[/\\\\]+/g, \"/\"));\n        return [volume + \"\\\\\", ...segments];\n    }\n    else if (isPosixPath(path)) {\n        const [_, ...segments] = split(\"file://\" + path.replace(/[/\\\\]+/g, \"/\"));\n        return [\"/\", ...segments];\n    }\n    else { // relative path\n        path = path.replace(/[/\\\\]+/g, \"/\");\n        const [_path, query] = path.split(\"?\");\n        if (query) {\n            const segments = _path ? trimEnd(_path, \"/\").split(\"/\") : [];\n            const [search, hash] = query.split(\"#\");\n            if (hash) {\n                return [...segments, \"?\" + search, \"#\" + hash];\n            }\n            else {\n                return [...segments, \"?\" + search];\n            }\n        }\n        else {\n            const [pathname, hash] = path.split(\"#\");\n            const segments = pathname ? trimEnd(pathname, \"/\").split(\"/\") : [];\n            if (hash) {\n                return [...segments, \"#\" + hash];\n            }\n            else {\n                return segments;\n            }\n        }\n    }\n}\nfunction stripFileProtocol(path) {\n    return path\n        .replace(/^file:\\/\\/(localhost)?\\/?([a-z]:)/i, \"$2\")\n        .replace(/^file:\\/?([a-z]:)/i, \"$1\")\n        .replace(/^file:\\/\\/(localhost)?\\//i, \"/\")\n        .replace(/^file:\\//i, \"/\");\n}\nfunction extractSegmentsForComparison(path, sub, options = {}) {\n    if (options.caseInsensitive) {\n        path = path.toLowerCase();\n        sub = sub.toLowerCase();\n    }\n    if (options.ignoreFileProtocol) {\n        path = stripFileProtocol(path);\n        sub = stripFileProtocol(sub);\n    }\n    const paths = split(path).filter(isNotQuery);\n    const subs = split(sub).filter(isNotQuery);\n    if (paths.length < subs.length) {\n        return { result: false, paths: [], subs: [] };\n    }\n    if (!options.caseInsensitive) {\n        paths.forEach((segment, i) => {\n            if (isVolume(segment)) {\n                // Windows volume is always case-insensitive\n                paths[i] = segment.toLowerCase();\n            }\n        });\n        subs.forEach((segment, i) => {\n            if (isVolume(segment)) {\n                // Windows volume is always case-insensitive\n                subs[i] = segment.toLowerCase();\n            }\n        });\n    }\n    if (!subs.length) {\n        return { result: true, paths, subs };\n    }\n    return { result: undefined, paths, subs };\n}\n/**\n * Checks if the `path` contains the given `sub` path.\n *\n * This function doesn't check the path string directly, instead, it checks the\n * path segments.\n\n * This function is ignorant about the path separator, the query string and the\n * hash string (if present). And is case-insensitive on Windows volume symbol\n * by default.\n *\n * @example\n * ```ts\n * import { contains } from \"@ayonli/jsext/path\";\n *\n * console.assert(contains(\"/usr/bin\", \"/usr\"));\n * console.assert(contains(\"C:\\\\Windows\\\\System32\", \"Windows\\\\System32\"));\n * console.assert(contains(\"http://example.com/foo/bar\", \"foo\"));\n * console.assert(contains(\"file:///C:/Windows/System32\", \"C:/Windows/System32\"));\n *\n * // To be noted, the origin portion of a URL is considered as a whole segment.\n * console.assert(!contains(\"http://example.com/foo/bar\", \"example.com\"));\n * console.assert(contains(\"http://example.com/foo/b\", \"http://example.com\"));\n * ```\n */\nexport function contains(path, sub, options = {}) {\n    const { result, paths, subs } = extractSegmentsForComparison(path, sub, options);\n    if (result !== undefined) {\n        return result;\n    }\n    return includesSlice(paths, subs);\n}\n/**\n * Checks if the `path` starts with the given `sub` path.\n *\n * This function doesn't check the path string directly, instead, it checks the\n * path segments.\n *\n * This function is ignorant about the path separator, the query string and the\n * hash string (if present). And is case-insensitive on Windows volume symbol\n * by default.\n *\n * @example\n * ```ts\n * import { startsWith } from \"@ayonli/jsext/path\";\n *\n * console.assert(startsWith(\"/usr/bin\", \"/usr\"));\n * console.assert(startsWith(\"C:\\\\Windows\\\\System32\", \"c:/Windows\"));\n * console.assert(startsWith(\"http://example.com/foo/bar\", \"http://example.com\"));\n * console.assert(startsWith(\"file:///C:/Windows/System32\", \"file:///c:/Windows\"));\n *\n * // To be noted, the origin portion of a URL is considered as a whole segment.\n * console.assert(!startsWith(\"http://example.com/foo/bar\", \"example.com\"));\n * console.assert(startsWith(\"http://example.com/foo/b\", \"http://example.com\"));\n *\n * // ignore file protocol\n * console.assert(startsWith(\"file:///C:/Windows/System32\", \"C:/Windows/System32\", {\n *     ignoreFileProtocol: true,\n * }));\n * ```\n */\nexport function startsWith(path, sub, options = {}) {\n    const { result, paths, subs } = extractSegmentsForComparison(path, sub, options);\n    if (result !== undefined)\n        return result;\n    return _startsWith(paths, subs);\n}\n/**\n * Checks if the `path` ends with the given `sub` path.\n *\n * This function doesn't check the path string directly, instead, it checks the\n * path segments.\n *\n * This function is ignorant about the path separator, the query string and the\n * hash string (if present). And is case-insensitive on Windows volume symbol\n * by default.\n *\n * @example\n * ```ts\n * import { endsWith } from \"@ayonli/jsext/path\";\n *\n * console.assert(endsWith(\"/usr/bin\", \"bin\"));\n * console.assert(endsWith(\"C:\\\\Windows\\\\System32\", \"System32\"));\n * console.assert(endsWith(\"http://example.com/foo/bar\", \"bar\"));\n * console.assert(endsWith(\"file:///C:/Windows/System32\", \"System32\"));\n *\n * // To be noted, an absolute sub path has its own root.\n * console.assert(!endsWith(\"/usr/bin\", \"/bin\"));\n * ```\n */\nexport function endsWith(path, sub, options = {}) {\n    const { result, paths, subs } = extractSegmentsForComparison(path, sub, options);\n    if (result !== undefined)\n        return result;\n    return _endsWith(paths, subs);\n}\n/**\n * Checks if the `path1` and `path2` describe the same path.\n *\n * This function doesn't check the path string directly, instead, it checks the\n * path segments.\n *\n * This function is ignorant about the path separator, the query string and the\n * hash string (if present). And is case-insensitive on Windows volume symbol\n * by default.\n *\n * @example\n * ```ts\n * import { equals } from \"@ayonli/jsext/path\";\n *\n * console.assert(equals(\"/usr/bin\", \"/usr/bin\"));\n * console.assert(equals(\"C:\\\\Windows\\\\System32\", \"c:/Windows/System32\"));\n * console.assert(equals(\"http://example.com/foo/bar?foo=bar\", \"http://example.com/foo/bar\"));\n * console.assert(equals(\"file://localhost/C:/Windows/System32\", \"file:///c:/Windows/System32\"));\n *\n * // ignore file protocol\n * console.assert(equals(\"file:///C:/Windows/System32\", \"C:\\\\Windows\\\\System32\", {\n *     ignoreFileProtocol: true,\n * }));\n * ```\n */\nexport function equals(path1, path2, options = {}) {\n    const { result, paths, subs } = extractSegmentsForComparison(path1, path2, options);\n    if (result === false || paths.length !== subs.length)\n        return false;\n    return _equals(paths, subs);\n}\n//# sourceMappingURL=util.js.map","/**\n * Platform-independent utility functions for dealing with file system paths and\n * URLs.\n *\n * The functions in this module are designed to be generic and work in any\n * runtime, whether server-side or browsers. They can be used for both system\n * paths and URLs.\n * @module\n */\nimport { isDeno, isNodeLike } from \"./env.ts\";\nimport { stripEnd, trim } from \"./string.ts\";\nimport { contains, endsWith, equals, isAbsolute, isFileUrl, isFsPath, isNotQuery, isPosixPath, isUrl, isVolume, isWindowsPath, split, startsWith, } from \"./path/util.ts\";\nexport { isWindowsPath, isPosixPath, isFsPath, isUrl, isFileUrl, isAbsolute, contains, endsWith, startsWith, equals, split, };\n/**\n * Platform-specific path segment separator. The value is `\\` in Windows\n * server-side environments, and `/` elsewhere.\n */\nexport const sep = (() => {\n    if (isDeno) {\n        if (Deno.build.os === \"windows\") {\n            return \"\\\\\";\n        }\n    }\n    else if (isNodeLike) {\n        if (process.platform === \"win32\") {\n            return \"\\\\\";\n        }\n    }\n    return \"/\";\n})();\n/**\n * Returns the current working directory.\n *\n * **NOTE:** In the browser, this function returns the current origin and pathname.\n *\n * This function may fail in unsupported environments or being rejected by the\n * permission system of the runtime.\n */\nexport function cwd() {\n    if (isDeno) {\n        return Deno.cwd();\n    }\n    else if (isNodeLike) {\n        return process.cwd();\n    }\n    else if (typeof location === \"object\" && location.origin) {\n        return location.origin + (location.pathname === \"/\" ? \"\" : location.pathname);\n    }\n    else {\n        throw new Error(\"Unable to determine the current working directory.\");\n    }\n}\n/**\n * Concatenates all given `segments` into a well-formed path.\n *\n * @example\n * ```ts\n * import { join } from \"@ayonli/jsext/path\";\n *\n * console.log(join(\"foo\", \"bar\")); // \"foo/bar\" or \"foo\\\\bar\" on Windows\n * console.log(join(\"/\", \"foo\", \"bar\")); // \"/foo/bar\"\n * console.log(join(\"C:\\\\\", \"foo\", \"bar\")); // \"C:\\\\foo\\\\bar\"\n * console.log(join(\"file:///foo\", \"bar\", \"..\")) // \"file:///foo\"\n *\n * console.log(join(\"http://example.com\", \"foo\", \"bar\", \"?query\"));\n * // \"http://example.com/foo/bar?query\"\n * ```\n */\nexport function join(...segments) {\n    let _paths = [];\n    for (let i = 0; i < segments.length; i++) {\n        const path = segments[i];\n        if (path) {\n            if (isAbsolute(path)) {\n                _paths = [];\n            }\n            _paths.push(path);\n        }\n    }\n    const paths = [];\n    for (let i = 0; i < _paths.length; i++) {\n        let segment = _paths[i];\n        for (const _segment of split(segment)) {\n            if (_segment === \"..\") {\n                if (!paths.length || paths.every(p => p === \"..\")) {\n                    paths.push(\"..\");\n                }\n                else if (paths.length > 2\n                    || (paths.length === 2 && !isAbsolute(paths[1]))\n                    || (paths.length === 1 && !isAbsolute(paths[0]))) {\n                    paths.pop();\n                }\n            }\n            else if (_segment && _segment !== \".\") {\n                paths.push(_segment);\n            }\n        }\n    }\n    if (!paths.length) {\n        return \".\";\n    }\n    const start = paths[0];\n    const _sep = isUrl(start) || isPosixPath(start) ? \"/\" : isWindowsPath(start) ? \"\\\\\" : sep;\n    let path = \"\";\n    for (let i = 0; i < paths.length; i++) {\n        const segment = paths[i];\n        if (!path || segment[0] === \"?\" || segment[0] === \"#\") {\n            path += segment;\n        }\n        else if (isVolume(segment)) {\n            if (path) {\n                path += segment + \"/\";\n            }\n            else {\n                path = segment;\n            }\n        }\n        else {\n            path += (path.endsWith(_sep) ? \"\" : _sep) + trim(segment, \"/\\\\\");\n        }\n    }\n    if (/^file:\\/\\/\\/[a-z]:$/i.test(path)) {\n        return path + \"/\";\n    }\n    else {\n        return path;\n    }\n}\n/**\n * This function is similar to Node.js implementation, but does not preserve\n * trailing slashes.\n *\n * Since Node.js implementation is not well-designed and this function is\n * identical as calling `join(path)`, so it is deprecated.\n *\n * @deprecated use {@link join} or {@link sanitize} instead.\n */\nexport function normalize(path) {\n    return join(path);\n}\n/**\n * Similar to {@link normalize}, but also remove the search string and hash\n * string if present.\n *\n * @example\n * ```ts\n * import { sanitize } from \"@ayonli/jsext/path\";\n *\n * console.log(sanitize(\"foo/bar?query\")); // \"foo/bar\"\n * console.log(sanitize(\"foo/bar#hash\")); // \"foo/bar\"\n * console.log(sanitize(\"foo/bar/..?query#hash\")); // \"foo\"\n * console.log(sanitize(\"foo/./bar/..?query#hash\")); // \"foo\"\n * ```\n */\nexport function sanitize(path) {\n    return join(...split(path).filter(isNotQuery));\n}\n/**\n * Resolves path `segments` into a well-formed path.\n *\n * This function is similar to {@link join}, except it always returns an\n * absolute path based on the current working directory if the input segments\n * are not absolute by themselves.\n */\nexport function resolve(...segments) {\n    segments = segments.filter(s => s !== \"\");\n    const _cwd = cwd();\n    if (!segments.length) {\n        return _cwd;\n    }\n    segments = isAbsolute(segments[0]) ? segments : [_cwd, ...segments];\n    return join(...segments);\n}\n/**\n * Returns the parent path of the given `path`.\n *\n * @example\n * ```ts\n * import { dirname } from \"@ayonli/jsext/path\";\n *\n * console.log(dirname(\"foo/bar\")); // \"foo\"\n * console.log(dirname(\"/foo/bar\")); // \"/foo\"\n * console.log(dirname(\"C:\\\\foo\\\\bar\")); // \"C:\\\\foo\"\n * console.log(dirname(\"file:///foo/bar\")); // \"file:///foo\"\n * console.log(dirname(\"http://example.com/foo/bar\")); // \"http://example.com/foo\"\n * console.log(dirname(\"http://example.com/foo\")); // \"http://example.com\"\n * console.log(dirname(\"http://example.com/foo/bar?foo=bar#baz\")); // \"http://example.com/foo\"\n * ```\n */\nexport function dirname(path) {\n    if (isUrl(path)) {\n        const { protocol, host, pathname } = new URL(path);\n        const origin = protocol + \"//\" + host;\n        const _dirname = dirname(decodeURI(pathname));\n        if (_dirname === \"/\") {\n            return protocol === \"file:\" && !host ? origin + \"/\" : origin;\n        }\n        else {\n            return origin + _dirname;\n        }\n    }\n    else {\n        const segments = split(path).filter(isNotQuery);\n        const last = segments.pop();\n        if (segments.length) {\n            return join(...segments);\n        }\n        else if (last === \"/\") {\n            return \"/\";\n        }\n        else if (isVolume(last, true)) {\n            return last + \"\\\\\";\n        }\n        else if (isVolume(last)) {\n            return last;\n        }\n        else {\n            return \".\";\n        }\n    }\n}\n/**\n * Return the last portion of the given `path`. Trailing directory separators\n * are ignored, and optional `suffix` is removed.\n *\n * @example\n * ```ts\n * import { basename } from \"@ayonli/jsext/path\";\n *\n * console.log(basename(\"/foo/bar\")); // \"bar\"\n * console.log(basename(\"c:\\\\foo\\\\bar\")); // \"bar\"\n * console.log(basename(\"file:///foo/bar\")); // \"bar\"\n * console.log(basename(\"http://example.com/foo/bar\")); // \"bar\"\n * console.log(basename(\"http://example.com/foo/bar?foo=bar#baz\")); // \"bar\"\n * console.log(basename(\"http://example.com/foo/bar.txt?foo=bar#baz\", \".txt\")); // \"bar\"\n * ```\n */\nexport function basename(path, suffix = \"\") {\n    if (isUrl(path)) {\n        const { pathname } = new URL(path);\n        return basename(decodeURI(pathname), suffix);\n    }\n    else {\n        const segments = split(path).filter(isNotQuery);\n        const _basename = segments.pop();\n        if (!_basename || _basename === \"/\" || isVolume(_basename)) {\n            return \"\";\n        }\n        else if (suffix) {\n            return stripEnd(_basename, suffix);\n        }\n        else {\n            return _basename;\n        }\n    }\n}\n/**\n * Returns the extension of the `path` with leading period.\n *\n * @example\n * ```ts\n * import { extname } from \"@ayonli/jsext/path\";\n *\n * console.log(extname(\"/foo/bar.txt\")); // \".txt\"\n * console.log(extname(\"c:\\\\foo\\\\bar.txt\")); // \".txt\"\n * console.log(extname(\"file:///foo/bar.txt\")); // \".txt\"\n * console.log(extname(\"http://example.com/foo/bar.txt\")); // \".txt\"\n * console.log(extname(\"http://example.com/foo/bar.txt?foo=bar#baz\")); // \".txt\"\n * ```\n */\nexport function extname(path) {\n    const base = basename(path);\n    const index = base.lastIndexOf(\".\");\n    if (index === -1) {\n        return \"\";\n    }\n    else {\n        return base.slice(index);\n    }\n}\n/**\n * Converts the given path to a file URL if it's not one already.\n *\n * @example\n * ```ts\n * import { toFileUrl } from \"@ayonli/jsext/path\";\n *\n * console.log(toFileUrl(\"foo/bar\")); // \"file:///foo/bar\"\n * console.log(toFileUrl(\"c:\\\\foo\\\\bar\")); // \"file:///c:/foo/bar\"\n * ```\n */\nexport function toFileUrl(path) {\n    if (isFileUrl(path)) {\n        return path;\n    }\n    else if (!isUrl(path)) {\n        let _path = resolve(path).replace(/\\\\/g, \"/\");\n        _path = _path[0] === \"/\" ? _path : \"/\" + _path;\n        return new URL(\"file://\" + _path).href;\n    }\n    else {\n        throw new Error(\"Cannot convert a URL to a file URL.\");\n    }\n}\n/**\n * Converts the given URL to a file system path if it's not one already.\n *\n * @example\n * ```ts\n * import { toFsPath } from \"@ayonli/jsext/path\";\n *\n * console.log(toFsPath(\"file:///foo/bar\")); // \"/foo/bar\"\n * console.log(toFsPath(\"file:///c:/foo/bar\")); // \"c:\\\\foo\\\\bar\"\n * ```\n */\nexport function toFsPath(url) {\n    if (typeof url === \"object\") {\n        if (url.protocol === \"file:\") {\n            return join(fileUrlToFsPath(url.toString()));\n        }\n        else {\n            throw new Error(\"Cannot convert a non-file URL to a file system path.\");\n        }\n    }\n    if (isFsPath(url)) {\n        return url;\n    }\n    else if (isFileUrl(url)) {\n        return join(fileUrlToFsPath(url));\n    }\n    else if (!isUrl(url)) {\n        return resolve(url);\n    }\n    else {\n        throw new Error(\"Cannot convert a non-file URL to a file system path.\");\n    }\n}\nfunction fileUrlToFsPath(url) {\n    return url.replace(/^file:(\\/\\/)?/i, \"\").replace(/^\\/([a-z]):/i, \"$1:\");\n}\n//# sourceMappingURL=path.js.map","export const UTIMap = {\n    \"public.item\": [\"*/*\"],\n    \"public.movie\": [\"video/*\"],\n    \"public.audio\": [\"audio/*\"],\n    \"public.image\": [\"image/*\"],\n    \"public.text\": [\"text/*\"],\n    \"public.plain-text\": [\".txt\", \"text/plain\"],\n    \"public.rtf\": [\".rtf\", \"text/rtf\"],\n    \"public.html\": [\".html\", \".htm\", \"text/html\"],\n    \"public.xml\": [\".xml\", \"text/xml\"],\n    \"public.css\": [\".css\", \"text/css\"],\n    \"public.json\": [\".json\", \"application/json\"],\n    \"public.yaml\": [\".yaml\", \".yml\", \"application/yaml\", \"application/x-yaml\"],\n    \"public.toml\": [\".toml\", \"application/toml\"],\n    \"public.ini\": [\".ini\", \"text/ini\"],\n    \"public.comma-separated-values-text\": [\".csv\", \"text/csv\"],\n    \"public.c-source\": [\".c\", \"text/x-csrc\"],\n    \"public.objective-c-source\": [\".m\", \"text/x-objcsrc\"],\n    \"public.c-plus-plus-source\": [\".cpp\", \".cc\", \".cp\", \".c++\", \".cxx\", \"text/x-c++src\"],\n    \"public.objective-c-plus-plus-source\": [\".mm\", \"text/x-objcppsrc\"],\n    \"public.c-header\": [\".h\", \"text/x-chdr\"],\n    \"public.c-plus-plus-header\": [\".hpp\", \".hh\", \".h++\", \".hxx\", \"text/x-c++hdr\"],\n    \"public.assembly-source\": [\".s\", \".S\", \"text/x-asm\"],\n    \"com.apple.rez-source\": [\".r\", \"text/x-rez\"],\n    \"public.mig-source\": [\".defs\", \"text/x-mig\"],\n    \"com.apple.symbol-export\": [\".exp\", \"text/x-export\"],\n    \"com.netscape.javascript-source\": [\".js\", \".mjs\", \".cjs\", \"text/javascript\", \"application/javascript\"],\n    \"public.shell-script\": [\".sh\", \".command\", \".bat\", \".cmd\", \".ps1\", \"text/x-shellscript\"],\n    \"public.csh-script\": [\".csh\", \"text/x-csh\"],\n    \"public.perl-script\": [\".pl\", \".pm\", \"application/perl\", \"text/x-perl\", \"text/x-perl-script\"],\n    \"public.python-script\": [\".py\", \".pyc\", \"application/python\", \"text/x-python\", \"text/x-python-script\"],\n    \"public.ruby-script\": [\".rb\", \"application/ruby\", \"text/ruby\", \"text/x-ruby-script\"],\n    \"public.php-script\": [\".php\", \".php3\", \".php4\", \".php5\", \".phtml\", \"application/php\", \"text/php\", \"text/x-php-script\"],\n    \"com.apple.applescript.text\": [\".applescript\"],\n    \"com.apple.applescript.script\": [\".scpt\"],\n    \"public.object-code\": [\".o\"],\n    \"com.microsoft.windows-executable\": [\".exe\", \".com\", \".msi\", \"application/vnd.microsoft.portable-executable\"],\n    \"com.microsoft.windows-dynamic-link-library\": [\".dll\", \".ocx\", \"application/x-msdownload\"],\n    \"com.sun.java-source\": [\".java\", \".jav\", \"text/x-java-source\"],\n    \"com.sun.java-class\": [\".class\"],\n    \"com.sun.java-archive\": [\".jar\", \"application/java-archive\"],\n    \"com.sun.java-properties\": [\".properties\", \"text/x-java-properties\"],\n    \"com.sun.java-keystore\": [\".jks\", \"application/x-java-keystore\"],\n    \"com.sun.java-web-start\": [\".jnlp\", \"application/jnlp\"],\n    \"com.apple.quartz-composer-composition\": [\".qtz\", \"application/x-quartzcomposer\"],\n    \"org.gnu.gnu-tar-archive\": [\".gtar\", \"application/x-gtar\"],\n    \"public.tar-archive\": [\".tar\", \"application/x-tar\", \"application/tar\"],\n    \"org.gnu.gnu-zip-archive\": [\".gz\", \".gzip\", \"application/gzip\", \"application/x-gzip\"],\n    \"org.gnu.gnu-zip-tar-archive\": [\".tgz\", \"application/x-tar-gz\", \"application/x-gzip-compressed-tar\"],\n    \"public.bzip2-archive\": [\".bz2\", \"application/x-bzip2\"],\n    \"public.tar-bzip2-archive\": [\".tbz\", \".tbz2\", \"application/x-bzip2-compressed-tar\"],\n    \"com.apple.xar-archive\": [\".xar\", \"application/x-xar\"],\n    \"com.apple.binhex-archive\": [\".hqx\", \"application/mac-binhex40\", \"application/binhex\"],\n    \"com.apple.macbinary-archive\": [\".bin\", \"application/x-macbinary\", \"application/macbinary\"],\n    \"public.vcard\": [\".vcf\", \"text/vcard\"],\n    \"public.jpeg\": [\".jpg\", \".jpeg\", \"image/jpeg\"],\n    \"public.jpeg-2000\": [\".jp2\", \"image/jp2\"],\n    \"public.tiff\": [\".tiff\", \".tif\", \"image/tiff\"],\n    \"com.apple.pict\": [\".pct\", \"image/pict\"],\n    \"com.apple.macpaint-image\": [\".pntg\", \"image/x-macpaint\"],\n    \"public.png\": [\".png\", \"image/png\"],\n    \"public.xbitmap-image\": [\".xbm\", \"image/x-xbitmap\"],\n    \"com.apple.quicktime-image\": [\".qtif\", \"image/x-quicktime\"],\n    \"com.apple.icns\": [\".icns\", \"image/icns\"],\n    \"com.apple.quicktime-movie\": [\".mov\", \".qt\", \"video/quicktime\"],\n    \"public.avi\": [\".avi\", \"video/x-msvideo\"],\n    \"public.mpeg\": [\".mpg\", \".mpeg\", \"video/mpeg\"],\n    \"public.mpeg-4\": [\".mp4\", \"video/mp4\"],\n    \"public.3gpp\": [\".3gp\", \"video/3gpp\"],\n    \"public.3gpp2\": [\".3g2\", \"video/3gpp2\"],\n    \"public.mp3\": [\".mp3\", \"audio/mpeg\", \"audio/mp3\"],\n    \"public.mpeg-4-audio\": [\".m4a\", \"audio/x-m4a\"],\n    \"com.apple.protected-mpeg-4-audio\": [\".m4p\", \"audio/mp4\", \"audio/x-m4p\"],\n    \"public.ulaw-audio\": [\".au\", \"audio/basic\"],\n    \"public.aifc-audio\": [\".aifc\", \"audio/x-aifc\"],\n    \"public.aiff-audio\": [\".aiff\", \".aif\", \"audio/aiff\"],\n    \"com.apple.coreaudio-format\": [\".caf\", \"audio/x-caf\"],\n    \"com.apple.bundle\": [\".bundle\"],\n    \"com.apple.application-bundle\": [\".app\"],\n    \"com.apple.plugin\": [\".plugin\"],\n    \"com.apple.metadata-importer\": [\".mdimporter\"],\n    \"com.apple.dashboard-widget\": [\".wdgt\"],\n    \"public.cpio-archive\": [\".cpio\", \"application/x-cpio\"],\n    \"public.zip-archive\": [\".zip\", \"application/zip\"],\n    \"com.apple.framework\": [\".framework\"],\n    \"com.apple.rtfd\": [\".rtfd\", \"application/rtfd\"],\n    \"public.opentype-font\": [\".otf\", \"application/x-font-opentype\"],\n    \"public.truetype-ttf-font\": [\".ttf\", \"application/x-font-truetype\"],\n    \"public.truetype-collection-font\": [\".ttc\", \"application/x-font-ttf\"],\n    \"com.apple.font-suitcase\": [\".dfont\", \"application/x-font-suitcase\"],\n    \"com.adobe.postscript.pfa-font\": [\".pfa\", \"application/x-font-type1\"],\n    \"com.adobe.postscript-pfb-font\": [\".pfb\", \"application/x-font-type2\"],\n    \"com.apple.colorsync-profile\": [\".icc\", \".icm\", \"application/vnd.iccprofile\"],\n    \"com.adobe.pdf\": [\".pdf\", \"application/pdf\"],\n    \"com.adobe.postscript\": [\".ps\", \"application/postscript\"],\n    \"com.adobe.encapsulated-postscript\": [\".eps\", \"application/x-eps\"],\n    \"com.adobe.photoshop-image\": [\".psd\", \"image/vnd.adobe.photoshop\", \"image/psd\"],\n    \"com.adobe.illustrator.ai-image\": [\".ai\", \"application/illustrator\", \"application/vnd.adobe.illustrator\"],\n    \"com.compuserve.gif\": [\".gif\", \"image/gif\"],\n    \"com.microsoft.bmp\": [\".bmp\", \"image/bmp\"],\n    \"com.microsoft.ico\": [\".ico\", \"image/x-icon\"],\n    \"com.microsoft.word.doc\": [\".doc\", \"application/msword\"],\n    \"com.microsoft.excel.xls\": [\".xls\", \"application/vnd.ms-excel\"],\n    \"com.microsoft.powerpoint.ppt\": [\".ppt\", \"application/vnd.ms-powerpoint\"],\n    \"org.openxmlformats.spreadsheetml.sheet\": [\".xlsx\", \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\"],\n    \"org.openxmlformats.presentationml.presentation\": [\".pptx\", \"application/vnd.openxmlformats-officedocument.presentationml.presentation\"],\n    \"org.openxmlformats.wordprocessingml.document\": [\".docx\", \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\"],\n    \"com.microsoft.waveform-audio\": [\".wav\", \"audio/wav\"],\n    \"com.microsoft.advanced-systems-format\": [\".asf\", \"video/x-ms-asf\"],\n    \"com.microsoft.windows-media-wm\": [\".wm\", \"video/x-ms-wm\"],\n    \"com.microsoft.windows-media-wmv\": [\".wmv\", \"video/x-ms-wmv\"],\n    \"com.microsoft.windows-media-wmp\": [\".wmp\", \"video/x-ms-wmp\"],\n    \"com.microsoft.windows-media-wma\": [\".wma\", \"audio/x-ms-wma\"],\n    \"com.microsoft.advanced-stream-redirector\": [\".asx\", \"video/x-ms-asx\"],\n    \"com.microsoft.windows-media-wmx\": [\".wmx\", \"video/x-ms-wmx\"],\n    \"com.microsoft.windows-media-wvx\": [\".wvx\", \"video/x-ms-wvx\"],\n    \"com.microsoft.windows-media-wax\": [\".wax\", \"audio/x-ms-wax\"],\n    \"com.apple.iwork.pages.sffpages\": [\".pages\", \"application/x-iwork-pages-sffpages\"],\n    \"com.apple.iwork.numbers.sffnumbers\": [\".numbers\", \"application/x-iwork-numbers-sffnumbers\"],\n    \"com.apple.iwork.keynote.sffkey\": [\".key\", \"application/x-iwork-keynote-sffkey\"],\n    \"com.truevision.tga-image\": [\".tga\", \"image/x-tga\"],\n    \"com.sgi.sgi-image\": [\".sgi\", \"image/sgi\"],\n    \"com.sgi.rgb-image\": [\".rgb\", \"image/x-rgb\"],\n    \"com.ilm.openexr-image\": [\".exr\", \"image/x-exr\"],\n    \"com.kodak.flashpix.image\": [\".fpx\", \".fpix\", \"image/vnd.fpx\"],\n    \"com.j2.jfx-fax\": [\".jfx\", \"image/jfax\"],\n    \"com.js.efx-fax\": [\".efx\", \"image/efax\"],\n    \"com.digidesign.sd2-audio\": [\".sd2\", \"audio/x-sd2\"],\n    \"com.real.realmedia\": [\".rm\", \"application/vnd.rn-realmedia\"],\n    \"com.real.realmedia-vbr\": [\".rv\", \".rmvb\", \"application/vnd.rn-realmedia-vbr\"],\n    \"com.real.realaudio\": [\".ra\", \"audio/vnd.rn-realaudio\"],\n    \"com.real.smil\": [\".smil\", \"application/smil\"],\n    \"com.allume.stuffit-archive\": [\".sit\", \"application/x-stuffit\"],\n    \"org.opml.opml\": [\".opml\", \"text/x-opml\"],\n    \"net.daringfireball.markdown\": [\".md\", \"text/markdown\"],\n    \"vnd.sqlite3\": [\".sqlite3\", \".sqlite\", \".db\", \"application/x-sqlite3\"],\n    \"public.iso-image\": [\".iso\", \"application/x-iso-image\"],\n    \"com.apple.disk-image\": [\".dmg\", \".smi\", \".img\", \"application/x-apple-diskimage\"],\n    \"public.heic\": [\".heic\", \".heif\", \"image/heic\"],\n    \"com.apple.installer-package-archive\": [\".pkg\", \"application/x-apple-installer-package\"],\n    \"public.mpeg-2-transport-stream\": [\".ts\", \"video/mp2t\", \"application/typescript\", \"text/typescript\"],\n    \"public.x509-certificate\": [\".cer\", \".crt\", \".der\", \".pem\", \"application/x-x509-ca-cert\"],\n    \"com.microsoft.cab-archive\": [\".cab\", \"application/vnd.ms-cab-compressed\"],\n    \"public.xz-archive\": [\".xz\", \"application/x-xz\"],\n    \"public.7z-archive\": [\".7z\", \"application/x-7z-compressed\"],\n    \"com.rarlab.rar-archive\": [\".rar\", \"application/x-rar-compressed\"],\n    \"public.rpm-archive\": [\".rpm\", \"application/x-rpm\"],\n    \"public.deb-archive\": [\".deb\", \"application/vnd.debian.binary-package\"],\n    \"public.ar-archive\": [\".ar\", \"application/x-unix-archive\"],\n    \"public.wasm-executable\": [\".wasm\", \"application/wasm\"],\n    \"public.svg-image\": [\".svg\", \"image/svg+xml\"],\n    \"public.webp\": [\".webp\", \"image/webp\"],\n    \"public.avif\": [\".avif\", \"image/avif\"],\n    \"public.pkcs8\": [\".p8\", \".pkcs8\", \"application/pkcs8\"],\n    \"public.pkcs10\": [\".p10\", \".pkcs10\", \"application/pkcs10\"],\n    \"public.x-pkcs12\": [\".p12\", \".pfx\", \"application/x-pkcs12\"],\n    \"public.systemd-swap-unit\": [\".swap\", \"application/systemd-swap\"],\n    \"public.systemd-service-unit\": [\".service\", \"application/systemd-service\"],\n    \"public.systemd-socket-unit\": [\".socket\", \"application/systemd-socket\"],\n    \"public.webmanifest\": [\".webmanifest\", \"application/manifest+json\"],\n    \"com.apple.xcode.project\": [\".xcodeproj\", \"application/x-xcodeproj\"],\n};\n//# sourceMappingURL=constants.js.map","/**\n * Functions to get file types in different fashions.\n * @module\n */\nimport { UTIMap } from \"./filetype/constants.ts\";\n/**\n * Returns the corresponding UTI (Uniform Type Identifier) for the given\n * type, where the type is a file extension or a MIME type name.\n *\n * @example\n * ```ts\n * import { getUTI } from \"@ayonli/jsext/filetype\";\n *\n * console.log(getUTI(\".png\")); // public.png\n * console.log(getUTI(\"image/png\")); // public.png\n * ```\n */\nexport function getUTI(type) {\n    type = type.toLowerCase();\n    if (type.startsWith(\"*.\")) {\n        type = type.slice(1);\n    }\n    if (!type) {\n        return undefined;\n    }\n    for (const [uti, values] of Object.entries(UTIMap)) {\n        if (uti === type || values.includes(type)) {\n            return uti;\n        }\n    }\n    return undefined;\n}\n/**\n * Returns the corresponding MIME type for the given type, where the type is a\n * file extension or a UTI (Uniform Type Identifier) name.\n *\n * @example\n * ```ts\n * import { getMIME } from \"@ayonli/jsext/filetype\";\n *\n * console.log(getMIME(\".png\")); // image/png\n * console.log(getMIME(\"public.png\")); // image/png\n * ```\n */\nexport function getMIME(type) {\n    type = type.toLowerCase();\n    if (type.startsWith(\"*.\")) {\n        type = type.slice(1);\n    }\n    if (!type) {\n        return undefined;\n    }\n    else if (type.includes(\"/\")) {\n        return type;\n    }\n    else if (type[0] !== \".\") {\n        const values = UTIMap[type] || null;\n        return values ? values.find(v => v.includes(\"/\")) : undefined;\n    }\n    for (const values of Object.values(UTIMap)) {\n        if (values.includes(type)) {\n            const mime = values.find(v => v.includes(\"/\"));\n            if (mime) {\n                return mime;\n            }\n        }\n    }\n    return undefined;\n}\n/**\n * Returns the corresponding file extensions for the given type, where the type\n * is a MIME type or a UTI (Uniform Type Identifier) name.\n *\n * @example\n * ```ts\n * import { getExtensions } from \"@ayonli/jsext/filetype\";\n *\n * console.log(getExtensions(\"image/png\")); // [\".png\"]\n * console.log(getExtensions(\"public.png\")); // [\".png\"]\n * ```\n */\nexport function getExtensions(type) {\n    type = type.toLowerCase();\n    if (type.startsWith(\"*.\")) {\n        type = type.slice(1);\n    }\n    if (!type) {\n        return [];\n    }\n    else if (type[0] === \".\") {\n        return [type];\n    }\n    if (type[0] !== \".\" && !type.includes(\"/\")) {\n        const values = UTIMap[type] || null;\n        return values ? values.filter(v => v[0] === \".\") : [];\n    }\n    if (type.endsWith(\"/*\")) {\n        const _type = type.slice(0, -1);\n        return Object.values(UTIMap)\n            .filter(values => values.some(v => v !== type && v.startsWith(_type)))\n            .map(values => values.filter(v => v[0] === \".\"))\n            .flat();\n    }\n    for (const types of Object.values(UTIMap)) {\n        if (types.includes(type)) {\n            return types.filter(t => t.startsWith(\".\"));\n        }\n    }\n    return [];\n}\n//# sourceMappingURL=filetype.js.map","import { orderBy, startsWith } from \"../array.ts\";\nimport { Exception } from \"../error.ts\";\nimport { getMIME } from \"../filetype.ts\";\nimport { omit } from \"../object.ts\";\nimport { basename, extname, isFileUrl, split, toFsPath } from \"../path.ts\";\nexport function ensureFsTarget(path) {\n    if (path instanceof URL) {\n        if (path.protocol !== \"file:\") {\n            throw new TypeError(\"Only file URLs are supported\");\n        }\n        else {\n            return toFsPath(path.href);\n        }\n    }\n    else if (typeof path === \"string\" && isFileUrl(path)) {\n        return toFsPath(path);\n    }\n    else {\n        return path;\n    }\n}\nfunction getErrorName(err) {\n    if (err.constructor === Error) {\n        return err.constructor.name;\n    }\n    else {\n        return err.name;\n    }\n}\n/**\n * Wraps a raw file system error to a predefined error by this module.\n *\n * @param type Used for `FileSystemHandle` operations.\n */\nexport function wrapFsError(err, type = undefined) {\n    if (err instanceof Error && !(err instanceof Exception) && !(err instanceof TypeError)) {\n        const errName = getErrorName(err);\n        const errCode = err.code;\n        if (errName === \"NotFoundError\"\n            || errName === \"NotFound\"\n            || errCode === \"ENOENT\"\n            || errCode === \"ENOTFOUND\") {\n            return new Exception(err.message, { name: \"NotFoundError\", code: 404, cause: err });\n        }\n        else if (errName === \"NotAllowedError\"\n            || errName === \"PermissionDenied\"\n            || errName === \"InvalidStateError\"\n            || errName === \"SecurityError\"\n            || errName === \"EACCES\"\n            || errCode === \"EPERM\"\n            || errCode === \"ERR_ACCESS_DENIED\") {\n            return new Exception(err.message, { name: \"NotAllowedError\", code: 403, cause: err });\n        }\n        else if (errName === \"AlreadyExists\"\n            || errCode === \"EEXIST\"\n            || errCode === \"ERR_FS_CP_EEXIST\") {\n            return new Exception(err.message, { name: \"AlreadyExistsError\", code: 409, cause: err });\n        }\n        else if ((errName === \"TypeMismatchError\" && type === \"file\")\n            || errName === \"IsADirectory\"\n            || errCode === \"EISDIR\"\n            || errCode === \"ERR_FS_EISDIR\") {\n            return new Exception(err.message, { name: \"IsDirectoryError\", code: 415, cause: err });\n        }\n        else if ((errName === \"TypeMismatchError\" && type === \"directory\")\n            || errName === \"NotADirectory\"\n            || errCode === \"ENOTDIR\") {\n            return new Exception(err.message, { name: \"NotDirectoryError\", code: 415, cause: err });\n        }\n        else if (errName === \"InvalidModificationError\"\n            || errName === \"NotSupported\"\n            || errCode === \"ENOTEMPTY\"\n            || errCode === \"ERR_FS_CP_EINVAL\"\n            || errCode === \"ERR_FS_CP_FIFO_PIPE\"\n            || errCode === \"ERR_FS_CP_DIR_TO_NON_DIR\"\n            || errCode === \"ERR_FS_CP_NON_DIR_TO_DIR\"\n            || errCode === \"ERR_FS_CP_SOCKET\"\n            || errCode === \"ERR_FS_CP_SYMLINK_TO_SUBDIRECTORY\"\n            || errCode === \"ERR_FS_CP_UNKNOWN\"\n            || errCode === \"ERR_FS_INVALID_SYMLINK_TYPE\") {\n            return new Exception(err.message, { name: \"InvalidOperationError\", code: 405, cause: err });\n        }\n        else if (errName === \"NoModificationAllowedError\"\n            || errName === \"Busy\"\n            || errName === \"TimedOut\"\n            || errCode === \"ERR_DIR_CONCURRENT_OPERATION\") {\n            return new Exception(errName, { name: \"BusyError\", code: 409, cause: err });\n        }\n        else if (errName === \"Interrupted\" || errCode === \"ERR_DIR_CLOSED\") {\n            return new Exception(err.message, { name: \"InterruptedError\", code: 409, cause: err });\n        }\n        else if (errName === \"QuotaExceededError\"\n            || errCode === \"ERR_FS_FILE_TOO_LARGE\") {\n            return new Exception(err.message, { name: \"FileTooLargeError\", code: 413, cause: err });\n        }\n        else if (errName === \"FilesystemLoop\") {\n            return new Exception(err.message, { name: \"FilesystemLoopError\", code: 508, cause: err });\n        }\n        else {\n            return err;\n        }\n    }\n    else if (err instanceof Error) {\n        return err;\n    }\n    else if (typeof err === \"string\") {\n        return new Exception(err, { code: 500, cause: err });\n    }\n    else {\n        return new Exception(\"Unknown error\", { code: 500, cause: err });\n    }\n}\n/**\n * Wraps a raw file system operation so that when any error occurs, the error is\n * wrapped to a predefined error by this module.\n *\n * @param type Only used for `FileSystemHandle` operations.\n */\nexport function rawOp(op, type = undefined) {\n    return op.catch((err) => {\n        throw wrapFsError(err, type);\n    });\n}\nexport function fixDirEntry(entry) {\n    // for backward compatibility\n    Object.defineProperty(entry, \"path\", {\n        get() {\n            return entry.relativePath;\n        },\n    });\n    return entry;\n}\nexport function fixFileType(file) {\n    var _a;\n    if (!file.type) {\n        const ext = extname(file.name);\n        if (ext) {\n            Object.defineProperty(file, \"type\", {\n                value: (_a = getMIME(ext)) !== null && _a !== void 0 ? _a : \"\",\n                writable: false,\n                configurable: true,\n            });\n        }\n    }\n    return file;\n}\n/**\n * @param addPathProp `DirEntry.prop` is deprecated, this option is for backward\n * compatibility.\n */\nexport function makeTree(dir, entries, addPathProp = false) {\n    const list = entries.map(entry => ({\n        ...entry,\n        paths: split(entry.relativePath),\n    }));\n    const nodes = (function walk(list, store) {\n        // Order the entries first by kind, then by names alphabetically.\n        list = [\n            ...orderBy(list.filter(e => e.kind === \"directory\"), e => e.name, \"asc\"),\n            ...orderBy(list.filter(e => e.kind === \"file\"), e => e.name, \"asc\"),\n        ];\n        const nodes = [];\n        for (const entry of list) {\n            if (entry.kind === \"directory\") {\n                const paths = entry.paths;\n                const childEntries = store.filter(e => startsWith(e.paths, paths));\n                const directChildren = childEntries\n                    .filter(e => e.paths.length === paths.length + 1);\n                if (directChildren.length) {\n                    const indirectChildren = childEntries\n                        .filter(e => !directChildren.includes(e));\n                    const _entry = {\n                        ...omit(entry, [\"paths\"]),\n                        children: walk(directChildren, indirectChildren),\n                    };\n                    addPathProp && fixDirEntry(_entry);\n                    nodes.push(_entry);\n                }\n                else {\n                    let _entry = {\n                        ...omit(entry, [\"paths\"]),\n                        children: [],\n                    };\n                    addPathProp && fixDirEntry(_entry);\n                    nodes.push(_entry);\n                }\n            }\n            else {\n                const _entry = {\n                    ...omit(entry, [\"paths\"]),\n                };\n                addPathProp && fixDirEntry(_entry);\n                nodes.push(_entry);\n            }\n        }\n        return nodes;\n    })(list.filter(entry => entry.paths.length === 1), list.filter(entry => entry.paths.length > 1));\n    let rootName;\n    if (typeof dir === \"object\") {\n        rootName = dir.name || \"(root)\";\n    }\n    else if (dir) {\n        rootName = basename(dir);\n        if (!rootName || rootName === \".\") {\n            rootName = \"(root)\";\n        }\n    }\n    else {\n        rootName = \"(root)\";\n    }\n    const rooEntry = {\n        name: rootName,\n        kind: \"directory\",\n        relativePath: \"\",\n        children: nodes,\n    };\n    if (typeof dir === \"object\") {\n        rooEntry.handle = dir;\n    }\n    addPathProp && fixDirEntry(rooEntry);\n    return rooEntry;\n}\n//# sourceMappingURL=util.js.map","import { isDeno, isNodeLike } from \"../../env.ts\";\nexport async function resolveHomeDir(path) {\n    if (path[0] === \"~\" && (isDeno || isNodeLike)) {\n        const os = await import(\"node:os\");\n        const homedir = os.homedir();\n        path = homedir + path.slice(1);\n    }\n    return path;\n}\n//# sourceMappingURL=server.js.map","import chan from \"../chan.ts\";\nimport { fromErrorEvent } from \"../error.ts\";\nfunction isFunction(val) {\n    return typeof val === \"function\";\n}\nasync function* resolveAsyncIterable(promise) {\n    const stream = await promise;\n    const reader = stream.getReader();\n    try {\n        while (true) {\n            const { done, value } = await reader.read();\n            if (done) {\n                break;\n            }\n            yield value;\n        }\n    }\n    finally {\n        reader.releaseLock();\n    }\n}\nexport function resolveReadableStream(promise) {\n    const { readable, writable } = new TransformStream();\n    promise.then(stream => stream.pipeTo(writable));\n    return readable;\n}\n/**\n * If the given `promise` resolves to a `ReadableStream<Uint8Array>`, this\n * function will return a new `ReadableStream<Uint8Array>` object that can be\n * used to read the byte stream without the need to wait for the promise to\n * resolve.\n *\n * This function is optimized for zero-copy read, so it's recommended to use\n * this function when the source stream is a byte stream.\n */\nexport function resolveByteStream(promise) {\n    let reader;\n    return new ReadableStream({\n        type: \"bytes\",\n        async start() {\n            const source = await promise;\n            try { // zero-copy read from the source stream\n                reader = source.getReader({ mode: \"byob\" });\n            }\n            catch (_a) {\n                reader = source.getReader();\n            }\n        },\n        async pull(controller) {\n            var _a;\n            try {\n                let request;\n                let view;\n                let result;\n                if (\"byobRequest\" in controller && ((_a = controller.byobRequest) === null || _a === void 0 ? void 0 : _a.view)) {\n                    // This stream is requested for zero-copy read.\n                    request = controller.byobRequest;\n                    view = request.view;\n                }\n                else if (reader instanceof ReadableStreamBYOBReader) {\n                    view = new Uint8Array(4096);\n                }\n                if (reader instanceof ReadableStreamBYOBReader) {\n                    // The source stream supports zero-copy read, we can read its\n                    // data directly into the request view's buffer.\n                    result = await reader.read(view);\n                }\n                else {\n                    // The source stream does not support zero-copy read, we need to\n                    // copy its data to a new buffer.\n                    result = await reader.read();\n                }\n                if (request) {\n                    if (result.done) {\n                        controller.close();\n                        // The final chunk may be empty, but still needs to be\n                        // responded in order to close the request reader.\n                        if (result.value !== undefined) {\n                            request.respondWithNewView(result.value);\n                        }\n                        else {\n                            request.respond(0);\n                        }\n                    }\n                    else if (reader instanceof ReadableStreamBYOBReader\n                        || (view && result.value.buffer.byteLength === view.buffer.byteLength)) {\n                        // Respond to the request reader with the same underlying\n                        // buffer of the source stream.\n                        // Or the source stream doesn't support zero-copy read, but\n                        // the result bytes has the same buffer size as the request\n                        // view.\n                        request.respondWithNewView(result.value);\n                    }\n                    else {\n                        // This stream is requested for zero-copy read, but the\n                        // source stream doesn't support it. We need to copy and\n                        // deliver the new buffer instead.\n                        controller.enqueue(result.value);\n                    }\n                }\n                else {\n                    if (result.done) {\n                        controller.close();\n                    }\n                    else {\n                        controller.enqueue(result.value);\n                    }\n                }\n            }\n            catch (err) {\n                reader.releaseLock();\n                controller.error(err);\n            }\n        },\n        cancel(reason = undefined) {\n            reader.cancel(reason);\n            reader.releaseLock();\n        },\n    });\n}\n/**\n * Converts the given `source` into an `AsyncIterable` object if it's not one\n * already, returns `null` if failed.\n */\nexport function asAsyncIterable(source) {\n    if (typeof source[Symbol.asyncIterator] === \"function\") {\n        return source;\n    }\n    else if (typeof source[Symbol.iterator] === \"function\") {\n        return {\n            [Symbol.asyncIterator]: async function* () {\n                for (const value of source) {\n                    yield value;\n                }\n            },\n        };\n    }\n    else if (typeof ReadableStream === \"function\"\n        && source instanceof ReadableStream) {\n        const reader = source.getReader();\n        return {\n            [Symbol.asyncIterator]: async function* () {\n                try {\n                    while (true) {\n                        const { done, value } = await reader.read();\n                        if (done) {\n                            break;\n                        }\n                        yield value;\n                    }\n                }\n                catch (err) {\n                    reader.cancel(err);\n                }\n                finally {\n                    reader.releaseLock();\n                }\n            },\n        };\n    }\n    else if (typeof source[\"then\"] === \"function\") {\n        return resolveAsyncIterable(source);\n    }\n    return null;\n}\nexport function toAsyncIterable(source, eventMap = undefined) {\n    var _a;\n    const iterable = asAsyncIterable(source);\n    if (iterable) {\n        return iterable;\n    }\n    const channel = chan(Infinity);\n    const handleMessage = channel.send.bind(channel);\n    const handleClose = channel.close.bind(channel);\n    const handleBrowserErrorEvent = (ev) => {\n        let err;\n        if (typeof ErrorEvent === \"function\" && ev instanceof ErrorEvent) {\n            err = ev.error || fromErrorEvent(ev);\n        }\n        else {\n            // @ts-ignore\n            err = new Error(\"something went wrong\", { cause: ev });\n        }\n        handleClose(err);\n    };\n    const proto = Object.getPrototypeOf(source);\n    const msgDesc = Object.getOwnPropertyDescriptor(proto, \"onmessage\");\n    if ((msgDesc === null || msgDesc === void 0 ? void 0 : msgDesc.set) && isFunction(source[\"close\"])) { // WebSocket or EventSource\n        const errDesc = Object.getOwnPropertyDescriptor(proto, \"onerror\");\n        const closeDesc = Object.getOwnPropertyDescriptor(proto, \"onclose\");\n        let cleanup;\n        if ((eventMap === null || eventMap === void 0 ? void 0 : eventMap.event) &&\n            (eventMap === null || eventMap === void 0 ? void 0 : eventMap.event) !== \"message\" &&\n            isFunction(source[\"addEventListener\"])) { // for EventSource listening on custom events\n            const es = source;\n            const eventName = eventMap.event;\n            const msgListener = (ev) => {\n                handleMessage(ev.data);\n            };\n            es.addEventListener(eventName, msgListener);\n            cleanup = () => {\n                es.removeEventListener(eventName, msgListener);\n            };\n        }\n        else {\n            msgDesc.set.call(source, (ev) => {\n                handleMessage(ev.data);\n            });\n            cleanup = () => {\n                var _a;\n                (_a = msgDesc.set) === null || _a === void 0 ? void 0 : _a.call(source, null);\n            };\n        }\n        (_a = errDesc === null || errDesc === void 0 ? void 0 : errDesc.set) === null || _a === void 0 ? void 0 : _a.call(source, handleBrowserErrorEvent);\n        if (closeDesc === null || closeDesc === void 0 ? void 0 : closeDesc.set) { // WebSocket\n            closeDesc.set.call(source, () => {\n                var _a, _b;\n                handleClose();\n                (_a = closeDesc.set) === null || _a === void 0 ? void 0 : _a.call(source, null);\n                (_b = errDesc === null || errDesc === void 0 ? void 0 : errDesc.set) === null || _b === void 0 ? void 0 : _b.call(source, null);\n                cleanup === null || cleanup === void 0 ? void 0 : cleanup();\n            });\n        }\n        else if (!(closeDesc === null || closeDesc === void 0 ? void 0 : closeDesc.set) && isFunction(source[\"close\"])) { // EventSource\n            // EventSource by default does not trigger close event, we need to\n            // make sure when it calls the close() function, the iterator is\n            // automatically closed.\n            const es = source;\n            const _close = es.close;\n            Object.defineProperty(es, \"close\", {\n                configurable: true,\n                writable: true,\n                value: function close() {\n                    var _a;\n                    _close.call(es);\n                    handleClose();\n                    Object.defineProperty(es, \"close\", {\n                        configurable: true,\n                        writable: true,\n                        value: _close,\n                    });\n                    (_a = errDesc === null || errDesc === void 0 ? void 0 : errDesc.set) === null || _a === void 0 ? void 0 : _a.call(source, null);\n                    cleanup === null || cleanup === void 0 ? void 0 : cleanup();\n                }\n            });\n        }\n    }\n    else if (isFunction(source[\"send\"]) && isFunction(source[\"close\"])) {\n        // non-standard WebSocket implementation or WebSocket-like object\n        const ws = source;\n        if (typeof ws.addEventListener === \"function\") {\n            const msgListener = (ev) => {\n                handleMessage(ev.data);\n            };\n            ws.addEventListener(\"message\", msgListener);\n            ws.addEventListener(\"error\", handleBrowserErrorEvent);\n            ws.addEventListener(\"close\", () => {\n                handleClose();\n                ws.removeEventListener(\"message\", msgListener);\n                ws.removeEventListener(\"error\", handleBrowserErrorEvent);\n            });\n        }\n        else {\n            ws.onmessage = (ev) => {\n                handleMessage(ev.data);\n            };\n            ws.onerror = handleBrowserErrorEvent;\n            ws.onclose = () => {\n                handleClose();\n                ws.onclose = null;\n                ws.onerror = null;\n                ws.onmessage = null;\n            };\n        }\n    }\n    else if (isFunction(source[\"addEventListener\"])) { // EventTarget\n        const target = source;\n        const msgEvent = (eventMap === null || eventMap === void 0 ? void 0 : eventMap.message) || \"message\";\n        const errEvent = (eventMap === null || eventMap === void 0 ? void 0 : eventMap.error) || \"error\";\n        const closeEvent = (eventMap === null || eventMap === void 0 ? void 0 : eventMap.close) || \"close\";\n        const msgListener = (ev) => {\n            if (ev instanceof MessageEvent) {\n                handleMessage(ev.data);\n            }\n        };\n        target.addEventListener(msgEvent, msgListener);\n        target.addEventListener(errEvent, handleBrowserErrorEvent);\n        target.addEventListener(closeEvent, function closeListener() {\n            handleClose();\n            target.removeEventListener(closeEvent, closeListener);\n            target.removeEventListener(msgEvent, msgListener);\n            target.removeEventListener(errEvent, handleBrowserErrorEvent);\n        });\n    }\n    else if (isFunction(source[\"on\"])) { // EventEmitter\n        const target = source;\n        let dataEvent;\n        let errEvent;\n        let closeEvent;\n        if (typeof process === \"object\" && source === process) {\n            dataEvent = \"message\";\n            errEvent = \"uncaughtException\";\n            closeEvent = \"exit\";\n        }\n        else if ((isFunction(source[\"send\"]) && isFunction(source[\"kill\"])) || // child process\n            (isFunction(source[\"postMessage\"]) && isFunction(source[\"terminate\"])) || // worker thread\n            (isFunction(source[\"postMessage\"]) && isFunction(source[\"close\"])) // message port\n        ) {\n            dataEvent = \"message\";\n            errEvent = \"error\";\n            closeEvent = \"exit\";\n        }\n        else {\n            dataEvent = (eventMap === null || eventMap === void 0 ? void 0 : eventMap.data) || \"data\";\n            errEvent = (eventMap === null || eventMap === void 0 ? void 0 : eventMap.error) || \"error\";\n            closeEvent = (eventMap === null || eventMap === void 0 ? void 0 : eventMap.close) || \"close\";\n        }\n        target.on(dataEvent, handleMessage);\n        target.once(errEvent, handleClose);\n        target.once(closeEvent, () => {\n            handleClose();\n            target.off(dataEvent, handleMessage);\n            target.off(errEvent, handleClose);\n        });\n    }\n    else {\n        throw new TypeError(\"The  source cannot be converted to an async iterable object.\");\n    }\n    return {\n        [Symbol.asyncIterator]: channel[Symbol.asyncIterator].bind(channel),\n    };\n}\n//# sourceMappingURL=util.js.map","/**\n * Utility functions for reading data from various types of source into various\n * forms.\n * @module\n */\nimport { concat as concatBytes, text } from \"./bytes.ts\";\nimport { asAsyncIterable, toAsyncIterable, resolveByteStream, resolveReadableStream, } from \"./reader/util.ts\";\nexport { toAsyncIterable, resolveByteStream };\nexport function toReadableStream(source, eventMap = undefined) {\n    if (source instanceof ReadableStream) {\n        return source;\n    }\n    else if (typeof source[\"then\"] === \"function\") {\n        return resolveReadableStream(source);\n    }\n    const iterable = toAsyncIterable(source, eventMap);\n    const iterator = iterable[Symbol.asyncIterator]();\n    return new ReadableStream({\n        async pull(controller) {\n            const { done, value } = await iterator.next();\n            if (done) {\n                controller.close();\n            }\n            else {\n                controller.enqueue(value);\n            }\n        },\n        cancel(reason = undefined) {\n            var _a;\n            (_a = iterator.throw) === null || _a === void 0 ? void 0 : _a.call(iterator, reason);\n        }\n    });\n}\n/**\n * Reads all data from the iterable object or readable stream to an array.\n *\n * @example\n * ```ts\n * import { readAsArray } from \"@ayonli/jsext/reader\";\n * import * as fs from \"node:fs\";\n *\n * const file = fs.createReadStream(\"./package.json\");\n * const chunks = await readAsArray(file);\n *\n * console.log(chunks);\n * ```\n */\nexport async function readAsArray(source) {\n    const iterable = asAsyncIterable(source);\n    const list = [];\n    for await (const chunk of iterable) {\n        list.push(chunk);\n    }\n    return list;\n}\n/**\n * Reads all data from the given source to an `ArrayBuffer`.\n *\n * @example\n * ```ts\n * import { readAsArrayBuffer } from \"@ayonli/jsext/reader\";\n * import { createReadableStream } from \"@ayonli/jsext/fs\";\n *\n * const stream = createReadableStream(\"./package.json\");\n * const buffer = await readAsArrayBuffer(stream);\n * ```\n */\nexport async function readAsArrayBuffer(source) {\n    if (typeof Blob === \"function\" && source instanceof Blob) {\n        return await source.arrayBuffer();\n    }\n    else if (ArrayBuffer.isView(source)) {\n        return source.buffer;\n    }\n    const iterable = asAsyncIterable(source);\n    if (!iterable) {\n        throw new TypeError(\"The source is not an async iterable object.\");\n    }\n    const chunks = await readAsArray(iterable);\n    const bytes = concatBytes(...chunks);\n    return bytes.buffer;\n}\n/**\n * Reads all data from the given source to a `Blob`.\n *\n * @example\n * ```ts\n * import { readAsBlob } from \"@ayonli/jsext/reader\";\n * import { createReadableStream } from \"@ayonli/jsext/fs\";\n *\n * const stream = createReadableStream(\"./package.json\");\n * const blob = await readAsBlob(stream, \"application/json\");\n * ```\n */\nexport async function readAsBlob(source, type) {\n    if (source instanceof ArrayBuffer || ArrayBuffer.isView(source)) {\n        return new Blob([source], { type });\n    }\n    const buffer = await readAsArrayBuffer(source);\n    return new Blob([buffer], { type });\n}\n/**\n * Reads all data from the given source to a data URL.\n *\n * @example\n * ```ts\n * import { readAsDataURL } from \"@ayonli/jsext/reader\";\n *\n * const file = new File([\"Hello, World!\"], \"hello.txt\", { type: \"text/plain\" });\n * const dataURL = await readAsDataURL(file, file.type);\n *\n * console.log(dataURL); // data:text/plain;base64,SGVsbG8sIFdvcmxkIQ==\n * ```\n */\nexport async function readAsDataURL(source, type) {\n    if (source instanceof ArrayBuffer) {\n        const base64 = text(new Uint8Array(source), \"base64\");\n        return `data:${type};base64,${base64}`;\n    }\n    else if (source instanceof Uint8Array) {\n        const base64 = text(source, \"base64\");\n        return `data:${type};base64,${base64}`;\n    }\n    else if (ArrayBuffer.isView(source)) {\n        const bytes = new Uint8Array(source.buffer, source.byteOffset, source.byteLength);\n        const base64 = text(bytes, \"base64\");\n        return `data:${type};base64,${base64}`;\n    }\n    const buffer = await readAsArrayBuffer(source);\n    const _bytes = new Uint8Array(buffer);\n    const base64 = text(_bytes, \"base64\");\n    return `data:${type};base64,${base64}`;\n}\n/**\n * Reads all data from the given source to an object URL.\n *\n * @example\n * ```ts\n * import { readAsObjectURL } from \"@ayonli/jsext/reader\";\n *\n * const file = new File([\"Hello, World!\"], \"hello.txt\", { type: \"text/plain\" });\n * const objectURL = await readAsObjectURL(file, file.type);\n *\n * console.log(objectURL); // e.g. blob:http://localhost:8080/7b8e7b7d-7b7d-7b7d-7b7d-7b7d7b7d7b7d\n * ```\n */\nexport async function readAsObjectURL(source, type) {\n    if (source instanceof Blob) {\n        return URL.createObjectURL(source);\n    }\n    else if (source instanceof ArrayBuffer || ArrayBuffer.isView(source)) {\n        const blob = new Blob([source], { type });\n        return URL.createObjectURL(blob);\n    }\n    const buffer = await readAsArrayBuffer(source);\n    const blob = new Blob([buffer], { type });\n    return URL.createObjectURL(blob);\n}\n/**\n * Reads all data from the given source to a string.\n *\n * @example\n * ```ts\n * import { readAsText } from \"@ayonli/jsext/reader\";\n * import { createReadableStream } from \"@ayonli/jsext/fs\";\n *\n * const stream = createReadableStream(\"./package.json\");\n * const text = await readAsText(stream);\n * ```\n */\nexport async function readAsText(source, encoding = undefined) {\n    if (typeof Blob === \"function\" && source instanceof Blob && !encoding) {\n        return await source.text();\n    }\n    else if (source instanceof ArrayBuffer || ArrayBuffer.isView(source)) {\n        return new TextDecoder(encoding).decode(source);\n    }\n    const buffer = await readAsArrayBuffer(source);\n    return new TextDecoder(encoding).decode(buffer);\n}\n/**\n * Reads all data from the given source to a JSON object.\n *\n * @example\n * ```ts\n * import { readAsJSON } from \"@ayonli/jsext/reader\";\n * import { createReadableStream } from \"@ayonli/jsext/fs\";\n *\n * const stream = createReadableStream(\"./package.json\");\n * const pkg = await readAsJSON(stream);\n * ```\n */\nexport async function readAsJSON(source) {\n    const text = await readAsText(source);\n    return JSON.parse(text);\n}\nexport function concat(...sources) {\n    if (!sources[0]) {\n        throw new TypeError(\"No sources provided.\");\n    }\n    if (typeof ReadableStream === \"function\" && sources[0] instanceof ReadableStream) {\n        if (!sources.every(source => source instanceof ReadableStream)) {\n            throw new TypeError(\"All sources must be readable streams.\");\n        }\n        const streams = sources;\n        let current = 0;\n        let reader = streams[current].getReader();\n        return new ReadableStream({\n            async pull(controller) {\n                try {\n                    let { done, value } = await reader.read();\n                    if (!done) {\n                        controller.enqueue(value);\n                    }\n                    else {\n                        reader.releaseLock();\n                        current++;\n                        if (current < streams.length) {\n                            reader = streams[current].getReader();\n                            return this.pull(controller);\n                        }\n                        else {\n                            controller.close();\n                        }\n                    }\n                }\n                catch (err) {\n                    reader.releaseLock();\n                    controller.error(err);\n                }\n            }\n        });\n    }\n    else {\n        if (sources.some(source => typeof source[Symbol.asyncIterator] !== \"function\")) {\n            throw new TypeError(\"All sources must be async iterable objects.\");\n        }\n        const iterables = sources;\n        return {\n            [Symbol.asyncIterator]: async function* () {\n                for (const source of iterables) {\n                    yield* source;\n                }\n            }\n        };\n    }\n}\n//# sourceMappingURL=reader.js.map","/**\n * A slim version of the `fs` module for the browser.\n *\n * Normally, we should just use the `fs` module, however, if we don't want\n * to include other parts that are not needed in the browser, we can use this\n * module instead.\n * @module\n */\nimport { abortable } from \"../async.ts\";\nimport { getMIME } from \"../filetype.ts\";\nimport { as } from \"../object.ts\";\nimport { basename, dirname, extname, join, split } from \"../path.ts\";\nimport { readAsArray, readAsText, resolveByteStream, toAsyncIterable } from \"../reader.ts\";\nimport { stripStart } from \"../string.ts\";\nimport _try from \"../try.ts\";\nimport { fixDirEntry, fixFileType, makeTree, rawOp, wrapFsError } from \"./util.ts\";\nexport const EOL = \"\\n\";\n/**\n * Obtains the directory handle of the given path.\n *\n * NOTE: This function is only available in the browser.\n *\n * NOTE: If the `path` is not provided or is empty, the root directory handle\n * will be returned.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { getDirHandle } from \"@ayonli/jsext/fs\";\n *\n * const dir = await getDirHandle(\"/path/to/dir\");\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { getDirHandle } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * const dir = await getDirHandle(\"/path/to/dir\", { root });\n * ```\n *\n * @example\n * ```ts\n * // create the directory if not exist\n * import { getDirHandle } from \"@ayonli/jsext/fs\";\n *\n * const dir = await getDirHandle(\"/path/to/dir\", { create: true, recursive: true });\n * ```\n *\n * @example\n * ```ts\n * // return the root directory handle\n * import { getDirHandle } from \"@ayonli/jsext/fs\";\n *\n * const root = await getDirHandle();\n * ```\n */\nexport async function getDirHandle(path = \"\", options = {}) {\n    var _a;\n    if (typeof location === \"object\" && typeof location.origin === \"string\") {\n        path = stripStart(path, location.origin);\n    }\n    const { create = false, recursive = false } = options;\n    const paths = split(stripStart(path, \"/\")).filter(p => p !== \".\");\n    const root = (_a = options.root) !== null && _a !== void 0 ? _a : await rawOp(navigator.storage.getDirectory(), \"directory\");\n    let dir = root;\n    for (let i = 0; i < paths.length; i++) {\n        const _path = paths[i];\n        dir = await rawOp(dir.getDirectoryHandle(_path, {\n            create: create && (recursive || (i === paths.length - 1)),\n        }), \"directory\");\n    }\n    return dir;\n}\n/**\n * Obtains the file handle of the given path.\n *\n * NOTE: This function is only available in the browser.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { getFileHandle } from \"@ayonli/jsext/fs\";\n *\n * const file = await getFileHandle(\"/path/to/file.txt\");\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { getFileHandle } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * const file = await getFileHandle(\"/path/to/file.txt\", { root });\n * ```\n *\n * @example\n * ```ts\n * // create the file if not exist\n * import { getFileHandle } from \"@ayonli/jsext/fs\";\n *\n * const file = await getFileHandle(\"/path/to/file.txt\", { create: true });\n * ```\n */\nexport async function getFileHandle(path, options = {}) {\n    var _a;\n    const dirPath = dirname(path);\n    const name = basename(path);\n    const dir = await getDirHandle(dirPath, { root: options.root });\n    return await rawOp(dir.getFileHandle(name, {\n        create: (_a = options.create) !== null && _a !== void 0 ? _a : false,\n    }), \"file\");\n}\nexport async function exists(path, options = {}) {\n    try {\n        await stat(path, options);\n        return true;\n    }\n    catch (err) {\n        if (err instanceof Exception) {\n            if (err.name === \"NotFoundError\") {\n                return false;\n            }\n        }\n        throw err;\n    }\n}\nexport async function stat(target, options = {}) {\n    var _a, _b, _c, _d, _e;\n    if (typeof target === \"object\") {\n        if (target.kind === \"file\") {\n            const info = await rawOp(target.getFile(), \"file\");\n            return {\n                name: target.name,\n                kind: \"file\",\n                size: info.size,\n                type: (_b = (_a = info.type) !== null && _a !== void 0 ? _a : getMIME(extname(target.name))) !== null && _b !== void 0 ? _b : \"\",\n                mtime: new Date(info.lastModified),\n                atime: null,\n                birthtime: null,\n                mode: 0,\n                uid: 0,\n                gid: 0,\n                isBlockDevice: false,\n                isCharDevice: false,\n                isFIFO: false,\n                isSocket: false,\n            };\n        }\n        else {\n            return {\n                name: target.name,\n                kind: \"directory\",\n                size: 0,\n                type: \"\",\n                mtime: null,\n                atime: null,\n                birthtime: null,\n                mode: 0,\n                uid: 0,\n                gid: 0,\n                isBlockDevice: false,\n                isCharDevice: false,\n                isFIFO: false,\n                isSocket: false,\n            };\n        }\n    }\n    else {\n        const [err, file] = await _try(getFileHandle(target, options));\n        if (file) {\n            const info = await rawOp(file.getFile(), \"file\");\n            return {\n                name: info.name,\n                kind: \"file\",\n                size: info.size,\n                type: (_d = (_c = info.type) !== null && _c !== void 0 ? _c : getMIME(extname(info.name))) !== null && _d !== void 0 ? _d : \"\",\n                mtime: new Date(info.lastModified),\n                atime: null,\n                birthtime: null,\n                mode: 0,\n                uid: 0,\n                gid: 0,\n                isBlockDevice: false,\n                isCharDevice: false,\n                isFIFO: false,\n                isSocket: false,\n            };\n        }\n        else if (((_e = as(err, Exception)) === null || _e === void 0 ? void 0 : _e.name) === \"IsDirectoryError\") {\n            return {\n                name: basename(target),\n                kind: \"directory\",\n                size: 0,\n                type: \"\",\n                mtime: null,\n                atime: null,\n                birthtime: null,\n                mode: 0,\n                uid: 0,\n                gid: 0,\n                isBlockDevice: false,\n                isCharDevice: false,\n                isFIFO: false,\n                isSocket: false,\n            };\n        }\n        else {\n            throw err;\n        }\n    }\n}\nexport async function mkdir(path, options = {}) {\n    if (await exists(path, { root: options.root })) {\n        throw new Exception(`File or folder already exists, mkdir '${path}'`, {\n            name: \"AlreadyExistsError\",\n            code: 409,\n        });\n    }\n    await getDirHandle(path, { ...options, create: true });\n}\nexport async function ensureDir(path, options = {}) {\n    var _a;\n    if (await exists(path, options)) {\n        return;\n    }\n    try {\n        await mkdir(path, { ...options, recursive: true });\n    }\n    catch (err) {\n        if (((_a = as(err, Exception)) === null || _a === void 0 ? void 0 : _a.name) === \"AlreadyExistsError\") {\n            return;\n        }\n        else {\n            throw err;\n        }\n    }\n}\nexport async function* readDir(target, options = {}) {\n    const handle = typeof target === \"object\"\n        ? target\n        : await getDirHandle(target, options);\n    yield* readDirHandle(handle, options);\n}\nasync function* readDirHandle(dir, options = {}) {\n    const { base = \"\", recursive = false } = options;\n    const entries = dir.entries();\n    for await (const [_, entry] of entries) {\n        const _entry = fixDirEntry({\n            name: entry.name,\n            kind: entry.kind,\n            relativePath: join(base, entry.name),\n            handle: entry,\n        });\n        yield _entry;\n        if (recursive && entry.kind === \"directory\") {\n            yield* readDirHandle(entry, {\n                base: _entry.relativePath,\n                recursive,\n            });\n        }\n    }\n}\nexport async function readTree(target, options = {}) {\n    const entries = (await readAsArray(readDir(target, { ...options, recursive: true })));\n    const tree = makeTree(target, entries, true);\n    if (!tree.handle && options.root) {\n        tree.handle = options.root;\n    }\n    return tree;\n}\nexport async function readFile(target, options = {}) {\n    const handle = typeof target === \"object\"\n        ? target\n        : await getFileHandle(target, { root: options.root });\n    const file = await rawOp(handle.getFile(), \"file\");\n    const arr = new Uint8Array(file.size);\n    let offset = 0;\n    let reader = toAsyncIterable(file.stream());\n    if (options.signal) {\n        reader = abortable(reader, options.signal);\n    }\n    for await (const chunk of reader) {\n        arr.set(chunk, offset);\n        offset += chunk.length;\n    }\n    return arr;\n}\nexport async function readFileAsText(target, options = {}) {\n    const { encoding, ...rest } = options;\n    const file = await readFile(target, rest);\n    return await readAsText(file, encoding);\n}\nexport async function readFileAsFile(target, options = {}) {\n    const handle = typeof target === \"object\"\n        ? target\n        : await getFileHandle(target, { root: options.root });\n    const file = await rawOp(handle.getFile(), \"file\");\n    return fixFileType(file);\n}\nexport async function writeFile(target, data, options = {}) {\n    const handle = typeof target === \"object\"\n        ? target\n        : await getFileHandle(target, { root: options.root, create: true });\n    const writer = await createFileHandleWritableStream(handle, options);\n    if (options.signal) {\n        const { signal } = options;\n        if (signal.aborted) {\n            await writer.abort(signal.reason);\n            throw wrapFsError(signal.reason, \"file\");\n        }\n        else {\n            signal.addEventListener(\"abort\", () => {\n                writer.abort(signal.reason);\n            });\n        }\n    }\n    try {\n        if (data instanceof Blob) {\n            await data.stream().pipeTo(writer);\n        }\n        else if (data instanceof ReadableStream) {\n            await data.pipeTo(writer);\n        }\n        else {\n            await writer.write(data);\n            await writer.close();\n        }\n    }\n    catch (err) {\n        throw wrapFsError(err, \"file\");\n    }\n}\nexport async function writeLines(target, lines, options = {}) {\n    const current = await readFileAsText(target, options).catch(err => {\n        var _a;\n        if (((_a = as(err, Exception)) === null || _a === void 0 ? void 0 : _a.name) !== \"NotFoundError\") {\n            throw err;\n        }\n        else {\n            return \"\";\n        }\n    });\n    const lineEndings = current.match(/\\r?\\n/g);\n    let eol = EOL;\n    if (lineEndings) {\n        const crlf = lineEndings.filter(e => e === \"\\r\\n\").length;\n        const lf = lineEndings.length - crlf;\n        eol = crlf > lf ? \"\\r\\n\" : \"\\n\";\n    }\n    let content = lines.join(eol);\n    if (!content.endsWith(eol)) {\n        if (eol === \"\\r\\n\" && content.endsWith(\"\\r\")) {\n            content += \"\\n\";\n        }\n        else {\n            content += eol;\n        }\n    }\n    if (options.append && !current.endsWith(eol) && !content.startsWith(eol)) {\n        if (eol === \"\\r\\n\" && current.endsWith(\"\\r\")) {\n            if (!content.startsWith(\"\\n\")) {\n                content = \"\\n\" + content;\n            }\n        }\n        else {\n            content = eol + content;\n        }\n    }\n    await writeFile(target, content, options);\n}\nexport async function truncate(target, size = 0, options = {}) {\n    const handle = typeof target === \"object\"\n        ? target\n        : await getFileHandle(target, { root: options.root });\n    try {\n        const writer = await handle.createWritable({ keepExistingData: true });\n        await writer.truncate(size);\n        await writer.close();\n    }\n    catch (err) {\n        throw wrapFsError(err, \"file\");\n    }\n}\nexport async function remove(path, options = {}) {\n    const parent = dirname(path);\n    const name = basename(path);\n    const dir = await getDirHandle(parent, { root: options.root });\n    await rawOp(dir.removeEntry(name, options), \"directory\");\n}\nexport async function rename(oldPath, newPath, options = {}) {\n    return await copyInBrowser(oldPath, newPath, {\n        root: options.root,\n        recursive: true,\n        move: true,\n    });\n}\nexport async function copy(src, dest, options = {}) {\n    return copyInBrowser(src, dest, options);\n}\nasync function copyInBrowser(src, dest, options = {}) {\n    var _a, _b;\n    if (typeof src === \"object\" && typeof dest !== \"object\") {\n        throw new TypeError(\"The destination must be a FileSystemHandle.\");\n    }\n    else if (typeof dest === \"object\" && typeof src !== \"object\") {\n        throw new TypeError(\"The source must be a FileSystemHandle.\");\n    }\n    else if (typeof src === \"object\" && typeof dest === \"object\") {\n        if (src.kind === \"file\") {\n            if (dest.kind === \"file\") {\n                return await copyFileHandleToFileHandle(src, dest);\n            }\n            else {\n                return await copyFileHandleToDirHandle(src, dest);\n            }\n        }\n        else if (dest.kind === \"directory\") {\n            if (!options.recursive) {\n                throw new Exception(\"Cannot copy a directory without the 'recursive' option\", {\n                    name: \"InvalidOperationError\",\n                    code: 400,\n                });\n            }\n            return await copyDirHandleToDirHandle(src, dest);\n        }\n        else {\n            throw new Exception(\"The destination location is not a directory\", {\n                name: \"NotDirectoryError\",\n                code: 415,\n            });\n        }\n    }\n    const oldParent = dirname(src);\n    const oldName = basename(src);\n    let oldDir = await getDirHandle(oldParent, { root: options.root });\n    const [oldErr, oldFile] = await _try(rawOp(oldDir.getFileHandle(oldName), \"file\"));\n    if (oldFile) {\n        const newParent = dirname(dest);\n        const newName = basename(dest);\n        let newDir = await getDirHandle(newParent, { root: options.root });\n        const [newErr, newFile] = await _try(rawOp(newDir.getFileHandle(newName, {\n            create: true,\n        }), \"file\"));\n        if (newFile) {\n            await copyFileHandleToFileHandle(oldFile, newFile);\n            if (options.move) {\n                await rawOp(oldDir.removeEntry(oldName), \"directory\");\n            }\n        }\n        else if (((_a = as(newErr, Exception)) === null || _a === void 0 ? void 0 : _a.name) === \"IsDirectoryError\" && !options.move) {\n            // The destination is a directory, copy the file into the new path\n            // with the old name.\n            newDir = await rawOp(newDir.getDirectoryHandle(newName), \"directory\");\n            await copyFileHandleToDirHandle(oldFile, newDir);\n        }\n        else {\n            throw newErr;\n        }\n    }\n    else if (((_b = as(oldErr, Exception)) === null || _b === void 0 ? void 0 : _b.name) === \"IsDirectoryError\") {\n        if (!options.recursive) {\n            throw new Exception(\"Cannot copy a directory without the 'recursive' option\", {\n                name: \"InvalidOperationError\",\n                code: 400,\n            });\n        }\n        const parent = oldDir;\n        oldDir = await rawOp(oldDir.getDirectoryHandle(oldName), \"directory\");\n        const newDir = await getDirHandle(dest, { root: options.root, create: true });\n        await copyDirHandleToDirHandle(oldDir, newDir);\n        if (options.move) {\n            await rawOp(parent.removeEntry(oldName, { recursive: true }), \"directory\");\n        }\n    }\n    else {\n        throw oldErr;\n    }\n}\nasync function copyFileHandleToFileHandle(src, dest) {\n    try {\n        const srcFile = await src.getFile();\n        const destFile = await dest.createWritable();\n        await srcFile.stream().pipeTo(destFile);\n    }\n    catch (err) {\n        throw wrapFsError(err, \"file\");\n    }\n}\nasync function copyFileHandleToDirHandle(src, dest) {\n    try {\n        const srcFile = await src.getFile();\n        const newFile = await dest.getFileHandle(src.name, { create: true });\n        const destFile = await newFile.createWritable();\n        await srcFile.stream().pipeTo(destFile);\n    }\n    catch (err) {\n        throw wrapFsError(err, \"file\");\n    }\n}\nasync function copyDirHandleToDirHandle(src, dest) {\n    const entries = src.entries();\n    for await (const [_, entry] of entries) {\n        if (entry.kind === \"file\") {\n            try {\n                const oldFile = await entry.getFile();\n                const newFile = await dest.getFileHandle(entry.name, {\n                    create: true,\n                });\n                const reader = oldFile.stream();\n                const writer = await newFile.createWritable();\n                await reader.pipeTo(writer);\n            }\n            catch (err) {\n                throw wrapFsError(err, \"file\");\n            }\n        }\n        else {\n            const newSubDir = await rawOp(dest.getDirectoryHandle(entry.name, {\n                create: true,\n            }), \"directory\");\n            await copyDirHandleToDirHandle(entry, newSubDir);\n        }\n    }\n}\nexport function createReadableStream(target, options = {}) {\n    return resolveByteStream((async () => {\n        const handle = typeof target === \"object\"\n            ? target\n            : await getFileHandle(target, { root: options.root });\n        const file = await rawOp(handle.getFile(), \"file\");\n        return file.stream();\n    })());\n}\nexport function createWritableStream(target, options = {}) {\n    const { readable, writable } = new TransformStream();\n    const getHandle = typeof target === \"object\"\n        ? Promise.resolve(target)\n        : getFileHandle(target, { root: options.root, create: true });\n    getHandle.then(handle => createFileHandleWritableStream(handle, options))\n        .then(stream => readable.pipeTo(stream));\n    return writable;\n}\nasync function createFileHandleWritableStream(handle, options) {\n    var _a;\n    const stream = await rawOp(handle.createWritable({\n        keepExistingData: (_a = options === null || options === void 0 ? void 0 : options.append) !== null && _a !== void 0 ? _a : false,\n    }), \"file\");\n    if (options.append) {\n        const file = await rawOp(handle.getFile(), \"file\");\n        file.size && stream.seek(file.size);\n    }\n    return stream;\n}\n//# sourceMappingURL=web.js.map","/**\n * Universal file system APIs for both server and browser applications.\n *\n * This module is guaranteed to work in the following environments:\n *\n * - Node.js\n * - Deno\n * - Bun\n * - Modern browsers\n * - Cloudflare Workers (limited support and experimental)\n *\n * We can also use the {@link runtime} function to check whether the runtime\n * has file system support. When `runtime().fsSupport` is `true`, this module\n * should work properly.\n *\n * In most browsers, this module uses the\n * [Origin Private File System](https://developer.mozilla.org/en-US/docs/Web/API/File_System_API/Origin_private_file_system).\n * In Chromium browsers, this module can also access the device's local file\n * system via `window.showOpenFilePicker()` and `window.showDirectoryPicker()`.\n *\n * This module also provides limited support for Cloudflare Workers, however it\n * requires setting the `[site].bucket` option in the `wrangler.toml` file. Only\n * the reading functions are supported, such as {@link readFile} and\n * {@link readDir}, these functions allow us reading static files in the workers,\n * writing functions is not implemented at the moment. More details about\n * serving static assets in Cloudflare Workers can be found here:\n * [Add static assets to an existing Workers project](https://developers.cloudflare.com/workers/configuration/sites/start-from-worker/).\n *\n * **Errors:**\n *\n * When a file system operation fails, this module throws an {@link Exception}\n * with one of the following names:\n *\n * - `NotFoundError`: The file or directory does not exist.\n * - `NotAllowedError`: The operation is not allowed, such as being blocked by\n *   the permission system.\n * - `AlreadyExistsError`: The file or directory already exists.\n * - `IsDirectoryError`: The path is a directory, not a file.\n * - `NotDirectoryError`: The path is a file, not a directory.\n * - `InvalidOperationError`: The operation is not supported, such as trying to\n *   copy a directory without the `recursive` option.\n * - `BusyError`: The file is busy, such as being locked by another program.\n * - `InterruptedError`: The operation is interrupted by the underlying file\n *   system.\n * - `FileTooLargeError`: The file is too large, or the file system doesn't have\n *   enough space to store the new content.\n * - `FilesystemLoopError`:  Too many symbolic links were encountered when\n *   resolving the filename.\n *\n * Other errors may also be thrown by the runtime, such as `TypeError`.\n * @module\n */\nimport bytes from \"./bytes.ts\";\nimport { isDeno, isNodeLike } from \"./env.ts\";\nimport { Exception } from \"./error.ts\";\nimport { getMIME } from \"./filetype.ts\";\nimport { ensureFsTarget, fixDirEntry, makeTree, rawOp, wrapFsError } from \"./fs/util.ts\";\nimport { resolveHomeDir } from \"./fs/util/server.ts\";\nimport { getDirHandle, getFileHandle, stat as webStat, mkdir as webMakeDir, readDir as webReadDir, readFile as webReadFile, readFileAsFile as webReadFileAsFile, writeFile as webWriteFile, truncate as webTruncate, remove as webRemove, rename as webRename, copy as webCopy, createReadableStream as webCreateReadableStream, createWritableStream as webCreateWritableStream, } from \"./fs/web.ts\";\nimport { as } from \"./object.ts\";\nimport { basename, extname, join } from \"./path.ts\";\nimport { readAsArray, readAsText, resolveByteStream } from \"./reader.ts\";\nimport { platform } from \"./runtime.ts\";\nexport { getDirHandle, getFileHandle };\n/**\n * Platform-specific end-of-line marker. The value is `\\r\\n` in Windows\n * server-side environments, and `\\n` elsewhere.\n */\nexport const EOL = (() => {\n    if (typeof Deno === \"object\" && typeof Deno.build === \"object\") {\n        return Deno.build.os === \"windows\" ? \"\\r\\n\" : \"\\n\";\n    }\n    else if (typeof process === \"object\" && typeof process.platform === \"string\") {\n        return process.platform === \"win32\" ? \"\\r\\n\" : \"\\n\";\n    }\n    else {\n        return \"\\n\";\n    }\n})();\n/**\n * Checks if the given path exists.\n *\n * This function may throw an error if the path is invalid or the operation is\n * not allowed.\n *\n * NOTE: This function can also be used in Cloudflare Workers.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { exists } from \"@ayonli/jsext/fs\";\n *\n * if (await exists(\"/path/to/file.txt\")) {\n *     console.log(\"The file exists.\");\n * } else {\n *     console.log(\"The file does not exist.\");\n * }\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { exists } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n *\n * if (await exists(\"/path/to/file.txt\", { root })) {\n *     console.log(\"The file exists.\");\n * } else {\n *     console.log(\"The file does not exist.\");\n * }\n * ```\n */\nexport async function exists(path, options = {}) {\n    try {\n        await stat(path, options);\n        return true;\n    }\n    catch (err) {\n        if (err instanceof Exception) {\n            if (err.name === \"NotFoundError\") {\n                return false;\n            }\n        }\n        throw err;\n    }\n}\n/**\n * Returns the information of the given file or directory.\n *\n * NOTE: This function can also be used in Cloudflare Workers.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { stat } from \"@ayonli/jsext/fs\";\n *\n * const info = await stat(\"/path/to/file.txt\");\n * console.log(`${info.name} is a ${info.kind}, its size is ${info.size} bytes, with MIME type ${info.type}.`);\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { stat } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * const info = await stat(\"/path/to/file.txt\", { root });\n * console.log(`${info.name} is a ${info.kind}, its size is ${info.size} bytes, with MIME type ${info.type}.`);\n * ```\n */\nexport async function stat(target, options = {}) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;\n    target = ensureFsTarget(target);\n    if (typeof target === \"object\" || !(isDeno || isNodeLike)) {\n        return await webStat(target, options);\n    }\n    const path = await resolveHomeDir(target);\n    if (isDeno) {\n        const stat = await rawOp(options.followSymlink ? Deno.stat(path) : Deno.lstat(path));\n        const kind = stat.isDirectory\n            ? \"directory\"\n            : stat.isSymlink\n                ? \"symlink\"\n                : \"file\";\n        return {\n            name: basename(path),\n            kind,\n            size: stat.size,\n            type: kind === \"file\" ? ((_a = getMIME(extname(path))) !== null && _a !== void 0 ? _a : \"\") : \"\",\n            mtime: (_b = stat.mtime) !== null && _b !== void 0 ? _b : null,\n            atime: (_c = stat.atime) !== null && _c !== void 0 ? _c : null,\n            birthtime: (_d = stat.birthtime) !== null && _d !== void 0 ? _d : null,\n            mode: (_e = stat.mode) !== null && _e !== void 0 ? _e : 0,\n            uid: (_f = stat.uid) !== null && _f !== void 0 ? _f : 0,\n            gid: (_g = stat.gid) !== null && _g !== void 0 ? _g : 0,\n            isBlockDevice: (_h = stat.isBlockDevice) !== null && _h !== void 0 ? _h : false,\n            isCharDevice: (_j = stat.isCharDevice) !== null && _j !== void 0 ? _j : false,\n            isFIFO: (_k = stat.isFifo) !== null && _k !== void 0 ? _k : false,\n            isSocket: (_l = stat.isSocket) !== null && _l !== void 0 ? _l : false,\n        };\n    }\n    else {\n        const fs = await import(\"node:fs/promises\");\n        const stat = await rawOp(options.followSymlink ? fs.stat(path) : fs.lstat(path));\n        const kind = stat.isDirectory()\n            ? \"directory\"\n            : stat.isSymbolicLink()\n                ? \"symlink\"\n                : \"file\";\n        return {\n            name: basename(path),\n            kind,\n            size: stat.size,\n            type: kind === \"file\" ? ((_m = getMIME(extname(path))) !== null && _m !== void 0 ? _m : \"\") : \"\",\n            mtime: (_o = stat.mtime) !== null && _o !== void 0 ? _o : null,\n            atime: (_p = stat.atime) !== null && _p !== void 0 ? _p : null,\n            birthtime: (_q = stat.birthtime) !== null && _q !== void 0 ? _q : null,\n            mode: (_r = stat.mode) !== null && _r !== void 0 ? _r : 0,\n            uid: (_s = stat.uid) !== null && _s !== void 0 ? _s : 0,\n            gid: (_t = stat.gid) !== null && _t !== void 0 ? _t : 0,\n            isBlockDevice: stat.isBlockDevice(),\n            isCharDevice: stat.isCharacterDevice(),\n            isFIFO: stat.isFIFO(),\n            isSocket: stat.isSocket(),\n        };\n    }\n}\n/**\n * Creates a new directory with the given path.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { mkdir } from \"@ayonli/jsext/fs\";\n *\n * await mkdir(\"/path/to/dir\");\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { mkdir } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * await mkdir(\"/path/to/dir\", { root });\n * ```\n *\n * @example\n * ```ts\n * // create the directory and its parent directories if not exist\n * import { mkdir } from \"@ayonli/jsext/fs\";\n *\n * await mkdir(\"/path/to/dir\", { recursive: true });\n * ```\n */\nexport async function mkdir(path, options = {}) {\n    path = ensureFsTarget(path);\n    if (!(isDeno || isNodeLike)) {\n        return await webMakeDir(path, options);\n    }\n    path = await resolveHomeDir(path);\n    if (isDeno) {\n        await rawOp(Deno.mkdir(path, options));\n    }\n    else {\n        const fs = await import(\"node:fs/promises\");\n        await rawOp(fs.mkdir(path, options));\n    }\n}\n/**\n * Ensures the directory exists, creating it (and any parent directory) if not.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { ensureDir } from \"@ayonli/jsext/fs\";\n *\n * await ensureDir(\"/path/to/dir\");\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { ensureDir } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * await ensureDir(\"/path/to/dir\", { root });\n * ```\n */\nexport async function ensureDir(path, options = {}) {\n    var _a;\n    if (await exists(path, options)) {\n        return;\n    }\n    try {\n        await mkdir(path, { ...options, recursive: true });\n    }\n    catch (err) {\n        if (((_a = as(err, Exception)) === null || _a === void 0 ? void 0 : _a.name) === \"AlreadyExistsError\") {\n            return;\n        }\n        else {\n            throw err;\n        }\n    }\n}\n/**\n * Reads the directory of the given path and iterates its entries.\n *\n * NOTE: The order of the entries is not guaranteed.\n *\n * NOTE: This function can also be used in Cloudflare Workers.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { readDir } from \"@ayonli/jsext/fs\";\n *\n * for await (const entry of readDir(\"/path/to/dir\")) {\n *     console.log(`${entry.name} is a ${entry.kind}, its relative path is '${entry.relativePath}'.`);\n * }\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { readDir } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * for await (const entry of readDir(\"/path/to/dir\", { root })) {\n *     console.log(`${entry.name} is a ${entry.kind}, its relative path is '${entry.relativePath}'.`);\n * }\n * ```\n *\n * @example\n * ```ts\n * // read the sub-directories recursively\n * import { readDir } from \"@ayonli/jsext/fs\";\n *\n * for await (const entry of readDir(\"/path/to/dir\", { recursive: true })) {\n *     console.log(`${entry.name} is a ${entry.kind}, its relative path is '${entry.relativePath}'.`);\n * }\n * ```\n */\nexport async function* readDir(target, options = {}) {\n    target = ensureFsTarget(target);\n    if (typeof target === \"object\" || !(isDeno || isNodeLike)) {\n        yield* webReadDir(target, options);\n        return;\n    }\n    const path = await resolveHomeDir(target);\n    if (isDeno) {\n        yield* (async function* read(path, base) {\n            try {\n                for await (const entry of Deno.readDir(path)) {\n                    const _entry = fixDirEntry({\n                        name: entry.name,\n                        kind: entry.isDirectory\n                            ? \"directory\"\n                            : entry.isSymlink\n                                ? \"symlink\"\n                                : \"file\",\n                        relativePath: join(base, entry.name),\n                    });\n                    yield _entry;\n                    if ((options === null || options === void 0 ? void 0 : options.recursive) && entry.isDirectory) {\n                        yield* read(join(path, entry.name), _entry.relativePath);\n                    }\n                }\n            }\n            catch (err) {\n                throw wrapFsError(err);\n            }\n        })(path, \"\");\n    }\n    else {\n        const fs = await import(\"node:fs/promises\");\n        yield* (async function* read(path, base) {\n            const entries = await rawOp(fs.readdir(path, { withFileTypes: true }));\n            for (const entry of entries) {\n                const _entry = fixDirEntry({\n                    name: entry.name,\n                    kind: entry.isDirectory()\n                        ? \"directory\"\n                        : entry.isSymbolicLink()\n                            ? \"symlink\"\n                            : \"file\",\n                    relativePath: join(base, entry.name),\n                });\n                yield _entry;\n                if ((options === null || options === void 0 ? void 0 : options.recursive) && entry.isDirectory()) {\n                    yield* read(join(path, entry.name), _entry.relativePath);\n                }\n            }\n        })(path, \"\");\n    }\n}\n/**\n * Recursively reads the contents of the directory and transform them into a\n * tree structure.\n *\n * NOTE: Unlike {@link readDir}, the order of the entries returned by this\n * function is guaranteed, they are ordered first by kind (directories before\n * files), then by names alphabetically.\n *\n * NOTE: This function can also be used in Cloudflare Workers.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { readTree } from \"@ayonli/jsext/fs\";\n *\n * const tree = await readTree(\"/path/to/dir\");\n * console.log(tree);\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { readTree } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * const tree = await readTree(\"/path/to/dir\", { root });\n * console.log(tree);\n * ```\n */\nexport async function readTree(target, options = {}) {\n    target = ensureFsTarget(target);\n    const entries = (await readAsArray(readDir(target, { ...options, recursive: true })));\n    const tree = makeTree(target, entries, true);\n    if (!tree.handle && options.root) {\n        tree.handle = options.root;\n    }\n    return tree;\n}\n/**\n * Reads the content of the given file in bytes.\n *\n * NOTE: This function can also be used in Cloudflare Workers.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { readFile } from \"@ayonli/jsext/fs\";\n *\n * const bytes = await readFile(\"/path/to/file.txt\");\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { readFile } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * const bytes = await readFile(\"/path/to/file.txt\", { root });\n * ```\n */\nexport async function readFile(target, options = {}) {\n    target = ensureFsTarget(target);\n    if (typeof target === \"object\" || !(isDeno || isNodeLike)) {\n        return await webReadFile(target, options);\n    }\n    const filename = await resolveHomeDir(target);\n    if (isDeno) {\n        return await rawOp(Deno.readFile(filename, options));\n    }\n    else {\n        const fs = await import(\"node:fs/promises\");\n        const buffer = await rawOp(fs.readFile(filename, options));\n        return new Uint8Array(buffer.buffer, buffer.byteOffset, buffer.byteLength);\n    }\n}\n/**\n * Reads the content of the given file as text.\n *\n * NOTE: This function can also be used in Cloudflare Workers.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { readFileAsText } from \"@ayonli/jsext/fs\";\n *\n * const text = await readFileAsText(\"/path/to/file.txt\");\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { readFileAsText } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * const text = await readFileAsText(\"/path/to/file.txt\", { root });\n * ```\n *\n * @example\n * ```ts\n * // with a specific encoding\n * import { readFileAsText } from \"@ayonli/jsext/fs\";\n *\n * const text = await readFileAsText(\"./examples/samples/gb2312.txt\", { encoding: \"gb2312\" });\n * ```\n */\nexport async function readFileAsText(target, options = {}) {\n    const { encoding, ...rest } = options;\n    const file = await readFile(target, rest);\n    return await readAsText(file, encoding);\n}\n/**\n * Reads the file as a `File` object.\n *\n * NOTE: This function can also be used in Cloudflare Workers.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { readFileAsFile } from \"@ayonli/jsext/fs\";\n *\n * const file = await readFileAsFile(\"/path/to/file.txt\");\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { readFileAsFile } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * const file = await readFileAsFile(\"/path/to/file.txt\", { root });\n * ```\n */\nexport async function readFileAsFile(target, options = {}) {\n    var _a;\n    target = ensureFsTarget(target);\n    if (typeof target === \"object\" || !(isDeno || isNodeLike)) {\n        return await webReadFileAsFile(target, options);\n    }\n    const bytes = await readFile(target, options);\n    const type = (_a = getMIME(extname(target))) !== null && _a !== void 0 ? _a : \"\";\n    const file = new File([bytes], basename(target), { type });\n    Object.defineProperty(file, \"webkitRelativePath\", {\n        configurable: true,\n        enumerable: true,\n        writable: false,\n        value: \"\",\n    });\n    return file;\n}\n/**\n * Writes the given data to the file.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { writeFile } from \"@ayonli/jsext/fs\";\n *\n * await writeFile(\"/path/to/file.txt\", \"Hello, world!\");\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { writeFile } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * await writeFile(\"/path/to/file.txt\", \"Hello, world!\", { root });\n * ```\n *\n * @example\n * ```ts\n * // append the data to the file\n * import { writeFile } from \"@ayonli/jsext/fs\";\n *\n * await writeFile(\"/path/to/file.txt\", \"Hello, world!\", { append: true });\n * ```\n *\n * @example\n * ```ts\n * // write binary data to the file\n * import { writeFile } from \"@ayonli/jsext/fs\";\n * import bytes from \"@ayonli/jsext/bytes\";\n *\n * const data = bytes(\"Hello, world!\");\n * await writeFile(\"/path/to/file.txt\", data)\n * ```\n *\n * @example\n * ```ts\n * // write a blob to the file\n * import { writeFile } from \"@ayonli/jsext/fs\";\n *\n * const blob = new Blob([\"Hello, world!\"], { type: \"text/plain\" });\n * await writeFile(\"/path/to/file.txt\", blob);\n * ```\n *\n * @example\n * ```ts\n * // write a readable stream to the file\n * import { writeFile } from \"@ayonli/jsext/fs\";\n *\n * const res = await fetch(\"https://example.com/file.txt\");\n * await writeFile(\"/path/to/file.txt\", res.body!);\n * ```\n */\nexport async function writeFile(target, data, options = {}) {\n    target = ensureFsTarget(target);\n    if (typeof target === \"object\" || !(isDeno || isNodeLike)) {\n        return await webWriteFile(target, data, options);\n    }\n    const filename = await resolveHomeDir(target);\n    if (isDeno) {\n        if (typeof data === \"string\") {\n            return await rawOp(Deno.writeTextFile(filename, data, options));\n        }\n        else if (data instanceof Blob) {\n            return await rawOp(Deno.writeFile(filename, data.stream(), options));\n        }\n        else if (data instanceof ArrayBuffer) {\n            return await rawOp(Deno.writeFile(filename, new Uint8Array(data), options));\n        }\n        else if (data instanceof Uint8Array) {\n            return await rawOp(Deno.writeFile(filename, data, options));\n        }\n        else if (ArrayBuffer.isView(data)) {\n            return await rawOp(Deno.writeFile(filename, bytes(data), options));\n        }\n        else if (data) {\n            return await rawOp(Deno.writeFile(filename, data, options));\n        }\n    }\n    else {\n        if (typeof Blob === \"function\" && data instanceof Blob) {\n            const reader = data.stream();\n            const writer = createNodeWritableStream(filename, options);\n            await reader.pipeTo(writer);\n        }\n        else if (typeof ReadableStream === \"function\" && data instanceof ReadableStream) {\n            const writer = createNodeWritableStream(filename, options);\n            await data.pipeTo(writer);\n        }\n        else {\n            const fs = await import(\"node:fs/promises\");\n            const { append, ...rest } = options;\n            let _data;\n            if (data instanceof ArrayBuffer) {\n                _data = new Uint8Array(data);\n            }\n            else if (data instanceof Uint8Array) {\n                _data = data;\n            }\n            else if (ArrayBuffer.isView(data)) {\n                _data = bytes(data);\n            }\n            else if (typeof data === \"string\") {\n                _data = data;\n            }\n            else {\n                throw new TypeError(\"Unsupported data type\");\n            }\n            return await rawOp(fs.writeFile(filename, _data, {\n                flag: append ? \"a\" : \"w\",\n                ...rest,\n            }));\n        }\n    }\n}\n/**\n * Writes multiple lines of content to the file.\n *\n * This function will automatically detect the line ending of the current\n * content and use it to write the new lines. If the file is empty or does not\n * exists (will be created automatically), it will use the system's default line\n * ending to separate lines.\n *\n * This function will append a new line at the end of the final content, in\n * appending mode, it will also prepend a line ending before the input lines if\n * the current content doesn't ends with one.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { writeLines } from \"@ayonli/jsext/fs\";\n *\n * await writeLines(\"/path/to/file.txt\", [\"Hello\", \"World\"]);\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { writeLines } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * await writeLines(\"/path/to/file.txt\", [\"Hello\", \"World\"], { root });\n * ```\n *\n * @example\n * ```ts\n * // append the lines to the file\n * import { writeLines } from \"@ayonli/jsext/fs\";\n *\n * await writeLines(\"/path/to/file.txt\", [\"Hello\", \"World\"], { append: true });\n * ```\n */\nexport async function writeLines(target, lines, options = {}) {\n    const current = await readFileAsText(target, options).catch(err => {\n        var _a;\n        if (((_a = as(err, Exception)) === null || _a === void 0 ? void 0 : _a.name) !== \"NotFoundError\") {\n            throw err;\n        }\n        else {\n            return \"\";\n        }\n    });\n    const lineEndings = current.match(/\\r?\\n/g);\n    let eol = EOL;\n    if (lineEndings) {\n        const crlf = lineEndings.filter(e => e === \"\\r\\n\").length;\n        const lf = lineEndings.length - crlf;\n        eol = crlf > lf ? \"\\r\\n\" : \"\\n\";\n    }\n    let content = lines.join(eol);\n    if (!content.endsWith(eol)) {\n        if (eol === \"\\r\\n\" && content.endsWith(\"\\r\")) {\n            content += \"\\n\";\n        }\n        else {\n            content += eol;\n        }\n    }\n    if (options.append && !current.endsWith(eol) && !content.startsWith(eol)) {\n        if (eol === \"\\r\\n\" && current.endsWith(\"\\r\")) {\n            if (!content.startsWith(\"\\n\")) {\n                content = \"\\n\" + content;\n            }\n        }\n        else {\n            content = eol + content;\n        }\n    }\n    await writeFile(target, content, options);\n}\n/**\n * Truncates (or extends) the file to reach the specified `size`. If `size` is\n * not specified then the entire file contents are truncated.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { stat, truncate } from \"@ayonli/jsext/fs\";\n *\n * await truncate(\"/path/to/file.txt\", 1024);\n * const info = await stat(\"/path/to/file.txt\");\n * console.assert(info.size === 1024);\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { stat, truncate } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * await truncate(\"/path/to/file.txt\", 1024, { root });\n * const info = await stat(\"/path/to/file.txt\", { root });\n * console.assert(info.size === 1024);\n * ```\n *\n * @example\n * ```ts\n * // truncate the file to zero size\n * import { stat, truncate } from \"@ayonli/jsext/fs\";\n *\n * await truncate(\"/path/to/file.txt\");\n * const info = await stat(\"/path/to/file.txt\");\n * console.assert(info.size === 0);\n * ```\n */\nexport async function truncate(target, size = 0, options = {}) {\n    target = ensureFsTarget(target);\n    if (typeof target === \"object\" || !(isDeno || isNodeLike)) {\n        return await webTruncate(target, size, options);\n    }\n    const filename = await resolveHomeDir(target);\n    if (isDeno) {\n        await rawOp(Deno.truncate(filename, size));\n    }\n    else {\n        const fs = await import(\"node:fs/promises\");\n        await rawOp(fs.truncate(filename, size));\n    }\n}\n/**\n * Removes the file or directory of the given path from the file system.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { remove } from \"@ayonli/jsext/fs\";\n *\n * await remove(\"/path/to/file.txt\");\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { remove } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * await remove(\"/path/to/file.txt\", { root });\n * ```\n *\n * @example\n * ```ts\n * // remove the directory and its contents recursively\n * import { remove } from \"@ayonli/jsext/fs\";\n *\n * await remove(\"/path/to/dir\", { recursive: true });\n * ```\n */\nexport async function remove(path, options = {}) {\n    path = ensureFsTarget(path);\n    if (!(isDeno || isNodeLike)) {\n        return await webRemove(path, options);\n    }\n    path = await resolveHomeDir(path);\n    if (isDeno) {\n        await rawOp(Deno.remove(path, options));\n    }\n    else {\n        const fs = await import(\"node:fs/promises\");\n        if (typeof fs.rm === \"function\") {\n            await rawOp(fs.rm(path, options));\n        }\n        else {\n            try {\n                const _stat = await fs.stat(path);\n                if (_stat.isDirectory()) {\n                    await fs.rmdir(path, options);\n                }\n                else {\n                    await fs.unlink(path);\n                }\n            }\n            catch (err) {\n                throw wrapFsError(err);\n            }\n        }\n    }\n}\n/**\n * Renames the file or directory from the old path to the new path.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { rename } from \"@ayonli/jsext/fs\";\n *\n * await rename(\"/path/to/old.txt\", \"/path/to/new.txt\");\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { rename } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * await rename(\"/path/to/old.txt\", \"/path/to/new.txt\", { root });\n * ```\n */\nexport async function rename(oldPath, newPath, options = {}) {\n    oldPath = ensureFsTarget(oldPath);\n    newPath = ensureFsTarget(newPath);\n    if (!(isDeno || isNodeLike)) {\n        return await webRename(oldPath, newPath, options);\n    }\n    oldPath = await resolveHomeDir(oldPath);\n    newPath = await resolveHomeDir(newPath);\n    if (isDeno) {\n        await rawOp(Deno.rename(oldPath, newPath));\n    }\n    else {\n        const fs = await import(\"node:fs/promises\");\n        await rawOp(fs.rename(oldPath, newPath));\n    }\n}\nexport async function copy(src, dest, options = {}) {\n    src = ensureFsTarget(src);\n    dest = ensureFsTarget(dest);\n    if (typeof src === \"object\" || typeof dest === \"object\" || !(isDeno || isNodeLike)) {\n        // @ts-ignore internal call\n        return await webCopy(src, dest, options);\n    }\n    src = await resolveHomeDir(src);\n    dest = await resolveHomeDir(dest);\n    const oldStat = await stat(src, { followSymlink: true });\n    const isDirSrc = oldStat.kind === \"directory\";\n    let isDirDest = false;\n    if (isDirSrc && !options.recursive) {\n        throw new Exception(\"Cannot copy a directory without the 'recursive' option\", {\n            name: \"InvalidOperationError\",\n            code: 400,\n        });\n    }\n    try {\n        const newStat = await stat(dest, { followSymlink: true });\n        isDirDest = newStat.kind === \"directory\";\n        if (isDirSrc && !isDirDest) {\n            throw new Exception(`'${dest}' is not a directory`, {\n                name: \"NotDirectoryError\",\n                code: 415,\n            });\n        }\n    }\n    catch (_a) {\n        if (isDirSrc) {\n            await mkdir(dest);\n            isDirDest = true;\n        }\n    }\n    if (isDeno) {\n        if (isDirSrc) {\n            const entries = readDir(src, { recursive: true });\n            for await (const entry of entries) {\n                const _oldPath = join(src, entry.relativePath);\n                const _newPath = join(dest, entry.relativePath);\n                if (entry.kind === \"directory\") {\n                    await rawOp(Deno.mkdir(_newPath));\n                }\n                else {\n                    await rawOp(Deno.copyFile(_oldPath, _newPath));\n                }\n            }\n        }\n        else {\n            const _newPath = isDirDest ? join(dest, basename(src)) : dest;\n            await rawOp(Deno.copyFile(src, _newPath));\n        }\n    }\n    else {\n        const fs = await import(\"node:fs/promises\");\n        if (isDirSrc) {\n            const entries = readDir(src, { recursive: true });\n            for await (const entry of entries) {\n                const _oldPath = join(src, entry.relativePath);\n                const _newPath = join(dest, entry.relativePath);\n                if (entry.kind === \"directory\") {\n                    await rawOp(fs.mkdir(_newPath));\n                }\n                else {\n                    await rawOp(fs.copyFile(_oldPath, _newPath));\n                }\n            }\n        }\n        else {\n            const _newPath = isDirDest ? join(dest, basename(src)) : dest;\n            await rawOp(fs.copyFile(src, _newPath));\n        }\n    }\n}\n/**\n * Creates a hard link (or symbolic link) from the source path to the destination\n * path.\n *\n * NOTE: This function is only available in Node.js, Deno and Bun.\n *\n * @example\n * ```ts\n * // create a hard link\n * import { link } from \"@ayonli/jsext/fs\";\n *\n * await link(\"/path/to/file.txt\", \"/path/to/link.txt\");\n * ```\n *\n * @example\n * ```ts\n * // create a symbolic link\n * import { link } from \"@ayonli/jsext/fs\";\n *\n * await link(\"/path/to/file.txt\", \"/path/to/link.txt\", { symbolic: true });\n * ```\n */\nexport async function link(src, dest, options = {}) {\n    src = ensureFsTarget(src);\n    dest = ensureFsTarget(dest);\n    src = await resolveHomeDir(src);\n    dest = await resolveHomeDir(dest);\n    if (isDeno) {\n        if (options.symbolic) {\n            if (platform() === \"windows\") {\n                const _stat = await stat(src);\n                await rawOp(Deno.symlink(src, dest, {\n                    type: _stat.kind === \"directory\" ? \"dir\" : \"file\",\n                }));\n            }\n            else {\n                await rawOp(Deno.symlink(src, dest));\n            }\n        }\n        else {\n            await rawOp(Deno.link(src, dest));\n        }\n    }\n    else if (isNodeLike) {\n        const fs = await import(\"node:fs/promises\");\n        if (options.symbolic) {\n            if (platform() === \"windows\") {\n                const _stat = await stat(src);\n                await rawOp(fs.symlink(src, dest, _stat.kind === \"directory\" ? \"dir\" : \"file\"));\n            }\n            else {\n                await rawOp(fs.symlink(src, dest));\n            }\n        }\n        else {\n            await rawOp(fs.link(src, dest));\n        }\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\n/**\n * Returns the destination path of a symbolic link.\n *\n * NOTE: This function is only available in Node.js, Deno and Bun.\n *\n * @example\n * ```ts\n * import { readLink } from \"@ayonli/jsext/fs\";\n *\n * const dest = await readLink(\"/path/to/link.txt\");\n * console.log(dest);\n * ```\n */\nexport async function readLink(path) {\n    path = ensureFsTarget(path);\n    path = await resolveHomeDir(path);\n    if (isDeno) {\n        return await rawOp(Deno.readLink(path));\n    }\n    else if (isNodeLike) {\n        const fs = await import(\"node:fs/promises\");\n        return await rawOp(fs.readlink(path));\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\n/**\n * Changes the permission of the specified file or directory.\n *\n * The mode is a sequence of 3 octal numbers. The first/left-most number\n * specifies the permissions for the owner. The second number specifies the\n * permissions for the group. The last/right-most number specifies the\n * permissions for others. For example, with a mode of 0o764, the owner (7) can\n * read/write/execute, the group (6) can read/write and everyone else (4) can\n * read only.\n *\n * | Number | Description |\n * | ------ | ----------- |\n * | 7      | read, write, and execute |\n * | 6      | read and write |\n * | 5      | read and execute |\n * | 4      | read only |\n * | 3      | write and execute |\n * | 2      | write only |\n * | 1      | execute only |\n * | 0      | no permission |\n *\n * NOTE: This function is only available in Node.js, Deno and Bun, and only\n * works in Unix/Linux systems, in other environments, it's a no-op.\n *\n * @example\n * ```ts\n * import { chmod } from \"@ayonli/jsext/fs\";\n *\n * // Change the file's permission to read/write for owner, read for group and others.\n * await chmod(\"/path/to/file.txt\", 0o644);\n * ```\n */\nexport async function chmod(path, mode) {\n    if (platform() !== \"windows\") {\n        path = ensureFsTarget(path);\n        path = await resolveHomeDir(path);\n        if (isDeno) {\n            await rawOp(Deno.chmod(path, mode));\n        }\n        else if (isNodeLike) {\n            const fs = await import(\"node:fs/promises\");\n            await rawOp(fs.chmod(path, mode));\n        }\n    }\n}\n/**\n * Changes the owner and group of the specified file or directory.\n *\n * NOTE: This function is only available in Node.js, Deno and Bun, and only\n * works in Unix/Linux systems, in other environments, it's a no-op.\n *\n * @example\n * ```ts\n * import { chown } from \"@ayonli/jsext/fs\";\n *\n * // Change the owner and group of the file to root.\n * await chown(\"/path/to/file.txt\", 0, 0);\n * ```\n */\nexport async function chown(path, uid, gid) {\n    if (platform() !== \"windows\") {\n        path = ensureFsTarget(path);\n        path = await resolveHomeDir(path);\n        if (isDeno) {\n            await rawOp(Deno.chown(path, uid, gid));\n        }\n        else if (isNodeLike) {\n            const fs = await import(\"node:fs/promises\");\n            await rawOp(fs.chown(path, uid, gid));\n        }\n    }\n}\n/**\n * Changes the access (`atime`) and modification (`mtime`) times of the file\n * or directory. Given times are either in seconds (UNIX epoch time) or as `Date`\n * objects.\n *\n * NOTE: This function only works in Node.js, Deno and Bun, in other\n * environments, it's a no-op.\n *\n * @example\n * ```ts\n * import { utimes } from \"@ayonli/jsext/fs\";\n *\n * // Set the access and modification times to the current time.\n * await utimes(\"/path/to/file.txt\", Date.now(), Date.now());\n * ```\n */\nexport async function utimes(path, atime, mtime) {\n    path = ensureFsTarget(path);\n    path = await resolveHomeDir(path);\n    if (isDeno) {\n        await rawOp(Deno.utime(path, atime, mtime));\n    }\n    else if (isNodeLike) {\n        const fs = await import(\"node:fs/promises\");\n        await rawOp(fs.utimes(path, atime, mtime));\n    }\n}\n/**\n * Creates a readable stream for the target file.\n *\n * NOTE: In Node.js, this function requires Node.js v18.0 or above.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { createReadableStream } from \"@ayonli/jsext/fs\";\n * import { readAsText } from \"@ayonli/jsext/reader\";\n *\n * const input = createReadableStream(\"/path/to/file.txt\");\n *\n * const text = await readAsText(input);\n * console.log(text);\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { createReadableStream } from \"@ayonli/jsext/fs\";\n * import { readAsText } from \"@ayonli/jsext/reader\";\n *\n * const root = await window.showDirectoryPicker();\n * const input = createReadableStream(\"/path/to/file.txt\", { root });\n *\n * const text = await readAsText(input);\n * console.log(text);\n * ```\n */\nexport function createReadableStream(target, options = {}) {\n    target = ensureFsTarget(target);\n    if (typeof target === \"object\" || !(isDeno || isNodeLike)) {\n        return webCreateReadableStream(target, options);\n    }\n    if (isDeno) {\n        return resolveByteStream((async () => {\n            const filename = await resolveHomeDir(target);\n            const file = await rawOp(Deno.open(filename, { read: true }));\n            return file.readable;\n        })());\n    }\n    else {\n        let reader;\n        return new ReadableStream({\n            async start(controller) {\n                const fs = await import(\"node:fs\");\n                const filename = await resolveHomeDir(target);\n                reader = fs.createReadStream(filename);\n                reader.on(\"data\", (chunk) => {\n                    const bytes = new Uint8Array(chunk.buffer, chunk.byteOffset, chunk.byteLength);\n                    controller.enqueue(bytes);\n                });\n                reader.on(\"end\", () => controller.close());\n                reader.on(\"error\", (err) => controller.error(err));\n            },\n            cancel(reason = undefined) {\n                reader.destroy(reason);\n            },\n        });\n    }\n}\n/**\n * Creates a writable stream for the target file.\n *\n * NOTE: In Node.js, this function requires Node.js v18.0 or above.\n *\n * @example\n * ```ts\n * // with the default storage\n * import { createWritableStream } from \"@ayonli/jsext/fs\";\n *\n * const output = createWritableStream(\"/path/to/file.txt\");\n * const res = await fetch(\"https://example.com/file.txt\");\n *\n * await res.body!.pipeTo(output);\n * ```\n *\n * @example\n * ```ts\n * // with a user-selected directory as root (Chromium only)\n * import { createWritableStream } from \"@ayonli/jsext/fs\";\n *\n * const root = await window.showDirectoryPicker();\n * const output = createWritableStream(\"/path/to/file.txt\", { root });\n * const res = await fetch(\"https://example.com/file.txt\");\n *\n * await res.body!.pipeTo(output);\n * ```\n */\nexport function createWritableStream(target, options = {}) {\n    target = ensureFsTarget(target);\n    if (typeof target === \"object\" || !(isDeno || isNodeLike)) {\n        return webCreateWritableStream(target, options);\n    }\n    const filename = target;\n    if (isDeno) {\n        const { readable, writable } = new TransformStream();\n        resolveHomeDir(filename).then(filename => {\n            var _a;\n            return Deno.open(filename, {\n                write: true,\n                create: true,\n                append: (_a = options.append) !== null && _a !== void 0 ? _a : false,\n            });\n        })\n            .then(file => file.writable)\n            .then(stream => readable.pipeTo(stream));\n        return writable;\n    }\n    else {\n        return createNodeWritableStream(filename, options);\n    }\n}\nfunction createNodeWritableStream(filename, options) {\n    let dest;\n    return new WritableStream({\n        async start() {\n            const { append, ...rest } = options;\n            const { createWriteStream } = await import(\"node:fs\");\n            filename = await resolveHomeDir(filename);\n            dest = createWriteStream(filename, {\n                flags: append ? \"a\" : \"w\",\n                ...rest,\n            });\n        },\n        write(chunk) {\n            return new Promise((resolve, reject) => {\n                dest.write(chunk, (err) => err ? reject(err) : resolve());\n            });\n        },\n        close() {\n            return new Promise((resolve) => {\n                dest.end(() => resolve());\n            });\n        },\n        abort(reason) {\n            dest.destroy(reason);\n        }\n    });\n}\n//# sourceMappingURL=fs.js.map","import { isUrl } from \"../path.ts\";\nconst urlCache = new Map();\n/**\n * This function is primarily used to bypass the same-origin policy for Web\n * Workers in the browser, it downloads the script from the given URL and\n * converts it to an object URL which can be used by the `Worker` constructor.\n *\n * This function can also be used in other scenarios as it also corrects the\n * content-type of the response to ensure the script can be loaded properly.\n *\n * NOTE: This function is primarily designed for the browser, it has very little\n * use on the server side.\n */\nexport async function getObjectURL(src, mimeType = \"text/javascript\") {\n    var _a;\n    const isAbsolute = isUrl(src);\n    let cache = isAbsolute ? urlCache.get(src) : undefined;\n    if (cache) {\n        return cache;\n    }\n    // Use fetch to download the script and compose an object URL which can\n    // bypass the same-origin policy for web workers.\n    const res = await fetch(src);\n    if (!res.ok) {\n        throw new Error(`Failed to fetch resource: ${src}`);\n    }\n    let blob;\n    // JavaScript has more than one MIME types, so we just check it loosely.\n    const type = mimeType.includes(\"javascript\") ? \"javascript\" : mimeType;\n    if ((_a = res.headers.get(\"content-type\")) === null || _a === void 0 ? void 0 : _a.includes(type)) {\n        blob = await res.blob();\n    }\n    else {\n        // If the MIME type is not matched, we need to convert the response to\n        // a new Blob with the correct MIME type.\n        const buf = await res.arrayBuffer();\n        blob = new Blob([new Uint8Array(buf)], {\n            type: mimeType,\n        });\n    }\n    cache = URL.createObjectURL(blob);\n    isAbsolute && urlCache.set(src, cache);\n    return cache;\n}\n//# sourceMappingURL=util.js.map","/**\n * The `module` module purified for the web.\n * @module\n */\nimport { isBrowserWindow, isDedicatedWorker, isSharedWorker } from \"../env.ts\";\nimport { equals, extname } from \"../path.ts\";\nimport { getObjectURL } from \"./util.ts\";\nexport function interop(module, strict = undefined) {\n    if (typeof module === \"function\") {\n        return module().then(mod => interop(mod, strict));\n    }\n    else if (module instanceof Promise) {\n        return module.then(mod => interop(mod, strict));\n    }\n    else if (typeof module === \"object\" && module !== null && !Array.isArray(module)) {\n        if (typeof module[\"default\"] === \"object\" &&\n            module[\"default\"] !== null &&\n            !Array.isArray(module[\"default\"])) {\n            const hasEsModule = module[\"__esModule\"] === true\n                || module[\"default\"][\"__esModule\"] === true;\n            if (hasEsModule) {\n                return module[\"default\"];\n            }\n            else if (strict) {\n                return module;\n            }\n            const moduleKeys = Object.getOwnPropertyNames(module)\n                .filter(x => x !== \"default\" && x !== \"__esModule\").sort();\n            const defaultKeys = Object.getOwnPropertyNames(module[\"default\"])\n                .filter(x => x !== \"default\" && x !== \"__esModule\").sort();\n            if (String(moduleKeys) === String(defaultKeys)) {\n                return module[\"default\"];\n            }\n            else if (strict === false && !moduleKeys.length) {\n                return module[\"default\"];\n            }\n        }\n    }\n    return module;\n}\nexport function isMain(importMeta) {\n    if (\"main\" in importMeta && typeof importMeta[\"main\"] === \"boolean\") {\n        return importMeta[\"main\"];\n    }\n    if (\"serviceWorker\" in globalThis && \"url\" in importMeta) {\n        // @ts-ignore\n        return globalThis[\"serviceWorker\"][\"scriptURL\"] === importMeta.url;\n    }\n    else if ((isDedicatedWorker || isSharedWorker)\n        && \"url\" in importMeta && typeof location === \"object\" && location) {\n        return importMeta.url === location.href;\n    }\n    if (typeof process === \"object\" && Array.isArray(process.argv) && process.argv.length) {\n        if (!process.argv[1]) {\n            // Node.js REPL or the program is executed by `node -e \"code\"`,\n            // or the program is executed by itself.\n            return [\"<repl>\", \"[eval]\"].includes(importMeta[\"id\"]);\n        }\n        const filename = \"url\" in importMeta ? importMeta.url : importMeta[\"filename\"];\n        const urlExt = extname(filename);\n        let entry = process.argv[1];\n        if (!extname(entry) && urlExt) {\n            // In Node.js, the extension name may be omitted when starting the script.\n            entry += urlExt;\n        }\n        return equals(filename, entry, { ignoreFileProtocol: true });\n    }\n    return false;\n}\nconst importCache = new Map();\n/**\n * Imports a script from the given URL to the current document, useful for\n * loading 3rd-party libraries dynamically in the browser.\n *\n * This function uses cache to avoid loading the same module multiple times.\n *\n * NOTE: This function is only available in the browser.\n *\n * @example\n * ```ts\n * import { importScript } from \"@ayonli/jsext/module\";\n *\n * await importScript(\"https://code.jquery.com/jquery-3.7.1.min.js\");\n *\n * console.assert(typeof jQuery === \"function\");\n * console.assert($ === jQuery);\n * ```\n */\nexport function importScript(url, options = {}) {\n    if (!isBrowserWindow) {\n        return Promise.reject(new Error(\"This function is only available in the browser.\"));\n    }\n    url = new URL(url, location.href).href;\n    let cache = importCache.get(url);\n    if (cache) {\n        return cache;\n    }\n    cache = new Promise((resolve, reject) => {\n        getObjectURL(url).then(_url => {\n            const script = document.createElement(\"script\");\n            script.src = _url;\n            script.type = options.type === \"module\" ? \"module\" : \"text/javascript\";\n            script.setAttribute(\"data-src\", url);\n            script.onload = () => setTimeout(resolve, 0);\n            script.onerror = () => reject(new Error(`Failed to load script: ${url}`));\n            document.head.appendChild(script);\n        }).catch(reject);\n    });\n    importCache.set(url, cache);\n    return cache;\n}\n/**\n * Imports a stylesheet from the given URL to the current document, useful for\n * loading 3rd-party libraries dynamically in the browser.\n *\n * This function uses cache to avoid loading the same module multiple times.\n *\n * NOTE: This function is only available in the browser.\n *\n * @example\n * ```ts\n * import { importStylesheet } from \"@ayonli/jsext/module\";\n *\n * await importStylesheet(\"https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css\");\n * ```\n */\nexport function importStylesheet(url) {\n    if (!isBrowserWindow) {\n        return Promise.reject(new Error(\"This function is only available in the browser.\"));\n    }\n    url = new URL(url, location.href).href;\n    let cache = importCache.get(url);\n    if (cache) {\n        return cache;\n    }\n    cache = new Promise((resolve, reject) => {\n        getObjectURL(url, \"text/css\").then(_url => {\n            const link = document.createElement(\"link\");\n            link.href = _url;\n            link.rel = \"stylesheet\";\n            link.setAttribute(\"data-src\", url);\n            link.onload = () => setTimeout(resolve, 0);\n            link.onerror = () => reject(new Error(`Failed to load stylesheet: ${url}`));\n            document.head.appendChild(link);\n        }).catch(reject);\n    });\n    importCache.set(url, cache);\n    return cache;\n}\nconst wasmCache = new Map();\nexport async function importWasm(module, imports = undefined) {\n    if (module instanceof WebAssembly.Module) {\n        let cache = wasmCache.get(module);\n        if (!cache) {\n            cache = WebAssembly.instantiate(module, imports).then(ins => ins.exports);\n            wasmCache.set(module, cache);\n        }\n        return await cache;\n    }\n    const url = typeof module === \"string\" ? module : module.href;\n    if (typeof WebAssembly.instantiateStreaming === \"function\") {\n        let cache = wasmCache.get(url);\n        if (!cache) {\n            cache = fetch(url)\n                .then(res => WebAssembly.instantiateStreaming(res, imports))\n                .then(ins => ins.instance.exports);\n            wasmCache.set(url, cache);\n        }\n        return await cache;\n    }\n    else {\n        let cache = wasmCache.get(url);\n        if (!cache) {\n            cache = fetch(url)\n                .then(res => res.arrayBuffer())\n                .then(buf => WebAssembly.instantiate(buf, imports))\n                .then(ins => ins.instance.exports);\n            wasmCache.set(url, cache);\n        }\n        return await cache;\n    }\n}\n//# sourceMappingURL=web.js.map","/**\n * Utility functions for working with JavaScript modules.\n * @module\n */\nimport { isDeno, isNodeLike } from \"./env.ts\";\nimport { createReadableStream, readFile } from \"./fs.ts\";\nimport { isFileUrl, isUrl, resolve, toFsPath } from \"./path.ts\";\nimport { importWasm as webImportWasm } from \"./module/web.ts\";\nexport * from \"./module/web.ts\";\nconst wasmCache = new Map();\n/**\n * Imports a WebAssembly module from a URL or file path (relative to the current\n * working directory if not absolute), or from a {@link WebAssembly.Module}\n * object, returns the symbols exported by the module.\n *\n * This function is available in both the browser and server runtimes such as\n * Node.js, Deno, Bun and Cloudflare Workers.\n *\n * This function uses cache to avoid loading the same module multiple times.\n *\n * @param imports An object containing the values to be imported by the\n * WebAssembly module, allowing passing values from JavaScript to WebAssembly.\n *\n * ```ts\n * import { importWasm } from \"@ayonli/jsext/module\";\n *\n * const { timestamp } = await importWasm<{\n *     timestamp: () => number; // function exported by the WebAssembly module\n * }>(\"./examples/convert.wasm\", {\n *     // JavaScript module and function passed into the WebAssembly module\n *     Date: { now: Date.now },\n * });\n *\n * console.log(\"The current timestamp is:\", timestamp());\n * ```\n *\n * The corresponding WebAssembly module `convert.wasm` in text format looks like\n * this:\n *\n * ```wat\n * ;; examples/convert.wat\n * (module\n *   (import \"Date\" \"now\" (func $now (result i32)))\n *   (func (export \"timestamp\") (result i32)\n *     call $now\n *     ;; Convert to seconds\n *     i32.const 1000\n *     i32.div_u\n *   )\n * )\n * ```\n *\n * NOTE: In Cloudflare Workers, this function cannot access the file system, we\n * need to import the WebAssembly module with a `import` statement or with the\n * `import()` function before we can use it. For example:\n *\n * ```ts\n * // In Cloudflare Workers\n * import { importWasm } from \"@ayonli/jsext/module\";\n * import wasmModule from \"./examples/convert.wasm\";\n *\n * const { timestamp } = await importWasm<{\n *     timestamp: () => number; // function exported by the WebAssembly module\n * }>(wasmModule, {\n *     // JavaScript module and function passed into the WebAssembly module\n *     Date: { now: Date.now },\n * });\n *\n * console.log(\"The current timestamp is:\", timestamp());\n * ```\n *\n * NOTE: Deno v2.1+ has built-in support for importing WebAssembly modules as\n * JavaScript modules, it's recommended to use the built-in `import` statement\n * to import WebAssembly modules directly for Deno programs.\n */\nexport async function importWasm(module, imports = undefined) {\n    if ((!isNodeLike && !isDeno) ||\n        module instanceof WebAssembly.Module ||\n        (module instanceof URL && module.protocol !== \"file:\") ||\n        (typeof module === \"string\" && isUrl(module) && !isFileUrl(module))) {\n        return await webImportWasm(module, imports);\n    }\n    const src = typeof module === \"string\" ? module : module.href;\n    const filename = isFileUrl(src) ? toFsPath(src) : resolve(src);\n    if (typeof WebAssembly.instantiateStreaming === \"function\") {\n        let cache = wasmCache.get(filename);\n        if (!cache) {\n            const stream = createReadableStream(filename);\n            cache = Promise.resolve(new Response(stream, {\n                headers: { \"Content-Type\": \"application/wasm\" },\n            })).then(res => WebAssembly.instantiateStreaming(res, imports))\n                .then(ins => ins.instance.exports);\n            wasmCache.set(filename, cache);\n        }\n        return await cache;\n    }\n    else {\n        let cache = wasmCache.get(filename);\n        if (!cache) {\n            cache = readFile(filename)\n                .then(bytes => WebAssembly.instantiate(bytes, imports))\n                .then(ins => ins.instance.exports);\n            wasmCache.set(filename, cache);\n        }\n        return await cache;\n    }\n}\n//# sourceMappingURL=module.js.map","import { isBun, isDeno, isNode } from \"../env.ts\";\nimport { isAbsolute, isFsPath, toFsPath } from \"../path.ts\";\nimport { trim } from \"../string.ts\";\nimport { interop } from \"../module.ts\";\nimport { getObjectURL } from \"../module/util.ts\";\nconst moduleCache = new Map();\nexport function sanitizeModuleId(id, strict = false) {\n    let _id = \"\";\n    if (typeof id === \"function\") {\n        let str = id.toString();\n        let offset = \"import(\".length;\n        let start = str.lastIndexOf(\"import(\");\n        if (start === -1) {\n            offset = \"require(\".length;\n            start = str.lastIndexOf(\"require(\");\n        }\n        if (start === -1) {\n            throw new TypeError(\"The given script is not a dynamic import expression.\");\n        }\n        else {\n            start += offset;\n            const end = str.indexOf(\")\", start);\n            _id = trim(str.slice(start, end), ` '\"\\'`);\n        }\n    }\n    else {\n        _id = id;\n    }\n    if (isNode && isFsPath(_id) && !/\\.[cm]?(js|ts|)x?$/.test(_id)) {\n        _id += \".js\"; // In Node.js, if no suffix is provided, it fallback to .js\n    }\n    if (!strict && !isAbsolute(_id)) {\n        _id = \"./\" + _id;\n    }\n    return _id;\n}\nexport async function resolveModule(modId, baseUrl = undefined) {\n    let module;\n    if (isNode || isBun) {\n        const path = baseUrl ? toFsPath(new URL(modId, baseUrl).href) : modId;\n        module = await import(path);\n    }\n    else {\n        const url = new URL(modId, baseUrl).href;\n        module = moduleCache.get(url);\n        if (!module) {\n            if (isDeno) {\n                module = await import(url);\n                moduleCache.set(url, module);\n            }\n            else {\n                try {\n                    module = await import(url);\n                    moduleCache.set(url, module);\n                }\n                catch (err) {\n                    if (String(err).includes(\"Failed\")) {\n                        const _url = await getObjectURL(url);\n                        module = await import(_url);\n                        moduleCache.set(url, module);\n                    }\n                    else {\n                        throw err;\n                    }\n                }\n            }\n        }\n    }\n    return interop(module);\n}\n//# sourceMappingURL=module.js.map","import { Channel } from \"../chan.ts\";\nimport { id, isMainThread } from \"../env.ts\";\nconst channelStore = new Map();\nexport function isChannelMessage(msg) {\n    return msg\n        && typeof msg === \"object\"\n        && [\"send\", \"close\"].includes(msg.type)\n        && typeof msg.channelId === \"number\";\n}\nexport async function handleChannelMessage(msg) {\n    const record = channelStore.get(msg.channelId);\n    if (!record)\n        return;\n    if (msg.type === \"send\") {\n        await record.raw.send(msg.value);\n    }\n    else if (msg.type === \"close\") {\n        const { value: err, channelId } = msg;\n        record.raw.close(err);\n        channelStore.delete(channelId);\n        if (isMainThread && record.writers.length > 1) {\n            // distribute the channel close event to all threads\n            record.writers.forEach(write => {\n                write(\"close\", err, channelId);\n            });\n        }\n    }\n}\nfunction wireChannel(channel, channelWrite) {\n    const channelId = channel[id];\n    if (!channelStore.has(channelId)) {\n        const send = channel.send.bind(channel);\n        const close = channel.close.bind(channel);\n        channelStore.set(channelId, {\n            channel,\n            raw: { send, close },\n            writers: [channelWrite],\n            counter: 0,\n        });\n        Object.defineProperties(channel, {\n            send: {\n                configurable: true,\n                writable: true,\n                value: async (data) => {\n                    const record = channelStore.get(channelId);\n                    if (record) {\n                        const channel = record.channel;\n                        if (channel[\"state\"] !== 1) {\n                            throw new Error(\"the channel is closed\");\n                        }\n                        const write = record.writers[record.counter++ % record.writers.length];\n                        await Promise.resolve(write(\"send\", data, channelId));\n                    }\n                },\n            },\n            close: {\n                configurable: true,\n                writable: true,\n                value: (err = null) => {\n                    const record = channelStore.get(channelId);\n                    if (record) {\n                        channelStore.delete(channelId);\n                        const channel = record.channel;\n                        record.writers.forEach(write => {\n                            write(\"close\", err, channelId);\n                        });\n                        // recover to the original methods\n                        Object.defineProperties(channel, {\n                            send: {\n                                configurable: true,\n                                writable: true,\n                                value: record.raw.send,\n                            },\n                            close: {\n                                configurable: true,\n                                writable: true,\n                                value: record.raw.close,\n                            },\n                        });\n                        channel.close(err);\n                    }\n                },\n            },\n        });\n    }\n    else {\n        const record = channelStore.get(channelId);\n        record.writers.push(channelWrite);\n    }\n}\nexport function wrapChannel(channel, channelWrite) {\n    wireChannel(channel, channelWrite);\n    return { \"@@type\": \"Channel\", \"@@id\": channel[id], \"capacity\": channel.capacity };\n}\nexport function unwrapChannel(obj, channelWrite) {\n    var _a, _b;\n    const channelId = obj[\"@@id\"];\n    let channel = (_a = channelStore.get(channelId)) === null || _a === void 0 ? void 0 : _a.channel;\n    if (!channel) {\n        channel = Object.assign(Object.create(Channel.prototype), {\n            [id]: channelId,\n            capacity: (_b = obj.capacity) !== null && _b !== void 0 ? _b : 0,\n            buffer: [],\n            producers: [],\n            consumers: [],\n            error: null,\n            state: 1,\n        });\n    }\n    wireChannel(channel, channelWrite);\n    return channel;\n}\n//# sourceMappingURL=channel.js.map","import { Channel } from \"../chan.ts\";\nimport { isBun, isDeno, isNode, isNodeBelow14, isNodeLike } from \"../env.ts\";\nimport { handleChannelMessage, isChannelMessage, wrapChannel } from \"./channel.ts\";\nimport { getObjectURL } from \"../module/util.ts\";\nimport { isPlainObject } from \"../object.ts\";\nimport { serial } from \"../number.ts\";\nimport { Exception, fromErrorEvent, fromObject, isAggregateError, isDOMException, toObject, } from \"../error.ts\";\nimport * as path from \"../path.ts\";\nimport { unrefTimer } from \"../runtime.ts\";\nconst workerIdCounter = serial(true);\nlet workerPool = [];\nlet gcTimer;\nexport const remoteTasks = new Map();\nexport const getMaxParallelism = (async () => {\n    if (typeof navigator === \"object\" && navigator.hardwareConcurrency) {\n        return navigator.hardwareConcurrency;\n    }\n    else if (isNode) {\n        const os = await import(\"node:os\");\n        if (typeof os.availableParallelism === \"function\") {\n            return os.availableParallelism();\n        }\n        else {\n            return os.cpus().length;\n        }\n    }\n    else {\n        return 8;\n    }\n})();\nexport function isCallResponse(msg) {\n    return msg\n        && typeof msg === \"object\"\n        && [\"return\", \"yield\", \"error\", \"gen\"].includes(msg.type);\n}\nfunction getModuleDir(importMetaPath) {\n    if (path.extname(importMetaPath) === \".ts\") {\n        return path.resolve(importMetaPath, \"../..\");\n    }\n    let _dirname = path.dirname(importMetaPath);\n    if (path.endsWith(_dirname, \"jsext/bundle\")) {\n        // The application imports the bundled version of this module\n        return path.dirname(_dirname);\n    }\n    else {\n        // The application imports the compiled version of this module\n        return path.resolve(_dirname, \"../..\");\n    }\n}\nasync function getWorkerEntry(parallel = {}) {\n    if (isDeno) {\n        if (parallel.workerEntry) {\n            return parallel.workerEntry;\n        }\n        else if (import.meta[\"main\"]) {\n            // The code is bundled, try the remote worker entry.\n            if (import.meta.url.includes(\"jsr.io\")) {\n                return \"jsr:@ayonli/jsext/worker.ts\";\n            }\n            else {\n                return \"https://ayonli.github.io/jsext/bundle/worker.mjs\";\n            }\n        }\n        else {\n            if (import.meta.url.includes(\"jsr.io\")) {\n                return \"jsr:@ayonli/jsext/worker.ts\";\n            }\n            else {\n                const _dirname = getModuleDir(import.meta.url);\n                return path.join(_dirname, \"worker.ts\");\n            }\n        }\n    }\n    else if (isNodeLike) {\n        if (parallel.workerEntry) {\n            return parallel.workerEntry;\n        }\n        const _filename = path.toFsPath(import.meta.url);\n        if (_filename === process.argv[1]) {\n            // The code is bundled, try the worker entry in node_modules\n            // (hope it exists).\n            const _dirname = path.join(path.cwd(), \"node_modules/@ayonli/jsext\");\n            if (isBun) {\n                if (path.extname(_filename) === \".ts\") {\n                    return path.join(_dirname, \"worker.ts\");\n                }\n                else {\n                    return path.join(_dirname, \"bundle/worker.mjs\");\n                }\n            }\n            else {\n                return path.join(_dirname, \"bundle/worker-node.mjs\");\n            }\n        }\n        else {\n            const _dirname = getModuleDir(_filename);\n            if (isBun) {\n                if (path.extname(_filename) === \".ts\") {\n                    return path.join(_dirname, \"worker.ts\");\n                }\n                else {\n                    return path.join(_dirname, \"bundle/worker.mjs\");\n                }\n            }\n            else {\n                return path.join(_dirname, \"bundle/worker-node.mjs\");\n            }\n        }\n    }\n    else {\n        if (parallel.workerEntry) {\n            if (path.isUrl(parallel.workerEntry)) {\n                return await getObjectURL(parallel.workerEntry);\n            }\n            else {\n                return parallel.workerEntry;\n            }\n        }\n        else {\n            const url = \"https://ayonli.github.io/jsext/bundle/worker.mjs\";\n            return await getObjectURL(url);\n        }\n    }\n}\nexport async function createWorker(options) {\n    let { adapter = \"worker_threads\", parallel } = options;\n    const entry = await getWorkerEntry(parallel);\n    if (isNode || isBun) {\n        if (adapter === \"child_process\") {\n            const { fork } = await import(\"node:child_process\");\n            const serialization = isNodeBelow14 ? \"json\" : \"advanced\";\n            const worker = fork(entry, [\"--worker-thread\"], {\n                stdio: \"inherit\",\n                serialization,\n            });\n            const workerId = worker.pid;\n            await new Promise((resolve, reject) => {\n                worker.once(\"error\", reject);\n                worker.once(\"message\", () => {\n                    worker.off(\"error\", reject);\n                    resolve();\n                });\n            });\n            return {\n                worker,\n                workerId,\n                kind: \"node_process\",\n            };\n        }\n        else if (isNode) {\n            const { Worker } = await import(\"node:worker_threads\");\n            const worker = new Worker(entry, { argv: [\"--worker-thread\"] });\n            const workerId = worker.threadId;\n            await new Promise((resolve, reject) => {\n                worker.once(\"error\", reject);\n                worker.once(\"online\", () => {\n                    worker.off(\"error\", reject);\n                    resolve();\n                });\n            });\n            return {\n                worker,\n                workerId,\n                kind: \"node_worker\",\n            };\n        }\n        else { // isBun\n            const worker = new Worker(entry, { type: \"module\" });\n            const workerId = workerIdCounter.next().value;\n            await new Promise((resolve, reject) => {\n                worker.onerror = (ev) => {\n                    reject(new Error(ev.message || \"Unable to start the worker.\"));\n                };\n                worker.addEventListener(\"open\", () => {\n                    // @ts-ignore\n                    worker.onerror = null;\n                    resolve();\n                });\n            });\n            return {\n                worker,\n                workerId,\n                kind: \"bun_worker\",\n            };\n        }\n    }\n    else { // Deno and browsers\n        const worker = new Worker(entry, { type: \"module\" });\n        const workerId = workerIdCounter.next().value;\n        return {\n            worker,\n            workerId,\n            kind: \"web_worker\",\n        };\n    }\n}\nfunction handleWorkerMessage(poolRecord, worker, msg) {\n    var _a, _b, _c, _d;\n    if (isChannelMessage(msg)) {\n        handleChannelMessage(msg);\n    }\n    else if (isCallResponse(msg) && msg.taskId) {\n        const task = remoteTasks.get(msg.taskId);\n        if (!task)\n            return;\n        if (msg.type === \"return\" || msg.type === \"error\") {\n            if (msg.type === \"error\") {\n                const err = isPlainObject(msg.error)\n                    ? ((_a = fromObject(msg.error)) !== null && _a !== void 0 ? _a : msg.error)\n                    : msg.error;\n                if (err instanceof Error &&\n                    (err.message.includes(\"not be cloned\")\n                        || ((_b = err.stack) === null || _b === void 0 ? void 0 : _b.includes(\"not be cloned\")) // Node.js v16-\n                    )) {\n                    Object.defineProperty(err, \"stack\", {\n                        configurable: true,\n                        enumerable: false,\n                        writable: true,\n                        value: (err.stack ? err.stack + \"\\n    \" : \"\")\n                            + `at ${task.fn} (${task.module})`,\n                    });\n                }\n                if (task.promise) {\n                    task.promise.reject(err);\n                    if (task.channel) {\n                        task.channel.close();\n                    }\n                }\n                else if (task.channel) {\n                    task.channel.close(err);\n                }\n                else {\n                    task.error = err;\n                }\n            }\n            else {\n                const value = unwrapReturnValue(msg.value);\n                if (task.promise) {\n                    task.promise.resolve(value);\n                }\n                else {\n                    task.result = { value };\n                }\n                if (task.channel) {\n                    task.channel.close();\n                }\n            }\n            poolRecord.tasks.delete(msg.taskId);\n            if (!poolRecord.tasks.size && typeof worker.unref === \"function\") {\n                // Allow the main thread to exit if the event\n                // loop is empty.\n                worker.unref();\n            }\n        }\n        else if (msg.type === \"yield\") {\n            const value = unwrapReturnValue(msg.value);\n            (_c = task.channel) === null || _c === void 0 ? void 0 : _c.send({ value, done: msg.done });\n            if (msg.done) {\n                // The final message of yield event is the\n                // return value.\n                handleWorkerMessage(poolRecord, worker, {\n                    type: \"return\",\n                    value,\n                    taskId: msg.taskId,\n                });\n            }\n        }\n        else if (msg.type === \"gen\") {\n            (_d = task.generate) === null || _d === void 0 ? void 0 : _d.call(task);\n        }\n    }\n}\nfunction handleWorkerClose(poolRecord, err) {\n    for (const taskId of poolRecord.tasks) {\n        poolRecord.tasks.delete(taskId);\n        const task = remoteTasks.get(taskId);\n        if (task) {\n            if (task.promise) {\n                task.promise.reject(err);\n                if (task.channel) {\n                    task.channel.close();\n                }\n            }\n            else if (task.channel) {\n                task.channel.close(err);\n            }\n            else {\n                task.error = err;\n            }\n        }\n    }\n    workerPool = workerPool.filter(item => item !== poolRecord);\n}\nexport async function acquireWorker(taskId, parallel) {\n    const maxWorkers = parallel.maxWorkers || await getMaxParallelism;\n    let poolRecord = workerPool.find(item => !item.tasks.size);\n    if (poolRecord) {\n        poolRecord.lastAccess = Date.now();\n    }\n    else if (workerPool.length < maxWorkers) {\n        workerPool.push(poolRecord = {\n            getWorker: (async () => {\n                const worker = (await createWorker({ parallel }))\n                    .worker;\n                const handleMessage = handleWorkerMessage.bind(void 0, poolRecord, worker);\n                const handleClose = handleWorkerClose.bind(void 0, poolRecord);\n                if (isNode) {\n                    worker.on(\"message\", handleMessage)\n                        .on(\"error\", handleClose); // In Node.js, worker will exit once erred.\n                }\n                else if (isBun) {\n                    const _worker = worker;\n                    _worker.onmessage = (ev) => handleMessage(ev.data);\n                    _worker.onerror = () => _worker.terminate(); // terminate once erred\n                    _worker.addEventListener(\"close\", ((ev) => {\n                        handleClose(new Error(ev.reason + \" (\" + ev.code + \")\"));\n                    }));\n                }\n                else {\n                    const _worker = worker;\n                    _worker.onmessage = (ev) => handleMessage(ev.data);\n                    _worker.onerror = (ev) => {\n                        var _a;\n                        _worker.terminate(); // ensure termination\n                        handleClose((_a = fromErrorEvent(ev)) !== null && _a !== void 0 ? _a : new Error(\"worker exited\"));\n                    };\n                }\n                return worker;\n            })(),\n            tasks: new Set(),\n            lastAccess: Date.now(),\n        });\n        if (!gcTimer) {\n            gcTimer = setInterval(() => {\n                // GC: clean long-time unused workers\n                const now = Date.now();\n                const idealItems = [];\n                workerPool = workerPool.filter(item => {\n                    const ideal = !item.tasks.size\n                        && (now - item.lastAccess) >= 10000;\n                    if (ideal) {\n                        idealItems.push(item);\n                    }\n                    return !ideal;\n                });\n                idealItems.forEach(async (item) => {\n                    const worker = await item.getWorker;\n                    await worker.terminate();\n                });\n            }, 1000);\n            unrefTimer(gcTimer);\n        }\n    }\n    else {\n        poolRecord = workerPool[taskId % workerPool.length];\n        poolRecord.lastAccess = Date.now();\n    }\n    poolRecord.tasks.add(taskId);\n    const worker = await poolRecord.getWorker;\n    if (\"ref\" in worker && typeof worker.ref === \"function\") {\n        // Prevent premature exit in the main thread.\n        worker.ref();\n    }\n    return worker;\n}\nexport function wrapArgs(args, getWorker) {\n    const transferable = [];\n    args = args.map(arg => {\n        if (arg instanceof Channel) {\n            return wrapChannel(arg, (type, msg, channelId) => {\n                getWorker.then(worker => {\n                    if (typeof worker[\"postMessage\"] === \"function\") {\n                        try {\n                            worker.postMessage({\n                                type,\n                                value: msg,\n                                channelId,\n                            });\n                        }\n                        catch (err) {\n                            // Suppress error when sending `close` command to\n                            // the channel in the worker thread when the thread\n                            // is terminated. This situation often occurs when\n                            // using `run()` to call function and the `result()`\n                            // is called before `channel.close()`.\n                            if (!(type === \"close\" &&\n                                String(err).includes(\"Worker has been terminated\"))) {\n                                throw err;\n                            }\n                        }\n                    }\n                    else {\n                        worker.send({\n                            type,\n                            value: msg,\n                            channelId,\n                        });\n                    }\n                });\n            });\n        }\n        else if ((arg instanceof Exception)\n            || isDOMException(arg)\n            || isAggregateError(arg)) {\n            return toObject(arg);\n        }\n        if (arg instanceof ArrayBuffer) {\n            transferable.push(arg);\n        }\n        else if (isPlainObject(arg)) {\n            for (const key of Object.getOwnPropertyNames(arg)) {\n                const value = arg[key];\n                if (value instanceof ArrayBuffer) {\n                    transferable.push(value);\n                }\n                else if ((value instanceof Exception)\n                    || isDOMException(value)\n                    || isAggregateError(value)) {\n                    arg[key] = toObject(value);\n                }\n            }\n        }\n        else if (Array.isArray(arg)) {\n            arg = arg.map(item => {\n                if (item instanceof ArrayBuffer) {\n                    transferable.push(item);\n                    return item;\n                }\n                else if ((item instanceof Exception)\n                    || isDOMException(item)\n                    || isAggregateError(item)) {\n                    return toObject(item);\n                }\n                else {\n                    return item;\n                }\n            });\n        }\n        return arg;\n    });\n    return { args, transferable };\n}\nexport function unwrapReturnValue(value) {\n    if (isPlainObject(value) && (value[\"@@type\"] === \"Exception\" ||\n        value[\"@@type\"] === \"DOMException\" ||\n        value[\"@@type\"] === \"AggregateError\")) {\n        return fromObject(value);\n    }\n    return value;\n}\n//# sourceMappingURL=threads.js.map","/**\n * This module provides JavaScript the ability to run functions in parallel\n * threads and take advantage of multi-core CPUs, inspired by Golang.\n * @module\n */\nimport { ThenableAsyncGenerator } from \"./external/thenable-generator/index.ts\";\nimport chan from \"./chan.ts\";\nimport { serial } from \"./number.ts\";\nimport { cwd, isFsPath, toFileUrl } from \"./path.ts\";\nimport { asyncTask } from \"./async.ts\";\nimport { isMainThread, isNode } from \"./env.ts\";\nimport { resolveModule, sanitizeModuleId } from \"./parallel/module.ts\";\nimport { acquireWorker, remoteTasks, wrapArgs } from \"./parallel/threads.ts\";\nconst taskIdCounter = serial(true);\nasync function safeRemoteCall(worker, req, transferable, taskId) {\n    try {\n        worker.postMessage(req, transferable);\n    }\n    catch (err) {\n        remoteTasks.delete(taskId);\n        if (typeof worker[\"unref\"] === \"function\") {\n            worker.unref();\n        }\n        throw err;\n    }\n}\nfunction createRemoteCall(module, fn, args) {\n    const taskId = taskIdCounter.next().value;\n    remoteTasks.set(taskId, { module, fn });\n    let getWorker = acquireWorker(taskId, parallel);\n    const { args: _args, transferable } = wrapArgs(args, getWorker);\n    getWorker = getWorker.then(async (worker) => {\n        await safeRemoteCall(worker, {\n            type: \"call\",\n            module,\n            fn,\n            args: _args,\n            taskId,\n        }, transferable, taskId);\n        return worker;\n    });\n    return new ThenableAsyncGenerator({\n        then(onfulfilled, onrejected) {\n            const task = remoteTasks.get(taskId);\n            if (task.error) {\n                remoteTasks.delete(taskId);\n                return onrejected === null || onrejected === void 0 ? void 0 : onrejected(task.error);\n            }\n            else if (task.result) {\n                remoteTasks.delete(taskId);\n                return onfulfilled === null || onfulfilled === void 0 ? void 0 : onfulfilled(task.result.value);\n            }\n            else {\n                return getWorker.then(() => {\n                    return (task.promise = asyncTask()).finally(() => {\n                        remoteTasks.delete(taskId);\n                    });\n                }).then(onfulfilled, onrejected);\n            }\n        },\n        async next(input) {\n            var _a;\n            const task = remoteTasks.get(taskId);\n            if (task.error) {\n                const err = task.error;\n                remoteTasks.delete(taskId);\n                throw err;\n            }\n            else if (task.result) {\n                const value = task.result.value;\n                remoteTasks.delete(taskId);\n                return { value, done: true };\n            }\n            else {\n                (_a = task.channel) !== null && _a !== void 0 ? _a : (task.channel = chan(Infinity));\n                const worker = await getWorker;\n                if (!task.generate) {\n                    await new Promise(resolve => {\n                        task.generate = resolve;\n                    });\n                }\n                const { args, transferable } = wrapArgs([input], getWorker);\n                await safeRemoteCall(worker, {\n                    type: \"next\",\n                    args: args,\n                    taskId,\n                }, transferable, taskId);\n                return await task.channel.recv();\n            }\n        },\n        async return(value) {\n            remoteTasks.delete(taskId);\n            const worker = await getWorker;\n            const { args, transferable } = wrapArgs([value], getWorker);\n            await safeRemoteCall(worker, {\n                type: \"return\",\n                args: args,\n                taskId,\n            }, transferable, taskId);\n            return { value, done: true };\n        },\n        async throw(err) {\n            remoteTasks.delete(taskId);\n            const worker = await getWorker;\n            await safeRemoteCall(worker, {\n                type: \"throw\",\n                args: [err],\n                taskId,\n            }, transferable, taskId);\n            throw err;\n        },\n    });\n}\nfunction createLocalCall(module, fn, args) {\n    const getReturns = resolveModule(module).then(mod => {\n        return mod[fn](...args);\n    });\n    return new ThenableAsyncGenerator({\n        then(onfulfilled, onrejected) {\n            return getReturns.then(onfulfilled, onrejected);\n        },\n        async next(input) {\n            const gen = await getReturns;\n            return await gen.next(input);\n        },\n        async return(value) {\n            const gen = await getReturns;\n            return await gen.return(value);\n        },\n        async throw(err) {\n            const gen = await getReturns;\n            return gen.throw(err);\n        },\n    });\n}\nfunction extractBaseUrl(stackTrace) {\n    var _a, _b, _c;\n    let lines = stackTrace.split(\"\\n\");\n    const offset = lines.findIndex(line => line === \"Error\");\n    if (offset !== -1 && offset !== 0) {\n        lines = lines.slice(offset); // fix for tsx in Node.js v16\n    }\n    let callSite;\n    if ((_a = lines[0]) === null || _a === void 0 ? void 0 : _a.startsWith(\"Error\")) { // chromium browsers\n        callSite = lines[2];\n    }\n    else {\n        callSite = lines[1];\n    }\n    let baseUrl;\n    if (callSite) {\n        let start = callSite.lastIndexOf(\"(\");\n        let end = 0;\n        if (start !== -1) {\n            start += 1;\n            end = callSite.indexOf(\")\", start);\n            callSite = callSite.slice(start, end);\n        }\n        else if (callSite.startsWith(\"    at \")) {\n            callSite = callSite.slice(7); // remove leading `    at `\n        }\n        else if (typeof location === \"object\") { // general browsers\n            start = (_c = (_b = callSite.match(/(https?|file):/)) === null || _b === void 0 ? void 0 : _b.index) !== null && _c !== void 0 ? _c : -1;\n            if (start > 0) {\n                callSite = callSite.slice(start);\n            }\n        }\n        baseUrl = callSite.replace(/:\\d+:\\d+$/, \"\");\n        if (!/^(https?|file):/.test(baseUrl)) {\n            if (isFsPath(baseUrl)) {\n                baseUrl = toFileUrl(baseUrl);\n            }\n            else {\n                try {\n                    baseUrl = toFileUrl(cwd()) + \"/\"; // must ends with `/`\n                }\n                catch ( // `cwd()` may fail in unsupported environments or being rejected\n                _d) { // `cwd()` may fail in unsupported environments or being rejected\n                    baseUrl = \"\";\n                }\n            }\n        }\n    }\n    return baseUrl;\n}\n/**\n * Wraps a module so its functions will be run in worker threads.\n *\n * In Node.js and Bun, the `module` can be either an ES module or a CommonJS\n * module, **node_modules** and built-in modules are also supported.\n *\n * In browsers and Deno, the `module` can only be an ES module.\n *\n * Data are cloned and transferred between threads via **Structured Clone**\n * **Algorithm**.\n *\n * Apart from the standard data types supported by the algorithm, {@link Channel}\n * can also be used to transfer data between threads. To do so, just passed a\n * channel instance to the threaded function. But be aware, channel can only be\n * used as a parameter, return a channel from the threaded function is not\n * allowed. Once passed, the data can only be transferred into and out-from the\n * function.\n *\n * The difference between using a channel and a generator function for streaming\n * processing is, for a generator function, `next(value)` is coupled with a\n * `yield value`, the process is blocked between **next** calls, channel doesn't\n * have this limit, we can use it to stream all the data into the function\n * before processing and receiving any result.\n *\n * The threaded function also supports `ArrayBuffer`s as transferable objects.\n * If an array buffer is presented as an argument or the direct property of an\n * argument (assume it's a plain object), or the array buffer is the return\n * value or the direct property of the return value (assume it's a plain object),\n * it automatically becomes a transferrable object and will be transferred to\n * the other thread instead of being cloned. This strategy allows us to easily\n * compose objects like `Request` and `Response` instances into plain objects\n * and pass them between threads without overhead.\n *\n * **NOTE:**\n * If the current module is already in a worker thread, use this function won't\n * create another worker thread.\n *\n * **NOTE:**\n * Cloning and transferring data between the main thread and worker threads are\n * very heavy and slow, worker threads are only intended to run CPU-intensive\n * tasks or divide tasks among multiple threads, they have no advantage when\n * performing IO-intensive tasks such as handling HTTP requests, always prefer\n * `cluster` module for that kind of purpose.\n *\n * **NOTE:**\n * For error instances, only the following types are guaranteed to be sent and\n * received properly between threads.\n *\n * - `Error`\n * - `EvalError`\n * - `RangeError`\n * - `ReferenceError`\n * - `SyntaxError`\n * - `TypeError`\n * - `URIError`\n * - `AggregateError` (as arguments, return values, thrown values, or shallow\n *   object properties)\n * - `Exception` (as arguments, return values, thrown values, or shallow object\n *   properties)\n * - `DOMException` (as arguments, return values, thrown values, or shallow\n *   object properties)\n *\n * In order to handle errors properly between threads, throw well-known error\n * types or use `Exception` (or `DOMException`) with error names in the threaded\n * function.\n *\n * @example\n * ```ts\n * // regular or async function\n * import parallel from \"@ayonli/jsext/parallel\";\n * const { greet } = parallel(() => import(\"./examples/worker.mjs\"));\n *\n * console.log(await greet(\"World\")); // Hi, World\n * ```\n *\n * @example\n * ```ts\n * // generator or async generator function\n * import parallel from \"@ayonli/jsext/parallel\";\n * const { sequence } = parallel(() => import(\"./examples/worker.mjs\"));\n *\n * for await (const word of sequence([\"foo\", \"bar\"])) {\n *     console.log(word);\n * }\n * // output:\n * // foo\n * // bar\n * ```\n *\n * @example\n * ```ts\n * // use channel\n * import chan from \"@ayonli/jsext/chan\";\n * import { range } from \"@ayonli/jsext/number\";\n * import readAll from \"@ayonli/jsext/readAll\";\n * import parallel from \"@ayonli/jsext/parallel\";\n * const { twoTimesValues } = parallel(() => import(\"./examples/worker.mjs\"));\n *\n * const channel = chan<{ value: number; done: boolean; }>();\n * const length = twoTimesValues(channel);\n *\n * for (const value of range(0, 9)) {\n *     await channel.send({ value, done: value === 9 });\n * }\n *\n * const results = (await readAll(channel)).map(item => item.value);\n * console.log(results);      // [0, 2, 4, 6, 8, 10, 12, 14, 16, 18]\n * console.log(await length); // 10\n * ```\n *\n * @example\n * ```ts\n * // use transferrable\n * import parallel from \"@ayonli/jsext/parallel\";\n * const { transfer } = parallel(() => import(\"./examples/worker.mjs\"));\n *\n * const arr = Uint8Array.from([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]);\n * const length = await transfer(arr.buffer);\n *\n * console.log(length);     // 10\n * console.log(arr.length); // 0\n * ```\n *\n * **Compatibility List:**\n *\n * The following environments are guaranteed to work:\n *\n * - [x] Node.js v14.18+\n * - [x] Deno v1.0+\n * - [x] Bun v1.0+\n * - [x] Modern browsers\n *\n * **Use with Vite:**\n *\n * In order to use parallel threads with Vite, we need to adjust a little bit,\n * please check [this document](https://github.com/ayonli/jsext/blob/main/parallel/README.md#use-with-vite).\n *\n * **Warn about TSX (the runtime):**\n *\n * For users who use [tsx](https://www.npmjs.com/package/tsx) to run TypeScript\n * directly in Node.js, the runtime is unable to use TypeScript directly in\n * worker threads at the moment, so this function won't work in such a case.\n * See [this issue](https://github.com/privatenumber/tsx/issues/354) for more\n * information.\n */\nfunction parallel(module) {\n    if (!isNode && typeof Worker !== \"function\") {\n        throw new Error(\"Unsupported runtime\");\n    }\n    let modId = sanitizeModuleId(module, true);\n    let baseUrl;\n    if (isFsPath(modId)) {\n        if (typeof Error.captureStackTrace === \"function\") {\n            const trace = {};\n            Error.captureStackTrace(trace);\n            baseUrl = extractBaseUrl(trace.stack);\n        }\n        else {\n            const trace = new Error(\"\");\n            baseUrl = extractBaseUrl(trace.stack);\n        }\n    }\n    if (baseUrl) {\n        modId = new URL(modId, baseUrl).href;\n    }\n    return new Proxy(Object.create(null), {\n        get: (target, prop) => {\n            if (Reflect.has(target, prop)) {\n                return target[prop];\n            }\n            else if (typeof prop === \"symbol\") {\n                return undefined;\n            }\n            const obj = {\n                // This syntax will give our remote function a name.\n                [prop]: (...args) => {\n                    if (isMainThread) {\n                        return createRemoteCall(modId, prop, args);\n                    }\n                    else {\n                        return createLocalCall(modId, prop, args);\n                    }\n                }\n            };\n            return obj[prop];\n        }\n    });\n}\n(function (parallel) {\n    /**\n     * The maximum number of workers allowed to exist at the same time. If not\n     * set, the program by default uses CPU core numbers as the limit.\n     */\n    parallel.maxWorkers = undefined;\n    /**\n     * In browsers, by default, the program loads the worker entry directly from\n     * GitHub, which could be slow due to poor internet connection, we can copy\n     * the entry file `bundle/worker.mjs` to a local path of our website and set\n     * this option to that path so that it can be loaded locally.\n     *\n     * Or, if the code is bundled, the program won't be able to automatically\n     * locate the entry file in the file system, in such case, we can also copy\n     * the entry file (`bundle/worker.mjs` for Bun, Deno and the browser,\n     * `bundle/worker-node.mjs` for Node.js) to a local directory and supply\n     * this option instead.\n     */\n    parallel.workerEntry = undefined;\n    /**\n     * Indicates whether the current thread is the main thread.\n     */\n    parallel.isMainThread = false;\n})(parallel || (parallel = {}));\nObject.defineProperty(parallel, \"isMainThread\", {\n    value: isMainThread,\n    writable: false,\n});\nexport default parallel;\n//# sourceMappingURL=parallel.js.map","/**\n * Runs a script in a worker thread and invokes its `default` function to\n * collect the result.\n * @module\n */\nimport chan from \"./chan.ts\";\nimport { isPlainObject } from \"./object.ts\";\nimport { fromErrorEvent, fromObject } from \"./error.ts\";\nimport { cwd, isAbsolute, toFileUrl } from \"./path.ts\";\nimport { isNode, isBun, isBrowserWindow } from \"./env.ts\";\nimport { sanitizeModuleId } from \"./parallel/module.ts\";\nimport { handleChannelMessage, isChannelMessage } from \"./parallel/channel.ts\";\nimport { getMaxParallelism, createWorker, isCallResponse, wrapArgs, unwrapReturnValue, } from \"./parallel/threads.ts\";\nimport parallel from \"./parallel.ts\";\nimport { unrefTimer } from \"./runtime.ts\";\nimport { abortWith, asyncTask } from \"./async.ts\";\nconst workerPools = new Map();\nlet gcTimer;\n// The worker consumer queue is nothing but a callback list, once a worker is\n// available, the runner pop a consumer and run the callback, which will retry\n// gaining the worker and retry the task.\nconst workerConsumerQueue = [];\n/**\n * Runs the given `script` in a worker thread and invokes its `default` function\n * to collect the result.\n *\n * This function is similar to {@link parallel}(), many features and\n * restrictions applicable to `parallel()` are also applicable to `run()`,\n * except the following:\n *\n * 1. The `script` can only be a filename, and is relative to the current\n *   working directory (or the current URL) if not absolute.\n * 2. Only one task is allow to run at a time for one worker thread, set\n *   {@link run.maxWorkers} to allow more tasks to be run at the same time if\n *   needed.\n * 3. By default, the worker thread is dropped after the task settles, set\n *   `keepAlive` option in order to reuse it.\n * 4. This function is not intended to be used in the browser, because it takes\n *   a bare filename as argument, which will not be transformed to a proper URL\n *   if the program is to be bundled.\n *\n * @example\n * ```ts\n * // result\n * import run from \"@ayonli/jsext/run\";\n *\n * const job1 = await run(\"examples/worker.mjs\", [\"World\"]);\n * console.log(await job1.result()); // Hello, World\n * ```\n *\n * @example\n * ```ts\n * // iterate\n * import run from \"@ayonli/jsext/run\";\n *\n * const job2 = await run<string, [string[]]>(\n *     \"examples/worker.mjs\",\n *     [[\"foo\", \"bar\"]],\n *     { fn: \"sequence\" } // sequence is a generator function\n * );\n * for await (const word of job2.iterate()) {\n *     console.log(word);\n * }\n * // output:\n * // foo\n * // bar\n * ```\n *\n * @example\n * ```ts\n * // abort\n * import run from \"@ayonli/jsext/run\";\n * import _try from \"@ayonli/jsext/try\";\n *\n * const job3 = await run<string, [string]>(\"examples/worker.mjs\", [\"foobar\"], {\n *    fn: \"takeTooLong\",\n * });\n * job3.abort();\n * const [err, res] = await _try(job3.result());\n * console.assert((err as DOMException)?.name === \"AbortError\");\n * console.assert(res === undefined);\n * ```\n */\nasync function run(script, args, options) {\n    var _a, _b;\n    if (!isNode && typeof Worker !== \"function\") {\n        throw new Error(\"Unsupported runtime\");\n    }\n    script = typeof script === \"string\" ? script : script.href;\n    const maxWorkers = run.maxWorkers || parallel.maxWorkers || await getMaxParallelism;\n    if ((_a = options === null || options === void 0 ? void 0 : options.signal) === null || _a === void 0 ? void 0 : _a.aborted) {\n        throw options.signal.reason;\n    }\n    const fn = (options === null || options === void 0 ? void 0 : options.fn) || \"default\";\n    let modId = sanitizeModuleId(script);\n    let baseUrl = undefined;\n    if (isBrowserWindow) { // browser main thread\n        baseUrl = location.href;\n    }\n    else if (!isAbsolute(modId)) {\n        try {\n            baseUrl = toFileUrl(cwd()) + \"/\"; // must ends with `/`\n        }\n        catch ( // `cwd()` may fail in unsupported environments or being rejected\n        _c) { // `cwd()` may fail in unsupported environments or being rejected\n            baseUrl = \"\";\n        }\n    }\n    if (baseUrl) {\n        modId = new URL(modId, baseUrl).href;\n    }\n    const req = {\n        type: \"call\",\n        module: modId,\n        fn,\n        args: args !== null && args !== void 0 ? args : [],\n    };\n    const adapter = (options === null || options === void 0 ? void 0 : options.adapter) || \"worker_threads\";\n    const workerPool = (_b = workerPools.get(adapter)) !== null && _b !== void 0 ? _b : workerPools.set(adapter, []).get(adapter);\n    let poolRecord = workerPool.find(item => !item.busy);\n    if (poolRecord) {\n        poolRecord.busy = true;\n        poolRecord.lastAccess = Date.now();\n    }\n    else if (workerPool.length < maxWorkers) {\n        // Fill the worker pool regardless the current call should keep-alive\n        // or not, this will make sure that the total number of workers will not\n        // exceed the `run.maxWorkers`. If the the call doesn't keep-alive the\n        // worker, it will be cleaned after the call.\n        workerPool.push(poolRecord = {\n            getWorker: createWorker({ parallel, adapter }),\n            adapter,\n            busy: true,\n            lastAccess: Date.now(),\n        });\n        if (!gcTimer) {\n            gcTimer = setInterval(() => {\n                workerPools.forEach((workerPool, adapter) => {\n                    // GC: clean long-time unused workers\n                    const now = Date.now();\n                    const idealItems = [];\n                    workerPools.set(adapter, workerPool.filter(item => {\n                        const ideal = !item.busy\n                            && (now - item.lastAccess) >= 10000;\n                        if (ideal) {\n                            idealItems.push(item);\n                        }\n                        return !ideal;\n                    }));\n                    idealItems.forEach(async (item) => {\n                        const { worker } = await item.getWorker;\n                        if (typeof worker[\"terminate\"] === \"function\") {\n                            await worker\n                                .terminate();\n                        }\n                        else {\n                            worker.kill();\n                        }\n                    });\n                });\n            }, 1000);\n            unrefTimer(gcTimer);\n        }\n    }\n    else {\n        // Put the current call in the consumer queue if there are no workers\n        // available, once an existing call finishes, the queue will pop the its\n        // head consumer and retry.\n        return new Promise((resolve) => {\n            workerConsumerQueue.push(resolve);\n        }).then(() => run(modId, args, options));\n    }\n    let error = null;\n    let result;\n    let promise;\n    let channel = undefined;\n    let workerId;\n    let release;\n    let terminate = () => Promise.resolve(void 0);\n    const controller = (options === null || options === void 0 ? void 0 : options.timeout) || (options === null || options === void 0 ? void 0 : options.signal) ? abortWith({\n        timeout: options === null || options === void 0 ? void 0 : options.timeout,\n        parent: options === null || options === void 0 ? void 0 : options.signal,\n    }) : new AbortController();\n    const { signal } = controller;\n    signal.addEventListener(\"abort\", () => {\n        if (error || result) {\n            return; // If the task has already settled, ignore the abort event.\n        }\n        error = signal.reason;\n        terminate().then(() => {\n            handleClose(error, true);\n        });\n    });\n    const handleMessage = async (msg) => {\n        var _a, _b;\n        if (isChannelMessage(msg)) {\n            await handleChannelMessage(msg);\n        }\n        else if (isCallResponse(msg)) {\n            if (msg.type === \"return\" || msg.type === \"error\") {\n                if (msg.type === \"error\") {\n                    const err = isPlainObject(msg.error)\n                        ? ((_a = fromObject(msg.error)) !== null && _a !== void 0 ? _a : msg.error)\n                        : msg.error;\n                    if (err instanceof Error &&\n                        (err.message.includes(\"not be cloned\")\n                            || ((_b = err.stack) === null || _b === void 0 ? void 0 : _b.includes(\"not be cloned\")) // Node.js v16-\n                            || err.message.includes(\"Do not know how to serialize\") // JSON error\n                        )) {\n                        Object.defineProperty(err, \"stack\", {\n                            configurable: true,\n                            enumerable: false,\n                            writable: true,\n                            value: (err.stack ? err.stack + \"\\n    \" : \"\")\n                                + `at ${fn} (${modId})`,\n                        });\n                    }\n                    error = err;\n                }\n                else {\n                    result = { value: unwrapReturnValue(msg.value) };\n                }\n                (options === null || options === void 0 ? void 0 : options.keepAlive) || await terminate();\n                handleClose(null, !(options === null || options === void 0 ? void 0 : options.keepAlive));\n            }\n            else if (msg.type === \"yield\") {\n                const value = unwrapReturnValue(msg.value);\n                if (msg.done) {\n                    // The final message of yield event is the return value.\n                    handleMessage({\n                        type: \"return\",\n                        value,\n                    });\n                }\n                else {\n                    channel === null || channel === void 0 ? void 0 : channel.send(value);\n                }\n            }\n        }\n    };\n    const handleClose = (err, terminated = false) => {\n        var _a, _b, _c;\n        if (!terminated) {\n            // Release before resolve.\n            release === null || release === void 0 ? void 0 : release();\n            if (workerConsumerQueue.length) {\n                // Queued consumer now has chance to gain the worker.\n                (_a = workerConsumerQueue.shift()) === null || _a === void 0 ? void 0 : _a();\n            }\n        }\n        else if (poolRecord) {\n            // Clean the pool before resolve.\n            // The `workerPool` of this key in the pool map may have been\n            // modified by other routines, we need to retrieve the newest value.\n            const remainItems = (_b = workerPools.get(adapter)) === null || _b === void 0 ? void 0 : _b.filter(record => record !== poolRecord);\n            if (remainItems === null || remainItems === void 0 ? void 0 : remainItems.length) {\n                workerPools.set(adapter, remainItems);\n            }\n            else {\n                workerPools.delete(adapter);\n            }\n            if (workerConsumerQueue.length) {\n                // Queued consumer now has chance to create new worker.\n                (_c = workerConsumerQueue.shift()) === null || _c === void 0 ? void 0 : _c();\n            }\n        }\n        if (err) {\n            error !== null && error !== void 0 ? error : (error = err);\n        }\n        if (error) {\n            if (promise) {\n                promise.reject(error);\n                if (channel) {\n                    channel.close();\n                }\n            }\n            else if (channel) {\n                if (error instanceof Error) {\n                    channel.close(error);\n                }\n                else if (typeof error === \"string\") {\n                    channel.close(new Error(error));\n                }\n                else {\n                    // @ts-ignore\n                    channel.close(new Error(\"unknown error\", { cause: error }));\n                }\n            }\n        }\n        else {\n            result !== null && result !== void 0 ? result : (result = { value: void 0 });\n            if (promise) {\n                promise.resolve(result.value);\n            }\n            if (channel) {\n                channel.close();\n            }\n        }\n    };\n    const safeRemoteCall = async (worker, req, transferable = []) => {\n        try {\n            if (typeof worker[\"postMessage\"] === \"function\") {\n                worker.postMessage(req, transferable);\n            }\n            else {\n                await new Promise((resolve, reject) => {\n                    worker.send(req, err => {\n                        err ? reject(err) : resolve();\n                    });\n                });\n            }\n        }\n        catch (err) {\n            if (typeof worker[\"unref\"] === \"function\") {\n                worker.unref();\n            }\n            error = err;\n            (options === null || options === void 0 ? void 0 : options.keepAlive) || await terminate();\n            handleClose(null, !(options === null || options === void 0 ? void 0 : options.keepAlive));\n            throw err;\n        }\n    };\n    if (isNode || isBun) {\n        if (adapter === \"child_process\") {\n            const record = await poolRecord.getWorker;\n            const worker = record.worker;\n            workerId = record.workerId;\n            worker.ref(); // prevent premature exit in the main thread\n            worker.on(\"message\", handleMessage);\n            worker.once(\"exit\", (code, signal) => {\n                if (!error && !result) {\n                    handleClose(new Error(`worker exited (${code !== null && code !== void 0 ? code : signal})`), true);\n                }\n            });\n            release = () => {\n                // allow the main thread to exit if the event loop is empty\n                worker.unref();\n                // Remove the event listener so that later calls will not mess\n                // up.\n                worker.off(\"message\", handleMessage);\n                worker.removeAllListeners(\"exit\");\n                poolRecord && (poolRecord.busy = false);\n            };\n            terminate = () => Promise.resolve(void worker.kill(1));\n            if (error) {\n                // The worker take too long to start and timeout error already\n                // thrown.\n                await terminate();\n                throw error;\n            }\n            const { args } = wrapArgs(req.args, Promise.resolve(worker));\n            req.args = args;\n            await safeRemoteCall(worker, req);\n        }\n        else if (isNode) {\n            const record = await poolRecord.getWorker;\n            const worker = record.worker;\n            const handleErrorEvent = (err) => {\n                if (!error && !result) {\n                    // In Node.js, worker will exit once erred.\n                    handleClose(err, true);\n                }\n            };\n            workerId = record.workerId;\n            worker.ref();\n            worker.on(\"message\", handleMessage);\n            worker.once(\"error\", handleErrorEvent);\n            release = () => {\n                worker.unref();\n                worker.off(\"message\", handleMessage);\n                worker.off(\"error\", handleErrorEvent);\n                poolRecord && (poolRecord.busy = false);\n            };\n            terminate = async () => void (await worker.terminate());\n            if (error) {\n                await terminate();\n                throw error;\n            }\n            const { args, transferable, } = wrapArgs(req.args, Promise.resolve(worker));\n            req.args = args;\n            await safeRemoteCall(worker, req, transferable);\n        }\n        else { // isBun\n            const record = await poolRecord.getWorker;\n            const worker = record.worker;\n            const handleCloseEvent = ((ev) => {\n                if (!error && !result) {\n                    handleClose(new Error(ev.reason + \" (\" + ev.code + \")\"), true);\n                }\n            });\n            workerId = record.workerId;\n            worker.ref();\n            worker.onmessage = (ev) => handleMessage(ev.data);\n            worker.onerror = () => void worker.terminate(); // terminate once erred\n            worker.addEventListener(\"close\", handleCloseEvent);\n            release = () => {\n                worker.unref();\n                worker.onmessage = null;\n                // @ts-ignore\n                worker.onerror = null;\n                worker.removeEventListener(\"close\", handleCloseEvent);\n                poolRecord && (poolRecord.busy = false);\n            };\n            terminate = () => Promise.resolve(worker.terminate());\n            if (error) {\n                await terminate();\n                throw error;\n            }\n            const { args, transferable, } = wrapArgs(req.args, Promise.resolve(worker));\n            req.args = args;\n            await safeRemoteCall(worker, req, transferable);\n        }\n    }\n    else {\n        const record = await poolRecord.getWorker;\n        const worker = record.worker;\n        workerId = record.workerId;\n        worker.onmessage = (ev) => handleMessage(ev.data);\n        worker.onerror = (ev) => {\n            var _a;\n            if (!error && !result) {\n                worker.terminate(); // ensure termination\n                handleClose((_a = fromErrorEvent(ev)) !== null && _a !== void 0 ? _a : new Error(\"worker exited\"), true);\n            }\n        };\n        release = () => {\n            worker.onmessage = null;\n            // @ts-ignore\n            worker.onerror = null;\n            poolRecord && (poolRecord.busy = false);\n        };\n        terminate = () => Promise.resolve(worker.terminate());\n        if (error) {\n            await terminate();\n            throw error;\n        }\n        const { args, transferable, } = wrapArgs(req.args, Promise.resolve(worker));\n        req.args = args;\n        await safeRemoteCall(worker, req, transferable);\n    }\n    const task = {\n        workerId,\n        abort(reason = undefined) {\n            controller.abort(reason);\n        },\n        async result() {\n            const task = asyncTask();\n            if (error) {\n                task.reject(error);\n            }\n            else if (result) {\n                task.resolve(result.value);\n            }\n            else {\n                promise = task;\n            }\n            return await task;\n        },\n        iterate() {\n            if (promise) {\n                throw new Error(\"result() has been called\");\n            }\n            else if (result) {\n                throw new TypeError(\"The response is not iterable.\");\n            }\n            channel = chan(Infinity);\n            return {\n                [Symbol.asyncIterator]: channel[Symbol.asyncIterator].bind(channel),\n            };\n        },\n    };\n    return task;\n}\n(function (run) {\n    /**\n     * The maximum number of workers allowed to exist at the same time.\n     * If not set, use the same setting as {@link parallel.maxWorkers}.\n     */\n    run.maxWorkers = undefined;\n})(run || (run = {}));\nexport default run;\n//# sourceMappingURL=run.js.map","/**\n * Marks a function as deprecated and emit warnings when it is called.\n * @module\n * @experimental\n */\nimport runtime from \"./runtime.ts\";\nimport wrap from \"./wrap.ts\";\nconst warnedRecord = new Map();\nexport default function deprecate(target, ...args) {\n    var _a, _b, _c, _d;\n    const { identity } = runtime();\n    if (typeof target === \"function\") {\n        const tip = (_a = args[0]) !== null && _a !== void 0 ? _a : \"\";\n        const once = (_b = args[1]) !== null && _b !== void 0 ? _b : false;\n        return wrap(target, function wrapped(fn, ...args) {\n            const lineOffset = ({\n                \"node\": 2,\n                \"deno\": 2,\n                \"chrome\": 2,\n                \"workerd\": 2,\n                \"bun\": 1,\n                \"safari\": 1,\n                \"firefox\": 3,\n                \"fastly\": 3,\n                \"unknown\": 3,\n            })[identity];\n            emitWarning(fn.name + \"()\", wrapped, tip, once, lineOffset, identity, true);\n            return fn.apply(this, args);\n        });\n    }\n    const forFn = args[0];\n    const tip = (_c = args[1]) !== null && _c !== void 0 ? _c : \"\";\n    const once = (_d = args[2]) !== null && _d !== void 0 ? _d : false;\n    const lineOffset = ({\n        \"node\": 1,\n        \"deno\": 1,\n        \"chrome\": 1,\n        \"workerd\": 1,\n        \"bun\": 1,\n        \"safari\": 1,\n        \"firefox\": 3,\n        \"fastly\": 3,\n        \"unknown\": 3,\n    })[identity];\n    return emitWarning(target, forFn, tip, once, lineOffset, identity, false);\n}\nfunction emitWarning(target, forFn, tip, once, lineNum, runtime, wrapped = false) {\n    if (!once || !warnedRecord.has(forFn)) {\n        let trace = {};\n        if (typeof Error.captureStackTrace === \"function\") {\n            Error.captureStackTrace(trace, forFn);\n        }\n        else {\n            trace = new Error(\"\");\n        }\n        let lines = trace.stack.split(\"\\n\");\n        const offset = lines.findIndex(line => line === \"Error\");\n        if (offset !== -1 && offset !== 0) {\n            lines = lines.slice(offset); // fix for tsx in Node.js v16\n        }\n        let line;\n        if (runtime === \"safari\") {\n            line = lines.find(line => line.trim().startsWith(\"module code@\"))\n                || lines[lineNum];\n        }\n        else if (runtime === \"bun\" && !wrapped) {\n            line = lines.find(line => line.trim().startsWith(\"at module code\"))\n                || lines[lineNum];\n        }\n        else {\n            line = lines[lineNum];\n        }\n        let warning = `${target} is deprecated`;\n        if (tip) {\n            warning += \", \" + tip;\n        }\n        if (line) {\n            line = line.trim();\n            let start = line.indexOf(\"(\");\n            if (start !== -1) {\n                start += 1;\n                const end = line.indexOf(\")\", start);\n                line = line.slice(start, end);\n            }\n            warning += \" (\" + line + \")\";\n        }\n        console.warn(\"DeprecationWarning:\", warning);\n        once && warnedRecord.set(forFn, true);\n    }\n}\n//# sourceMappingURL=deprecate.js.map","import _try from \"./try.ts\";\nimport func from \"./func.ts\";\nimport wrap from \"./wrap.ts\";\nimport mixin from \"./mixin.ts\";\nimport throttle from \"./throttle.ts\";\nimport debounce from \"./debounce.ts\";\nimport queue from \"./queue.ts\";\nimport lock from \"./lock.ts\";\nimport chan from \"./chan.ts\";\nimport parallel from \"./parallel.ts\";\nimport run from \"./run.ts\";\nimport deprecate from \"./deprecate.ts\";\nimport pipe from \"./pipe.ts\";\nexport * from \"./types.ts\";\n/**\n * The entry of jsext major functions.\n */\nconst jsext = {\n    _try,\n    /** @deprecated Use `_try` instead */\n    try: _try,\n    func,\n    wrap,\n    mixin,\n    throttle,\n    debounce,\n    queue,\n    lock,\n    chan,\n    parallel,\n    run,\n    deprecate,\n    pipe,\n};\nexport { jsext as default, _try, func, wrap, mixin, throttle, debounce, queue, lock, chan, parallel, run, deprecate, pipe, };\n//# sourceMappingURL=index.js.map","/**\n * Inspired by Golang, creates a function that receives a `defer` keyword which\n * can be used to carry deferred jobs.\n * @module\n */\n// @ts-ignore\nimport { isAsyncGenerator, isGenerator } from \"./external/check-iterable/index.mjs\";\n/**\n * Inspired by Golang, creates a function that receives a `defer` keyword which\n * can be used to carry deferred jobs that will be run after the main function\n * is complete.\n *\n * Multiple calls of the `defer` keyword is supported, and the callbacks are\n * called in the LIFO order. Callbacks can be async functions if the main\n * function is an async function or an async generator function, and all the\n * running procedures will be awaited.\n *\n * @example\n * ```ts\n * import func from \"@ayonli/jsext/func\";\n * import * as fs from \"node:fs/promises\";\n *\n * export const getVersion = func(async (defer) => {\n *     const file = await fs.open(\"./package.json\", \"r\");\n *     defer(() => file.close());\n *\n *     const content = await file.readFile(\"utf8\");\n *     const pkg = JSON.parse(content);\n *\n *     return pkg.version as string;\n * });\n * ```\n */\nexport default function func(fn) {\n    return function (...args) {\n        var _a;\n        const callbacks = [];\n        const defer = (cb) => void callbacks.push(cb);\n        let result;\n        try {\n            const returns = fn.call(this, defer, ...args);\n            if (isAsyncGenerator(returns)) {\n                const gen = (async function* () {\n                    var _a;\n                    let input;\n                    // Use `while` loop instead of `for...of...` in order to\n                    // retrieve the return value of a generator function.\n                    while (true) {\n                        try {\n                            const { done, value } = await returns.next(input);\n                            if (done) {\n                                result = { value, error: null };\n                                break;\n                            }\n                            else {\n                                // Receive any potential input value that passed\n                                // to the outer `next()` call, and pass them to\n                                // `res.next()` in the next call.\n                                input = yield Promise.resolve(value);\n                            }\n                        }\n                        catch (error) {\n                            // If any error occurs, capture that error and break\n                            // the loop immediately, indicating the process is\n                            // forced broken.\n                            result = { value: void 0, error };\n                            break;\n                        }\n                    }\n                    for (let i = callbacks.length - 1; i >= 0; i--) {\n                        await ((_a = callbacks[i]) === null || _a === void 0 ? void 0 : _a.call(callbacks));\n                    }\n                    if (result.error) {\n                        throw result.error;\n                    }\n                    else {\n                        return result.value;\n                    }\n                })();\n                return gen;\n            }\n            else if (isGenerator(returns)) {\n                const gen = (function* () {\n                    var _a;\n                    let input;\n                    while (true) {\n                        try {\n                            const { done, value } = returns.next(input);\n                            if (done) {\n                                result = { value, error: null };\n                                break;\n                            }\n                            else {\n                                input = yield value;\n                            }\n                        }\n                        catch (error) {\n                            result = { value: void 0, error };\n                            break;\n                        }\n                    }\n                    for (let i = callbacks.length - 1; i >= 0; i--) {\n                        (_a = callbacks[i]) === null || _a === void 0 ? void 0 : _a.call(callbacks);\n                    }\n                    if (result.error) {\n                        throw result.error;\n                    }\n                    else {\n                        return result.value;\n                    }\n                })();\n                return gen;\n            }\n            else if (typeof (returns === null || returns === void 0 ? void 0 : returns.then) === \"function\") {\n                return Promise.resolve(returns).then(value => ({\n                    value,\n                    error: null,\n                })).catch((error) => ({\n                    value: void 0,\n                    error,\n                })).then(async (result) => {\n                    var _a;\n                    for (let i = callbacks.length - 1; i >= 0; i--) {\n                        await ((_a = callbacks[i]) === null || _a === void 0 ? void 0 : _a.call(callbacks));\n                    }\n                    if (result.error) {\n                        throw result.error;\n                    }\n                    else {\n                        return result.value;\n                    }\n                });\n            }\n            else {\n                result = { value: returns, error: null };\n            }\n        }\n        catch (error) {\n            result = { value: void 0, error };\n        }\n        for (let i = callbacks.length - 1; i >= 0; i--) {\n            (_a = callbacks[i]) === null || _a === void 0 ? void 0 : _a.call(callbacks);\n        }\n        if (result.error) {\n            throw result.error;\n        }\n        else {\n            return result.value;\n        }\n    };\n}\n//# sourceMappingURL=func.js.map","var _a, _b;\nimport bytes, { concat as concatBytes } from \"../bytes.ts\";\nimport { Exception } from \"../error.ts\";\nimport { makeTree } from \"../fs/util.ts\";\nimport { omit } from \"../object.ts\";\nimport { basename, dirname } from \"../path.ts\";\nimport { concat as concatStreams, toReadableStream } from \"../reader.ts\";\nimport { stripEnd } from \"../string.ts\";\nconst _stream = Symbol.for(\"stream\");\nconst _bodyUsed = Symbol.for(\"bodyUsed\");\nvar FileTypes;\n(function (FileTypes) {\n    FileTypes[FileTypes[\"file\"] = 0] = \"file\";\n    FileTypes[FileTypes[\"link\"] = 1] = \"link\";\n    FileTypes[FileTypes[\"symlink\"] = 2] = \"symlink\";\n    FileTypes[FileTypes[\"character-device\"] = 3] = \"character-device\";\n    FileTypes[FileTypes[\"block-device\"] = 4] = \"block-device\";\n    FileTypes[FileTypes[\"directory\"] = 5] = \"directory\";\n    FileTypes[FileTypes[\"fifo\"] = 6] = \"fifo\";\n    FileTypes[FileTypes[\"contiguous-file\"] = 7] = \"contiguous-file\";\n})(FileTypes || (FileTypes = {}));\nexport const HEADER_LENGTH = 512;\nconst USTAR_MAGIC_HEADER = \"ustar\\x00\";\nconst USTarFileHeaderFieldLengths = {\n    name: 100, // 0\n    mode: 8, // 100\n    uid: 8, // 108\n    gid: 8, // 116\n    size: 12, // 124\n    mtime: 12, // 136\n    checksum: 8, // 148\n    typeflag: 1, // 156\n    linkname: 100, // 157\n    magic: 6, // 257\n    version: 2, // 263\n    uname: 32, // 265\n    gname: 32, // 297\n    devmajor: 8, // 329\n    devminor: 8, // 337\n    prefix: 155, // 345\n    padding: 12, // 500\n};\n// https://pubs.opengroup.org/onlinepubs/9699919799/utilities/pax.html#tag_20_92_13_06\n// eight checksum bytes taken to be ascii spaces (decimal value 32)\nconst initialChecksum = 8 * 32;\nconst FilenameTooLongError = new Exception(\"UStar format does not allow a long file name (length of [file name\"\n    + \"prefix] + / + [file name] must be shorter than 256 bytes)\", {\n    name: \"FilenameTooLongError\",\n    code: 431\n});\nfunction toFixedOctal(num, bytes) {\n    return num.toString(8).padStart(bytes, \"0\");\n}\nfunction trimBytes(data) {\n    const index = data.indexOf(0);\n    return index === -1 ? data : data.subarray(0, index);\n}\nfunction formatHeader(data) {\n    const buffer = new Uint8Array(HEADER_LENGTH);\n    let offset = 0;\n    for (const [field, length] of Object.entries(USTarFileHeaderFieldLengths)) {\n        const entry = bytes(data[field] || \"\");\n        buffer.set(entry, offset);\n        offset += length;\n    }\n    return buffer;\n}\nexport function parseHeader(header) {\n    const decoder = new TextDecoder();\n    const data = {};\n    let offset = 0;\n    for (const [field, length] of Object.entries(USTarFileHeaderFieldLengths)) {\n        let buffer = header.subarray(offset, offset + length);\n        if (field !== \"magic\") {\n            buffer = trimBytes(buffer);\n        }\n        const value = decoder.decode(buffer).trim();\n        data[field] = value;\n        offset += length;\n    }\n    // validate checksum\n    const checksum = getChecksum(header);\n    if (checksum !== parseInt(data.checksum, 8)) {\n        if (checksum === initialChecksum) {\n            // EOF\n            return null;\n        }\n        throw new Error(\"The archive is corrupted\");\n    }\n    if (!data.magic.startsWith(\"ustar\")) {\n        throw new TypeError(\"Unsupported archive format: \" + data.magic);\n    }\n    return [data, header.subarray(0, offset), header.subarray(offset)];\n}\nfunction getChecksum(header) {\n    let sum = initialChecksum;\n    for (let i = 0; i < HEADER_LENGTH; i++) {\n        if (i >= 148 && i < 156) {\n            // Ignore checksum header\n            continue;\n        }\n        sum += header[i];\n    }\n    return sum;\n}\nexport function createEntry(headerInfo) {\n    var _c;\n    const relativePath = (headerInfo.prefix ? headerInfo.prefix + \"/\" : \"\")\n        + stripEnd(headerInfo.name, \"/\");\n    return {\n        name: basename(relativePath),\n        kind: ((_c = FileTypes[parseInt(headerInfo.typeflag)]) !== null && _c !== void 0 ? _c : \"file\"),\n        relativePath,\n        size: parseInt(headerInfo.size, 8),\n        mtime: new Date(parseInt(headerInfo.mtime, 8) * 1000),\n        mode: parseInt(headerInfo.mode, 8),\n        uid: parseInt(headerInfo.uid, 8),\n        gid: parseInt(headerInfo.gid, 8),\n        owner: headerInfo.uname.trim(),\n        group: headerInfo.gname.trim(),\n    };\n}\nexport const _entries = Symbol.for(\"entries\");\n/**\n * A `Tarball` instance represents a tar archive.\n *\n * @example\n * ```ts\n * // create a tarball\n * import { stat, createReadableStream, createWriteableStream } from \"@ayonli/jsext/fs\";\n * import { Tarball } from \"@ayonli/jsext/archive\";\n *\n * const tarball = new Tarball();\n *\n * const file1 = await stat(\"foo.txt\");\n * const stream1 = createReadableStream(\"foo.txt\");\n * tarball.append(stream1, { relativePath: \"foo.txt\", size: file1.size });\n *\n * const file2 = await stat(\"bar.txt\");\n * const stream2 = createReadableStream(\"bar.txt\");\n * tarball.append(stream2, { relativePath: \"bar.txt\", size: file2.size });\n *\n * const output = createWritableStream(\"archive.tar\");\n * await tarball.stream().pipeTo(output);\n * ```\n *\n * @example\n * ```ts\n * // load a tarball\n * import { createReadableStream } from \"@ayonli/jsext/fs\";\n * import { Tarball } from \"@ayonli/jsext/archive\";\n *\n * const input = createReadableStream(\"archive.tar\");\n * const tarball = await Tarball.load(input);\n *\n * for (const entry of tarball) {\n *     console.log(entry);\n * }\n * ```\n */\nexport default class Tarball {\n    constructor() {\n        this[_a] = [];\n        this[_b] = false;\n        if (typeof ReadableStream === \"undefined\") {\n            throw new TypeError(\"ReadableStream is not supported in this environment.\");\n        }\n    }\n    constructEntry(relativePath, data, info) {\n        var _c, _d, _e, _f, _g;\n        // UStar format has a limitation of file name length. Specifically:\n        // \n        // 1. File names can contain at most 255 bytes.\n        // 2. File names longer than 100 bytes must be split at a directory separator in two parts,\n        //   the first being at most 155 bytes long. So, in most cases file names must be a bit shorter\n        //   than 255 bytes.\n        // \n        // So we need to separate file name into two parts if needed.\n        let name = relativePath;\n        let prefix = \"\";\n        if (name.length > 100) {\n            let i = name.length;\n            while (i >= 0) {\n                i = name.lastIndexOf(\"/\", i);\n                if (i <= 155) {\n                    prefix = name.slice(0, i);\n                    name = name.slice(i + 1);\n                    break;\n                }\n                i--;\n            }\n            if (i < 0 || name.length > 100) {\n                throw FilenameTooLongError;\n            }\n            else if (prefix.length > 155) {\n                throw FilenameTooLongError;\n            }\n        }\n        let body;\n        let size = 0;\n        if (typeof data === \"string\") {\n            const _data = bytes(data);\n            body = toReadableStream([_data]);\n            size = _data.byteLength;\n        }\n        else if (data instanceof ArrayBuffer) {\n            body = toReadableStream([new Uint8Array(data)]);\n            size = data.byteLength;\n        }\n        else if (data instanceof Uint8Array) {\n            body = toReadableStream([data]);\n            size = data.byteLength;\n        }\n        else if (ArrayBuffer.isView(data)) {\n            const _data = new Uint8Array(data.buffer, data.byteOffset, data.byteLength);\n            body = toReadableStream([_data]);\n            size = _data.byteLength;\n        }\n        else if (typeof Blob === \"function\" && data instanceof Blob) {\n            body = data.stream();\n            size = data.size;\n        }\n        else if (data instanceof ReadableStream) {\n            body = data;\n            if (info.size != undefined) {\n                size = info.size;\n            }\n            else {\n                throw new TypeError(\"size must be provided for ReadableStream data.\");\n            }\n        }\n        else {\n            throw new TypeError(\"data must be a string, Uint8Array, ArrayBuffer, ArrayBufferView, Blob, or ReadableStream.\");\n        }\n        const kind = (_c = info.kind) !== null && _c !== void 0 ? _c : \"file\";\n        const mode = (_d = info.mode) !== null && _d !== void 0 ? _d : (kind === \"directory\" ? 0o755 : 0o666);\n        const mtime = (_e = info.mtime) !== null && _e !== void 0 ? _e : new Date();\n        if (kind === \"directory\") {\n            size = 0; // ensure size is 0 for directories\n        }\n        const headerInfo = {\n            name,\n            mode: toFixedOctal(mode, USTarFileHeaderFieldLengths.mode),\n            uid: toFixedOctal((_f = info.uid) !== null && _f !== void 0 ? _f : 0, USTarFileHeaderFieldLengths.uid),\n            gid: toFixedOctal((_g = info.gid) !== null && _g !== void 0 ? _g : 0, USTarFileHeaderFieldLengths.gid),\n            size: toFixedOctal(size, USTarFileHeaderFieldLengths.size),\n            mtime: toFixedOctal(Math.floor((mtime.getTime()) / 1000), USTarFileHeaderFieldLengths.mtime),\n            checksum: \"        \",\n            typeflag: kind in FileTypes ? String(FileTypes[kind]) : \"0\",\n            linkname: kind === \"link\" || kind === \"symlink\" ? name : \"\",\n            magic: USTAR_MAGIC_HEADER,\n            version: \"00\",\n            uname: info.owner || \"\",\n            gname: info.group || \"\",\n            devmajor: \"00000000\",\n            devminor: \"00000000\",\n            prefix,\n        };\n        // calculate the checksum\n        let checksum = 0;\n        const encoder = new TextEncoder();\n        Object.values(headerInfo).forEach((data) => {\n            checksum += encoder.encode(data).reduce((p, c) => p + c, 0);\n        });\n        headerInfo.checksum = toFixedOctal(checksum, USTarFileHeaderFieldLengths.checksum);\n        const header = formatHeader(headerInfo);\n        const fileName = info.name\n            || (typeof File === \"function\" && data instanceof File\n                ? data.name\n                : basename(relativePath));\n        return {\n            name: fileName,\n            kind,\n            relativePath,\n            size,\n            mtime,\n            mode,\n            uid: info.uid || 0,\n            gid: info.gid || 0,\n            owner: info.owner || \"\",\n            group: info.group || \"\",\n            header,\n            body,\n        };\n    }\n    append(data, info = {}) {\n        if (data === null) {\n            if (info.kind === \"directory\") {\n                data = new Uint8Array(0);\n            }\n            else {\n                throw new TypeError(\"data must be provided for files.\");\n            }\n        }\n        let relativePath = info.relativePath;\n        if (!relativePath) {\n            if (typeof File === \"function\" && data instanceof File) {\n                relativePath = (data.webkitRelativePath || data.name);\n            }\n            else {\n                throw new TypeError(\"info.relativePath must be provided.\");\n            }\n        }\n        const dir = dirname(relativePath).replace(/\\\\/g, \"/\");\n        // If the input path has parent directories that are not in the archive,\n        // we need to add them first.\n        if (dir && dir !== \".\" && !this[_entries].some((entry) => entry.relativePath === dir)) {\n            this.append(null, {\n                kind: \"directory\",\n                relativePath: dir,\n            });\n        }\n        const entry = this.constructEntry(relativePath, data, info);\n        this[_entries].push(entry);\n    }\n    /**\n     * Retrieves an entry in the archive by its relative path.\n     *\n     * The returned entry object contains a `stream` property which is a copy of\n     * the entry's data, and since it's a copy, the data in the archive is still\n     * available even after the `stream` property is consumed.\n     *\n     * However, due to the nature of the `ReadableStream.tee()` API, if the copy\n     * is consumed, the data will be loaded and cached in memory until the\n     * tarball's stream is consumed or dropped. This may cause memory issues for\n     * large files, so it is recommended not to use the `stream` property unless\n     * necessary.\n     */\n    retrieve(relativePath) {\n        const _entry = this[_entries].find((entry) => entry.relativePath === relativePath);\n        if (!_entry) {\n            return null;\n        }\n        const entry = omit(_entry, [\"header\", \"body\"]);\n        Object.defineProperty(entry, \"stream\", {\n            get() {\n                if (entry[_stream]) {\n                    return entry[_stream];\n                }\n                else {\n                    const [copy1, copy2] = _entry.body.tee();\n                    _entry.body = copy1;\n                    return (entry[_stream] = copy2);\n                }\n            },\n        });\n        return entry;\n    }\n    /**\n     * Removes an entry from the archive by its relative path.\n     *\n     * This function returns `true` if the entry is successfully removed, or `false` if the entry\n     * does not exist.\n     */\n    remove(relativePath) {\n        const index = this[_entries].findIndex((entry) => entry.relativePath === relativePath);\n        if (index === -1) {\n            return false;\n        }\n        else {\n            this[_entries].splice(index, 1);\n            return true;\n        }\n    }\n    /**\n     * Replaces an entry in the archive with new data.\n     *\n     * This function returns `true` if the entry is successfully replaced, or `false` if the entry\n     * does not exist or the entry kind of the new data is incompatible with the old one.\n     */\n    replace(relativePath, data, info = {}) {\n        const index = this[_entries].findIndex((entry) => entry.relativePath === relativePath);\n        const oldEntry = index === -1 ? undefined : this[_entries][index];\n        if (!oldEntry) {\n            return false;\n        }\n        else if (oldEntry.kind === \"directory\" && info.kind !== \"directory\") {\n            return false;\n        }\n        else if (oldEntry.kind !== \"directory\" && info.kind === \"directory\") {\n            return false;\n        }\n        else if (data === null) {\n            if (info.kind === \"directory\") {\n                data = new Uint8Array(0);\n            }\n            else {\n                throw new TypeError(\"data must be provided for files.\");\n            }\n        }\n        const newEntry = this.constructEntry(relativePath, data, info);\n        this[_entries][index] = newEntry;\n        return true;\n    }\n    [(_a = _entries, _b = _bodyUsed, Symbol.iterator)]() {\n        return this.entries();\n    }\n    /**\n     * Iterates over the entries in the archive.\n     */\n    *entries() {\n        const iter = this[_entries][Symbol.iterator]();\n        for (const entry of iter) {\n            yield omit(entry, [\"header\", \"body\"]);\n        }\n    }\n    /**\n     * Returns a tree view of the entries in the archive.\n     *\n     * NOTE: The entries returned by this function are reordered first by kind\n     * (directories before files), then by names alphabetically.\n     */\n    treeView() {\n        const now = new Date();\n        const entries = [...this.entries()];\n        const { children, ...rest } = makeTree(\"\", entries);\n        return {\n            ...rest,\n            size: 0,\n            mtime: now,\n            mode: 0o755,\n            uid: 0,\n            gid: 0,\n            owner: \"\",\n            group: \"\",\n            children: children !== null && children !== void 0 ? children : [],\n        };\n    }\n    /**\n     * Returns the approximate size of the archive in bytes.\n     *\n     * NOTE: This value may not reflect the actual size of the archive file\n     * when constructed via the {@link load} method.\n     */\n    get size() {\n        return this[_entries].reduce((size, entry) => {\n            size += entry.header.byteLength;\n            size += entry.size;\n            const paddingSize = HEADER_LENGTH - (entry.size % HEADER_LENGTH || HEADER_LENGTH);\n            if (paddingSize > 0) {\n                size += paddingSize;\n            }\n            return size;\n        }, 0);\n    }\n    /**\n     * Indicates whether the body of the tarball has been used. This property\n     * will be set to `true` after the `stream()` method is called.\n     */\n    get bodyUsed() {\n        return this[_bodyUsed];\n    }\n    /**\n     * Returns a readable stream of the archive that can be piped to a writable\n     * target.\n     *\n     * This method can only be called once per instance, as after the stream\n     * has been consumed, the underlying data of the archive's entries will no\n     * longer be available, and subsequent calls to this method will throw an\n     * error.\n     *\n     * To reuse the stream, use the `tee()` method of the stream to create a\n     * copy of the stream instead.\n     */\n    stream(options = {}) {\n        if (this[_bodyUsed]) {\n            throw new TypeError(\"The body of the tarball has been used.\");\n        }\n        this[_bodyUsed] = true;\n        const streams = [];\n        for (const { size, header, body } of this[_entries]) {\n            streams.push(toReadableStream([header]));\n            streams.push(body);\n            const paddingSize = HEADER_LENGTH - (size % HEADER_LENGTH || HEADER_LENGTH);\n            if (paddingSize > 0) {\n                streams.push(toReadableStream([new Uint8Array(paddingSize)]));\n            }\n        }\n        const stream = concatStreams(...streams);\n        if (options.gzip) {\n            const gzip = new CompressionStream(\"gzip\");\n            return stream.pipeThrough(gzip);\n        }\n        else {\n            return stream;\n        }\n    }\n    /**\n     * Loads a tar archive from a readable stream.\n     *\n     * NOTE: This function loads the entire archive into memory, so it is not\n     * suitable for large archives. For large archives, use the `untar` function\n     * to extract files to the file system instead.\n     */\n    static async load(stream, options = {}) {\n        if (options.gzip) {\n            const gzip = new DecompressionStream(\"gzip\");\n            stream = stream.pipeThrough(gzip);\n        }\n        const tarball = new Tarball();\n        const reader = stream.getReader();\n        let lastChunk = new Uint8Array(0);\n        let header = null;\n        let headerInfo = null;\n        let entry = null;\n        let writer = null;\n        let writtenBytes = 0;\n        let paddingSize = 0;\n        try {\n            outer: while (true) {\n                const { done, value } = await reader.read();\n                if (done) {\n                    break;\n                }\n                lastChunk = lastChunk.byteLength ? concatBytes(lastChunk, value) : value;\n                while (true) {\n                    if (paddingSize > 0 && lastChunk.byteLength >= paddingSize) {\n                        lastChunk = lastChunk.subarray(paddingSize);\n                        paddingSize = 0;\n                    }\n                    if (!entry) {\n                        if (lastChunk.byteLength >= HEADER_LENGTH) {\n                            const _header = parseHeader(lastChunk);\n                            if (_header) {\n                                [headerInfo, header, lastChunk] = _header;\n                                entry = createEntry(headerInfo);\n                            }\n                            else {\n                                lastChunk = new Uint8Array(0);\n                                break outer;\n                            }\n                        }\n                        else {\n                            break;\n                        }\n                    }\n                    const fileSize = entry.size;\n                    if (writer) {\n                        let leftBytes = fileSize - writtenBytes;\n                        if (lastChunk.byteLength > leftBytes) {\n                            const chunk = lastChunk.subarray(0, leftBytes);\n                            writer.push(chunk);\n                            writtenBytes += chunk.byteLength;\n                            lastChunk = lastChunk.subarray(leftBytes);\n                        }\n                        else {\n                            writer.push(lastChunk);\n                            writtenBytes += lastChunk.byteLength;\n                            lastChunk = new Uint8Array(0);\n                        }\n                    }\n                    else {\n                        writer = [];\n                        continue;\n                    }\n                    if (writtenBytes === fileSize) {\n                        const _entry = {\n                            ...entry,\n                            header: header,\n                            body: toReadableStream(writer),\n                        };\n                        tarball[_entries].push(_entry);\n                        paddingSize = HEADER_LENGTH - (fileSize % HEADER_LENGTH || HEADER_LENGTH);\n                        writtenBytes = 0;\n                        headerInfo = null;\n                        header = null;\n                        entry = null;\n                        writer = null;\n                    }\n                    else {\n                        break;\n                    }\n                }\n            }\n            if (lastChunk.byteLength) {\n                throw new Error(\"The archive is corrupted\");\n            }\n            return tarball;\n        }\n        finally {\n            reader.releaseLock();\n        }\n    }\n}\n//# sourceMappingURL=Tarball.js.map","import bytes from \"../bytes.ts\";\nexport var ControlKeys;\n(function (ControlKeys) {\n    /** ^I - Tab */\n    ControlKeys.TAB = bytes(\"\\t\");\n    /** ^J - Enter on Linux */\n    ControlKeys.LF = bytes(\"\\n\");\n    /** ^M - Enter on macOS and Windows (CRLF) */\n    ControlKeys.CR = bytes(\"\\r\");\n    /** ^H - Backspace on Linux and Windows */\n    ControlKeys.BS = bytes(\"\\b\");\n    /** ^? - Backspace on macOS */\n    ControlKeys.DEL = bytes([0x7f]);\n    /** ^[ - Escape */\n    ControlKeys.ESC = bytes([0x1b]);\n    /** ^C - Cancel */\n    ControlKeys.CTRL_C = bytes([0x03]);\n    /** ^A - Start of line */\n    ControlKeys.CTRL_A = bytes([0x01]);\n    /** ^E - End of line */\n    ControlKeys.CTRL_E = bytes([0x05]);\n})(ControlKeys || (ControlKeys = {}));\nexport var NavigationKeys;\n(function (NavigationKeys) {\n    NavigationKeys.UP = bytes(\"\\u001b[A\");\n    NavigationKeys.DOWN = bytes(\"\\u001b[B\");\n    NavigationKeys.LEFT = bytes(\"\\u001b[D\");\n    NavigationKeys.RIGHT = bytes(\"\\u001b[C\");\n    NavigationKeys.HOME = bytes(\"\\u001b[H\");\n    NavigationKeys.END = bytes(\"\\u001b[F\");\n    NavigationKeys.PAGE_UP = bytes(\"\\u001b[5~\");\n    NavigationKeys.PAGE_DOWN = bytes(\"\\u001b[6~\");\n    NavigationKeys.INSERT = bytes(\"\\u001b[2~\");\n    NavigationKeys.DELETE = bytes(\"\\u001b[3~\");\n})(NavigationKeys || (NavigationKeys = {}));\nexport var FunctionKeys;\n(function (FunctionKeys) {\n    FunctionKeys.F1 = bytes(\"\\u001bOP\");\n    FunctionKeys.F2 = bytes(\"\\u001bOQ\");\n    FunctionKeys.F3 = bytes(\"\\u001bOR\");\n    FunctionKeys.F4 = bytes(\"\\u001bOS\");\n    FunctionKeys.F5 = bytes(\"\\u001b[15~\");\n    FunctionKeys.F6 = bytes(\"\\u001b[17~\");\n    FunctionKeys.F7 = bytes(\"\\u001b[18~\");\n    FunctionKeys.F8 = bytes(\"\\u001b[19~\");\n    FunctionKeys.F9 = bytes(\"\\u001b[20~\");\n    FunctionKeys.F10 = bytes(\"\\u001b[21~\");\n    FunctionKeys.F11 = bytes(\"\\u001b[23~\");\n    FunctionKeys.F12 = bytes(\"\\u001b[24~\");\n})(FunctionKeys || (FunctionKeys = {}));\nexport var ControlSequences;\n(function (ControlSequences) {\n    /** Clear the current line */\n    ControlSequences.CLR = bytes(\"\\r\\u001b[K\");\n    /** Clear the right side of the cursor */\n    ControlSequences.CLR_RIGHT = bytes(\"\\u001b[0K\");\n    /** Clear the left side of the cursor */\n    ControlSequences.CLR_LEFT = bytes(\"\\u001b[1K\");\n    /** Clear the screen from the cursor down */\n    ControlSequences.CLR_DOWN = bytes(\"\\u001b[0J\");\n    /** Clear the screen from the cursor up */\n    ControlSequences.CLR_UP = bytes(\"\\u001b[1J\");\n    /** Clear the entire screen */\n    ControlSequences.CLR_SCREEN = bytes(\"\\u001b[2J\");\n    /** Hide the cursor */\n    ControlSequences.HIDE_CURSOR = bytes(\"\\u001b[?25l\");\n    /** Show the cursor */\n    ControlSequences.SHOW_CURSOR = bytes(\"\\u001b[?25h\");\n    /** Enable mouse tracking */\n    ControlSequences.MOUSE_ON = bytes(\"\\u001b[?1000h\");\n    /** Disable mouse tracking */\n    ControlSequences.MOUSE_OFF = bytes(\"\\u001b[?1000l\");\n    /** Enable mouse wheel scrolling */\n    ControlSequences.MOUSE_WHEEL_ON = bytes(\"\\u001b[?1015h\");\n    /** Disable mouse wheel scrolling */\n    ControlSequences.MOUSE_WHEEL_OFF = bytes(\"\\u001b[?1015l\");\n    /** Enable bracketed paste mode */\n    ControlSequences.PASTE_ON = bytes(\"\\u001b[?2004h\");\n    /** Disable bracketed paste mode */\n    ControlSequences.PASTE_OFF = bytes(\"\\u001b[?2004l\");\n    /** Enable line wrapping */\n    ControlSequences.WRAP_ON = bytes(\"\\u001b[?7h\");\n    /** Disable line wrapping */\n    ControlSequences.WRAP_OFF = bytes(\"\\u001b[?7l\");\n    /** Enable alternate screen buffer */\n    ControlSequences.ALT_BUFFER_ON = bytes(\"\\u001b[?1049h\");\n    /** Disable alternate screen buffer */\n    ControlSequences.ALT_BUFFER_OFF = bytes(\"\\u001b[?1049l\");\n})(ControlSequences || (ControlSequences = {}));\nexport const PowerShellCommands = [\n    \"ac\",\n    \"asnp\",\n    \"cat\",\n    \"cd\",\n    \"chdir\",\n    \"clc\",\n    \"clear\",\n    \"clhy\",\n    \"cli\",\n    \"clp\",\n    \"cls\",\n    \"clv\",\n    \"cnsn\",\n    \"compare\",\n    \"copy\",\n    \"cp\",\n    \"cpi\",\n    \"cpp\",\n    \"curl\",\n    \"cvpa\",\n    \"dbp\",\n    \"del\",\n    \"diff\",\n    \"dir\",\n    \"dnsn\",\n    \"ebp\",\n    \"echo\",\n    \"epal\",\n    \"epcsv\",\n    \"epsn\",\n    \"erase\",\n    \"etsn\",\n    \"exsn\",\n    \"fc\",\n    \"fl\",\n    \"foreach\",\n    \"ft\",\n    \"fw\",\n    \"gal\",\n    \"gbp\",\n    \"gc\",\n    \"gci\",\n    \"gcm\",\n    \"gcs\",\n    \"gdr\",\n    \"ghy\",\n    \"gi\",\n    \"gjb\",\n    \"gl\",\n    \"gm\",\n    \"gmo\",\n    \"gp\",\n    \"gps\",\n    \"group\",\n    \"gsn\",\n    \"gsnp\",\n    \"gsv\",\n    \"gu\",\n    \"gv\",\n    \"gwmi\",\n    \"h\",\n    \"history\",\n    \"icm\",\n    \"iex\",\n    \"ihy\",\n    \"ii\",\n    \"ipal\",\n    \"ipcsv\",\n    \"ipmo\",\n    \"ipsn\",\n    \"irm\",\n    \"ise\",\n    \"iwmi\",\n    \"iwr\",\n    \"kill\",\n    \"lp\",\n    \"ls\",\n    \"man\", \"help\",\n    \"md\", \"mkdir\",\n    \"measure\",\n    \"mi\",\n    \"mount\",\n    \"move\",\n    \"mp\",\n    \"mv\",\n    \"nal\",\n    \"ndr\",\n    \"ni\",\n    \"nmo\",\n    \"npssc\",\n    \"nsn\",\n    \"nv\",\n    \"ogv\",\n    \"oh\",\n    \"popd\",\n    \"ps\",\n    \"pushd\",\n    \"pwd\",\n    \"r\",\n    \"rbp\",\n    \"rcjb\",\n    \"rcsn\",\n    \"rd\",\n    \"rdr\",\n    \"ren\",\n    \"ri\",\n    \"rjb\",\n    \"rm\",\n    \"rmdir\",\n    \"rmo\",\n    \"rni\",\n    \"rnp\",\n    \"rp\",\n    \"rsn\",\n    \"rsnp\",\n    \"rujb\",\n    \"rv\",\n    \"rvpa\",\n    \"rwmi\",\n    \"sajb\",\n    \"sal\",\n    \"saps\",\n    \"sasv\",\n    \"sbp\",\n    \"sc\",\n    \"select\",\n    \"set\",\n    \"shcm\",\n    \"si\"\n];\n//# sourceMappingURL=constants.js.map","import { createReadableStream, stat, readDir, createWritableStream } from \"../fs.ts\";\nimport { ensureFsTarget } from \"../fs/util.ts\";\nimport { basename, isFileUrl, join, resolve, toFsPath } from \"../path.ts\";\nimport Tarball from \"./Tarball.ts\";\nexport default async function tar(src, dest = {}, options = {}) {\n    var _a, _b;\n    src = ensureFsTarget(src);\n    let _dest = undefined;\n    if (typeof dest === \"string\") {\n        dest = isFileUrl(dest) ? toFsPath(dest) : dest;\n        _dest = options.root ? dest : resolve(dest);\n    }\n    else if (typeof dest === \"object\") {\n        if (typeof FileSystemFileHandle === \"function\" && dest instanceof FileSystemFileHandle) {\n            _dest = dest;\n        }\n        else if (dest instanceof URL) {\n            _dest = ensureFsTarget(dest);\n        }\n        else {\n            options = dest;\n        }\n    }\n    src = typeof src === \"string\" && !options.root ? resolve(src) : src;\n    const { signal } = options;\n    const baseDir = typeof src === \"string\" ? basename(src) : src.name;\n    const entries = readDir(src, { ...options, recursive: true });\n    const tarball = new Tarball();\n    for await (const entry of entries) {\n        let filename;\n        let info;\n        let stream = null;\n        if (entry.handle) {\n            filename = entry.relativePath;\n            info = await stat(entry.handle);\n        }\n        else if (typeof src === \"string\") {\n            filename = join(src, entry.relativePath);\n            info = await stat(filename, options);\n        }\n        else {\n            filename = entry.relativePath;\n            info = await stat(entry.relativePath, options);\n        }\n        if (info.kind !== \"directory\") {\n            stream = createReadableStream((_a = entry.handle) !== null && _a !== void 0 ? _a : filename, options);\n            signal === null || signal === void 0 ? void 0 : signal.addEventListener(\"abort\", () => {\n                stream.cancel(signal.reason).catch(() => { });\n            }, { once: true });\n        }\n        let kind;\n        if (info.kind === \"directory\") {\n            kind = \"directory\";\n        }\n        else if (info.kind === \"symlink\") {\n            kind = \"symlink\";\n        }\n        else if (info.isBlockDevice) {\n            kind = \"block-device\";\n        }\n        else if (info.isCharDevice) {\n            kind = \"character-device\";\n        }\n        else if (info.isFIFO || info.isSocket) {\n            kind = \"fifo\";\n        }\n        else {\n            kind = \"file\";\n        }\n        tarball.append(stream, {\n            name: entry.name,\n            kind,\n            relativePath: baseDir ? baseDir + \"/\" + entry.relativePath : entry.relativePath,\n            size: entry.kind === \"directory\" ? 0 : info.size,\n            mtime: (_b = info.mtime) !== null && _b !== void 0 ? _b : new Date(),\n            mode: info.mode,\n            uid: info.uid,\n            gid: info.gid,\n        });\n    }\n    if (!_dest) {\n        return tarball;\n    }\n    const output = createWritableStream(_dest, options);\n    const stream = tarball.stream(options);\n    signal === null || signal === void 0 ? void 0 : signal.addEventListener(\"abort\", () => {\n        output.abort(signal.reason).catch(() => { });\n    }, { once: true });\n    await stream.pipeTo(output);\n}\n//# sourceMappingURL=tar.js.map","import { concat as concatBytes } from \"../bytes.ts\";\nimport { isDeno, isNodeLike } from \"../env.ts\";\nimport { createProgressEvent } from \"../event.ts\";\nimport { chmod, createReadableStream, createWritableStream, ensureDir, stat, utimes } from \"../fs.ts\";\nimport { ensureFsTarget, makeTree } from \"../fs/util.ts\";\nimport { basename, dirname, isFileUrl, join, resolve, toFsPath } from \"../path.ts\";\nimport { platform } from \"../runtime.ts\";\nimport Tarball, { HEADER_LENGTH, createEntry, parseHeader } from \"./Tarball.ts\";\n;\nexport default async function untar(src, dest = {}, options = {}) {\n    var _a;\n    src = src instanceof ReadableStream ? src : ensureFsTarget(src);\n    let _dest = undefined;\n    if (typeof dest === \"string\") {\n        dest = isFileUrl(dest) ? toFsPath(dest) : dest;\n        _dest = options.root ? dest : resolve(dest);\n    }\n    else if (typeof dest === \"object\") {\n        if (typeof FileSystemDirectoryHandle === \"function\" &&\n            dest instanceof FileSystemDirectoryHandle) {\n            _dest = dest;\n        }\n        else if (dest instanceof URL) {\n            _dest = ensureFsTarget(dest);\n        }\n        else {\n            options = dest;\n        }\n    }\n    src = typeof src === \"string\" && options.root ? resolve(src) : src;\n    let input = src instanceof ReadableStream ? src : createReadableStream(src, options);\n    if (options.gzip) {\n        const gzip = new DecompressionStream(\"gzip\");\n        input = input.pipeThrough(gzip);\n    }\n    const { signal } = options;\n    signal === null || signal === void 0 ? void 0 : signal.addEventListener(\"abort\", () => {\n        input.cancel(signal.reason);\n    });\n    if (!_dest) {\n        return await Tarball.load(input);\n    }\n    else if (typeof _dest === \"string\") {\n        await ensureDir(_dest, options);\n    }\n    let totalWrittenBytes = 0;\n    let totalBytes = (_a = options.size) !== null && _a !== void 0 ? _a : 0;\n    if (!totalBytes && options.onProgress) {\n        if (typeof src === \"string\") {\n            const info = await stat(src, options);\n            totalBytes = info.size;\n        }\n        else if (typeof FileSystemFileHandle === \"function\"\n            && src instanceof FileSystemFileHandle) {\n            const info = await src.getFile();\n            totalBytes = info.size;\n        }\n    }\n    const entries = [];\n    const reader = input.getReader();\n    let lastChunk = new Uint8Array(0);\n    let entry = null;\n    let writer = null;\n    let writtenBytes = 0;\n    let paddingSize = 0;\n    try {\n        outer: while (true) {\n            const { done, value } = await reader.read();\n            if (done) {\n                break;\n            }\n            lastChunk = lastChunk.byteLength ? concatBytes(lastChunk, value) : value;\n            while (true) {\n                if (paddingSize > 0 && lastChunk.byteLength >= paddingSize) {\n                    lastChunk = lastChunk.subarray(paddingSize);\n                    paddingSize = 0;\n                }\n                if (!entry) {\n                    if (lastChunk.byteLength >= HEADER_LENGTH) {\n                        const _header = parseHeader(lastChunk);\n                        if (_header) {\n                            lastChunk = _header[2];\n                            entry = createEntry(_header[0]);\n                            entries.push(entry);\n                        }\n                        else {\n                            lastChunk = new Uint8Array(0);\n                            break outer;\n                        }\n                    }\n                    else {\n                        break;\n                    }\n                }\n                const fileSize = entry.size;\n                let filename = undefined;\n                if (writer) {\n                    const chunk = lastChunk.subarray(0, fileSize - writtenBytes);\n                    await writer.write(chunk);\n                    lastChunk = lastChunk.subarray(fileSize - writtenBytes);\n                    writtenBytes += chunk.byteLength;\n                    if (chunk.byteLength) {\n                        totalWrittenBytes += chunk.byteLength;\n                        if (options.onProgress) {\n                            options.onProgress(createProgressEvent(\"progress\", {\n                                lengthComputable: !!totalBytes,\n                                loaded: totalWrittenBytes,\n                                total: totalBytes\n                            }));\n                        }\n                    }\n                }\n                else if (entry.kind === \"directory\") {\n                    if (typeof FileSystemDirectoryHandle === \"function\" &&\n                        _dest instanceof FileSystemDirectoryHandle) {\n                        await ensureDir(entry.relativePath, { ...options, root: _dest });\n                    }\n                    else {\n                        filename = join(_dest, entry.relativePath);\n                        await ensureDir(filename, options);\n                    }\n                }\n                else {\n                    let _options = options;\n                    if (typeof FileSystemDirectoryHandle === \"function\" &&\n                        _dest instanceof FileSystemDirectoryHandle) {\n                        _options = { ...options, root: _dest };\n                        filename = entry.relativePath;\n                    }\n                    else {\n                        filename = join(_dest, entry.relativePath);\n                    }\n                    const dir = dirname(filename);\n                    if (dir && dir !== \".\" && dir !== \"/\") {\n                        await ensureDir(dir, _options);\n                    }\n                    const output = createWritableStream(filename, _options);\n                    writer = output.getWriter();\n                    continue;\n                }\n                if (writtenBytes === fileSize) {\n                    paddingSize = HEADER_LENGTH - (fileSize % HEADER_LENGTH || HEADER_LENGTH);\n                    writtenBytes = 0;\n                    writer === null || writer === void 0 ? void 0 : writer.close();\n                    writer = null;\n                    entry = null;\n                }\n                else {\n                    break;\n                }\n            }\n        }\n        if (lastChunk.byteLength) {\n            throw new Error(\"The archive is corrupted\");\n        }\n        else if (totalBytes && totalWrittenBytes < totalBytes && options.onProgress) {\n            totalWrittenBytes = totalBytes;\n            options.onProgress(createProgressEvent(\"progress\", {\n                lengthComputable: true,\n                loaded: totalWrittenBytes,\n                total: totalBytes,\n            }));\n        }\n    }\n    finally {\n        reader.releaseLock();\n    }\n    if ((isDeno || isNodeLike) && typeof _dest === \"string\") {\n        const isWindows = platform() === \"windows\";\n        const tree = makeTree(basename(_dest), entries);\n        await (async function restoreStats(nodes) {\n            var _a;\n            for (const entry of nodes) {\n                const filename = join(_dest, entry.relativePath);\n                if (entry.kind === \"directory\" && ((_a = entry.children) === null || _a === void 0 ? void 0 : _a.length)) {\n                    // must restore contents' stats before the directory itself\n                    await restoreStats(entry.children);\n                }\n                // Only restore the permission mode and the last modified time,\n                // don't restore the owner and group, because they may not exist\n                // and may cause an error.\n                //\n                // This behavior is consistent with `tar -xf archive.tar` in\n                // Unix-like systems.\n                if (entry.mode && !isWindows) {\n                    await chmod(filename, entry.mode);\n                }\n                if (entry.mtime) {\n                    await utimes(filename, new Date(), entry.mtime);\n                }\n            }\n        })(tree.children);\n    }\n}\n//# sourceMappingURL=untar.js.map","export const isFullWidth = (x) => {\n    return x === 0x3000 || x >= 0xFF01 && x <= 0xFF60 || x >= 0xFFE0 && x <= 0xFFE6;\n};\nexport const isWide = (x) => {\n    return x >= 0x1100 && x <= 0x115F || x === 0x231A || x === 0x231B || x === 0x2329 || x === 0x232A || x >= 0x23E9 && x <= 0x23EC || x === 0x23F0 || x === 0x23F3 || x === 0x25FD || x === 0x25FE || x === 0x2614 || x === 0x2615 || x >= 0x2648 && x <= 0x2653 || x === 0x267F || x === 0x2693 || x === 0x26A1 || x === 0x26AA || x === 0x26AB || x === 0x26BD || x === 0x26BE || x === 0x26C4 || x === 0x26C5 || x === 0x26CE || x === 0x26D4 || x === 0x26EA || x === 0x26F2 || x === 0x26F3 || x === 0x26F5 || x === 0x26FA || x === 0x26FD || x === 0x2705 || x === 0x270A || x === 0x270B || x === 0x2728 || x === 0x274C || x === 0x274E || x >= 0x2753 && x <= 0x2755 || x === 0x2757 || x >= 0x2795 && x <= 0x2797 || x === 0x27B0 || x === 0x27BF || x === 0x2B1B || x === 0x2B1C || x === 0x2B50 || x === 0x2B55 || x >= 0x2E80 && x <= 0x2E99 || x >= 0x2E9B && x <= 0x2EF3 || x >= 0x2F00 && x <= 0x2FD5 || x >= 0x2FF0 && x <= 0x2FFF || x >= 0x3001 && x <= 0x303E || x >= 0x3041 && x <= 0x3096 || x >= 0x3099 && x <= 0x30FF || x >= 0x3105 && x <= 0x312F || x >= 0x3131 && x <= 0x318E || x >= 0x3190 && x <= 0x31E3 || x >= 0x31EF && x <= 0x321E || x >= 0x3220 && x <= 0x3247 || x >= 0x3250 && x <= 0x4DBF || x >= 0x4E00 && x <= 0xA48C || x >= 0xA490 && x <= 0xA4C6 || x >= 0xA960 && x <= 0xA97C || x >= 0xAC00 && x <= 0xD7A3 || x >= 0xF900 && x <= 0xFAFF || x >= 0xFE10 && x <= 0xFE19 || x >= 0xFE30 && x <= 0xFE52 || x >= 0xFE54 && x <= 0xFE66 || x >= 0xFE68 && x <= 0xFE6B || x >= 0x16FE0 && x <= 0x16FE4 || x === 0x16FF0 || x === 0x16FF1 || x >= 0x17000 && x <= 0x187F7 || x >= 0x18800 && x <= 0x18CD5 || x >= 0x18D00 && x <= 0x18D08 || x >= 0x1AFF0 && x <= 0x1AFF3 || x >= 0x1AFF5 && x <= 0x1AFFB || x === 0x1AFFD || x === 0x1AFFE || x >= 0x1B000 && x <= 0x1B122 || x === 0x1B132 || x >= 0x1B150 && x <= 0x1B152 || x === 0x1B155 || x >= 0x1B164 && x <= 0x1B167 || x >= 0x1B170 && x <= 0x1B2FB || x === 0x1F004 || x === 0x1F0CF || x === 0x1F18E || x >= 0x1F191 && x <= 0x1F19A || x >= 0x1F200 && x <= 0x1F202 || x >= 0x1F210 && x <= 0x1F23B || x >= 0x1F240 && x <= 0x1F248 || x === 0x1F250 || x === 0x1F251 || x >= 0x1F260 && x <= 0x1F265 || x >= 0x1F300 && x <= 0x1F320 || x >= 0x1F32D && x <= 0x1F335 || x >= 0x1F337 && x <= 0x1F37C || x >= 0x1F37E && x <= 0x1F393 || x >= 0x1F3A0 && x <= 0x1F3CA || x >= 0x1F3CF && x <= 0x1F3D3 || x >= 0x1F3E0 && x <= 0x1F3F0 || x === 0x1F3F4 || x >= 0x1F3F8 && x <= 0x1F43E || x === 0x1F440 || x >= 0x1F442 && x <= 0x1F4FC || x >= 0x1F4FF && x <= 0x1F53D || x >= 0x1F54B && x <= 0x1F54E || x >= 0x1F550 && x <= 0x1F567 || x === 0x1F57A || x === 0x1F595 || x === 0x1F596 || x === 0x1F5A4 || x >= 0x1F5FB && x <= 0x1F64F || x >= 0x1F680 && x <= 0x1F6C5 || x === 0x1F6CC || x >= 0x1F6D0 && x <= 0x1F6D2 || x >= 0x1F6D5 && x <= 0x1F6D7 || x >= 0x1F6DC && x <= 0x1F6DF || x === 0x1F6EB || x === 0x1F6EC || x >= 0x1F6F4 && x <= 0x1F6FC || x >= 0x1F7E0 && x <= 0x1F7EB || x === 0x1F7F0 || x >= 0x1F90C && x <= 0x1F93A || x >= 0x1F93C && x <= 0x1F945 || x >= 0x1F947 && x <= 0x1F9FF || x >= 0x1FA70 && x <= 0x1FA7C || x >= 0x1FA80 && x <= 0x1FA88 || x >= 0x1FA90 && x <= 0x1FABD || x >= 0x1FABF && x <= 0x1FAC5 || x >= 0x1FACE && x <= 0x1FADB || x >= 0x1FAE0 && x <= 0x1FAE8 || x >= 0x1FAF0 && x <= 0x1FAF8 || x >= 0x20000 && x <= 0x2FFFD || x >= 0x30000 && x <= 0x3FFFD;\n};\n//# sourceMappingURL=index.js.map","/**\n * Useful utility functions for interacting with the terminal.\n *\n * NOTE: Despite the name of this module, many of its functions can also be used\n * in the browser environment.\n * @module\n */\nimport { isFullWidth, isWide } from \"../external/code-point-utils/index.ts\";\nimport { byteLength, chars } from \"../string.ts\";\nimport { EMOJI_CHAR } from \"../string/constants.ts\";\nimport bytes, { equals } from \"../bytes.ts\";\nimport { isBrowserWindow, isDeno, isNodeLike } from \"../env.ts\";\nimport { platform } from \"../runtime.ts\";\nimport { sum } from \"../math.ts\";\nimport { Mutex } from \"../lock.ts\";\nimport { ControlKeys, ControlSequences, FunctionKeys, NavigationKeys, } from \"./constants.ts\";\nexport { ControlKeys, ControlSequences, FunctionKeys, NavigationKeys, };\nconst NonTypingKeys = [\n    ...Object.values(ControlKeys),\n    ...Object.values(NavigationKeys),\n    ...Object.values(FunctionKeys),\n];\n/**\n * The command-line arguments passed to the program.\n *\n * This variable is the same as `Deno.args` in Deno and `process.argv.slice(2)`\n * in Node.js or Bun.\n *\n * @example\n * ```ts\n * // main.ts\n * // launch with `deno run main.ts --name=Bob --age=30`\n * // or `node main.js --name=Bob --age=30`\n * // or `bun run main.ts --name=Bob --age=30`\n * import { args } from \"@ayonli/jsext/cli\";\n *\n * console.log(args);\n * // [\n * //     \"--name=Bob\",\n * //     \"--age=30\"\n * // ]\n * ```\n */\nexport const args = (() => {\n    if (isDeno) {\n        return Deno.args;\n    }\n    else if (isNodeLike) {\n        return process.argv.slice(2);\n    }\n    else {\n        return [];\n    }\n})();\n/**\n * Whether the standard IO is a text terminal.\n */\nexport const isTTY = (() => {\n    if (isDeno) {\n        return Deno.stdin.isTerminal();\n    }\n    else if (isNodeLike) {\n        return process.stdin.isTTY;\n    }\n    else {\n        return false;\n    }\n})();\n/**\n * Returns the width of a single character.\n *\n * @example\n * ```ts\n * import { charWidth } from \"@ayonli/jsext/cli\";\n *\n * console.log(charWidth(\"a\")); // 1\n * console.log(charWidth(\"你\")); // 2\n * console.log(charWidth(\"👋\")); // 2\n * console.log(charWidth(\"♥\")); // 1\n * ```\n */\nexport function charWidth(char) {\n    if (EMOJI_CHAR.test(char)) {\n        const _bytes = byteLength(char);\n        // Most emojis are 4 bytes wide, but some are 3 bytes in Windows/Linux,\n        // and 6 bytes in macOS.\n        return _bytes === 3 || _bytes === 6 ? 1 : 2;\n    }\n    else if (isWide(char.codePointAt(0)) || isFullWidth(char.codePointAt(0))) {\n        return 2;\n    }\n    else {\n        return 1;\n    }\n}\n/**\n * Returns the width of a string.\n *\n * @example\n * ```ts\n * import { stringWidth } from \"@ayonli/jsext/cli\";\n *\n * console.log(stringWidth(\"Hello, World!\")); // 13\n * console.log(stringWidth(\"你好，世界！\")); // 12\n * console.log(stringWidth(\"👋🌍🚀♥️♣\")); // 8\n * ```\n */\nexport function stringWidth(str) {\n    return sum(...chars(str).map(charWidth));\n}\nconst stdinMutex = new Mutex(1);\n/**\n * Requests the standard input to be used only by the given task until it is\n * completed.\n *\n * This function sets the `stdin` in raw mode, and excludes other parts of the\n * program from reading from it at the same time . This is important so that our\n * program won't be affected by other tasks, especially in a REPL environment.\n *\n * @example\n * ```ts\n * // A simple program that reads a line of text from user input.\n * import process from \"node:process\";\n * import bytes, { equals } from \"@ayonli/jsext/bytes\";\n * import { chars } from \"@ayonli/jsext/string\";\n * import {\n *     ControlKeys,\n *     ControlSequences,\n *     lockStdin,\n *     readStdin,\n *     writeStdout,\n *     isTypingInput,\n *     moveLeftBy,\n * } from \"@ayonli/jsext/cli\";\n *\n * const input = await lockStdin(async () => {\n *     await writeStdout(bytes(\"Type something: \"));\n *\n *     const buf: string[] = []\n *\n *     while (true) {\n *         const input = await readStdin();\n *\n *         if (equals(input, ControlKeys.CTRL_C) || equals(input, ControlKeys.ESC)) {\n *             console.error(\"\\nUser cancelled\");\n *             process.exit(1);\n *         } else if (equals(input, ControlKeys.CR) || equals(input, ControlKeys.LF)) {\n *             await writeStdout(ControlKeys.LF);\n *             break;\n *         } else if (equals(input, ControlKeys.BS) || equals(input, ControlKeys.DEL)) {\n *             if (buf.length > 0) {\n *                 const char = buf.pop()!;\n *                 await moveLeftBy(char);\n *                 await writeStdout(ControlSequences.CLR_RIGHT);\n *             }\n *         } else if (isTypingInput(input)) {\n *             buf.push(...chars(String(input)));\n *             await writeStdout(input);\n *         }\n *     }\n *\n *     return buf.join(\"\")\n * });\n *\n * console.log(`You typed: ${input}`);\n * ```\n */\nexport async function lockStdin(task) {\n    if (!isTTY) {\n        throw new Error(\"Not a terminal\");\n    }\n    const lock = await stdinMutex.lock();\n    try {\n        if (isDeno) {\n            try {\n                Deno.stdin.setRaw(true);\n                return await task();\n            }\n            finally {\n                Deno.stdin.setRaw(false);\n            }\n        }\n        else if (isNodeLike) {\n            const { stdin } = process;\n            if (stdin.isPaused()) {\n                stdin.resume();\n            }\n            // copy listeners in cased being modified\n            const listeners = [...stdin.listeners(\"data\")];\n            if (listeners.length) {\n                stdin.removeAllListeners(\"data\");\n            }\n            try {\n                stdin.setRawMode(true);\n                return await task();\n            }\n            finally {\n                stdin.setRawMode(false);\n                if (listeners.length) {\n                    listeners.forEach(listener => stdin.addListener(\"data\", listener));\n                }\n                else {\n                    stdin.pause();\n                }\n            }\n        }\n        else {\n            throw new Error(\"No stdin available\");\n        }\n    }\n    finally {\n        lock.unlock();\n    }\n}\n/**\n * Reads a chunk of data from the standard input. This could be a single key\n * stroke, or a multi-byte sequence for input from an IME.\n *\n * NOTE: This function should be used within the task function of {@link lockStdin}.\n */\nexport async function readStdin() {\n    if (isDeno) {\n        const reader = Deno.stdin.readable.getReader();\n        try {\n            const { done, value } = await reader.read();\n            if (done) {\n                return bytes([]);\n            }\n            else {\n                return bytes(value);\n            }\n        }\n        finally {\n            reader.releaseLock();\n        }\n    }\n    else if (isNodeLike) {\n        const stdin = process.stdin;\n        return new Promise(resolve => {\n            const listener = (chunk) => {\n                stdin.removeListener(\"data\", listener);\n                resolve(bytes(chunk));\n            };\n            // Don't use `once`, it may not keep the program running in some runtimes,\n            // for example, Bun.\n            stdin.on(\"data\", listener);\n        });\n    }\n    else {\n        throw new Error(\"No stdin available\");\n    }\n}\n/**\n * Writes a chunk of data to the standard output.\n */\nexport async function writeStdout(data) {\n    if (isDeno) {\n        await Deno.stdout.write(data);\n    }\n    else if (isNodeLike) {\n        await new Promise(resolve => {\n            process.stdout.write(data, () => resolve());\n        });\n    }\n    else {\n        throw new Error(\"No stdout available\");\n    }\n}\n/**\n * Writes a chunk of data to the standard output synchronously.\n *\n * NOTE: Despite the function name, the synchronous behavior is only guaranteed\n * in Deno, in Node.js, it may still be asynchronous.\n *\n * Since the behavior is not guaranteed, it is recommended to use the asynchronous\n * `writeStdout` function instead. This synchronous function is only provided for\n * special cases where the asynchronous behavior is not acceptable.\n */\nexport function writeStdoutSync(data) {\n    if (isDeno) {\n        Deno.stdout.writeSync(data);\n    }\n    else if (isNodeLike) {\n        process.stdout.write(data);\n    }\n    else {\n        throw new Error(\"No stdout available\");\n    }\n}\n/**\n * Moves the cursor to the left base on the width of the given string.\n */\nexport async function moveLeftBy(str) {\n    await writeStdout(bytes(`\\u001b[${stringWidth(str)}D`));\n}\n/**\n * Moves the cursor to the right base on the width of the given string.\n */\nexport async function moveRightBy(str) {\n    await writeStdout(bytes(`\\u001b[${stringWidth(str)}C`));\n}\n/**\n * Returns `true` if the given data is a typing input. That is, it is not a\n * control key, navigation key, or function key.\n */\nexport function isTypingInput(data) {\n    return data.length > 0 && !NonTypingKeys.some(key => equals(data, key));\n}\n/**\n * Returns the current size of the application window.\n *\n * In the terminal, this is the size of the terminal window, where `width` and\n * `height` are the corresponding columns and rows.\n *\n * In the browser, this is the size of the viewport, where `width` and `height`\n * are measured in pixels.\n */\nexport function getWindowSize() {\n    if (isDeno) {\n        try {\n            const { columns, rows } = Deno.consoleSize(); // this could fail in some environments\n            return { width: columns, height: rows };\n        }\n        catch (_a) {\n            return { width: 0, height: 0 };\n        }\n    }\n    else if (isNodeLike) {\n        return {\n            width: process.stdout.columns,\n            height: process.stdout.rows,\n        };\n    }\n    else if (isBrowserWindow) {\n        return {\n            width: window.innerWidth,\n            height: window.innerHeight,\n        };\n    }\n    else {\n        return { width: 0, height: 0 };\n    }\n}\n/** Checks if the program is running in Windows Subsystem for Linux. */\nexport function isWSL() {\n    if (platform() !== \"linux\")\n        return false;\n    if (isDeno) {\n        return Deno.osRelease().includes(\"microsoft-standard-WSL\");\n    }\n    else if (isNodeLike) {\n        return !!process.env[\"WSL_INTEROP\"];\n    }\n    return false;\n}\nfunction parseValue(arg) {\n    let value = arg.trim();\n    if (value === \"true\") {\n        value = true;\n    }\n    else if (value === \"false\") {\n        value = false;\n    }\n    else if (/^[-+]?\\d+(\\.\\d+)?$/.test(value)) {\n        value = Number(value);\n    }\n    return value;\n}\nfunction parseKeyValue(arg, noCoercion = false) {\n    let index = arg.indexOf(\"=\");\n    if (index === -1) {\n        return [arg, undefined];\n    }\n    else {\n        const key = arg.slice(0, index);\n        const value = arg.slice(index + 1);\n        if (noCoercion === true || (Array.isArray(noCoercion) && noCoercion.includes(key))) {\n            return [key, value];\n        }\n        else {\n            return [key, parseValue(value)];\n        }\n    }\n}\n/**\n * Parses the given CLI arguments into an object.\n *\n * @example\n * ```ts\n * import { parseArgs } from \"@ayonli/jsext/cli\";\n *\n * const args = parseArgs([\n *     \"Bob\",\n *     \"--age\", \"30\",\n *     \"--married\",\n *     \"--wife=Alice\",\n *     \"--children\", \"Mia\",\n *     \"--children\", \"Ava\",\n *     \"-p\"\n * ], {\n *     alias: { \"p\": \"has-parents\" },\n *     lists: [\"children\"],\n * });\n *\n * console.log(args);\n * // {\n * //     \"0\": \"Bob\",\n * //     age: 30,\n * //     married: true,\n * //     wife: \"Alice\",\n * //     children: [\"Mia\", \"Ava\"],\n * //     \"has-parents\": true\n * // }\n * ```\n */\nexport function parseArgs(args, options = {}) {\n    var _a;\n    const { alias: alias = {}, lists = [], noCoercion = false } = options;\n    const result = {};\n    let key = null;\n    let index = 0;\n    const set = (key, value) => {\n        var _a;\n        if (lists.includes(key)) {\n            ((_a = result[key]) !== null && _a !== void 0 ? _a : (result[key] = [])).push(value);\n        }\n        else {\n            result[key] = value;\n        }\n    };\n    for (let i = 0; i < args.length; i++) {\n        const arg = args[i];\n        if (arg === \"--\") {\n            result[\"--\"] = args.slice(i + 1);\n            break;\n        }\n        else if (arg.startsWith(\"--\")) {\n            if (key) {\n                set(key, true);\n                key = null;\n            }\n            const [_key, value] = parseKeyValue(arg.slice(2), noCoercion);\n            if (value !== undefined) {\n                set(_key, value);\n            }\n            else {\n                key = arg.slice(2);\n            }\n        }\n        else if (arg.startsWith(\"-\")) {\n            if (key) {\n                set(key, true);\n                key = null;\n            }\n            const char = arg.slice(1);\n            key = (_a = alias[char]) !== null && _a !== void 0 ? _a : char;\n        }\n        else if (key) {\n            if (noCoercion === true || (Array.isArray(noCoercion) && noCoercion.includes(key))) {\n                set(key, arg);\n            }\n            else {\n                set(key, parseValue(arg));\n            }\n            key = null;\n        }\n        else {\n            const _key = String(index++);\n            if (noCoercion === true || (Array.isArray(noCoercion) && noCoercion.includes(_key))) {\n                set(_key, arg);\n            }\n            else {\n                set(_key, parseValue(arg));\n            }\n        }\n    }\n    if (key) {\n        set(key, true);\n    }\n    return result;\n}\n/**\n * Quotes a string to be used as a single argument to a shell command.\n *\n * @example\n * ```ts\n * import { quote } from \"@ayonli/jsext/cli\";\n *\n * console.log(quote(\"Hello, World!\")); // \"Hello, World!\"\n * console.log(quote(\"Hello, 'World'!\")); // \"Hello, 'World'!\"\n * console.log(quote(\"Hello, \\\"World\\\"!\")); // \"Hello, \\\"World\\\"!\"\n * console.log(quote(\"Hello, $World!\")); // \"Hello, \\$World!\"\n * console.log(quote(\"Hello, `World`!\")); // \"Hello, \\`World\\`!\"\n * console.log(quote(\"Hello, \\\\World!\")); // \"Hello, \\\\World!\"\n * ```\n */\nexport function quote(arg) {\n    if ((/[\"'\\s]/).test(arg)) {\n        return `\"` + arg.replace(/([\"\\\\$])/g, '\\\\$1') + `\"`;\n    }\n    return String(arg).replace(/([A-Za-z]:)?([#!\"$&'()*,:;<=>?@[\\\\\\]^`{|}])/g, '$1\\\\$2');\n}\n//# sourceMappingURL=common.js.map","/**\n * Useful utility functions for interacting with the terminal.\n *\n * NOTE: Despite the name of this module, many of its functions can also be used\n * in the browser environment.\n * @module\n * @experimental\n */\nimport { trimStart } from \"./string.ts\";\nimport { isBrowserWindow, isBun, isDeno, isNodeLike, isSharedWorker, isDedicatedWorker } from \"./env.ts\";\nimport runtime, { env, platform } from \"./runtime.ts\";\nimport { interop } from \"./module.ts\";\nimport { basename } from \"./path.ts\";\nimport { PowerShellCommands } from \"./cli/constants.ts\";\nimport { isWSL, quote } from \"./cli/common.ts\";\nimport { ensureFsTarget } from \"./fs/util.ts\";\nimport { resolveHomeDir } from \"./fs/util/server.ts\";\nexport * from \"./cli/common.ts\";\n/**\n * Executes a command in the terminal and returns the exit code and outputs.\n *\n * In Windows, this function will use PowerShell to execute the command when\n * possible, which has a lot UNIX-like aliases/commands available, such as `ls`,\n * `cat`, `rm`, etc.\n *\n * @example\n * ```ts\n * import { run } from \"@ayonli/jsext/cli\";\n *\n * const { code, stdout, stderr } = await run(\"echo\", [\"Hello, World!\"]);\n *\n * console.log(code); // 0\n * console.log(JSON.stringify(stdout)); // \"Hello, World!\\n\"\n * console.log(JSON.stringify(stderr)); // \"\"\n * ```\n */\nexport async function run(cmd, args, options = {}) {\n    const signal = options.signal;\n    const isWindows = platform() === \"windows\";\n    const isWslPs = isWSL() && cmd.endsWith(\"powershell.exe\");\n    if (isNodeLike || isDeno) {\n        const { spawn } = await import(\"node:child_process\");\n        const { decode } = await interop(import(\"iconv-lite\"), false);\n        const child = isWindows && PowerShellCommands.includes(cmd)\n            ? spawn(\"powershell\", [\"-c\", cmd, ...args.map(quote)], { signal })\n            : spawn(cmd, args, { signal });\n        const stdout = [];\n        const stderr = [];\n        child.stdout.on(\"data\", chunk => {\n            if (isWindows || isWslPs) {\n                stdout.push(decode(chunk, \"cp936\"));\n            }\n            else {\n                stdout.push(String(chunk));\n            }\n        });\n        child.stderr.on(\"data\", chunk => {\n            if (isWindows || isWslPs) {\n                stderr.push(decode(chunk, \"cp936\"));\n            }\n            else {\n                stderr.push(String(chunk));\n            }\n        });\n        const code = await new Promise((resolve, reject) => {\n            child.once(\"exit\", (code, signal) => {\n                if (code === null && signal) {\n                    resolve(1);\n                }\n                else {\n                    resolve(code !== null && code !== void 0 ? code : 0);\n                }\n            }).once(\"error\", reject);\n        });\n        return {\n            code,\n            stdout: stdout.join(\"\"),\n            stderr: stderr.join(\"\"),\n        };\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\n/**\n * Executes the script inside PowerShell as if they were typed at the PowerShell\n * command prompt.\n *\n * This function can also be called within Windows Subsystem for Linux to\n * directly interact with PowerShell.\n *\n * NOTE: This function is only available in Windows and Windows Subsystem for\n * Linux.\n *\n * @example\n * ```ts\n * import { powershell } from \"@ayonli/jsext/cli\";\n *\n * const cmd = \"ls\";\n * const {\n *     code,\n *     stdout,\n *     stderr,\n * } = await powershell(`Get-Command -Name ${cmd} | Select-Object -ExpandProperty Source`);\n * ```\n */\nexport async function powershell(script, options = {}) {\n    let command = \"powershell\";\n    if (isWSL()) {\n        command = \"/mnt/c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe\";\n    }\n    return await run(command, [\"-c\", script], options);\n}\n/**\n * Executes a command with elevated privileges using `sudo` (or UAC in Windows).\n *\n * @deprecated Running a command (or subprocess) with elevated privileges is\n * dangerous, and the underlying dependency `sudo-prompt` is also deprecated.\n * Use this function with caution.\n *\n * @example\n * ```ts\n * import { sudo } from \"@ayonli/jsext/cli\";\n *\n * await sudo(\"apt\", [\"install\", \"build-essential\"]);\n * ```\n */\nexport async function sudo(cmd, args, options = {}) {\n    const _platform = platform();\n    if ((_platform !== \"windows\" && !(options === null || options === void 0 ? void 0 : options.gui)) ||\n        (_platform === \"linux\" && !env(\"DISPLAY\")) ||\n        isWSL()) {\n        return await run(\"sudo\", [cmd, ...args]);\n    }\n    if (![\"darwin\", \"windows\", \"linux\"].includes(_platform)) {\n        throw new Error(\"Unsupported platform\");\n    }\n    const { exec } = await interop(import(\"sudo-prompt\"));\n    return await new Promise((resolve, reject) => {\n        exec(`${cmd}` + (args.length ? ` ${args.map(quote).join(\" \")}` : \"\"), {\n            name: (options === null || options === void 0 ? void 0 : options.title) || (isDeno ? \"Deno\" : isBun ? \"Bun\" : \"NodeJS\"),\n        }, (error, stdout, stderr) => {\n            if (error) {\n                reject(error);\n            }\n            else {\n                let _stdout = String(stdout);\n                if (_platform === \"windows\" && cmd === \"echo\" && _stdout.startsWith(`\"`)) {\n                    // In Windows CMD, the `echo` command will output the string\n                    // with double quotes. We need to remove them.\n                    let lastIndex = _stdout.lastIndexOf(`\"`);\n                    _stdout = _stdout.slice(1, lastIndex) + _stdout.slice(lastIndex + 1);\n                }\n                resolve({\n                    code: 0,\n                    stdout: _stdout,\n                    stderr: String(stderr),\n                });\n            }\n        });\n    });\n}\n/**\n * Returns the path of the given command if it exists in the system,\n * otherwise returns `null`.\n *\n * This function is available in Windows as well.\n *\n * @example\n * ```ts\n * import { which } from \"@ayonli/jsext/cli\";\n *\n * const path = await which(\"node\");\n *\n * console.log(path);\n * // e.g. \"/usr/bin/node\" in UNIX/Linux or \"C:\\\\Program Files\\\\nodejs\\\\node.exe\" in Windows\n * ```\n */\nexport async function which(cmd) {\n    if (platform() === \"windows\") {\n        const { code, stdout } = await run(\"powershell\", [\n            \"-Command\",\n            `Get-Command -Name ${cmd} | Select-Object -ExpandProperty Source`\n        ]);\n        return code ? null : stdout.trim();\n    }\n    else {\n        const { code, stdout } = await run(\"which\", [cmd]);\n        return code ? null : stdout.trim();\n    }\n}\n/**\n * Opens the given file in a text editor.\n *\n * The `filename` can include a line number by appending `:<number>` or `#L<number>`,\n * however, this feature is not supported by all editors.\n *\n * This function will try to open VS Code if available, otherwise it will try to\n * open the default editor or a preferred one, such as `vim` or `nano` when available.\n *\n * Some editor may hold the terminal until the editor is closed, while others may\n * return immediately. Anyway, the operation is asynchronous and the function will\n * not block the thread.\n *\n * In the browser, this function will always try to open the file in VS Code,\n * regardless of whether it's available or not.\n *\n * @example\n * ```ts\n * import { edit } from \"@ayonli/jsext/cli\";\n *\n * await edit(\"path/to/file.txt\");\n *\n * await edit(\"path/to/file.txt:10\"); // open the file at line 10\n * ```\n */\nexport async function edit(filename) {\n    filename = ensureFsTarget(filename);\n    filename = await resolveHomeDir(filename);\n    const match = filename.match(/(:|#L)(\\d+)/);\n    let line;\n    if (match) {\n        line = Number(match[2]);\n        filename = filename.slice(0, match.index);\n    }\n    if (isBrowserWindow) {\n        window.open(\"vscode://file/\" + trimStart(filename, \"/\") + (line ? `:${line}` : \"\"));\n        return;\n    }\n    else if (isSharedWorker\n        || isSharedWorker\n        || (isDedicatedWorker && ([\"chrome\", \"firefox\", \"safari\"]).includes(runtime().identity))) {\n        throw new Error(\"Unsupported runtime\");\n    }\n    const _platform = platform();\n    const vscode = await which(\"code\");\n    if (vscode) {\n        const args = line ? [\"--goto\", `${filename}:${line}`] : [filename];\n        const { code, stderr } = await run(vscode, args);\n        if (code)\n            throw new Error(stderr || `Unable to open ${filename} in the editor.`);\n        return;\n    }\n    else if (_platform === \"darwin\") {\n        const { code, stderr } = await run(\"open\", [\"-t\", filename]);\n        if (code)\n            throw new Error(stderr || `Unable to open ${filename} in the editor.`);\n        return;\n    }\n    else if (_platform === \"windows\" || isWSL()) {\n        const notepad = _platform === \"windows\"\n            ? \"notepad.exe\"\n            : \"/mnt/c/Windows/System32/notepad.exe\";\n        const { code, stderr } = await run(notepad, [filename]);\n        if (code)\n            throw new Error(stderr || `Unable to open ${filename} in the editor.`);\n        return;\n    }\n    let editor = env(\"EDITOR\")\n        || env(\"VISUAL\")\n        || (await which(\"gedit\"))\n        || (await which(\"kate\"))\n        || (await which(\"vim\"))\n        || (await which(\"vi\"))\n        || (await which(\"nano\"));\n    let args;\n    if (!editor) {\n        throw new Error(\"Cannot determine the editor to open.\");\n    }\n    else {\n        editor = basename(editor);\n    }\n    if ([\"gedit\", \"kate\", \"vim\", \"vi\", \"nano\"].includes(editor)) {\n        args = line ? [`+${line}`, filename] : [filename];\n    }\n    if ([\"vim\", \"vi\", \"nano\"].includes(editor)) {\n        if (await which(\"gnome-terminal\")) {\n            args = [\"--\", editor, ...args];\n            editor = \"gnome-terminal\";\n        }\n        else {\n            args = [\"-e\", `'${editor} ${args.map(quote).join(\" \")}'`];\n            editor = (await which(\"konsole\"))\n                || (await which(\"xfce4-terminal\"))\n                || (await which(\"deepin-terminal\"))\n                || (await which(\"xterm\"));\n        }\n        if (!editor) {\n            throw new Error(\"Cannot determine the terminal to open.\");\n        }\n    }\n    else {\n        args = [filename];\n    }\n    const { code, stderr } = await run(editor, args);\n    if (code)\n        throw new Error(stderr || `Unable to open ${filename} in the editor.`);\n}\n//# sourceMappingURL=cli.js.map","/**\n * Asynchronous dialog functions for both browsers and terminals.\n *\n * This includes `alert`, `confirm`, `prompt` and other non-standard dialogs.\n * @experimental\n * @module\n */\nimport { isBrowserWindow, isDeno, isNodeLike } from \"./env.ts\";\nimport progress from \"./dialog/progress.ts\";\nexport { progress };\nexport * from \"./dialog/progress.ts\";\nexport * from \"./dialog/file.ts\";\n/**\n * Displays a dialog with a message, and to wait until the user dismisses the\n * dialog.\n *\n * @example\n * ```ts\n * import { alert } from \"@ayonli/jsext/dialog\";\n *\n * await alert(\"Hello, world!\");\n * ```\n */\nexport async function alert(message, options = {}) {\n    if (isBrowserWindow) {\n        const { alert } = await import(\"./dialog/web.ts\");\n        await alert(message);\n    }\n    else if (isDeno || isNodeLike) {\n        const { default: alert } = await import(\"./dialog/cli/alert.ts\");\n        await alert(message, options);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\n/**\n * Displays a dialog with a message, and to wait until the user either confirms\n * or cancels the dialog.\n *\n * @example\n * ```ts\n * import { confirm } from \"@ayonli/jsext/dialog\";\n *\n * if (await confirm(\"Are you sure?\")) {\n *     console.log(\"Confirmed\");\n * } else {\n *     console.log(\"Canceled\");\n * }\n * ```\n */\nexport async function confirm(message, options = {}) {\n    if (isBrowserWindow) {\n        const { confirm } = await import(\"./dialog/web.ts\");\n        return await confirm(message);\n    }\n    else if (isDeno || isNodeLike) {\n        const { default: confirm } = await import(\"./dialog/cli/confirm.ts\");\n        return await confirm(message, options);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\nexport async function prompt(message, options = \"\") {\n    var _a, _b, _c;\n    const defaultValue = typeof options === \"string\"\n        ? options\n        : options.defaultValue;\n    const type = typeof options === \"object\"\n        ? (_a = options.type) !== null && _a !== void 0 ? _a : \"text\"\n        : \"text\";\n    const mask = type === \"password\"\n        ? typeof options === \"object\" ? ((_b = options.mask) !== null && _b !== void 0 ? _b : \"*\") : \"*\"\n        : undefined;\n    const gui = typeof options === \"object\" ? ((_c = options.gui) !== null && _c !== void 0 ? _c : false) : false;\n    if (isBrowserWindow) {\n        const { prompt } = await import(\"./dialog/web.ts\");\n        return await prompt(message, { type, defaultValue });\n    }\n    else if (isDeno || isNodeLike) {\n        const { default: prompt } = await import(\"./dialog/cli/prompt.ts\");\n        return await prompt(message, { defaultValue, type, mask, gui });\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\n//# sourceMappingURL=dialog.js.map","import { isBrowserWindow, isDeno, isNodeLike } from \"../env.ts\";\n/**\n * Opens the file picker dialog and pick a file, this function returns the\n * file's path or a `FileSystemFileHandle` in the browser.\n *\n * NOTE: Browser support is limited to the chromium-based browsers.\n *\n * @example\n * ```ts\n * // default usage\n * import { pickFile } from \"@ayonli/jsext/dialog\";\n *\n * // Node.js, Deno, Bun\n * const filename = await pickFile() as string | null;\n *\n * // Browser (Chrome)\n * const handle = await pickFile() as FileSystemFileHandle | null;\n * ```\n *\n * @example\n * ```ts\n * // filter by MIME type\n * import { pickFile } from \"@ayonli/jsext/dialog\";\n *\n * // Node.js, Deno, Bun\n * const filename = await pickFile({ type: \"image/*\" }) as string | null;\n *\n * // Browser (Chrome)\n * const handle = await pickFile({ type: \"image/*\" }) as FileSystemFileHandle | null;\n * ```\n *\n * @example\n * ```ts\n * // pick for save\n * import { pickFile } from \"@ayonli/jsext/dialog\";\n *\n * // Node.js, Deno, Bun\n * const filename = await pickFile({\n *     forSave: true,\n *     defaultName: \"hello.txt\",\n * }) as string | null;\n *\n * // Browser (Chrome)\n * const handle = await pickFile({\n *     forSave: true,\n *     defaultName: \"hello.txt\",\n * }) as FileSystemFileHandle | null;\n * ```\n */\nexport async function pickFile(options = {}) {\n    if (typeof globalThis[\"showOpenFilePicker\"] === \"function\") {\n        const { pickFile } = await import(\"./web/file.ts\");\n        return await pickFile(options);\n    }\n    else if (isDeno || isNodeLike) {\n        const { pickFile } = await import(\"./cli/file.ts\");\n        return await pickFile(options);\n    }\n    throw new Error(\"Unsupported platform\");\n}\n/**\n * Opens the file picker dialog and pick multiple files, this function returns\n * the paths or `FileSystemFileHandle` objects in the browser of the files\n * selected.\n *\n * NOTE: Browser support is limited to the chromium-based browsers.\n *\n * @example\n * ```ts\n * // default usage\n * import { pickFiles } from \"@ayonli/jsext/dialog\";\n *\n * // Node.js, Deno, Bun\n * const filenames = await pickFiles() as string[];\n *\n * // Browser (Chrome)\n * const handles = await pickFiles() as FileSystemFileHandle[];\n * ```\n *\n * @example\n * ```ts\n * // filter by MIME type\n * import { pickFiles } from \"@ayonli/jsext/dialog\";\n *\n * // Node.js, Deno, Bun\n * const filenames = await pickFiles({ type: \"image/*\" }) as string[];\n *\n * // Browser (Chrome)\n * const handles = await pickFiles({ type: \"image/*\" }) as FileSystemFileHandle[];\n * ```\n */\nexport async function pickFiles(options = {}) {\n    if (typeof globalThis[\"showOpenFilePicker\"] === \"function\") {\n        const { pickFiles } = await import(\"./web/file.ts\");\n        return await pickFiles(options);\n    }\n    else if (isDeno || isNodeLike) {\n        const { pickFiles } = await import(\"./cli/file.ts\");\n        return await pickFiles(options);\n    }\n    throw new Error(\"Unsupported platform\");\n}\n/**\n * Opens the file picker dialog and pick a directory, this function returns the\n * directory's path or `FileSystemDirectoryHandle` in the browser.\n *\n * NOTE: Browser support is limited to the chromium-based browsers.\n *\n * @example\n * ```ts\n * import { pickDirectory } from \"@ayonli/jsext/dialog\";\n *\n * // Node.js, Deno, Bun\n * const dirname = await pickDirectory() as string | null;\n *\n * // Browser (Chrome)\n * const handle = await pickDirectory() as FileSystemDirectoryHandle | null;\n * ```\n */\nexport async function pickDirectory(options = {}) {\n    if (typeof globalThis[\"showDirectoryPicker\"] === \"function\") {\n        const { pickDirectory } = await import(\"./web/file.ts\");\n        return await pickDirectory();\n    }\n    else if (isDeno || isNodeLike) {\n        const { pickDirectory } = await import(\"./cli/file.ts\");\n        return await pickDirectory(options);\n    }\n    throw new Error(\"Unsupported platform\");\n}\n/**\n * Opens the file picker dialog and selects a file to open.\n *\n * @example\n * ```ts\n * // default usage\n * import { openFile } from \"@ayonli/jsext/dialog\";\n *\n * const file = await openFile();\n *\n * if (file) {\n *     console.log(`You selected: ${file.name}`);\n * }\n * ```\n *\n * @example\n * ```ts\n * // filter by MIME type\n * import { openFile } from \"@ayonli/jsext/dialog\";\n *\n * const file = await openFile({ type: \"image/*\" });\n *\n * if (file) {\n *     console.log(`You selected: ${file.name}`);\n *     console.assert(file.type.startsWith(\"image/\"));\n * }\n * ```\n */\nexport async function openFile(options) {\n    if (isBrowserWindow) {\n        const { openFile } = await import(\"./web/file.ts\");\n        return await openFile(options);\n    }\n    else if (isDeno || isNodeLike) {\n        const { openFile } = await import(\"./cli/file.ts\");\n        return await openFile(options);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\n/**\n * Opens the file picker dialog and selects multiple files to open.\n *\n * @example\n * ```ts\n * // default usage\n * import { openFiles } from \"@ayonli/jsext/dialog\";\n *\n * const files = await openFiles();\n *\n * if (files.length > 0) {\n *     console.log(`You selected: ${files.map(file => file.name).join(\", \")}`);\n * }\n * ```\n *\n * @example\n * ```ts\n * // filter by MIME type\n * import { openFiles } from \"@ayonli/jsext/dialog\";\n *\n * const files = await openFiles({ type: \"image/*\" });\n *\n * if (files.length > 0) {\n *     console.log(`You selected: ${files.map(file => file.name).join(\", \")}`);\n *     console.assert(files.every(file => file.type.startsWith(\"image/\")));\n * }\n * ```\n */\nexport async function openFiles(options = {}) {\n    if (isBrowserWindow) {\n        const { openFiles } = await import(\"./web/file.ts\");\n        return await openFiles(options);\n    }\n    else if (isDeno || isNodeLike) {\n        const { openFiles } = await import(\"./cli/file.ts\");\n        return await openFiles(options);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\n/**\n * Opens the directory picker dialog and selects all its files to open.\n *\n * @example\n * ```ts\n * import { openDirectory } from \"@ayonli/jsext/dialog\";\n *\n * const files = await openDirectory();\n *\n * for (const file of files) {\n *     console.log(`File name: ${file.name}, path: ${file.webkitRelativePath}`);\n * }\n * ```\n */\nexport async function openDirectory(options = {}) {\n    if (isBrowserWindow) {\n        const { openDirectory } = await import(\"./web/file.ts\");\n        return await openDirectory();\n    }\n    else if (isDeno || isNodeLike) {\n        const { openDirectory } = await import(\"./cli/file.ts\");\n        return await openDirectory(options);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\nexport async function saveFile(file, options = {}) {\n    if (isBrowserWindow) {\n        const { saveFile } = await import(\"./web/file.ts\");\n        return await saveFile(file, options);\n    }\n    else if (isDeno || isNodeLike) {\n        const { saveFile } = await import(\"./cli/file.ts\");\n        return await saveFile(file, options);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\n/**\n * Downloads the file of the given URL to the file system.\n *\n * In the CLI, this function will open a dialog to let the user choose the\n * location where the file will be saved. In the browser, the file will be saved\n * to the default download location, or the browser will prompt the user to\n * choose a location.\n *\n * NOTE: This function depends on the Fetch API and Web Streams API, in Node.js,\n * it requires Node.js v18.0 or above.\n *\n * @example\n * ```ts\n * import { downloadFile } from \"@ayonli/jsext/dialog\";\n *\n * await downloadFile(\"https://ayonli.github.io/jsext/README.md\");\n * ```\n */\nexport async function downloadFile(url, options = {}) {\n    if (isBrowserWindow) {\n        const { downloadFile } = await import(\"./web/file.ts\");\n        return downloadFile(url, options);\n    }\n    else if (!isDeno && !isNodeLike || typeof fetch !== \"function\") {\n        throw new Error(\"Unsupported runtime\");\n    }\n    const { downloadFile } = await import(\"./cli/file.ts\");\n    return downloadFile(url, options);\n}\n//# sourceMappingURL=file.js.map","import { isBrowserWindow, isDeno, isNodeLike } from \"../env.ts\";\n/**\n * Displays a dialog with a progress bar indicating the ongoing state of the\n * `fn` function, and to wait until the job finishes or the user cancels the\n * dialog.\n *\n * @param onAbort If provided, the dialog will show a cancel button (or listen\n * for Escape in CLI) that allows the user to abort the task. This function can\n * either return a default/fallback result or throw an error to indicate the\n * cancellation.\n *\n * @example\n * ```ts\n * // default usage\n * import { progress } from \"@ayonli/jsext/dialog\";\n *\n * const result = await progress(\"Processing...\", async () => {\n *     // ... some long-running task\n *     return { ok: true };\n * });\n *\n * console.log(result); // { ok: true }\n * ```\n *\n * @example\n * ```ts\n * // update state\n * import { progress } from \"@ayonli/jsext/dialog\";\n *\n * const result = await progress(\"Processing...\", async (set) => {\n *     set({ percent: 0 });\n *     // ... some long-running task\n *     set({ percent: 50, message: \"Halfway there!\" });\n *     // ... some long-running task\n *     set({ percent: 100 });\n *\n *     return { ok: true };\n * });\n *\n * console.log(result); // { ok: true }\n * ```\n *\n * @example\n * ```ts\n * // abortable\n * import { progress } from \"@ayonli/jsext/dialog\";\n *\n * const result = await progress(\"Processing...\", async (set, signal) => {\n *     set({ percent: 0 });\n *\n *     if (!signal.aborted) {\n *         // ... some long-running task\n *         set({ percent: 50, message: \"Halfway there!\" });\n *     }\n *\n *     if (!signal.aborted) {\n *         // ... some long-running task\n *         set({ percent: 100 });\n *     }\n *\n *     return { ok: true };\n * }, () => {\n *     return { ok: false };\n * });\n *\n * console.log(result); // { ok: true } or { ok: false }\n * ```\n */\nexport default async function progress(message, fn, onAbort = undefined) {\n    if (isBrowserWindow) {\n        const { progress } = await import(\"./web.ts\");\n        return await progress(message, fn, onAbort);\n    }\n    else if (isDeno || isNodeLike) {\n        const { default: progress } = await import(\"./cli/progress.ts\");\n        return await progress(message, fn, onAbort);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\n//# sourceMappingURL=progress.js.map","import bytes from \"../bytes.ts\";\nimport { readAsArrayBuffer } from \"../reader.ts\";\nexport function toBytes(data) {\n    if (typeof data === \"string\") {\n        return bytes(data);\n    }\n    else if (data instanceof ArrayBuffer) {\n        return new Uint8Array(data);\n    }\n    else if (data instanceof Uint8Array) {\n        return data;\n    }\n    else if (ArrayBuffer.isView(data)) {\n        return new Uint8Array(data.buffer, data.byteOffset, data.byteLength);\n    }\n    else {\n        throw new TypeError(\"Unsupported data type\");\n    }\n}\nexport async function toBytesAsync(data) {\n    if (typeof data === \"string\" || data instanceof ArrayBuffer || ArrayBuffer.isView(data)) {\n        return toBytes(data);\n    }\n    else if (typeof ReadableStream === \"function\" && data instanceof ReadableStream) {\n        return new Uint8Array(await readAsArrayBuffer(data));\n    }\n    else if (typeof Blob === \"function\" && data instanceof Blob) {\n        return new Uint8Array(await data.arrayBuffer());\n    }\n    else {\n        throw new TypeError(\"Unsupported data type\");\n    }\n}\n//# sourceMappingURL=util.js.map","/**\n * A slim version of the `hash` module for the browser.\n *\n * Normally, we should just use the `hash` module, however, if we don't want\n * to include other parts that are not needed in the browser, we can use this\n * module instead.\n * @module\n */\nimport bytes, { text } from \"../bytes.ts\";\nimport { toBytes, toBytesAsync } from \"./util.ts\";\n/**\n * Calculates the hash of the given data, the result is a 32-bit unsigned integer.\n *\n * This function uses the same algorithm as the [string-hash](https://www.npmjs.com/package/string-hash)\n * package, non-string data are converted to strings before hashing.\n *\n * @example\n * ```ts\n * import hash from \"@ayonli/jsext/hash\";\n *\n * console.log(hash(\"Hello, World!\")); // 4010631688\n * console.log(hash(new Uint8Array([1, 2, 3]))); // 193378021\n * ```\n */\nexport default function hash(data) {\n    let str;\n    if (typeof data === \"string\") {\n        str = data;\n    }\n    else if (data instanceof ArrayBuffer) {\n        str = text(new Uint8Array(data));\n    }\n    else if (data instanceof Uint8Array) {\n        str = text(data);\n    }\n    else if (ArrayBuffer.isView(data)) {\n        const bytes = new Uint8Array(data.buffer, data.byteOffset, data.byteLength);\n        str = text(bytes);\n    }\n    else {\n        throw new TypeError(\"Unsupported data type\");\n    }\n    let hash = 5381;\n    let i = str.length;\n    while (i) {\n        hash = (hash * 33) ^ str.charCodeAt(--i);\n    }\n    /* JavaScript does bitwise operations (like XOR, above) on 32-bit signed\n     * integers. Since we want the results to be always positive, convert the\n     * signed int to an unsigned by doing an unsigned bitshift. */\n    return hash >>> 0;\n}\n/**\n * Calculates the Adler-32 checksum of the given data, the result is a 32-bit\n * unsigned integer.\n *\n * Adler-32 checksum is used in zlib and libpng, it is similar to CRC32 but\n * faster and less reliable.\n *\n * @param previous The previous Adler-32 value, default is `1`. This is useful\n * when calculating the checksum of a large data in chunks.\n *\n * @example\n * ```ts\n * import { adler32 } from \"@ayonli/jsext/hash\";\n *\n * console.log(adler32(\"Hello, World!\")); // 530449514\n * console.log(adler32(new Uint8Array([1, 2, 3]))); // 851975\n *\n * // calculate chunks\n * const chunks = [\"Hello, \", \"World!\"];\n * let checksum = 1;\n *\n * for (const chunk of chunks) {\n *     checksum = adler32(chunk, checksum);\n * }\n *\n * console.log(checksum); // 530449514\n * ```\n */\nexport function adler32(data, previous = 1) {\n    const bin = toBytes(data);\n    let a = previous & 0xffff;\n    let b = (previous >>> 16) & 0xffff;\n    for (let i = 0; i < bin.length; i++) {\n        a = (a + bin[i]) % 65521;\n        b = (b + a) % 65521;\n    }\n    return ((b << 16) | a) >>> 0;\n}\nconst CRC32_TABLE = (() => {\n    const IEEE = 0xedb88320;\n    const table = new Uint32Array(256);\n    // Fill the table\n    for (let i = 0; i < 256; i++) {\n        let crc = i;\n        for (let j = 0; j < 8; j++) {\n            crc = crc & 1 ? IEEE ^ crc >>> 1 : crc >>> 1;\n        }\n        table[i] = crc;\n    }\n    return table;\n})();\n/**\n * Calculates the CRC-32 checksum of the given data, the result is a 32-bit\n * unsigned integer.\n *\n * This function is based on IEEE polynomial, which is widely used by Ethernet\n * (IEEE 802.3), v.42, fddi, gzip, zip, png and other technologies.\n *\n * @param previous The previous checksum value, default is `0`. This is useful\n * when calculating the CRC of a large data in chunks.\n *\n * @example\n * ```ts\n * import { crc32 } from \"@ayonli/jsext/hash\";\n *\n * console.log(crc32(\"Hello, World!\")); // 3964322768\n * console.log(crc32(new Uint8Array([1, 2, 3]))); // 1438416925\n *\n * // calculate chunks\n * const chunks = [\"Hello, \", \"World!\"];\n * let checksum = 0;\n *\n * for (const chunk of chunks) {\n *     checksum = crc32(chunk, checksum);\n * }\n *\n * console.log(checksum); // 3964322768\n * ```\n */\nexport function crc32(data, previous = 0) {\n    const bin = toBytes(data);\n    let crc = ~~previous ^ -1;\n    for (let i = 0; i < bin.length; i++) {\n        crc = CRC32_TABLE[(crc ^ bin[i]) & 0xff] ^ crc >>> 8;\n    }\n    return (crc ^ -1) >>> 0;\n}\nexport async function sha1(data, encoding = undefined) {\n    const bytes = await toBytesAsync(data);\n    const hash = await crypto.subtle.digest(\"SHA-1\", bytes);\n    if (encoding === \"hex\") {\n        return text(new Uint8Array(hash), \"hex\");\n    }\n    else if (encoding === \"base64\") {\n        return text(new Uint8Array(hash), \"base64\");\n    }\n    else {\n        return hash;\n    }\n}\nexport async function sha256(data, encoding = undefined) {\n    const bytes = await toBytesAsync(data);\n    const hash = await crypto.subtle.digest(\"SHA-256\", bytes);\n    if (encoding === \"hex\") {\n        return text(new Uint8Array(hash), \"hex\");\n    }\n    else if (encoding === \"base64\") {\n        return text(new Uint8Array(hash), \"base64\");\n    }\n    else {\n        return hash;\n    }\n}\nexport async function sha512(data, encoding = undefined) {\n    const bytes = await toBytesAsync(data);\n    const hash = await crypto.subtle.digest(\"SHA-512\", bytes);\n    if (encoding === \"hex\") {\n        return text(new Uint8Array(hash), \"hex\");\n    }\n    else if (encoding === \"base64\") {\n        return text(new Uint8Array(hash), \"base64\");\n    }\n    else {\n        return hash;\n    }\n}\nexport async function hmac(algorithm, key, data, encoding = undefined) {\n    const keyBuffer = await crypto.subtle.importKey(\"raw\", bytes(key), {\n        name: \"HMAC\",\n        hash: {\n            \"sha1\": \"SHA-1\",\n            \"sha256\": \"SHA-256\",\n            \"sha512\": \"SHA-512\",\n        }[algorithm],\n    }, false, [\"sign\"]);\n    const dataBytes = await toBytesAsync(data);\n    const hash = await crypto.subtle.sign(\"HMAC\", keyBuffer, dataBytes);\n    if (encoding === \"hex\") {\n        return text(new Uint8Array(hash), \"hex\");\n    }\n    else if (encoding === \"base64\") {\n        return text(new Uint8Array(hash), \"base64\");\n    }\n    else {\n        return hash;\n    }\n}\n//# sourceMappingURL=web.js.map","/**\n * Simplified hash functions for various data types, based on the Web Crypto API\n * and `crypto` package in Node.js.\n * @module\n */\nimport bytes from \"./bytes.ts\";\nimport { isDeno, isNodeLike } from \"./env.ts\";\nimport { toBytesAsync } from \"./hash/util.ts\";\nimport hash, { adler32, crc32, sha1 as _sha1, sha256 as _sha256, sha512 as _sha512, hmac as _hmac, } from \"./hash/web.ts\";\nexport default hash;\nexport { adler32, crc32 };\nasync function nodeHash(algorithm, data, encoding = undefined) {\n    const crypto = await import(\"node:crypto\");\n    const bytes = await toBytesAsync(data);\n    const hash = crypto.createHash(algorithm);\n    hash.update(bytes);\n    if (encoding) {\n        return hash.digest(encoding);\n    }\n    else {\n        const result = hash.digest();\n        // Truncate the buffer to the actual byte length so it's consistent with the web API.\n        return result.buffer.slice(result.byteOffset, result.byteOffset + result.byteLength);\n    }\n}\nexport async function sha1(data, encoding = undefined) {\n    if (typeof crypto === \"object\" && typeof crypto.subtle === \"object\") {\n        return encoding ? _sha1(data, encoding) : _sha1(data);\n    }\n    else if (isDeno || isNodeLike) {\n        return nodeHash(\"sha1\", data, encoding);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\nexport async function sha256(data, encoding = undefined) {\n    if (typeof crypto === \"object\" && typeof crypto.subtle === \"object\") {\n        return encoding ? _sha256(data, encoding) : _sha256(data);\n    }\n    else if (isDeno || isNodeLike) {\n        return nodeHash(\"sha256\", data, encoding);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\nexport async function sha512(data, encoding = undefined) {\n    if (typeof crypto === \"object\" && typeof crypto.subtle === \"object\") {\n        return encoding ? _sha512(data, encoding) : _sha512(data);\n    }\n    else if (isDeno || isNodeLike) {\n        return nodeHash(\"sha512\", data, encoding);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\nexport async function md5(data, encoding = undefined) {\n    if (isDeno || isNodeLike) {\n        return nodeHash(\"md5\", data, encoding);\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\nexport async function hmac(algorithm, key, data, encoding = undefined) {\n    if (typeof crypto === \"object\" && typeof crypto.subtle === \"object\") {\n        return encoding ? _hmac(algorithm, key, data, encoding) : _hmac(algorithm, key, data);\n    }\n    else if (isDeno || isNodeLike) {\n        const crypto = await import(\"node:crypto\");\n        const binary = await toBytesAsync(data);\n        const hash = crypto.createHmac(algorithm, bytes(key));\n        hash.update(binary);\n        if (encoding) {\n            return hash.digest(encoding);\n        }\n        else {\n            const result = hash.digest();\n            // Truncate the buffer to the actual byte length so it's consistent with the web API.\n            return result.buffer.slice(result.byteOffset, result.byteOffset + result.byteLength);\n        }\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\n//# sourceMappingURL=hash.js.map","var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\n/**\n * This module provides tools for working with server-sent events.\n *\n * The {@link EventEndpoint} is used to handle SSE requests on the server\n * and send messages to the client, while the {@link EventSource} and the\n * {@link EventConsumer} are used to read and process messages sent by the\n * server.\n *\n * Despite their names, these classes can be used in both the browser/client\n * and the server environments.\n *\n * NOTE: This module depends on the Fetch API and Web Streams API, in Node.js,\n * it requires Node.js v18.0 or above.\n * @module\n */\nimport \"./external/event-target-polyfill/index.ts\";\nimport { fixStringTag, getReadonly, setReadonly } from \"./class/util.ts\";\nimport { createCloseEvent, createErrorEvent } from \"./event.ts\";\nimport { isBun, isDeno } from \"./env.ts\";\nimport runtime, { customInspect } from \"./runtime.ts\";\nimport _try from \"./try.ts\";\nif (typeof MessageEvent !== \"function\" || runtime().identity === \"workerd\") {\n    // Worker environments does not implement or only partially implement the MessageEvent, \n    // we need to implement it ourselves.\n    globalThis.MessageEvent = class MessageEvent extends Event {\n        constructor(type, eventInitDict = undefined) {\n            var _o, _p, _q;\n            super(type, eventInitDict);\n            this.data = undefined;\n            this.lastEventId = \"\";\n            this.origin = \"\";\n            this.ports = [];\n            this.source = null;\n            if (eventInitDict) {\n                this.data = eventInitDict.data;\n                this.lastEventId = (_o = eventInitDict.lastEventId) !== null && _o !== void 0 ? _o : \"\";\n                this.origin = (_p = eventInitDict.origin) !== null && _p !== void 0 ? _p : \"\";\n                this.ports = (_q = eventInitDict.ports) !== null && _q !== void 0 ? _q : [];\n            }\n        }\n        initMessageEvent(type, bubbles = false, cancelable = false, data = null, origin = \"\", lastEventId = \"\", source = null, ports = []) {\n            this.initEvent(type, bubbles !== null && bubbles !== void 0 ? bubbles : false, cancelable !== null && cancelable !== void 0 ? cancelable : false);\n            Object.assign(this, { data, origin, lastEventId, source, ports });\n        }\n    };\n}\nconst encoder = new TextEncoder();\nconst decoder = new TextDecoder();\nconst SSEMarkClosed = new Set();\nconst _closed = Symbol.for(\"closed\");\nconst _request = Symbol.for(\"request\");\nconst _response = Symbol.for(\"response\");\nconst _writer = Symbol.for(\"writer\");\nconst _lastEventId = Symbol.for(\"lastEventId\");\nconst _reconnectionTime = Symbol.for(\"reconnectionTime\");\nconst _retry = Symbol.for(\"retry\");\nconst _timer = Symbol.for(\"timer\");\nconst _controller = Symbol.for(\"controller\");\nconst _onopen = Symbol.for(\"onopen\");\nconst _onerror = Symbol.for(\"onerror\");\nconst _onmessage = Symbol.for(\"onmessage\");\n/**\n * An SSE (server-sent events) implementation that can be used to send messages\n * to the client. This implementation is based on the `EventTarget` interface\n * and conforms the web standard.\n *\n * **Events:**\n *\n * - `close` - Dispatched when the connection is closed.\n *\n * @example\n * ```ts\n * // with Web APIs\n * import { EventEndpoint } from \"@ayonli/jsext/sse\";\n *\n * export default {\n *     async fetch(req: Request) {\n *         const events = new EventEndpoint(req);\n *\n *         events.addEventListener(\"close\", (ev) => {\n *             console.log(`The connection is closed, reason: ${ev.reason}`);\n *         });\n *\n *         setTimeout(() => {\n *             events.dispatchEvent(new MessageEvent(\"my-event\", {\n *                 data: \"Hello, World!\",\n *                 lastEventId: \"1\",\n *             }));\n *         }, 1_000);\n *\n *         return events.response!;\n *     }\n * }\n * ```\n *\n * @example\n * ```ts\n * // with Node.js APIs\n * import * as http from \"node:http\";\n * import { EventEndpoint } from \"@ayonli/jsext/sse\";\n *\n * const server = http.createServer((req, res) => {\n *     const events = new EventEndpoint(req, res);\n *\n *     events.addEventListener(\"close\", (ev) => {\n *         console.log(`The connection is closed, reason: ${ev.reason}`);\n *     });\n *\n *     setTimeout(() => {\n *         events.dispatchEvent(new MessageEvent(\"my-event\", {\n *             data: \"Hello, World!\",\n *             lastEventId: \"1\",\n *         }));\n *     }, 1_000);\n * });\n *\n * server.listen(3000);\n * ```\n */\nexport class EventEndpoint extends EventTarget {\n    constructor(request, ...args) {\n        var _o, _p, _q, _r, _s;\n        super();\n        const isNodeRequest = \"socket\" in request && \"socket\" in args[0];\n        let options;\n        if (isNodeRequest) {\n            const req = request;\n            this[_lastEventId] = String((_o = req.headers[\"last-event-id\"]) !== null && _o !== void 0 ? _o : \"\");\n            options = (_p = args[1]) !== null && _p !== void 0 ? _p : {};\n        }\n        else {\n            this[_lastEventId] = (_q = request.headers.get(\"Last-Event-ID\")) !== null && _q !== void 0 ? _q : \"\";\n            options = (_r = args[0]) !== null && _r !== void 0 ? _r : {};\n        }\n        this[_reconnectionTime] = (_s = options.reconnectionTime) !== null && _s !== void 0 ? _s : 0;\n        this[_closed] = this[_lastEventId]\n            ? SSEMarkClosed.has(this[_lastEventId])\n            : false;\n        const resInit = {\n            status: this.closed ? 204 : 200,\n            statusText: this.closed ? \"No Content\" : \"OK\",\n            headers: {\n                \"Content-Type\": \"text/event-stream\",\n                \"Cache-Control\": \"no-cache\",\n                \"Connection\": \"keep-alive\",\n                \"Transfer-Encoding\": \"chunked\",\n                \"X-Accel-Buffering\": \"no\", // For Nginx\n            },\n        };\n        const _this = this;\n        if (isNodeRequest) {\n            this[_response] = null;\n            const res = args[0];\n            const writable = new WritableStream({\n                write(chunk) {\n                    res.write(chunk);\n                },\n                close() {\n                    res.closed || res.end();\n                    _this[_closed] = true;\n                    _this.dispatchEvent(createCloseEvent(\"close\", { wasClean: true }));\n                },\n                abort(err) {\n                    res.closed || res.destroy(err);\n                },\n            });\n            this[_writer] = writable.getWriter();\n            res.once(\"close\", () => {\n                this[_writer].close().catch(() => { });\n            }).once(\"error\", (err) => {\n                this[_writer].abort(err).catch(() => { });\n            });\n            for (const [name, value] of Object.entries(resInit.headers)) {\n                // Use `setHeader` to set headers instead of passing them to `writeHead`,\n                // it seems in Deno, the headers are not written to the response if they\n                // are passed to `writeHead`.\n                res.setHeader(name, value);\n            }\n            res.writeHead(resInit.status, resInit.statusText);\n            res.write(new Uint8Array(0));\n        }\n        else {\n            const { writable, readable } = new TransformStream();\n            const reader = readable.getReader();\n            const _readable = new ReadableStream({\n                async start(controller) {\n                    if (isBun) {\n                        // In Bun, the response will not be sent to the client\n                        // until the first non-empty chunk is written. May be a\n                        // bug, but we need to work around it now.\n                        controller.enqueue(encoder.encode(\":ok\\n\\n\"));\n                    }\n                    else {\n                        controller.enqueue(new Uint8Array(0));\n                    }\n                },\n                async pull(controller) {\n                    while (true) {\n                        const { done, value } = await reader.read();\n                        if (done) {\n                            try {\n                                controller.close();\n                            }\n                            catch (_o) { }\n                            _this[_closed] = true;\n                            _this.dispatchEvent(createCloseEvent(\"close\", { wasClean: true }));\n                            break;\n                        }\n                        controller.enqueue(value);\n                    }\n                },\n                async cancel(reason) {\n                    await reader.cancel(reason);\n                }\n            });\n            this[_writer] = writable.getWriter();\n            this[_response] = new Response(this.closed ? null : _readable, resInit);\n        }\n        this.closed && this.close();\n    }\n    /**\n     * The last event ID that the server has sent.\n     */\n    get lastEventId() {\n        return this[_lastEventId];\n    }\n    /**\n     * Indicates whether the connection has been closed.\n     */\n    get closed() {\n        return this[_closed];\n    }\n    /**\n     * The response that will be sent to the client, only available when the\n     * instance is created with the `Request` API.\n     */\n    get response() {\n        return this[_response];\n    }\n    addEventListener(event, listener, options = undefined) {\n        return super.addEventListener(event, listener, options);\n    }\n    removeEventListener(type, listener, options = undefined) {\n        return super.removeEventListener(type, listener, options);\n    }\n    dispatchEvent(event) {\n        if (event instanceof MessageEvent) {\n            if (event.type === \"message\") {\n                this.send(event.data, event.lastEventId).catch(() => { });\n            }\n            else {\n                this.sendEvent(event.type, event.data, event.lastEventId)\n                    .catch(() => { });\n            }\n            return !event.cancelable || !event.defaultPrevented;\n        }\n        else {\n            return super.dispatchEvent(event);\n        }\n    }\n    buildMessage(data, options = {}) {\n        let message = \"\";\n        if (options.id) {\n            this[_lastEventId] = options.id;\n            message += `id: ${options.id}\\n`;\n        }\n        if (options.event) {\n            message += `event: ${options.event}\\n`;\n        }\n        if (this[_reconnectionTime]) {\n            message += `retry: ${this[_reconnectionTime]}\\n`;\n        }\n        message += data.split(/\\r\\n|\\n/).map((line) => `data: ${line}\\n`).join(\"\");\n        message += \"\\n\";\n        return encoder.encode(message);\n    }\n    /**\n     * Sends a message to the client.\n     *\n     * The client (`EventSource` or {@link EventConsumer}) will receive the\n     * message as a `MessageEvent`, which can be listened to using the\n     * `message` event.\n     *\n     * @param eventId If specified, the client will remember the value as the\n     * last event ID and will send it back to the server when reconnecting.\n     */\n    async send(data, eventId = undefined) {\n        await this[_writer].write(this.buildMessage(data, { id: eventId }));\n    }\n    /**\n     * Sends a custom event to the client.\n     *\n     * The client (`EventSource` or {@link EventConsumer}) will receive the\n     * event as a `MessageEvent`, which can be listened to using the custom\n     * event name.\n     *\n     * @param eventId If specified, the client will remember the value as the\n     * last event ID and will send it back to the server when reconnecting.\n     */\n    async sendEvent(event, data, eventId = undefined) {\n        await this[_writer].write(this.buildMessage(data, { id: eventId, event }));\n    }\n    /**\n     * Closes the connection.\n     *\n     * By default, when the connection is closed, the client will try to\n     * reconnect after a certain period of time, which is specified by the\n     * `reconnectionTime` option when creating the instance.\n     *\n     * However, if the `noReconnect` parameter is set, this method will mark\n     * the client as closed based on the last event ID. When the client\n     * reconnects, the server will send a `204 No Content` response to the\n     * client to instruct it to terminate the connection.\n     *\n     * It is important to note that the server depends on the last event ID to\n     * identify the client for this purpose, so the server must send a globally\n     * unique `lastEventId` to the client when sending messages.\n     */\n    close(noReconnect = false) {\n        this[_writer].close().catch(() => { }).finally(() => {\n            this[_closed] = true;\n            if (this.lastEventId) {\n                if (!SSEMarkClosed.has(this.lastEventId)) {\n                    noReconnect && SSEMarkClosed.add(this.lastEventId);\n                }\n                else {\n                    SSEMarkClosed.delete(this.lastEventId);\n                }\n            }\n        });\n    }\n}\nfixStringTag(EventEndpoint);\nasync function readAndProcessResponse(response, handlers) {\n    const reader = response.body.getReader();\n    let buffer = \"\";\n    try {\n        while (true) {\n            const { done, value } = await reader.read();\n            if (done) {\n                handlers.onEnd();\n                break;\n            }\n            buffer += decoder.decode(value);\n            const chunks = buffer.split(/\\r\\n\\r\\n|\\n\\n/);\n            if (chunks.length === 1) {\n                continue;\n            }\n            else {\n                buffer = chunks.pop();\n            }\n            for (const chunk of chunks) {\n                const lines = chunk.split(/\\r\\n|\\n/);\n                let data = \"\";\n                let type = \"message\";\n                let isMessage = false;\n                for (const line of lines) {\n                    if (line.startsWith(\"data:\") || line === \"data\") {\n                        let value = line.slice(5);\n                        if (value[0] === \" \") {\n                            value = value.slice(1);\n                        }\n                        if (data) {\n                            data += \"\\n\" + value;\n                        }\n                        else {\n                            data = value;\n                        }\n                        isMessage = true;\n                    }\n                    else if (line.startsWith(\"event:\") || line === \"event\") {\n                        type = line.slice(6).trim();\n                        isMessage = true;\n                    }\n                    else if (line.startsWith(\"id:\") || line === \"id\") {\n                        handlers.onId(line.slice(3).trim());\n                        isMessage = true;\n                    }\n                    else if (line.startsWith(\"retry:\")) {\n                        const time = parseInt(line.slice(6).trim());\n                        if (!isNaN(time) && time >= 0) {\n                            handlers.onRetry(time);\n                            isMessage = true;\n                        }\n                    }\n                }\n                if (isMessage) {\n                    handlers.onData(data, type || \"message\");\n                }\n            }\n        }\n    }\n    catch (error) {\n        handlers.onError(error);\n    }\n}\n/**\n * This is an implementation of the\n * [EventSource](https://developer.mozilla.org/en-US/docs/Web/API/EventSource)\n * API that serves as a polyfill in environments that do not have native support,\n * such as Node.js.\n *\n * NOTE: This API depends on the Fetch API and Web Streams API, in Node.js, it\n * requires Node.js v18.0 or above.\n *\n * @example\n * ```ts\n * import { EventSource } from \"@ayonli/jsext/sse\";\n *\n * globalThis.EventSource ??= EventSource;\n *\n * const events = new EventSource(\"http://localhost:3000\");\n *\n * events.addEventListener(\"open\", () => {\n *     console.log(\"The connection is open.\");\n * });\n *\n * events.addEventListener(\"error\", (ev) => {\n *     console.error(\"An error occurred:\", ev.error);\n * });\n *\n * events.addEventListener(\"message\", (ev) => {\n *     console.log(\"Received message from the server:\", ev.data);\n * });\n *\n * events.addEventListener(\"my-event\", (ev) => {\n *     console.log(\"Received custom event from the server:\", ev.data);\n * });\n * ```\n */\nexport class EventSource extends EventTarget {\n    get url() {\n        var _o;\n        return (_o = getReadonly(this, \"url\")) !== null && _o !== void 0 ? _o : \"\";\n    }\n    get withCredentials() {\n        var _o;\n        return (_o = getReadonly(this, \"withCredentials\")) !== null && _o !== void 0 ? _o : false;\n    }\n    get readyState() {\n        var _o;\n        return (_o = getReadonly(this, \"readyState\")) !== null && _o !== void 0 ? _o : this.CONNECTING;\n    }\n    get onopen() {\n        var _o;\n        return (_o = this[_onopen]) !== null && _o !== void 0 ? _o : null;\n    }\n    set onopen(value) {\n        this[_onopen] = value;\n    }\n    get onmessage() {\n        var _o;\n        return (_o = this[_onmessage]) !== null && _o !== void 0 ? _o : null;\n    }\n    set onmessage(value) {\n        this[_onmessage] = value;\n    }\n    get onerror() {\n        var _o;\n        return (_o = this[_onerror]) !== null && _o !== void 0 ? _o : null;\n    }\n    set onerror(value) {\n        this[_onerror] = value;\n    }\n    constructor(url, options = {}) {\n        var _o;\n        super();\n        this[_a] = new AbortController();\n        this[_b] = null;\n        this[_c] = \"\";\n        this[_d] = 0;\n        this[_e] = 0;\n        this[_f] = null;\n        this[_g] = null;\n        this[_h] = null;\n        this[_j] = null;\n        this.CONNECTING = EventSource.CONNECTING;\n        this.OPEN = EventSource.OPEN;\n        this.CLOSED = EventSource.CLOSED;\n        url = typeof url === \"object\" ? url.href : new URL(url, typeof location === \"object\" ? location.href : undefined).href;\n        setReadonly(this, \"url\", url);\n        setReadonly(this, \"withCredentials\", (_o = options.withCredentials) !== null && _o !== void 0 ? _o : false);\n        setReadonly(this, \"readyState\", this.CONNECTING);\n        setReadonly(this, \"CONNECTING\", EventSource.CONNECTING);\n        setReadonly(this, \"OPEN\", EventSource.OPEN);\n        setReadonly(this, \"CLOSED\", EventSource.CLOSED);\n        this.connect().catch(() => { });\n    }\n    async connect() {\n        var _o, _p, _q, _r, _s, _t;\n        if (this.readyState === this.CLOSED) {\n            return;\n        }\n        setReadonly(this, \"readyState\", this.CONNECTING);\n        const headers = {\n            \"Accept\": \"text/event-stream\",\n        };\n        if (this[_lastEventId]) {\n            headers[\"Last-Event-ID\"] = this[_lastEventId];\n        }\n        this[_request] = new Request(this.url, {\n            headers,\n            credentials: this.withCredentials ? \"include\" : \"same-origin\",\n            cache: \"no-store\",\n            signal: this[_controller].signal,\n        });\n        const [err, res] = await _try(fetch(this[_request]));\n        if (err || (res === null || res === void 0 ? void 0 : res.type) === \"error\") {\n            const event = createErrorEvent(\"error\", {\n                error: err || new Error(`Failed to fetch '${this.url}'`),\n            });\n            this.dispatchEvent(event);\n            (_o = this.onerror) === null || _o === void 0 ? void 0 : _o.call(this, event);\n            this.tryReconnect();\n            return;\n        }\n        else if (res.status === 204) { // No more data, close the connection\n            setReadonly(this, \"readyState\", this.CLOSED);\n            return;\n        }\n        else if (res.status !== 200) {\n            setReadonly(this, \"readyState\", this.CLOSED);\n            const event = createErrorEvent(\"error\", {\n                error: new TypeError(`The server responded with status ${res.status}.`),\n            });\n            this.dispatchEvent(event);\n            (_p = this.onerror) === null || _p === void 0 ? void 0 : _p.call(this, event);\n            return;\n        }\n        else if (!((_q = res.headers.get(\"Content-Type\")) === null || _q === void 0 ? void 0 : _q.startsWith(\"text/event-stream\"))) {\n            setReadonly(this, \"readyState\", this.CLOSED);\n            const event = createErrorEvent(\"error\", {\n                error: new TypeError(\"The response is not an event stream.\"),\n            });\n            this.dispatchEvent(event);\n            (_r = this.onerror) === null || _r === void 0 ? void 0 : _r.call(this, event);\n            return;\n        }\n        else if (!res.body) {\n            setReadonly(this, \"readyState\", this.CLOSED);\n            const event = createErrorEvent(\"error\", {\n                error: new TypeError(\"The response does not have a body.\"),\n            });\n            this.dispatchEvent(event);\n            (_s = this.onerror) === null || _s === void 0 ? void 0 : _s.call(this, event);\n            return;\n        }\n        setReadonly(this, \"readyState\", this.OPEN);\n        this[_retry] = 0;\n        const event = new Event(\"open\");\n        this.dispatchEvent(event);\n        (_t = this.onopen) === null || _t === void 0 ? void 0 : _t.call(this, event);\n        const origin = new URL(res.url || this.url).origin;\n        await readAndProcessResponse(res, {\n            onId: (id) => {\n                this[_lastEventId] = id;\n            },\n            onRetry: (time) => {\n                this[_reconnectionTime] = time;\n            },\n            onData: (data, event) => {\n                var _o;\n                const _event = new MessageEvent(event, {\n                    lastEventId: this[_lastEventId],\n                    data,\n                    origin,\n                });\n                this.dispatchEvent(_event);\n                (_o = this.onmessage) === null || _o === void 0 ? void 0 : _o.call(this, _event);\n            },\n            onError: (error) => {\n                var _o;\n                if (this.readyState !== this.CLOSED) {\n                    const event = createErrorEvent(\"error\", { error });\n                    this.dispatchEvent(event);\n                    (_o = this.onerror) === null || _o === void 0 ? void 0 : _o.call(this, event);\n                    this.tryReconnect();\n                }\n            },\n            onEnd: () => {\n                var _o;\n                if (this.readyState !== this.CLOSED) {\n                    const event = createErrorEvent(\"error\", {\n                        error: new Error(\"The connection is interrupted.\"),\n                    });\n                    this.dispatchEvent(event);\n                    (_o = this.onerror) === null || _o === void 0 ? void 0 : _o.call(this, event);\n                    this.tryReconnect();\n                }\n            },\n        });\n    }\n    tryReconnect() {\n        setReadonly(this, \"readyState\", this.CONNECTING);\n        this[_timer] && clearTimeout(this[_timer]);\n        this[_timer] = setTimeout(() => {\n            this.connect().catch(() => { });\n        }, this[_reconnectionTime] || 1000 * Math.min(30, Math.pow(2, this[_retry]++)));\n    }\n    /**\n     * Closes the connection.\n     */\n    close() {\n        if (this[_timer]) {\n            clearTimeout(this[_timer]);\n            this[_timer] = null;\n        }\n        setReadonly(this, \"readyState\", this.CLOSED);\n        this[_controller].abort();\n    }\n    addEventListener(event, listener, options = undefined) {\n        return super.addEventListener(event, listener, options);\n    }\n    removeEventListener(type, listener, options = undefined) {\n        return super.removeEventListener(type, listener, options);\n    }\n    [(_a = _controller, _b = _request, _c = _lastEventId, _d = _reconnectionTime, _e = _retry, _f = _timer, _g = _onopen, _h = _onmessage, _j = _onerror, customInspect)]() {\n        const _this = this;\n        if (isDeno) {\n            return \"EventSource \" + Deno.inspect({\n                readyState: _this.readyState,\n                url: _this.url,\n                withCredentials: _this.withCredentials,\n                onopen: _this.onopen,\n                onmessage: _this.onmessage,\n                onerror: _this.onerror,\n            }, { colors: true });\n        }\n        else {\n            return new class EventSource {\n                constructor() {\n                    this.readyState = _this.readyState;\n                    this.url = _this.url;\n                    this.withCredentials = _this.withCredentials;\n                    this.onopen = _this.onopen;\n                    this.onmessage = _this.onmessage;\n                    this.onerror = _this.onerror;\n                }\n            };\n        }\n    }\n}\nEventSource.CONNECTING = 0;\nEventSource.OPEN = 1;\nEventSource.CLOSED = 2;\nfixStringTag(EventSource);\n/**\n * Unlike the {@link EventSource} API, which takes a URL and only supports GET\n * request, the {@link EventConsumer} API accepts a `Response` object and reads\n * the messages from its body, the response can be generated from any type of\n * request, usually returned from the `fetch` function.\n *\n * This API doesn't support active closure and reconnection, however, we can\n * use `AbortController` in the request to terminate the connection, and add\n * a event listener to the close event and reestablish the connection manually.\n *\n * **Events:**\n *\n * - `error` - Dispatched when an error occurs, such as network failure. After\n *   this event is dispatched, the connection will be closed and the `close`\n *   event will be dispatched.\n * - `close` - Dispatched when the connection is closed. If the connection is\n *   closed due to some error, the `error` event will be dispatched before this\n *   event, and the close event will have the `wasClean` set to `false`, and the\n *   `reason` property contains the error message, if any.\n * - `message` - Dispatched when a message with the default event type is\n *   received.\n * - custom events - Dispatched when a message with a custom event type is\n *   received.\n *\n * NOTE: This API depends on the Fetch API and Web Streams API, in Node.js, it\n * requires Node.js v18.0 or above.\n *\n * @example\n * ```ts\n * import { EventConsumer } from \"@ayonli/jsext/sse\";\n *\n * const response = await fetch(\"http://localhost:3000\", {\n *     method: \"POST\",\n *     headers: {\n *         \"Accept\": \"text/event-stream\",\n *     },\n * });\n * const events = new EventConsumer(response);\n *\n * events.addEventListener(\"close\", (ev) => {\n *     console.log(`The connection is closed, reason: ${ev.reason}`);\n *\n *     if (!ev.wasClean) {\n *         // perhaps to reestablish the connection\n *     }\n * });\n *\n * events.addEventListener(\"my-event\", (ev) => {\n *     console.log(`Received message from the server: ${ev.data}`);\n * });\n * ```\n */\nexport class EventConsumer extends EventTarget {\n    constructor(response) {\n        var _o;\n        super();\n        this[_k] = \"\";\n        this[_l] = 0;\n        this[_m] = false;\n        if (!response.body) {\n            throw new TypeError(\"The response does not have a body.\");\n        }\n        else if (response.bodyUsed) {\n            throw new TypeError(\"The response body has already been used.\");\n        }\n        else if (response.body.locked) {\n            throw new TypeError(\"The response body is locked.\");\n        }\n        else if (!((_o = response.headers.get(\"Content-Type\")) === null || _o === void 0 ? void 0 : _o.startsWith(\"text/event-stream\"))) {\n            throw new TypeError(\"The response is not an event stream.\");\n        }\n        const origin = response.url ? new URL(response.url).origin : \"\";\n        readAndProcessResponse(response, {\n            onId: (id) => {\n                this[_lastEventId] = id;\n            },\n            onRetry: (time) => {\n                this[_reconnectionTime] = time;\n            },\n            onData: (data, event) => {\n                this.dispatchEvent(new MessageEvent(event, {\n                    lastEventId: this[_lastEventId],\n                    data,\n                    origin,\n                }));\n            },\n            onError: (error) => {\n                this[_closed] = true;\n                this.dispatchEvent(createErrorEvent(\"error\", { error }));\n                this.dispatchEvent(createCloseEvent(\"close\", {\n                    reason: error instanceof Error ? error.message : String(error),\n                    wasClean: false,\n                }));\n            },\n            onEnd: () => {\n                this[_closed] = true;\n                this.dispatchEvent(createCloseEvent(\"close\", { wasClean: true }));\n            },\n        }).catch(() => { });\n    }\n    /**\n     * The last event ID that the server has sent.\n     */\n    get lastEventId() {\n        return this[_lastEventId];\n    }\n    /**\n     * The time in milliseconds that instructs the client to wait before\n     * reconnecting.\n     *\n     * NOTE: The {@link EventConsumer} API does not support auto-reconnection,\n     * this value is only used when we want to reestablish the connection\n     * manually.\n     */\n    get retry() {\n        return this[_reconnectionTime];\n    }\n    /**\n     * Indicates whether the connection has been closed.\n     */\n    get closed() {\n        return this[_closed];\n    }\n    addEventListener(event, listener, options = undefined) {\n        return super.addEventListener(event, listener, options);\n    }\n    removeEventListener(type, listener, options = undefined) {\n        return super.removeEventListener(type, listener, options);\n    }\n}\n_k = _lastEventId, _l = _reconnectionTime, _m = _closed;\nfixStringTag(EventConsumer);\n//# sourceMappingURL=sse.js.map","export function setReadonly(obj, name, value) {\n    Object.defineProperty(obj, name, {\n        configurable: true,\n        enumerable: false,\n        writable: false,\n        value,\n    });\n}\nexport function getReadonly(obj, name) {\n    var _a;\n    return (_a = Object.getOwnPropertyDescriptor(obj, name)) === null || _a === void 0 ? void 0 : _a.value;\n}\nexport function fixStringTag(ctor) {\n    setReadonly(ctor.prototype, Symbol.toStringTag, ctor.name);\n}\n//# sourceMappingURL=util.js.map","var _a, _b, _c;\nimport { until } from \"../async.ts\";\nimport { isBun, isDeno, isNode } from \"../env.ts\";\nimport runtime, { env } from \"../runtime.ts\";\nimport { createRequestContext, createTimingFunctions, listenFetchEvent, withHeaders, patchTimingMetrics, } from \"./internal.ts\";\nexport function constructNetAddress(addr) {\n    Object.assign(addr, {\n        family: addr.hostname.includes(\":\") ? \"IPv6\" : \"IPv4\",\n    });\n    Object.defineProperty(addr, \"address\", {\n        enumerable: false,\n        get() {\n            return this.hostname;\n        },\n    });\n    return addr;\n}\nconst _hostname = Symbol.for(\"hostname\");\nconst _port = Symbol.for(\"port\");\nconst _http = Symbol.for(\"http\");\nconst _controller = Symbol.for(\"controller\");\n/**\n * A unified HTTP server interface.\n */\nexport class HttpServer {\n    constructor(impl, options) {\n        var _d, _e, _f;\n        this[_a] = \"0.0.0.0\";\n        this[_b] = 0;\n        this[_c] = null;\n        this.type = (_d = options.type) !== null && _d !== void 0 ? _d : \"classic\";\n        const { fetch: handle, ws, headers, secure } = options;\n        const onError = (_e = options.onError) !== null && _e !== void 0 ? _e : ((err) => {\n            console.error(err);\n            return new Response(\"Internal Server Error\", {\n                status: 500,\n                statusText: \"Internal Server Error\",\n            });\n        });\n        const defaultOnListen = ({ hostname, port }) => {\n            const _hostname = hostname === \"0.0.0.0\" ? \"localhost\" : hostname;\n            const protocol = secure ? \"https\" : \"http\";\n            console.log(`Server listening on ${protocol}://${_hostname}:${port}`);\n        };\n        const onListen = this.type === \"classic\"\n            ? ((_f = options.onListen) !== null && _f !== void 0 ? _f : defaultOnListen)\n            : defaultOnListen;\n        this[_http] = impl().then(({ http, hostname, port, controller }) => {\n            this[_hostname] = hostname;\n            this[_port] = port;\n            this[_controller] = controller;\n            if (http || isBun) {\n                onListen({ hostname, port });\n            }\n            return http;\n        });\n        if (isDeno) {\n            if (this.type === \"classic\") {\n                delete this.fetch;\n            }\n            else {\n                this.fetch = (req, info) => {\n                    const { getTimers, time, timeEnd } = createTimingFunctions();\n                    const ctx = createRequestContext(req, {\n                        ws,\n                        remoteAddress: info ? constructNetAddress({\n                            hostname: info.remoteAddr.hostname,\n                            port: info.remoteAddr.port,\n                        }) : null,\n                        time,\n                        timeEnd,\n                    });\n                    const _handle = withHeaders(handle, headers);\n                    const _onError = withHeaders(onError, headers);\n                    return _handle(req, ctx)\n                        .then(res => patchTimingMetrics(res, getTimers()))\n                        .catch(err => _onError(err, req, ctx));\n                };\n            }\n        }\n        else if (isBun) {\n            if (this.type === \"classic\") {\n                delete this.fetch;\n            }\n            else {\n                this.fetch = (req, server) => {\n                    ws.bunBind(server);\n                    const { getTimers, time, timeEnd } = createTimingFunctions();\n                    const addr = server.requestIP(req);\n                    const ctx = createRequestContext(req, {\n                        ws,\n                        remoteAddress: addr ? constructNetAddress({\n                            hostname: addr.address,\n                            port: addr.port,\n                        }) : null,\n                        time,\n                        timeEnd,\n                    });\n                    const _handle = withHeaders(handle, headers);\n                    const _onError = withHeaders(onError, headers);\n                    return _handle(req, ctx)\n                        .then(res => patchTimingMetrics(res, getTimers()))\n                        .catch(err => _onError(err, req, ctx));\n                };\n                Object.assign(this, {\n                    // Bun specific properties\n                    websocket: ws.bunListener,\n                });\n            }\n        }\n        else if (isNode) {\n            if (this.type === \"classic\") {\n                delete this.fetch;\n            }\n            else {\n                this.fetch = (req, ctx) => {\n                    const _handle = withHeaders(handle, headers);\n                    const _onError = withHeaders(onError, headers);\n                    return _handle(req, ctx)\n                        .catch(err => _onError(err, req, ctx));\n                };\n            }\n        }\n        else if (typeof addEventListener === \"function\") {\n            if (this.type === \"classic\") {\n                let bindings;\n                if (runtime().identity === \"workerd\") {\n                    bindings = {};\n                    Object.keys(globalThis).forEach((key) => {\n                        if (/^[A-Z][A-Z0-9_]*$/.test(key)) {\n                            // @ts-ignore\n                            bindings[key] = globalThis[key];\n                        }\n                    });\n                    env(bindings);\n                }\n                listenFetchEvent({ ws, fetch: handle, onError, headers, bindings });\n            }\n            else {\n                this.fetch = (req, bindings, _ctx) => {\n                    var _d;\n                    if (bindings && typeof bindings === \"object\" && !Array.isArray(bindings)) {\n                        env(bindings);\n                    }\n                    const address = req.headers.get(\"cf-connecting-ip\");\n                    const { getTimers, time, timeEnd } = createTimingFunctions();\n                    const ctx = createRequestContext(req, {\n                        ws,\n                        remoteAddress: address ? constructNetAddress({\n                            hostname: address,\n                            port: 0,\n                        }) : null,\n                        time,\n                        timeEnd,\n                        waitUntil: (_d = _ctx.waitUntil) === null || _d === void 0 ? void 0 : _d.bind(_ctx),\n                        bindings,\n                    });\n                    const _handle = withHeaders(handle, headers);\n                    const _onError = withHeaders(onError, headers);\n                    return _handle(req, ctx)\n                        .then(res => patchTimingMetrics(res, getTimers()))\n                        .catch(err => _onError(err, req, ctx));\n                };\n            }\n        }\n    }\n    /**\n     * The hostname of which the server is listening on, only available after\n     * the server is ready and the server type is `classic`.\n     */\n    get hostname() {\n        return this[_hostname] || \"\";\n    }\n    /**\n     * The port of which the server is listening on, only available after the\n     * server is ready and the server type is `classic`.\n     */\n    get port() {\n        return this[_port] || (isBun && this.type === \"module\" ? 3000 : 0);\n    }\n    /**\n     * A promise that resolves when the server is ready to accept connections.\n     */\n    get ready() {\n        return this[_http].then(() => this);\n    }\n    /**\n     * Closes the server and stops it from accepting new connections. By default,\n     * this function will wait until all active connections to close before\n     * shutting down the server. However, we can force the server to close all\n     * active connections and shutdown immediately by setting the `force`\n     * parameter to `true`.\n     *\n     * NOTE: In Node.js, the `force` parameter is only available for HTTP\n     * servers, it has no effect on HTTP2 servers.\n     *\n     * NOTE: This function only works in Node.js, Deno and Bun, it is a no-op in\n     * other environments.\n     */\n    async close(force = false) {\n        const server = await this[_http];\n        if (!server)\n            return;\n        if (typeof server.stop === \"function\") {\n            const _server = server;\n            _server.stop(force);\n            if (!force) {\n                await until(() => !_server.pendingRequests && !_server.pendingWebSockets);\n            }\n        }\n        else if (typeof server.shutdown === \"function\") {\n            const _server = server;\n            if (force && this[_controller]) {\n                this[_controller].abort();\n            }\n            else {\n                _server.shutdown();\n            }\n            await _server.finished;\n        }\n        else if (typeof server.close === \"function\") {\n            const _server = server;\n            await new Promise((resolve, reject) => {\n                _server.close((err) => err ? reject(err) : resolve());\n                if (force && \"closeAllConnections\" in _server) {\n                    _server.closeAllConnections();\n                }\n            });\n        }\n    }\n    /**\n     * Opposite of `unref()`, calling `ref()` on a previously `unref`ed server\n     * will _not_ let the program exit if it's the only server left (the default\n     * behavior). If the server is `ref`ed calling `ref()` again will have no\n     * effect.\n     *\n     * NOTE: This function only works in Node.js, Deno and Bun, it is a no-op in\n     * other environments.\n     */\n    ref() {\n        this[_http].then(server => {\n            var _d;\n            (_d = server === null || server === void 0 ? void 0 : server.ref) === null || _d === void 0 ? void 0 : _d.call(server);\n        });\n    }\n    /**\n     * Calling `unref()` on a server will allow the program to exit if this is\n     * the only active server in the event system. If the server is already\n     * `unref`ed calling`unref()` again will have no effect.\n     *\n     * NOTE: This function only works in Node.js, Deno and Bun, it is a no-op in\n     * other environments.\n     */\n    unref() {\n        this[_http].then(server => {\n            var _d;\n            (_d = server === null || server === void 0 ? void 0 : server.unref) === null || _d === void 0 ? void 0 : _d.call(server);\n        });\n    }\n}\n_a = _hostname, _b = _port, _c = _controller;\n//# sourceMappingURL=server.js.map","/**\n * This is an internal module that provides utility functions for handling HTTP\n * requests, mostly used by the `http.serve` and `http.serveStatic` functions.\n *\n * This module is exposed for advanced use cases such as when we want to\n * implement a new `serve` function that behave like the existing one, e.g. for\n * integrating with Vite dev server.\n * @module\n */\nimport { orderBy } from \"../array.ts\";\nimport { join } from \"../path.ts\";\nimport runtime from \"../runtime.ts\";\nimport { EventEndpoint } from \"../sse.ts\";\nimport { capitalize, dedent } from \"../string.ts\";\nimport { constructNetAddress } from \"./server.ts\";\nfunction sanitizeTimers(timers) {\n    const total = timers.get(\"total\");\n    const _timers = new Map([...timers].filter(([name, metrics]) => !!metrics.timeEnd && name !== \"total\"));\n    if (!!(total === null || total === void 0 ? void 0 : total.timeEnd)) {\n        _timers.set(\"total\", total);\n    }\n    return _timers;\n}\n/**\n * Creates timing functions for measuring the request processing time. This\n * function returns the timing functions and a `timers` map that associates\n * with them.\n */\nexport function createTimingFunctions() {\n    const timers = new Map();\n    return {\n        timers,\n        getTimers: (sanitize = false) => {\n            return sanitize ? sanitizeTimers(timers) : timers;\n        },\n        time: (name, description) => {\n            if (timers.has(name)) {\n                console.warn(`Timer '${name}' already exists`);\n            }\n            else {\n                timers.set(name, { timeStart: Date.now(), description });\n            }\n        },\n        timeEnd: (name) => {\n            const metrics = timers.get(name);\n            if (metrics) {\n                metrics.timeEnd = Date.now();\n            }\n            else {\n                console.warn(`Timer '${name}' does not exist`);\n            }\n        },\n    };\n}\n/**\n * Creates a request context object from the given `request` and properties.\n */\nexport function createRequestContext(request, props) {\n    const { ws, remoteAddress = null, ...rest } = props;\n    return {\n        remoteAddress,\n        createEventEndpoint: () => {\n            const events = new EventEndpoint(request);\n            return { events, response: events.response };\n        },\n        upgradeWebSocket: () => ws.upgrade(request),\n        ...rest,\n    };\n}\n;\n/**\n * Patches the timing metrics to the response's headers.\n */\nexport function patchTimingMetrics(response, timers) {\n    const metrics = [...sanitizeTimers(timers)].map(([name, metrics]) => {\n        const duration = metrics.timeEnd - metrics.timeStart;\n        let value = `${name};dur=${duration}`;\n        if (metrics.description) {\n            value += `;desc=\"${metrics.description}\"`;\n        }\n        else if (name === \"total\") {\n            value += `;desc=\"Total\"`;\n        }\n        return value;\n    }).join(\", \");\n    if (metrics) {\n        try {\n            response.headers.set(\"Server-Timing\", metrics);\n        }\n        catch (_a) {\n            // Ignore\n        }\n    }\n    return response;\n}\n/**\n * Returns a new request handler that wraps the given one so that we can add\n * extra `headers` to the response.\n */\nexport function withHeaders(handle, headers = undefined) {\n    if (headers === undefined) {\n        const { identity, version } = runtime();\n        let serverName = ({\n            \"node\": \"Node.js\",\n            \"deno\": \"Deno\",\n            \"bun\": \"Bun\",\n            \"workerd\": \"Cloudflare Workers\",\n            \"fastly\": \"Fastly Compute\",\n        })[identity] || \"Unknown\";\n        if (version) {\n            serverName += `/${version}`;\n        }\n        headers = { \"Server\": serverName };\n    }\n    return async (...args) => {\n        const response = await handle(...args);\n        if (response.status === 101) {\n            // WebSocket headers cannot be modified\n            return response;\n        }\n        try {\n            const patch = (name, value) => {\n                if (!response.headers.has(name)) {\n                    response.headers.set(name, value);\n                }\n            };\n            if (headers instanceof Headers) {\n                headers.forEach((value, name) => patch(name, value));\n            }\n            else if (Array.isArray(headers)) {\n                headers.forEach(([name, value]) => patch(name, value));\n            }\n            else if (headers !== null) {\n                Object.entries(headers).forEach(([name, value]) => patch(name, value));\n            }\n        }\n        catch (_a) {\n            // In case the headers are immutable, ignore the error.\n        }\n        return response;\n    };\n}\n/**\n * Adds a event listener to the `fetch` event in service workers that handles\n * HTTP requests with the given options.\n */\nexport function listenFetchEvent(options) {\n    const { ws, fetch, headers, onError, bindings } = options;\n    // @ts-ignore\n    addEventListener(\"fetch\", (event) => {\n        var _a, _b, _c;\n        const { request } = event;\n        const address = (_a = request.headers.get(\"cf-connecting-ip\")) !== null && _a !== void 0 ? _a : (_b = event.client) === null || _b === void 0 ? void 0 : _b.address;\n        const { getTimers, time, timeEnd } = createTimingFunctions();\n        const ctx = createRequestContext(request, {\n            ws,\n            remoteAddress: address ? constructNetAddress({\n                hostname: address,\n                port: 0,\n            }) : null,\n            time,\n            timeEnd,\n            waitUntil: (_c = event.waitUntil) === null || _c === void 0 ? void 0 : _c.bind(event),\n            bindings,\n        });\n        const _handle = withHeaders(fetch, headers);\n        const _onError = withHeaders(onError, headers);\n        const response = _handle(request, ctx)\n            .then(res => patchTimingMetrics(res, getTimers()))\n            .catch(err => _onError(err, request, ctx));\n        event.respondWith(response);\n    });\n}\n/**\n * Renders a directory listing page for the `pathname` with the given `entries`.\n */\nexport async function renderDirectoryPage(pathname, entries, extraHeaders = {}) {\n    const list = [\n        ...orderBy(entries.filter(e => e.kind === \"directory\"), e => e.name).map(e => e.name + \"/\"),\n        ...orderBy(entries.filter(e => e.kind === \"file\"), e => e.name).map(e => e.name),\n    ];\n    if (pathname !== \"/\") {\n        list.unshift(\"../\");\n    }\n    const listHtml = list.map((name) => {\n        let url = join(pathname, name);\n        if (name.endsWith(\"/\") && url !== \"/\") {\n            url += \"/\";\n        }\n        return dedent `\n            <li>\n                <a href=\"${url}\">${name}</a>\n            </li>\n            `;\n    });\n    return new Response(dedent `\n                <!DOCTYPE HTML>\n                <html lang=\"en\">\n                <head>\n                    <meta charset=\"utf-8\">\n                    <title>Directory listing for ${pathname}</title>\n                    <style>\n                    body {\n                        font-family: system-ui;\n                    }\n                    </style>\n                </head>\n                <body>\n                    <h1>Directory listing for ${pathname}</h1>\n                    <hr>\n                    <ul>\n                        ${listHtml.join(\"\")}\n                    </ul>\n                </body>\n                </html>\n                `, {\n        status: 200,\n        statusText: \"OK\",\n        headers: {\n            ...extraHeaders,\n            \"Content-Type\": \"text/html; charset=utf-8\",\n        },\n    });\n}\n/**\n * Creates a Node.js HTTP request listener with modern Web APIs.\n *\n * NOTE: This function is only available in Node.js and requires Node.js v18.4.1\n * or above.\n *\n * @example\n * ```ts\n * import * as http from \"node:http\";\n * import { withWeb } from \"@ayonli/jsext/http/internal\";\n *\n * const server = http.createServer(withWeb(async (req) => {\n *     return new Response(\"Hello, World!\");\n * }));\n *\n * server.listen(8000);\n * ```\n */\nexport function withWeb(listener) {\n    return async (nReq, nRes) => {\n        var _a, _b;\n        const remoteAddress = constructNetAddress({\n            hostname: nReq.socket.remoteAddress,\n            port: nReq.socket.remotePort,\n        });\n        const req = toWebRequest(nReq);\n        const res = await listener(req, { remoteAddress });\n        if (!nRes.req) { // fix for Deno and Node.js below v15.7.0\n            Object.assign(nRes, { req: nReq });\n        }\n        if (res && !nRes.headersSent) {\n            if (res.status === 101) {\n                // When the status code is 101, it means the server is upgrading\n                // the connection to a different protocol, usually to WebSocket.\n                // In this case, the response shall be and may have already been\n                // written by the request socket. So we should not write the\n                // response again.\n                return;\n            }\n            const gzip = (_b = (_a = req.headers.get(\"Accept-Encoding\")) === null || _a === void 0 ? void 0 : _a.includes(\"gzip\")) !== null && _b !== void 0 ? _b : false;\n            await toNodeResponse(res, nRes, gzip);\n        }\n    };\n}\n/**\n * Transforms a Node.js HTTP request to a modern `Request` object.\n */\nfunction toWebRequest(req) {\n    var _a, _b;\n    const protocol = req.socket[\"encrypted\"] || req.headers[\":scheme\"] === \"https\"\n        ? \"https\" : \"http\";\n    const host = (_a = req.headers[\":authority\"]) !== null && _a !== void 0 ? _a : req.headers[\"host\"];\n    const url = new URL((_b = req.url) !== null && _b !== void 0 ? _b : \"/\", `${protocol}://${host}`);\n    const headers = new Headers(Object.fromEntries(Object.entries(req.headers).filter(([key]) => {\n        return typeof key === \"string\" && !key.startsWith(\":\");\n    })));\n    if (req.headers[\":authority\"]) {\n        headers.set(\"Host\", req.headers[\":authority\"]);\n    }\n    const controller = new AbortController();\n    const init = {\n        method: req.method,\n        headers,\n        signal: controller.signal,\n    };\n    const cache = headers.get(\"Cache-Control\");\n    const mode = headers.get(\"Sec-Fetch-Mode\");\n    const referrer = headers.get(\"Referer\");\n    if (cache === \"no-cache\") {\n        init.cache = \"no-cache\";\n    }\n    else if (cache === \"no-store\") {\n        init.cache = \"no-store\";\n    }\n    else if (cache === \"only-if-cached\" && mode === \"same-origin\") {\n        init.cache = \"only-if-cached\";\n    }\n    else {\n        init.cache = \"default\";\n    }\n    if (mode === \"no-cors\") {\n        init.mode = \"no-cors\";\n    }\n    else if (mode === \"same-origin\") {\n        init.mode = \"same-origin\";\n    }\n    else {\n        init.mode = \"cors\";\n    }\n    if (referrer) {\n        init.referrer = referrer;\n    }\n    if (req.method !== \"GET\" && req.method !== \"HEAD\" && req.method !== \"OPTIONS\") {\n        const { readable, writable } = new TransformStream();\n        const writer = writable.getWriter();\n        req.on(\"data\", (chunk) => {\n            writer.write(chunk);\n        }).once(\"error\", (err) => {\n            writer.abort(err);\n        }).once(\"end\", () => {\n            writer.close();\n        });\n        init.body = readable;\n        // @ts-ignore Node.js special\n        init.duplex = \"half\";\n    }\n    req.once(\"close\", () => {\n        req.errored && controller.abort();\n    });\n    const request = new Request(url, init);\n    if (!req.headers[\":authority\"]) {\n        Object.assign(request, {\n            [Symbol.for(\"incomingMessage\")]: req,\n        });\n    }\n    return request;\n}\n/**\n * Pipes a modern `Response` object to a Node.js HTTP response.\n */\nasync function toNodeResponse(res, nodeRes, gzip = false) {\n    var _a, _b, _c;\n    const { status, statusText, headers } = res;\n    const length = res.body ? Number((_a = headers.get(\"Content-Length\")) !== null && _a !== void 0 ? _a : 0) : 0;\n    const type = (_b = headers.get(\"Content-Type\")) === null || _b === void 0 ? void 0 : _b.split(\";\")[0];\n    let stream = res.body;\n    for (const [key, value] of headers) {\n        // Use `setHeader` to set headers instead of passing them to `writeHead`,\n        // it seems in Deno, the headers are not written to the response if they\n        // are passed to `writeHead`.\n        nodeRes.setHeader(capitalize(key, true), value);\n    }\n    // Compress the response body with Gzip if the client supports it and the\n    // requirements are met.\n    // See https://docs.deno.com/deploy/api/compression/\n    if (stream && gzip && typeof CompressionStream === \"function\" &&\n        (length > 20 || !headers.has(\"Content-Length\")) &&\n        !headers.has(\"Content-Encoding\") &&\n        !headers.has(\"Content-Range\") &&\n        !((_c = headers.get(\"Cache-Control\")) === null || _c === void 0 ? void 0 : _c.includes(\"no-transform\")) &&\n        (type && isCompressible(type))) {\n        stream = stream.pipeThrough(new CompressionStream(\"gzip\"));\n        nodeRes.removeHeader(\"Content-Length\");\n        nodeRes.setHeader(\"Content-Encoding\", \"gzip\");\n        nodeRes.setHeader(\"Vary\", \"Accept-Encoding\");\n        const etag = headers.get(\"ETag\");\n        if (etag && !etag.startsWith(\"W/\")) {\n            nodeRes.setHeader(\"ETag\", `W/${etag}`);\n        }\n    }\n    if (nodeRes.req.httpVersion === \"2.0\") {\n        nodeRes.writeHead(status);\n    }\n    else {\n        nodeRes.writeHead(status, statusText);\n    }\n    if (!stream) {\n        nodeRes.end();\n    }\n    else {\n        await stream.pipeTo(new WritableStream({\n            start(controller) {\n                nodeRes.once(\"close\", () => {\n                    controller.error();\n                }).once(\"error\", (err) => {\n                    controller.error(err);\n                });\n            },\n            write(chunk) {\n                nodeRes.write(chunk);\n            },\n            close() {\n                nodeRes.end();\n            },\n            abort(err) {\n                nodeRes.destroy(err);\n            },\n        }));\n    }\n}\nconst re = /^text\\/|^application\\/(.+\\+)?(json|yaml|toml|xml|javascript|dart|tar|fontobject|opentype)$|^font\\/(otf|ttf)$|^image\\/((x-ms-)?bmp|svg\\+xml|(vnd\\.microsoft\\.|x-)icon)|vnd\\.adobe\\.photoshop/;\nfunction isCompressible(type) {\n    return type !== \"text/event-stream\" && re.test(type);\n}\n//# sourceMappingURL=internal.js.map","import { capitalize } from \"../string.ts\";\n/**\n * Parses the `Set-Cookie` header.\n *\n * @example\n * ```ts\n * import { parseCookie } from \"@ayonli/jsext/http\";\n *\n * const cookie = parseCookie(\"foo=bar; Domain=example.com; Path=/; Expires=Wed, 09 Jun 2021 10:18:14 GMT; HttpOnly; Secure; SameSite=Strict\");\n * console.log(cookie);\n * // {\n * //     name: \"foo\",\n * //     value: \"bar\",\n * //     domain: \"example.com\",\n * //     path: \"/\",\n * //     expires: 1623233894000,\n * //     httpOnly: true,\n * //     secure: true,\n * //     sameSite: \"strict\"\n * // }\n * ```\n */\nexport function parseCookie(str) {\n    const [nameValue, ...params] = str.split(\";\").map((part) => part.trim());\n    if (!nameValue || !nameValue.includes(\"=\")) {\n        throw new TypeError(\"Invalid Set-Cookie header\");\n    }\n    const [name, value] = nameValue.split(\"=\");\n    const cookie = { name: name, value: value };\n    for (const param of params) {\n        if (param) {\n            const [key, value = \"\"] = param.split(\"=\");\n            if (key === \"Domain\") {\n                cookie.domain = value;\n            }\n            else if (key === \"Expires\") {\n                cookie.expires = new Date(value).valueOf();\n            }\n            else if (key === \"Max-Age\") {\n                cookie.maxAge = parseInt(value);\n            }\n            else if (key === \"HttpOnly\") {\n                cookie.httpOnly = true;\n            }\n            else if (key === \"Secure\") {\n                cookie.secure = true;\n            }\n            else if (key === \"Path\") {\n                cookie.path = value || \"/\";\n            }\n            else if (key === \"SameSite\" && value) {\n                cookie.sameSite = value.toLowerCase();\n            }\n            else if (key === \"Partitioned\") {\n                cookie.partitioned = true;\n            }\n        }\n    }\n    return cookie;\n}\n/**\n * Converts a {@link Cookie} object to a string.\n *\n * @example\n * ```ts\n * import { stringifyCookie } from \"@ayonli/jsext/http\";\n *\n * const cookie = stringifyCookie({\n *     name: \"foo\",\n *     value: \"bar\",\n *     domain: \"example.com\",\n *     path: \"/\",\n *     expires: new Date(\"2021-06-09T10:18:14Z\"),\n *     httpOnly: true,\n *     secure: true,\n *     sameSite: \"Strict\"\n * });\n * console.log(cookie);\n * // foo=bar; Domain=example.com; Path=/; Expires=Wed, 09 Jun 2021 10:18:14 GMT; HttpOnly; Secure; SameSite=Strict\n */\nexport function stringifyCookie(cookie) {\n    let str = `${cookie.name}=${cookie.value}`;\n    if (cookie.domain)\n        str += `; Domain=${cookie.domain}`;\n    if (cookie.path)\n        str += `; Path=${cookie.path}`;\n    if (cookie.expires)\n        str += `; Expires=${new Date(cookie.expires).toUTCString()}`;\n    if (cookie.maxAge)\n        str += `; Max-Age=${cookie.maxAge}`;\n    if (cookie.httpOnly)\n        str += \"; HttpOnly\";\n    if (cookie.secure)\n        str += \"; Secure\";\n    if (cookie.sameSite)\n        str += `; SameSite=${capitalize(cookie.sameSite)}`;\n    if (cookie.partitioned)\n        str += \"; Partitioned\";\n    return str;\n}\n/**\n * Parses the `Cookie` header or the `document.cookie` property.\n */\nexport function parseCookies(str) {\n    return !str ? [] : str.split(/;\\s*/g).reduce((cookies, part) => {\n        const [name, value] = part.split(\"=\");\n        if (name && value !== undefined) {\n            cookies.push({ name, value });\n        }\n        return cookies;\n    }, []);\n}\n/**\n * Converts a list of cookies to a string that can be used in the `Cookie`\n * header.\n */\nexport function stringifyCookies(cookies) {\n    return cookies.map(({ name, value }) => `${name}=${value}`).join(\"; \");\n}\n/**\n * Gets the cookies from the `Cookie` header of the request or the `Set-Cookie`\n * header of the response.\n *\n * @example\n * ```ts\n * import { getCookies } from \"@ayonli/jsext/http\";\n *\n * export default {\n *     fetch(req: Request) {\n *         const cookies = getCookies(req);\n *         console.log(cookies);\n *\n *         return new Response(\"Hello, World!\");\n *     }\n * }\n * ```\n */\nexport function getCookies(obj) {\n    var _a;\n    if (\"ok\" in obj && \"status\" in obj) {\n        return obj.headers.getSetCookie().map(str => parseCookie(str));\n    }\n    else {\n        return parseCookies((_a = obj.headers.get(\"Cookie\")) !== null && _a !== void 0 ? _a : \"\");\n    }\n}\n/**\n * Gets the cookie by the given `name` from the `Cookie` header of the request\n * or the `Set-Cookie` header of the response.\n *\n * @example\n * ```ts\n * import { getCookie } from \"@ayonli/jsext/http\";\n *\n * export default {\n *     fetch(req: Request) {\n *         const cookie = getCookie(req, \"foo\");\n *         console.log(cookie);\n *\n *         return new Response(\"Hello, World!\");\n *     }\n * }\n * ```\n */\nexport function getCookie(obj, name) {\n    var _a;\n    return (_a = getCookies(obj).find(cookie => cookie.name === name)) !== null && _a !== void 0 ? _a : null;\n}\nexport function setCookie(obj, cookie) {\n    if (obj instanceof Headers) { // deprecated usage\n        obj.append(\"Set-Cookie\", stringifyCookie(cookie));\n    }\n    else if (obj instanceof Response) {\n        obj.headers.append(\"Set-Cookie\", stringifyCookie(cookie));\n    }\n    else {\n        const cookies = getCookies(obj);\n        const index = cookies.findIndex(({ name }) => name === cookie.name);\n        if (index === -1) {\n            cookies.push(cookie);\n        }\n        else {\n            cookies[index] = cookie;\n        }\n        obj.headers.set(\"Cookie\", stringifyCookies(cookies));\n    }\n}\n//# sourceMappingURL=cookie.js.map","import bytes, { concat, indexOfSlice, text } from \"../bytes.ts\";\nimport { sha256 } from \"../hash/web.ts\";\nimport { capitalize, stripEnd, stripStart } from \"../string.ts\";\nexport * from \"./cookie.ts\";\nexport * from \"./user-agent.ts\";\n/**\n * Parses the `Accept`, `Accept-Encoding` and `Accept-Language` headers.\n *\n * NOTE: This function automatically sorts the results by the q-factor value in\n * descending order.\n *\n * @example\n * ```ts\n * import { parseAccepts } from \"@ayonli/jsext/http\";\n *\n * const accepts = parseAccepts(\"text/html,application/xhtml+xml;q=0.9\");\n * console.log(accepts);\n * // [\n * //     { value: \"text/html\", weight: 1 },\n * //     { value: \"application/xhtml+xml\", weight: 0.9 }\n * // ]\n *\n * const acceptEncodings = parseAccepts(\"gzip, deflate, br;q=0.8\");\n * console.log(acceptEncodings);\n * // [\n * //     { value: \"gzip\", weight: 1 },\n * //     { value: \"deflate\", weight: 1 },\n * //     { value: \"br\", weight: 0.8 }\n * // ]\n *\n * const acceptLanguages = parseAccepts(\"en-US,en;q=0.9\");\n * console.log(acceptLanguages);\n * // [\n * //     { value: \"en-US\", weight: 1 },\n * //     { value: \"en\", weight: 0.9 }\n * // ]\n * ```\n */\nexport function parseAccepts(str) {\n    return str.split(\",\").map((type) => {\n        const [value, weight] = type.split(\";q=\");\n        return {\n            type: value.trim(),\n            weight: weight ? parseFloat(weight) : 1,\n        };\n    }).sort((a, b) => b.weight - a.weight);\n}\n/**\n * Parses the `Content-Type` header.\n *\n * @example\n * ```ts\n * import { parseContentType } from \"@ayonli/jsext/http\";\n *\n * const type = parseContentType(\"text/html; charset=utf-8\");\n * console.log(type);\n * // { type: \"text/html\", charset: \"utf-8\" }\n *\n * const type2 = parseContentType(\"multipart/form-data; boundary=----WebKitFormBoundaryzjK4sVZ2QeZvz5zB\");\n * console.log(type2);\n * // { type: \"multipart/form-data\", boundary: \"----WebKitFormBoundaryzjK4sVZ2QeZvz5zB\" }\n * ```\n */\nexport function parseContentType(str) {\n    const [type, ...params] = str.split(\";\").map((part) => part.trim());\n    if (!(type === null || type === void 0 ? void 0 : type.includes(\"/\"))) {\n        throw new TypeError(\"Invalid Content-Type header\");\n    }\n    const parsed = { type: type };\n    for (const param of params) {\n        if (param) {\n            const [key, value] = param.split(\"=\");\n            if (key === \"charset\") {\n                parsed.charset = value !== null && value !== void 0 ? value : \"\";\n            }\n            else if (key === \"boundary\") {\n                parsed.boundary = value !== null && value !== void 0 ? value : \"\";\n            }\n        }\n    }\n    return parsed;\n}\n/**\n * Sets the `Content-Disposition` header with the given filename when the\n * response is intended to be downloaded.\n *\n * This function encodes the filename with {@link encodeURIComponent} and sets\n * both the `filename` and the `filename*` parameters in the header for maximum\n * compatibility.\n *\n * NOTE: This function can be used with both {@link Response} and {@link Headers}\n * objects. However, when using with a `Headers` instance, make sure to set the\n * filename before the headers instance is used by the response object.\n *\n * @example\n * ```ts\n * import { setFilename } from \"@ayonli/jsext/http\";\n *\n * export default {\n *     fetch(req: Request) {\n *         const res = new Response(\"Hello, World!\");\n *         setFilename(res, \"hello.txt\");\n *\n *        return res;\n *     }\n * }\n * ```\n */\nexport function setFilename(res, filename) {\n    filename = encodeURIComponent(filename);\n    const disposition = `attachment; filename=\"${filename}\"; filename*=UTF-8''${filename}`;\n    if (res instanceof Headers) {\n        res.set(\"Content-Disposition\", disposition);\n    }\n    else {\n        res.headers.set(\"Content-Disposition\", disposition);\n    }\n}\n/**\n * Parses the `Range` header.\n *\n * @example\n * ```ts\n * import { parseRange } from \"@ayonli/jsext/http\";\n *\n * const range = parseRange(\"bytes=0-499\");\n * console.log(range);\n * // { unit: \"bytes\", ranges: [{ start: 0, end: 499 }] }\n *\n * const range2 = parseRange(\"bytes=0-499,1000-1499\");\n * console.log(range2);\n * // { unit: \"bytes\", ranges: [{ start: 0, end: 499 }, { start: 1000, end: 1499 }] }\n *\n * const range3 = parseRange(\"bytes=2000-\");\n * console.log(range3);\n * // { unit: \"bytes\", ranges: [{ start: 2000 }] }\n *\n * const range4 = parseRange(\"bytes=-500\");\n * console.log(range4);\n * // { unit: \"bytes\", ranges: [], suffix: 500 }\n * ```\n */\nexport function parseRange(str) {\n    if (!str.includes(\"=\")) {\n        throw new TypeError(\"Invalid Range header\");\n    }\n    const [unit, ranges] = str.split(\"=\").map((part) => part.trim());\n    const parsed = { unit: unit, ranges: [] };\n    for (const range of ranges.split(\",\")) {\n        if (!range || !range.includes(\"-\"))\n            continue;\n        const [start, end] = range.split(\"-\").map((part) => part.trim());\n        if (!start && !end) {\n            continue;\n        }\n        else if (!start) {\n            parsed.suffix = parseInt(end);\n        }\n        else if (!end) {\n            parsed.ranges.push({ start: parseInt(start) });\n        }\n        else {\n            parsed.ranges.push({ start: parseInt(start), end: parseInt(end) });\n        }\n    }\n    if ((!parsed.ranges.length && !parsed.suffix) ||\n        parsed.ranges.some((range) => range.start < 0 || (range.end && range.end <= range.start))) {\n        throw new TypeError(\"Invalid Range header\");\n    }\n    return parsed;\n}\n/**\n * Calculates the ETag for a given entity.\n *\n * NOTE: In Node.js, this function requires Node.js v19 or above, as it relies\n * on the [Web Crypto API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API).\n *\n * @example\n * ```ts\n * import { stat } from \"@ayonli/jsext/fs\";\n * import { etag } from \"@ayonli/jsext/http\";\n *\n * const etag1 = await etag(\"Hello, World!\");\n *\n * const data = new Uint8Array([1, 2, 3, 4, 5]);\n * const etag2 = await etag(data);\n *\n * const info = await stat(\"file.txt\");\n * const etag3 = await etag(info);\n * ```\n */\nexport async function etag(data) {\n    var _a;\n    if (typeof data === \"string\" || data instanceof Uint8Array) {\n        if (!data.length) {\n            // a short circuit for zero length entities\n            return `0-47DEQpj8HBSa+/TImW+5JCeuQeR`;\n        }\n        if (typeof data === \"string\") {\n            data = bytes(data);\n        }\n        const hash = await sha256(data, \"base64\");\n        return `${data.length.toString(16)}-${hash.slice(0, 27)}`;\n    }\n    const mtime = (_a = data.mtime) !== null && _a !== void 0 ? _a : new Date();\n    const hash = await sha256(mtime.toISOString(), \"base64\");\n    return `${data.size.toString(16)}-${hash.slice(0, 27)}`;\n}\n/**\n * Checks if the value from the `If-Match` header matches the given ETag.\n *\n * NOTE: Weak tags cannot be matched and will return `false`.\n *\n * @example\n * ```ts\n * import { etag, ifMatch } from \"@ayonli/jsext/http\";\n *\n * const _etag = await etag(\"Hello, World!\");\n * const match = ifMatch(\"d-3/1gIbsr1bCvZ2KQgJ7DpTGR3YH\", _etag);\n * console.log(match); // true\n * ```\n */\nexport function ifMatch(value, etag) {\n    // Weak tags cannot be matched and return false.\n    if (!value || etag.startsWith(\"W/\")) {\n        return false;\n    }\n    if (value.trim() === \"*\") {\n        return true;\n    }\n    const tags = value.split(/\\s*,\\s*/);\n    return tags.includes(etag);\n}\n/**\n * Checks if the value from the `If-None-Match` header matches the given ETag.\n *\n * @example\n * ```ts\n * import { etag, ifNoneMatch } from \"@ayonli/jsext/http\";\n *\n * const _etag = await etag(\"Hello, World!\");\n * const match = ifNoneMatch(\"d-3/1gIbsr1bCvZ2KQgJ7DpTGR3YH\", _etag);\n * console.log(match); // false\n * ```\n */\nexport function ifNoneMatch(value, etag) {\n    if (!value) {\n        return true;\n    }\n    if (value.trim() === \"*\") {\n        return false;\n    }\n    const tags = value.split(/\\s*,\\s*/).map((tag) => tag.startsWith(\"W/\") ? stripEnd(stripStart(tag.slice(2), '\"'), '\"') : tag);\n    return !tags.includes(etag);\n}\n/**\n * Parses the `Authorization` header with the `Basic` scheme.\n *\n * @example\n * ```ts\n * import { parseBasicAuth } from \"@ayonli/jsext/http\";\n *\n * const auth = parseBasicAuth(\"Basic cm9vdDpwYSQkdzByZA==\");\n * console.log(auth);\n * // { username: \"root\", password: \"pa$$w0rd\" }\n * ```\n */\nexport function parseBasicAuth(str) {\n    const parts = str.split(\" \");\n    const scheme = parts[0].toLowerCase();\n    const credentials = parts.slice(1).join(\" \");\n    if (!scheme || !credentials) {\n        throw new TypeError(\"Invalid Authorization header\");\n    }\n    else if (scheme !== \"basic\") {\n        throw new TypeError(\"Authorization scheme is not 'Basic'\");\n    }\n    else {\n        const [username, password] = text(bytes(credentials, \"base64\")).split(\":\");\n        return { username: username, password: password };\n    }\n}\n/**\n * Performs basic authentication verification for the request. When passed, this\n * function returns nothing (`undefined`), otherwise it returns a `Response`\n * with status `401 Unauthorized`, which should be responded to the client.\n *\n * @example\n * ```ts\n * import { verifyBasicAuth, type BasicAuthorization } from \"@ayonli/jsext/http\";\n *\n * const users = new Map([\n *    [\"root\", \"pa$$w0rd\"]\n * ]);\n *\n * async function verify(auth: BasicAuthorization) {\n *     const password = users.get(auth.username);\n *     return !!password && password === auth.password;\n * }\n *\n * export default {\n *     async fetch(req) {\n *         const res = await verifyBasicAuth(req, verify);\n *\n *         if (res) {\n *             return res;\n *         }\n *\n *         // continue with the request\n *     },\n * };\n * ```\n */\nexport async function verifyBasicAuth(req, verify) {\n    const auth = req.headers.get(\"Authorization\");\n    if (auth === null || auth === void 0 ? void 0 : auth.startsWith(\"Basic \")) {\n        try {\n            const credentials = parseBasicAuth(auth);\n            const ok = await verify(credentials);\n            if (ok) {\n                return;\n            }\n        }\n        catch (_a) { }\n    }\n    const { host } = new URL(req.url);\n    return new Response(\"Unauthorized\", {\n        status: 401,\n        statusText: \"Unauthorized\",\n        headers: {\n            \"WWW-Authenticate\": `Basic realm=\"${host}\"`,\n        },\n    });\n}\nexport const HTTP_METHODS = [\n    \"GET\",\n    \"HEAD\",\n    \"POST\",\n    \"PUT\",\n    \"DELETE\",\n    \"CONNECT\",\n    \"OPTIONS\",\n    \"TRACE\",\n    \"PATCH\",\n];\nexport const HTTP_STATUS = {\n    200: \"OK\",\n    201: \"Created\",\n    202: \"Accepted\",\n    204: \"No Content\",\n    206: \"Partial Content\",\n    301: \"Moved Permanently\",\n    302: \"Found\",\n    304: \"Not Modified\",\n    400: \"Bad Request\",\n    401: \"Unauthorized\",\n    403: \"Forbidden\",\n    404: \"Not Found\",\n    405: \"Method Not Allowed\",\n    406: \"Not Acceptable\",\n    408: \"Request Timeout\",\n    409: \"Conflict\",\n    410: \"Gone\",\n    413: \"Payload Too Large\",\n    414: \"URI Too Long\",\n    415: \"Unsupported Media Type\",\n    416: \"Range Not Satisfiable\",\n    417: \"Expectation Failed\",\n    426: \"Upgrade Required\",\n    500: \"Internal Server Error\",\n    501: \"Not Implemented\",\n    502: \"Bad Gateway\",\n    503: \"Service Unavailable\",\n    504: \"Gateway Timeout\",\n    505: \"HTTP Version Not Supported\",\n};\nfunction parseMessage(message) {\n    const headerEnd = message.indexOf(\"\\r\\n\\r\\n\");\n    if (headerEnd === -1) {\n        throw new TypeError(\"Invalid message\");\n    }\n    const headers = new Headers();\n    const headerLines = message.slice(0, headerEnd).split(\"\\r\\n\");\n    for (let i = 0; i < headerLines.length; i++) {\n        const line = headerLines[i];\n        const lineNum = i + 1;\n        const index = line.indexOf(\":\");\n        if (index === -1) {\n            throw new SyntaxError(\"Invalid token in line \" + lineNum);\n        }\n        const name = line.slice(0, index);\n        const value = line.slice(index + 1).trim();\n        try {\n            headers.append(name, value);\n        }\n        catch (_a) {\n            throw new TypeError(`Invalid header name '${name}' in line ${lineNum}`);\n        }\n    }\n    let body = message.slice(headerEnd + 4);\n    if (headers.get(\"Transfer-Encoding\") === \"chunked\") {\n        const decoder = new TextDecoder();\n        const encoder = new TextEncoder();\n        const lineBreak = encoder.encode(\"\\r\\n\");\n        const chunks = [];\n        let bodyBytes = encoder.encode(body);\n        while (bodyBytes.length) {\n            const lineEnd = indexOfSlice(bodyBytes, lineBreak);\n            if (lineEnd === -1) {\n                throw new TypeError(\"Invalid chunked body\");\n            }\n            const length = parseInt(decoder.decode(bodyBytes.subarray(0, lineEnd)), 16);\n            if (!Number.isInteger(length) || length < 0) {\n                throw new TypeError(\"Invalid chunk length\");\n            }\n            if (length === 0) { // end of chunked body\n                break;\n            }\n            const chunkStart = lineEnd + 2;\n            const chunkEnd = chunkStart + length;\n            const chunk = bodyBytes.subarray(chunkStart, chunkEnd);\n            if (chunk.length !== length) {\n                throw new TypeError(\"Invalid chunk\");\n            }\n            chunks.push(chunk);\n            bodyBytes = bodyBytes.subarray(chunkEnd + 2);\n        }\n        body = concat(...chunks);\n    }\n    return { headers, body };\n}\n/**\n * Parses the text message as an HTTP request.\n *\n * **NOTE:** This function only supports HTTP/1.1 protocol.\n *\n * @experimental This function is experimental and may have some bugs.\n *\n * @example\n * ```ts\n * // GET example\n * import { parseRequest } from \"@ayonli/jsext/http\";\n *\n * const message = \"GET /foo HTTP/1.1\\r\\nHost: example.com\\r\\n\\r\\n\";\n * const req = parseRequest(message);\n *\n * console.log(req.method); // \"GET\"\n * console.log(req.url); // \"http://example.com/foo\"\n * console.log(req.headers.get(\"Host\")); // \"example.com\"\n * ```\n *\n * @example\n * ```ts\n * // POST example\n * import { parseRequest } from \"@ayonli/jsext/http\";\n *\n * const message = \"POST /foo HTTP/1.1\\r\\n\"\n *     + \"Host: example.com\\r\\n\"\n *     + \"Content-Type: application/x-www-form-urlencoded\\r\\n\"\n *     + \"Content-Length: 19\\r\\n\"\n *     + \"\\r\\n\"\n *     + \"foo=hello&bar=world\";\n * const req = parseRequest(message);\n *\n * console.log(req.method); // \"POST\"\n * console.log(req.url); // \"http://example.com/foo\"\n * console.log(req.headers.get(\"Host\")); // \"example.com\"\n *\n * const form = new URLSearchParams(await req.text());\n *\n * console.log(form.get(\"foo\")); // \"hello\"\n * console.log(form.get(\"bar\")); // \"world\"\n * ```\n */\nexport function parseRequest(message) {\n    var _a;\n    let lineEnd = message.indexOf(\"\\r\\n\");\n    if (lineEnd === -1) {\n        throw new TypeError(\"Invalid message\");\n    }\n    const [method, url, version] = message.slice(0, lineEnd).split(/\\s+/);\n    if (!method || !HTTP_METHODS.includes(method) ||\n        !url || !url.startsWith(\"/\") ||\n        !(version === null || version === void 0 ? void 0 : version.startsWith(\"HTTP/\"))) {\n        throw new TypeError(\"Invalid message\");\n    }\n    else if (version !== \"HTTP/1.1\") {\n        throw new TypeError(\"Unsupported HTTP version\");\n    }\n    const { headers, body: _body } = parseMessage(message.slice(lineEnd + 2));\n    let body = _body;\n    if (method === \"GET\" || method === \"HEAD\") {\n        if (body) {\n            throw new TypeError(\"Request with GET/HEAD method cannot have body.\");\n        }\n        else {\n            body = null;\n        }\n    }\n    const host = (_a = headers.get(\"Host\")) !== null && _a !== void 0 ? _a : \"\";\n    return new Request(\"http://\" + host + url, {\n        method,\n        headers,\n        body,\n    });\n}\n/**\n * Parses the text message as an HTTP response.\n *\n * @experimental This function is experimental and may have some bugs.\n *\n * @example\n * ```ts\n * import { parseResponse } from \"@ayonli/jsext/http\";\n *\n * const message = \"HTTP/1.1 200 OK\\r\\n\"\n *     + \"Content-Type: text/plain\\r\\n\"\n *     + \"Content-Length: 12\\r\\n\"\n *     + \"\\r\\n\"\n *     + \"Hello, World!\";\n *\n * const res = parseResponse(message);\n *\n * console.log(res.status); // 200\n * console.log(res.statusText); // \"OK\"\n * console.log(res.headers.get(\"Content-Type\")); // \"text/plain\"\n *\n * const text = await res.text();\n * console.log(text); // \"Hello, World!\"\n * ```\n */\nexport function parseResponse(message) {\n    let lineEnd = message.indexOf(\"\\r\\n\");\n    if (lineEnd === -1) {\n        throw new TypeError(\"Invalid message\");\n    }\n    const [version, _status, ...statusTexts] = message.slice(0, lineEnd).split(/\\s+/);\n    const statusText = statusTexts.join(\" \");\n    let status;\n    if (!(version === null || version === void 0 ? void 0 : version.startsWith(\"HTTP/\")) ||\n        !_status || !Number.isInteger((status = Number(_status)))) {\n        throw new TypeError(\"Invalid message\");\n    }\n    const { headers, body: _body } = parseMessage(message.slice(lineEnd + 2));\n    let body = _body;\n    if (status === 204 || status === 304) {\n        if (body) {\n            throw new SyntaxError(\"Response with 204 or 304 status cannot have body.\");\n        }\n        else {\n            body = null;\n        }\n    }\n    return new Response(body, {\n        status,\n        statusText,\n        headers,\n    });\n}\n/**\n * Converts the request object to text format.\n *\n * @example\n * ```ts\n * // GET example\n * import { stringifyRequest } from \"@ayonli/jsext/http\";\n *\n * const req = new Request(\"http://example.com/foo\");\n * const message = await stringifyRequest(req);\n *\n * console.log(message);\n * // \"GET /foo HTTP/1.1\\r\\nHost: example.com\\r\\n\\r\\n\"\n * ```\n *\n * @example\n * ```ts\n * // POST example\n * import { stringifyRequest } from \"@ayonli/jsext/http\";\n *\n * const req = new Request(\"http://example.com/foo\", {\n *     method: \"POST\",\n *     headers: {\n *         \"Content-Type\": \"application/x-www-form-urlencoded\",\n *     },\n *     body: \"foo=hello&bar=world\",\n * });\n * const message = await stringifyRequest(req);\n *\n * console.log(message);\n * // \"POST /foo HTTP/1.1\\r\\n\" +\n * // \"Host: example.com\\r\\n\" +\n * // \"Content-Type: application/x-www-form-urlencoded\\r\\n\" +\n * // \"Content-Length: 19\\r\\n\" +\n * // \"\\r\\n\" +\n * // \"foo=hello&bar=world\"\n * ```\n */\nexport async function stringifyRequest(req) {\n    const { host, pathname } = new URL(req.url);\n    let message = `${req.method} ${pathname} HTTP/1.1\\r\\n`;\n    let body = req.body ? await req.text() : \"\";\n    if (host && !req.headers.has(\"Host\")) {\n        message += `Host: ${host}\\r\\n`;\n    }\n    for (const [name, value] of req.headers) {\n        message += `${capitalize(name, true)}: ${value}\\r\\n`;\n    }\n    if (body && !req.headers.has(\"Content-Length\")) {\n        message += `Content-Length: ${bytes(body).length}\\r\\n`;\n    }\n    message += \"\\r\\n\" + body;\n    return message;\n}\n/**\n * Converts the response object to text format.\n *\n * @example\n * ```ts\n * import { stringifyResponse } from \"@ayonli/jsext/http\";\n *\n * const res = new Response(\"Hello, World!\", {\n *     status: 200,\n *     statusText: \"OK\",\n *     headers: {\n *         \"Content-Type\": \"text/plain\",\n *     },\n * });\n * const message = await stringifyResponse(res);\n *\n * console.log(message);\n * // \"HTTP/1.1 200 OK\\r\\n\" +\n * // \"Content-Type: text/plain\\r\\n\" +\n * // \"Content-Length: 12\\r\\n\" +\n * // \"\\r\\n\" +\n * // \"Hello, World!\"\n * ```\n */\nexport async function stringifyResponse(res) {\n    const statusText = res.statusText;\n    let message = `HTTP/1.1 ${res.status}${statusText ? \" \" + statusText : \"\"}\\r\\n`;\n    let body = res.body ? await res.text() : \"\";\n    for (const [name, value] of res.headers) {\n        message += `${capitalize(name, true)}: ${value}\\r\\n`;\n    }\n    if (body && !res.headers.has(\"Content-Length\")) {\n        message += `Content-Length: ${bytes(body).length}\\r\\n`;\n    }\n    message += \"\\r\\n\" + body;\n    return message;\n}\n/**\n * Gets the suggested response type for the request.\n *\n * This function checks the `Accept` or the `Content-Type` header of the request,\n * or the request method, or other factors to determine the most suitable\n * response type for the client.\n *\n * For example, when requesting an article which is stored in markdown, the\n * server can respond an HTML page for the browser, a plain text for the\n * terminal, or a JSON object for the API client.\n *\n * This function returns the following response types:\n *\n * - `text`: plain text content (default)\n * - `html`: an HTML page\n * - `xml`: an XML document\n * - `json`: a JSON object\n * - `stream`: text stream or binary stream, depending on the use case\n * - `none`: no content should be sent, such as for a `HEAD` request\n *\n * @example\n * ```ts\n * import { suggestResponseType } from \"@ayonli/jsext/http\";\n *\n * export default {\n *     async fetch(req: Request) {\n *         const type = suggestResponseType(req);\n *\n *         if (type === \"text\") {\n *              return new Response(\"Hello, World!\");\n *         } else if (type === \"html\") {\n *              return new Response(\"<h1>Hello, World!</h1>\", {\n *                  headers: { \"Content-Type\": \"text/html\" },\n *              });\n *         } else if (type === \"xml\") {\n *              return new Response(\"<xml><message>Hello, World!</message></xml>\", {\n *                  headers: { \"Content-Type\": \"application/xml\" },\n *              });\n *         } else if (type === \"json\") {\n *              return new Response(JSON.stringify({ message: \"Hello, World!\" }), {\n *                  headers: { \"Content-Type\": \"application/json\" },\n *              });\n *         } else {\n *             return new Response(null, { status: 204 });\n *         }\n *     }\n * }\n * ```\n */\nexport function suggestResponseType(req) {\n    var _a;\n    const accepts = req.headers.get(\"Accept\");\n    const accept = accepts\n        ? (_a = parseAccepts(accepts).sort((a, b) => b.weight - a.weight)[0]) === null || _a === void 0 ? void 0 : _a.type\n        : null;\n    const acceptAll = !accept || accept === \"*/*\";\n    const contentType = req.headers.get(\"Content-Type\");\n    const fetchDest = req.headers.get(\"Sec-Fetch-Dest\") || req.destination;\n    const xhr = req.headers.get(\"X-Requested-With\") === \"XMLHttpRequest\";\n    if (req.method === \"HEAD\" || req.method === \"OPTIONS\") {\n        return \"none\";\n    }\n    else if ((accept === null || accept === void 0 ? void 0 : accept.includes(\"text/event-stream\"))\n        || (accept === null || accept === void 0 ? void 0 : accept.includes(\"application/octet-stream\"))\n        || (accept === null || accept === void 0 ? void 0 : accept.includes(\"multipart/form-data\"))\n        || /(image|audio|video)\\//.test(accept !== null && accept !== void 0 ? accept : \"\")\n        || [\"font\", \"image\", \"audio\", \"video\", \"object\", \"embed\"].includes(fetchDest)) {\n        return \"stream\";\n    }\n    else if ((accept === null || accept === void 0 ? void 0 : accept.includes(\"/json\"))\n        || (acceptAll && ((contentType === null || contentType === void 0 ? void 0 : contentType.includes(\"json\")) || xhr))\n        || fetchDest === \"manifest\") {\n        return \"json\";\n    }\n    else if ((accept === null || accept === void 0 ? void 0 : accept.includes(\"/xml\"))\n        || (acceptAll && (contentType === null || contentType === void 0 ? void 0 : contentType.includes(\"xml\")))\n        || fetchDest === \"xslt\") {\n        return \"xml\";\n    }\n    else if ((accept === null || accept === void 0 ? void 0 : accept.includes(\"/html\"))\n        || fetchDest === \"document\") {\n        return \"html\";\n    }\n    else {\n        const { pathname } = new URL(req.url);\n        if (pathname === \"/api\" ||\n            pathname.startsWith(\"/api/\") ||\n            /\\.json?$/i.test(pathname)) {\n            return \"json\";\n        }\n        else if (/\\.xml$/i.test(pathname)) {\n            return \"xml\";\n        }\n        else if (/\\.html?$/i.test(pathname)) {\n            return \"html\";\n        }\n        else {\n            return \"text\";\n        }\n    }\n}\n//# sourceMappingURL=util.js.map","var _a;\nimport \"../external/event-target-polyfill/index.ts\";\nimport chan from \"../chan.ts\";\nimport { fromErrorEvent } from \"../error.ts\";\nconst _source = Symbol.for(\"source\");\nconst _ws = Symbol.for(\"ws\");\n/**\n * This class represents a WebSocket connection on the server side.\n * Normally we don't create instances of this class directly, but rather use\n * the {@link WebSocketServer} to handle WebSocket connections, which will\n * create the instance for us.\n *\n * **Events:**\n *\n * - `open` - Dispatched when the connection is ready.\n * - `message` - Dispatched when a message is received.\n * - `error` - Dispatched when an error occurs, such as network failure. After\n *   this event is dispatched, the connection will be closed and the `close`\n *   event will be dispatched.\n * - `close` - Dispatched when the connection is closed. If the connection is\n *   closed due to some error, the `error` event will be dispatched before this\n *   event, and the close event will have the `wasClean` set to `false`, and the\n *   `reason` property contains the error message, if any.\n */\nexport class WebSocketConnection extends EventTarget {\n    constructor(source) {\n        super();\n        this[_a] = null;\n        this[_source] = source;\n        this[_source].then(ws => {\n            this[_ws] = ws;\n        });\n    }\n    /**\n     * A promise that resolves when the connection is ready to send and receive\n     * messages.\n     *\n     * @deprecated Listen for the `open` event instead.\n     */\n    get ready() {\n        return this[_source].then(() => this);\n    }\n    /**\n     * The current state of the WebSocket connection.\n     */\n    get readyState() {\n        var _b, _c;\n        return (_c = (_b = this[_ws]) === null || _b === void 0 ? void 0 : _b.readyState) !== null && _c !== void 0 ? _c : 0;\n    }\n    /**\n     * Sends data to the WebSocket client.\n     */\n    send(data) {\n        if (!this[_ws]) {\n            throw new Error(\"WebSocket connection is not ready.\");\n        }\n        this[_ws].send(data);\n    }\n    /**\n     * Closes the WebSocket connection.\n     */\n    close(code, reason) {\n        if (!this[_ws]) {\n            throw new Error(\"WebSocket connection is not ready.\");\n        }\n        this[_ws].close(code, reason);\n    }\n    addEventListener(event, listener, options = undefined) {\n        return super.addEventListener(event, listener, options);\n    }\n    removeEventListener(event, listener, options = undefined) {\n        return super.removeEventListener(event, listener, options);\n    }\n    async *[(_a = _ws, Symbol.asyncIterator)]() {\n        const channel = chan(Infinity);\n        const handleMessage = (ev) => {\n            channel.send(ev.data);\n        };\n        const handleClose = (ev) => {\n            ev.wasClean && channel.close();\n        };\n        const handleError = (ev) => {\n            channel.close(fromErrorEvent(ev));\n        };\n        this.addEventListener(\"message\", handleMessage);\n        this.addEventListener(\"close\", handleClose);\n        this.addEventListener(\"error\", handleError);\n        try {\n            for await (const data of channel) {\n                yield data;\n            }\n        }\n        finally {\n            this.removeEventListener(\"message\", handleMessage);\n            this.removeEventListener(\"close\", handleClose);\n            this.removeEventListener(\"error\", handleError);\n        }\n    }\n}\n//# sourceMappingURL=base.js.map","import { getReadonly, setReadonly } from \"../class/util.ts\";\nimport { WebSocketConnection } from \"./base.ts\";\n/**\n * A `WebSocket` polyfill for Node.js before v21.\n * See https://developer.mozilla.org/en-US/docs/Web/API/WebSocket\n *\n * NOTE: Must install the package from NPM to use this polyfill. If the runtime\n * already supports the global `WebSocket` class, this variable will be that\n * class instead of the polyfill one.\n */\nexport const WebSocket = globalThis.WebSocket;\nconst _ws = Symbol.for(\"ws\");\nfunction initWebSocketStream(wss, ws) {\n    ws.binaryType = \"arraybuffer\";\n    setReadonly(wss, \"url\", ws.url);\n    setReadonly(wss, \"opened\", new Promise((resolve, reject) => {\n        ws.addEventListener(\"open\", () => {\n            resolve({\n                extensions: ws.extensions,\n                protocol: ws.protocol,\n                readable: new ReadableStream({\n                    start(controller) {\n                        ws.addEventListener(\"message\", ({ data }) => {\n                            if (typeof data === \"string\") {\n                                controller.enqueue(data);\n                            }\n                            else if (data instanceof ArrayBuffer) {\n                                controller.enqueue(new Uint8Array(data));\n                            }\n                            else if (data instanceof Uint8Array) {\n                                controller.enqueue(new Uint8Array(data.buffer, data.byteOffset, data.byteLength));\n                            }\n                            else {\n                                ws.close(1003, \"Unsupported message type\");\n                            }\n                        });\n                        ws.addEventListener(\"close\", () => {\n                            try {\n                                controller.close();\n                            }\n                            catch (_a) { }\n                        });\n                    },\n                    cancel() {\n                        ws.close();\n                    },\n                }),\n                writable: new WritableStream({\n                    write(chunk) {\n                        ws.send(chunk);\n                    },\n                }),\n            });\n        });\n        ws.addEventListener(\"error\", () => {\n            reject(new Error(\"Failed to establish WebSocket connection.\"));\n        });\n    }));\n    setReadonly(wss, \"closed\", new Promise((resolve) => {\n        ws.addEventListener(\"close\", (ev) => {\n            resolve({\n                closeCode: ev.code,\n                reason: ev.reason,\n            });\n        });\n    }));\n}\n/**\n * A `WebSocketStream` polyfill.\n * See https://developer.mozilla.org/en-US/docs/Web/API/WebSocketStream\n *\n * NOTE: This API depends on the Web Streams API, in Node.js, it requires\n * Node.js v18.0 or above.\n *\n * NOTE: This implementation is based on the `WebSocket` API and supports\n * half-close, closing the writable stream will not close the connection, the\n * connection will only be closed when the `close` method is called or the\n * readable stream is canceled.\n *\n * @example\n * ```ts\n * // usage\n * globalThis.WebSocketStream ??= (await import(\"@ayonli/jsext/ws\")).WebSocketStream;\n * ```\n */\nexport class WebSocketStream {\n    get url() {\n        return getReadonly(this, \"url\");\n    }\n    get opened() {\n        return getReadonly(this, \"opened\");\n    }\n    get closed() {\n        return getReadonly(this, \"closed\");\n    }\n    constructor(url, options = {}) {\n        if (typeof globalThis.WebSocket !== \"function\") {\n            throw new Error(\"WebSocket is not supported in this environment.\");\n        }\n        const { protocols, signal } = options;\n        const ws = this[_ws] = new globalThis.WebSocket(url, protocols);\n        initWebSocketStream(this, ws);\n        signal === null || signal === void 0 ? void 0 : signal.addEventListener(\"abort\", () => ws.close());\n    }\n    close(options = {}) {\n        var _a;\n        const { closeCode, reason } = options;\n        (_a = this[_ws]) === null || _a === void 0 ? void 0 : _a.close(closeCode, reason);\n    }\n}\n// If the global `WebSocketStream` class is available, inherit from it, so that\n// the `instanceof` operator works properly.\n// @ts-ignore\nif (typeof globalThis.WebSocketStream === \"function\") {\n    // @ts-ignore\n    Object.setPrototypeOf(WebSocketStream, globalThis.WebSocketStream);\n    // @ts-ignore\n    Object.setPrototypeOf(WebSocketStream.prototype, globalThis.WebSocketStream.prototype);\n}\n/**\n * Transforms a `WebSocket` or {@link WebSocketConnection} instance into a\n * {@link WebSocketStream} instance.\n */\nexport function toWebSocketStream(ws) {\n    const wss = Object.create(WebSocketStream.prototype);\n    if (ws instanceof WebSocketConnection) {\n        wss[_ws] = ws;\n        setReadonly(wss, \"url\", \"\");\n        setReadonly(wss, \"opened\", ws.ready.then(() => ({\n            extensions: \"\",\n            protocol: \"\",\n            readable: new ReadableStream({\n                start(controller) {\n                    ws.addEventListener(\"message\", ({ data }) => {\n                        controller.enqueue(data);\n                    });\n                    ws.addEventListener(\"close\", () => {\n                        try {\n                            controller.close();\n                        }\n                        catch (_a) { }\n                    });\n                },\n                cancel() {\n                    ws.close();\n                },\n            }),\n            writable: new WritableStream({\n                write(chunk) {\n                    ws.send(chunk);\n                },\n            }),\n        })));\n        setReadonly(wss, \"closed\", new Promise((resolve) => {\n            ws.addEventListener(\"close\", (ev) => {\n                resolve({\n                    closeCode: ev.code,\n                    reason: ev.reason,\n                });\n            });\n        }));\n    }\n    else {\n        initWebSocketStream(wss, ws);\n    }\n    return wss;\n}\n//# sourceMappingURL=client.js.map","/**\n * This module provides unified WebSocket server and client interfaces for\n * Node.js, Deno, Bun and Cloudflare Workers.\n *\n * The {@link WebSocketServer} and {@link WebSocketConnection} are used to\n * manage WebSocket connections on the server side, while the {@link WebSocket}\n * (polyfill) and the {@link WebSocketStream} (polyfill) are used to connect to\n * WebSocket servers on the client side.\n *\n * **IMPORTANT**: The {@link WebSocketConnection} interface is an abstraction of\n * the WebSocket on the server side, it's design is not consistent with the\n * {@link WebSocket} API in the browser. For example, when receiving binary data,\n * the `data` property is always a `Uint8Array` object, which is different from\n * the `Blob` object (or `ArrayBuffer`) in the browser. In the future, a more\n * consistent API will be provided, be aware of this when using this module.\n * @module\n * @experimental\n */\nvar _a, _b, _c, _d;\nimport { asyncTask } from \"./async.ts\";\nimport { concat, text } from \"./bytes.ts\";\nimport { createCloseEvent, createErrorEvent } from \"./event.ts\";\nimport runtime from \"./runtime.ts\";\nimport { WebSocketConnection } from \"./ws/base.ts\";\nexport * from \"./ws/client.ts\";\nconst _errored = Symbol.for(\"errored\");\nconst _handler = Symbol.for(\"handler\");\nconst _clients = Symbol.for(\"clients\");\nconst _httpServer = Symbol.for(\"httpServer\");\nconst _wsServer = Symbol.for(\"wsServer\");\nconst _connTasks = Symbol.for(\"connTasks\");\n/**\n * A unified WebSocket server interface for Node.js, Deno, Bun and Cloudflare\n * Workers.\n *\n * There are two ways to handle WebSocket connections:\n *\n * 1. By passing a listener function to the constructor, handle all connections\n *    in a central place.\n * 2. By using the `socket` object returned from the `upgrade` method to handle\n *    each connection in a more flexible way. However, at this stage, the\n *    connection may not be ready yet, and we need to listen the `open` event\n *    or wait for the `ready` promise (deprecated) to resolve before we can\n *    start sending messages.\n *\n * The `socket` object is an async iterable object, which can be used in the\n * `for await...of` loop to read messages with backpressure support.\n *\n * @example\n * ```ts\n * // centralized connection handler\n * import { WebSocketServer } from \"@ayonli/jsext/ws\";\n *\n * const wsServer = new WebSocketServer(socket => {\n *     console.log(\"WebSocket connection established.\");\n *\n *     socket.addEventListener(\"message\", (event) => {\n *         socket.send(\"received: \" + event.data);\n *     });\n *\n *     socket.addEventListener(\"error\", (event) => {\n *         console.error(\"WebSocket connection error:\", event.error);\n *     });\n *\n *     socket.addEventListener(\"close\", (event) => {\n *         console.log(`WebSocket connection closed, reason: ${event.reason}, code: ${event.code}`);\n *     });\n * });\n *\n * // Node.js\n * import * as http from \"node:http\";\n * const httpServer = http.createServer(req => {\n *      wsServer.upgrade(req);\n * });\n * httpServer.listen(3000);\n *\n * // Node.js (withWeb)\n * import { withWeb } from \"@ayonli/jsext/http\";\n * const httpServer2 = http.createServer(withWeb(req => {\n *      const { response } = wsServer.upgrade(req);\n *      return response;\n * }));\n * httpServer2.listen(3001);\n *\n * // Bun\n * const bunServer = Bun.serve({\n *     fetch(req) {\n *         const { response } = wsServer.upgrade(req);\n *         return response;\n *     },\n *     websocket: wsServer.bunListener,\n * });\n * wsServer.bunBind(bunServer);\n *\n * // Deno\n * Deno.serve(req => {\n *     const { response } = wsServer.upgrade(req);\n *     return response;\n * });\n *\n * // Cloudflare Workers\n * export default {\n *     fetch(req) {\n *         const { response } = wsServer.upgrade(req);\n *         return response;\n *     },\n * };\n * ```\n *\n * @example\n * ```ts\n * // per-request connection handler (Deno example)\n * import { WebSocketServer } from \"@ayonli/jsext/ws\";\n *\n * const wsServer = new WebSocketServer();\n *\n * Deno.serve(req => {\n *     const { socket, response } = wsServer.upgrade(req);\n *\n *     socket.addEventListener(\"open\", () => {\n *         console.log(\"WebSocket connection established.\");\n *     });\n *\n *     socket.addEventListener(\"message\", (event) => {\n *         socket.send(\"received: \" + event.data);\n *     });\n *\n *     socket.addEventListener(\"error\", (event) => {\n *         console.error(\"WebSocket connection error:\", event.error);\n *     });\n *\n *     socket.addEventListener(\"close\", (event) => {\n *         console.log(`WebSocket connection closed, reason: ${event.reason}, code: ${event.code}`);\n *     });\n *\n *     // The response should be returned immediately, otherwise the web socket\n *     // will not be ready.\n *     return response;\n * });\n * ```\n *\n * @example\n * ```ts\n * // async iterable\n * const wsServer = new WebSocketServer(async socket => {\n *     console.log(\"WebSocket connection established.\");\n *\n *     try {\n *         for await (const message of socket) {\n *             socket.send(\"received: \" + message);\n *         }\n *     } catch (error) {\n *         console.error(\"WebSocket connection error:\", error);\n *     }\n *\n *     console.log(\"WebSocket connection closed\");\n * });\n *\n * Deno.serve(req => {\n *     const { response } = wsServer.upgrade(req);\n *     return response;\n * });\n * ```\n */\nexport class WebSocketServer {\n    constructor(...args) {\n        var _e, _f, _g;\n        this[_a] = new Map();\n        this[_b] = undefined;\n        this[_c] = null;\n        this[_d] = new Map();\n        if (args.length === 2) {\n            this.idleTimeout = ((_e = args[0]) === null || _e === void 0 ? void 0 : _e.idleTimeout) || 30;\n            this.perMessageDeflate = (_g = (_f = args[0]) === null || _f === void 0 ? void 0 : _f.perMessageDeflate) !== null && _g !== void 0 ? _g : false;\n            this[_handler] = args[1];\n        }\n        else {\n            this.idleTimeout = 30;\n            this.perMessageDeflate = false;\n            this[_handler] = args[0];\n        }\n    }\n    upgrade(request) {\n        const upgradeHeader = \"socket\" in request\n            ? request.headers[\"upgrade\"]\n            : request.headers.get(\"Upgrade\");\n        if (!upgradeHeader || upgradeHeader !== \"websocket\") {\n            throw new TypeError(\"Expected Upgrade: websocket\");\n        }\n        const handler = this[_handler];\n        const clients = this[_clients];\n        const { identity } = runtime();\n        if (identity === \"deno\") {\n            if (\"socket\" in request) {\n                throw new TypeError(\"Node.js support is not implemented outside Node.js runtime.\");\n            }\n            const { socket: ws, response } = Deno.upgradeWebSocket(request, {\n                idleTimeout: this.idleTimeout,\n            });\n            const socket = new WebSocketConnection(new Promise((resolve) => {\n                ws.binaryType = \"arraybuffer\";\n                ws.onmessage = (ev) => {\n                    if (typeof ev.data === \"string\") {\n                        socket.dispatchEvent(new MessageEvent(\"message\", {\n                            data: ev.data,\n                        }));\n                    }\n                    else {\n                        socket.dispatchEvent(new MessageEvent(\"message\", {\n                            data: new Uint8Array(ev.data),\n                        }));\n                    }\n                };\n                ws.onclose = (ev) => {\n                    if (!ev.wasClean) {\n                        socket.dispatchEvent(createErrorEvent(\"error\", {\n                            error: new Error(`WebSocket connection closed: ${ev.reason} (${ev.code})`),\n                        }));\n                    }\n                    clients.delete(request);\n                    socket.dispatchEvent(createCloseEvent(\"close\", {\n                        code: ev.code,\n                        reason: ev.reason,\n                        wasClean: ev.wasClean,\n                    }));\n                };\n                if (ws.readyState === 1) {\n                    resolve(ws);\n                }\n                else {\n                    ws.onopen = () => {\n                        resolve(ws);\n                    };\n                }\n            }));\n            socket.ready.then(() => {\n                clients.set(request, socket);\n                handler === null || handler === void 0 ? void 0 : handler.call(this, socket);\n                socket.dispatchEvent(new Event(\"open\"));\n            });\n            return { socket, response };\n        }\n        else if (identity === \"bun\") {\n            if (\"socket\" in request) {\n                throw new TypeError(\"Node.js support is not implemented outside Node.js runtime.\");\n            }\n            const server = this[_httpServer];\n            if (!server) {\n                throw new Error(\"WebSocket server is not bound to a Bun server instance.\");\n            }\n            const task = asyncTask();\n            this[_connTasks].set(request, task);\n            const ok = server.upgrade(request, { data: { request } });\n            if (!ok) {\n                throw new Error(\"Failed to upgrade to WebSocket.\");\n            }\n            const socket = new WebSocketConnection(task);\n            socket.ready.then(() => {\n                clients.set(request, socket);\n                handler === null || handler === void 0 ? void 0 : handler.call(this, socket);\n                socket.dispatchEvent(new Event(\"open\"));\n            });\n            return {\n                socket,\n                response: new Response(null, {\n                    status: 101,\n                    statusText: \"Switching Protocols\",\n                    headers: new Headers({\n                        \"Upgrade\": \"websocket\",\n                        \"Connection\": \"Upgrade\",\n                    }),\n                }),\n            };\n        }\n        else if (identity === \"node\") {\n            const isNodeRequest = \"socket\" in request;\n            if (!isNodeRequest && Reflect.has(request, Symbol.for(\"incomingMessage\"))) {\n                request = Reflect.get(request, Symbol.for(\"incomingMessage\"));\n            }\n            if (!(\"socket\" in request)) {\n                throw new TypeError(\"Expected an instance of http.IncomingMessage.\");\n            }\n            const { socket } = request;\n            const upgradeHeader = request.headers.upgrade;\n            if (!upgradeHeader || upgradeHeader !== \"websocket\") {\n                throw new TypeError(\"Expected Upgrade: websocket\");\n            }\n            const handler = this[_handler];\n            const clients = this[_clients];\n            if (!this[_wsServer]) {\n                this[_wsServer] = import(\"ws\").then(({ WebSocketServer: WsServer }) => {\n                    return new WsServer({\n                        noServer: true,\n                        perMessageDeflate: this.perMessageDeflate,\n                    });\n                });\n            }\n            const task = this[_wsServer].then(wsServer => new Promise((resolve) => {\n                wsServer.handleUpgrade(request, socket, Buffer.alloc(0), (ws) => {\n                    ws.binaryType = \"arraybuffer\";\n                    ws.on(\"message\", (data, isBinary) => {\n                        data = Array.isArray(data) ? concat(...data) : data;\n                        let event;\n                        if (typeof data === \"string\") {\n                            event = new MessageEvent(\"message\", { data });\n                        }\n                        else if (isBinary) {\n                            event = new MessageEvent(\"message\", {\n                                data: new Uint8Array(data),\n                            });\n                        }\n                        else {\n                            const bytes = data instanceof ArrayBuffer\n                                ? new Uint8Array(data)\n                                : data;\n                            event = new MessageEvent(\"message\", {\n                                data: text(bytes),\n                            });\n                        }\n                        client.dispatchEvent(event);\n                    });\n                    ws.on(\"error\", error => {\n                        Object.assign(ws, { [_errored]: true });\n                        client.dispatchEvent(createErrorEvent(\"error\", { error }));\n                    });\n                    ws.on(\"close\", (code, reason) => {\n                        var _e;\n                        clients.delete(request);\n                        client.dispatchEvent(createCloseEvent(\"close\", {\n                            code,\n                            reason: (_e = reason === null || reason === void 0 ? void 0 : reason.toString(\"utf8\")) !== null && _e !== void 0 ? _e : \"\",\n                            wasClean: Reflect.get(ws, _errored) !== false,\n                        }));\n                    });\n                    resolve(ws);\n                });\n            }));\n            const client = new WebSocketConnection(task);\n            client.ready.then(() => {\n                clients.set(request, client);\n                handler === null || handler === void 0 ? void 0 : handler.call(this, client);\n                client.dispatchEvent(new Event(\"open\"));\n            });\n            if (!isNodeRequest && typeof Response === \"function\") {\n                const response = new Response(null, {\n                    status: 200,\n                    statusText: \"Switching Protocols\",\n                    headers: new Headers({\n                        \"Upgrade\": \"websocket\",\n                        \"Connection\": \"Upgrade\",\n                    }),\n                });\n                // HACK: Node.js currently does not support setting the\n                // status code to outside the range of 200 to 599. This\n                // is a workaround to set the status code to 101.\n                Object.defineProperty(response, \"status\", {\n                    configurable: true,\n                    value: 101,\n                });\n                return { socket: client, response };\n            }\n            else {\n                return { socket: client };\n            }\n        }\n        else {\n            throw new TypeError(\"Unsupported runtime\");\n        }\n    }\n    /**\n     * Used in Bun, to bind the WebSocket server to the Bun server instance.\n     */\n    bunBind(server) {\n        this[_httpServer] = server;\n    }\n    /**\n     * A WebSocket listener for `Bun.serve()`.\n     */\n    get bunListener() {\n        const clients = this[_clients];\n        const connTasks = this[_connTasks];\n        return {\n            idleTimeout: this.idleTimeout,\n            perMessageDeflate: this.perMessageDeflate,\n            open: async (ws) => {\n                const { request } = ws.data;\n                const task = connTasks.get(request);\n                if (task) {\n                    connTasks.delete(request);\n                    task.resolve(ws);\n                }\n            },\n            message: (ws, msg) => {\n                const { request } = ws.data;\n                const client = clients.get(request);\n                if (client) {\n                    if (typeof msg === \"string\") {\n                        client.dispatchEvent(new MessageEvent(\"message\", {\n                            data: msg,\n                        }));\n                    }\n                    else {\n                        client.dispatchEvent(new MessageEvent(\"message\", {\n                            data: new Uint8Array(msg),\n                        }));\n                    }\n                }\n            },\n            error: (ws, error) => {\n                Object.assign(ws, { [_errored]: true });\n                const { request } = ws.data;\n                const client = clients.get(request);\n                client && client.dispatchEvent(createErrorEvent(\"error\", { error }));\n            },\n            close: (ws, code, reason) => {\n                const { request } = ws.data;\n                const client = clients.get(request);\n                if (client) {\n                    clients.delete(request);\n                    client.dispatchEvent(createCloseEvent(\"close\", {\n                        code,\n                        reason,\n                        wasClean: Reflect.get(ws, _errored) !== true,\n                    }));\n                }\n            },\n        };\n    }\n    /**\n     * An iterator that yields all connected WebSocket clients, can be used to\n     * broadcast messages to all clients.\n     */\n    get clients() {\n        return this[_clients].values();\n    }\n}\n_a = _clients, _b = _httpServer, _c = _wsServer, _d = _connTasks;\n//# sourceMappingURL=ws.js.map","/**\n * Functions for handling HTTP related tasks, such as parsing headers and\n * serving HTTP requests.\n *\n * Many functions in this module are designed to work in all environments, but\n * some of them are only available in server runtimes such as Node.js, Deno,\n * Bun and Cloudflare Workers.\n *\n * This module itself is a executable script that can be used to serve static\n * files in the current working directory, or we can provide an entry module\n * which has an default export that satisfies the {@link ServeOptions} to start\n * a custom HTTP server.\n *\n * The script can be run directly with Deno, Bun, or Node.js.\n *\n * Deno:\n * ```sh\n * deno run --allow-net --allow-read jsr:@ayonli/jsext/http [--port PORT] [DIR]\n * deno run --allow-net --allow-read jsr:@ayonli/jsext/http <entry.ts>\n * ```\n *\n * Bun:\n * ```sh\n * bun run node_modules/@ayonli/jsext/http.ts [DIR] [--port PORT] [--parallel [NUM]]\n * bun run node_modules/@ayonli/jsext/http.ts <entry.ts> [--parallel [NUM]]\n * ```\n *\n * Node.js:\n *\n * ```sh\n * tsx node_modules/@ayonli/jsext/http.ts [DIR] [--port PORT] [--parallel [NUM]]\n * tsx --import=@ayonli/jsext/http <entry.ts> [--parallel [NUM]]\n * # or\n * node node_modules/@ayonli/jsext/esm/http.js [DIR] [--port PORT] [--parallel [NUM]]\n * node -r @ayonli/jsext/http <entry.js> [--parallel [NUM]]\n * ```\n * @module\n */\nvar _a, _b;\nimport { asyncTask } from \"./async.ts\";\nimport bytes from \"./bytes.ts\";\nimport { args, parseArgs } from \"./cli.ts\";\nimport { isBun, isDeno, isNode } from \"./env.ts\";\nimport { createReadableStream, exists, readDir, readFile, stat } from \"./fs.ts\";\nimport { sha256 } from \"./hash.ts\";\nimport { createRequestContext, createTimingFunctions, listenFetchEvent, renderDirectoryPage, withHeaders, patchTimingMetrics, withWeb, } from \"./http/internal.ts\";\nimport { constructNetAddress, HttpServer } from \"./http/server.ts\";\nimport { ifMatch, ifNoneMatch, parseRange } from \"./http/util.ts\";\nimport { isMain } from \"./module.ts\";\nimport { randomPort as _randomPort } from \"./net.ts\";\nimport { as } from \"./object.ts\";\nimport { extname, join, resolve, startsWith } from \"./path.ts\";\nimport { readAsArray } from \"./reader.ts\";\nimport { stripStart } from \"./string.ts\";\nimport { WebSocketServer } from \"./ws.ts\";\nexport * from \"./http/util.ts\";\n/**\n * Calculates the ETag for a given entity.\n *\n * NOTE: This function shadows the one in the `http/util` module and provides\n * support for old Node.js versions.\n *\n * @example\n * ```ts\n * import { stat } from \"@ayonli/jsext/fs\";\n * import { etag } from \"@ayonli/jsext/http\";\n *\n * const etag1 = await etag(\"Hello, World!\");\n *\n * const data = new Uint8Array([1, 2, 3, 4, 5]);\n * const etag2 = await etag(data);\n *\n * const info = await stat(\"file.txt\");\n * const etag3 = await etag(info);\n * ```\n */\nexport async function etag(data) {\n    var _a;\n    if (typeof data === \"string\" || data instanceof Uint8Array) {\n        if (!data.length) {\n            // a short circuit for zero length entities\n            return `0-47DEQpj8HBSa+/TImW+5JCeuQeR`;\n        }\n        if (typeof data === \"string\") {\n            data = bytes(data);\n        }\n        const hash = await sha256(data, \"base64\");\n        return `${data.length.toString(16)}-${hash.slice(0, 27)}`;\n    }\n    const mtime = (_a = data.mtime) !== null && _a !== void 0 ? _a : new Date();\n    const hash = await sha256(mtime.toISOString(), \"base64\");\n    return `${data.size.toString(16)}-${hash.slice(0, 27)}`;\n}\n/**\n * @deprecated Use `randomPort` from `@ayonli/jsext/net` instead.\n */\nexport const randomPort = _randomPort;\n/**\n * Serves HTTP requests with the given options.\n *\n * This function provides a unified way to serve HTTP requests in all server\n * runtimes, even worker runtimes. It's similar to the `Deno.serve` and\n * `Bun.serve` functions, in fact, it calls them internally when running in the\n * corresponding runtime. When running in Node.js, it uses the built-in `http`\n * or `http2` modules to create the server.\n *\n * This function also provides easy ways to handle Server-sent Events and\n * WebSockets inside the fetch handler without touching the underlying verbose\n * APIs.\n *\n * Currently, the following runtimes are supported:\n *\n * - Node.js (v18.4.1 or above)\n * - Deno\n * - Bun\n * - Cloudflare Workers\n * - Fastly Compute\n * - Service Worker in the browser\n *\n * NOTE: WebSocket is not supported in Fastly Compute and browser's Service\n * Worker at the moment.\n *\n * @example\n * ```ts\n * // simple http server\n * import { serve } from \"@ayonli/jsext/http\";\n *\n * serve({\n *     fetch(req) {\n *         return new Response(\"Hello, World!\");\n *     },\n * });\n * ```\n *\n * @example\n * ```ts\n * // set the hostname and port\n * import { serve } from \"@ayonli/jsext/http\";\n *\n * serve({\n *     hostname: \"localhost\",\n *     port: 8787, // same port as Wrangler dev\n *     fetch(req) {\n *         return new Response(\"Hello, World!\");\n *     },\n * });\n * ```\n *\n * @example\n * ```ts\n * // serve HTTPS/HTTP2 requests\n * import { readFileAsText } from \"@ayonli/jsext/fs\";\n * import { serve } from \"@ayonli/jsext/http\";\n *\n * serve({\n *     key: await readFileAsText(\"./cert.key\"),\n *     cert: await readFileAsText(\"./cert.pem\"),\n *     fetch(req) {\n *         return new Response(\"Hello, World!\");\n *    },\n * });\n * ```\n *\n * @example\n * ```ts\n * // respond Server-sent Events\n * import { serve } from \"@ayonli/jsext/http\";\n *\n * serve({\n *     fetch(req, ctx) {\n *         const { events, response } = ctx.createEventEndpoint();\n *         let count = events.lastEventId ? Number(events.lastEventId) : 0;\n *\n *         setInterval(() => {\n *             const lastEventId = String(++count);\n *             events.dispatchEvent(new MessageEvent(\"ping\", {\n *                 data: lastEventId,\n *                 lastEventId,\n *             }));\n *         }, 5_000);\n *\n *         return response;\n *     },\n * });\n * ```\n *\n * @example\n * ```ts\n * // upgrade to WebSocket\n * import { serve } from \"@ayonli/jsext/http\";\n *\n * serve({\n *     fetch(req, ctx) {\n *         const { socket, response } = ctx.upgradeWebSocket();\n *\n *         socket.addEventListener(\"message\", (event) => {\n *             console.log(event.data);\n *             socket.send(\"Hello, Client!\");\n *         });\n *\n *         return response;\n *     },\n * });\n * ```\n *\n * @example\n * ```ts\n * // module mode (for `deno serve`, Bun and Cloudflare Workers)\n * import { serve } from \"@ayonli/jsext/http\";\n *\n * export default serve({\n *     type: \"module\",\n *     fetch(req) {\n *         return new Response(\"Hello, World!\");\n *     },\n * });\n * ```\n */\nexport function serve(options) {\n    var _a;\n    const type = isDeno || isBun || isNode ? options.type || \"classic\" : \"classic\";\n    const ws = new WebSocketServer(options.ws);\n    const { fetch: handle, key, cert, onListen, headers } = options;\n    const onError = (_a = options.onError) !== null && _a !== void 0 ? _a : ((err) => {\n        console.error(err);\n        return new Response(\"Internal Server Error\", {\n            status: 500,\n            statusText: \"Internal Server Error\",\n        });\n    });\n    return new HttpServer(async () => {\n        let hostname = options.hostname || \"0.0.0.0\";\n        let port = options.port;\n        let controller = null;\n        let server = null;\n        if (isDeno) {\n            if (type === \"classic\") {\n                port !== null && port !== void 0 ? port : (port = await randomPort(8000, hostname));\n                controller = new AbortController();\n                const task = asyncTask();\n                const _server = server = Deno.serve({\n                    hostname,\n                    port,\n                    key,\n                    cert,\n                    signal: controller.signal,\n                    onListen: () => task.resolve(),\n                }, (req, info) => {\n                    const { getTimers, time, timeEnd } = createTimingFunctions();\n                    const ctx = createRequestContext(req, {\n                        ws,\n                        remoteAddress: constructNetAddress({\n                            hostname: info.remoteAddr.hostname,\n                            port: info.remoteAddr.port,\n                        }),\n                        time,\n                        timeEnd,\n                    });\n                    const _handle = withHeaders(handle, headers);\n                    const _onError = withHeaders(onError, headers);\n                    return _handle(req, ctx)\n                        .then(res => patchTimingMetrics(res, getTimers()))\n                        .catch(err => _onError(err, req, ctx));\n                });\n                await task;\n                hostname = _server.addr.hostname;\n                port = _server.addr.port;\n            }\n            else {\n                hostname = \"\";\n                port = 0;\n            }\n        }\n        else if (isBun) {\n            if (type === \"classic\") {\n                const tls = key && cert ? { key, cert } : undefined;\n                port !== null && port !== void 0 ? port : (port = await randomPort(8000, hostname));\n                const _server = server = Bun.serve({\n                    hostname,\n                    port,\n                    tls,\n                    fetch: (req, server) => {\n                        const { getTimers, time, timeEnd } = createTimingFunctions();\n                        const addr = server.requestIP(req);\n                        const ctx = createRequestContext(req, {\n                            ws,\n                            remoteAddress: addr ? constructNetAddress({\n                                hostname: addr.address,\n                                port: addr.port,\n                            }) : null,\n                            time,\n                            timeEnd,\n                        });\n                        const _handle = withHeaders(handle, headers);\n                        const _onError = withHeaders(onError, headers);\n                        return _handle(req, ctx)\n                            .then(res => patchTimingMetrics(res, getTimers()))\n                            .catch(err => _onError(err, req, ctx));\n                    },\n                    websocket: ws.bunListener,\n                });\n                ws.bunBind(server);\n                hostname = _server.hostname;\n                port = _server.port;\n            }\n            else {\n                hostname = \"0.0.0.0\";\n                port = 3000;\n            }\n        }\n        else if (isNode) {\n            if (type === \"classic\") {\n                const reqListener = withWeb((req, info) => {\n                    const { getTimers, time, timeEnd } = createTimingFunctions();\n                    const ctx = createRequestContext(req, { ws, ...info, time, timeEnd });\n                    const _handle = withHeaders(handle, headers);\n                    const _onError = withHeaders(onError, headers);\n                    return _handle(req, ctx)\n                        .then(res => patchTimingMetrics(res, getTimers()))\n                        .catch(err => _onError(err, req, ctx));\n                });\n                if (key && cert) {\n                    const { createSecureServer } = await import(\"node:http2\");\n                    server = createSecureServer({ key, cert, allowHTTP1: true }, reqListener);\n                }\n                else {\n                    const { createServer } = await import(\"node:http\");\n                    server = createServer(reqListener);\n                }\n                const _server = server;\n                port !== null && port !== void 0 ? port : (port = await randomPort(8000, hostname));\n                await new Promise((resolve) => {\n                    if (hostname && hostname !== \"0.0.0.0\") {\n                        _server.listen(port, hostname, resolve);\n                    }\n                    else {\n                        _server.listen(port, resolve);\n                    }\n                });\n                const address = _server.address();\n                hostname || (hostname = address.address);\n                port = address.port;\n            }\n            else {\n                hostname = \"\";\n                port = 0;\n            }\n        }\n        else if (typeof addEventListener === \"function\") {\n            hostname = \"\";\n            port = 0;\n            if (type === \"classic\") {\n                listenFetchEvent({ ws, fetch: handle, onError, headers });\n            }\n        }\n        else {\n            throw new Error(\"Unsupported runtime\");\n        }\n        return { http: server, hostname, port, controller };\n    }, { type, fetch: handle, onError, onListen, ws, headers, secure: !!key && !!cert });\n}\n/**\n * Serves static files from a file system directory or KV namespace (in\n * Cloudflare Workers).\n *\n * NOTE: In Node.js, this function requires Node.js v18.4.1 or above.\n *\n * NOTE: In Cloudflare Workers, this function requires setting the\n * `[site].bucket` option in the `wrangler.toml` file.\n *\n * @example\n * ```ts\n * import { serve, serveStatic } from \"@ayonli/jsext/http\";\n *\n * // use `serve()` so this program runs in all environments\n * serve({\n *     async fetch(req: Request, ctx) {\n *         const { pathname } = new URL(req.url);\n *\n *         if (pathname.startsWith(\"/assets\")) {\n *             return await serveStatic(req, {\n *                 fsDir: \"./assets\",\n *                 kv: ctx.bindings?.__STATIC_CONTENT,\n *                 urlPrefix: \"/assets\",\n *             });\n *         }\n *\n *         return new Response(\"Hello, World!\");\n *     }\n * });\n * ```\n *\n * @example\n * ```toml\n * # wrangler.toml\n * [site]\n * bucket = \"./assets\"\n * ```\n */\nexport async function serveStatic(req, options = {}) {\n    var _a, _b, _c, _d, _e, _f;\n    const extraHeaders = (_a = options.headers) !== null && _a !== void 0 ? _a : {};\n    const dir = (_b = options.fsDir) !== null && _b !== void 0 ? _b : \".\";\n    const prefix = options.urlPrefix ? join(options.urlPrefix) : \"\";\n    const url = new URL(req.url);\n    const pathname = decodeURIComponent(url.pathname);\n    if (prefix && !startsWith(pathname, prefix)) {\n        return new Response(\"Not Found\", {\n            status: 404,\n            statusText: \"Not Found\",\n            headers: extraHeaders,\n        });\n    }\n    const filename = join(dir, stripStart(pathname.slice(prefix.length), \"/\"));\n    let info;\n    try {\n        info = await stat(filename);\n    }\n    catch (err) {\n        if (((_c = as(err, Error)) === null || _c === void 0 ? void 0 : _c.name) === \"NotFoundError\") {\n            return new Response(`Not Found`, {\n                status: 404,\n                statusText: \"Not Found\",\n                headers: extraHeaders,\n            });\n        }\n        else if (((_d = as(err, Error)) === null || _d === void 0 ? void 0 : _d.name) === \"NotAllowedError\") {\n            return new Response(\"Forbidden\", {\n                status: 403,\n                statusText: \"Forbidden\",\n                headers: extraHeaders,\n            });\n        }\n        else {\n            return new Response(\"Internal Server Error\", {\n                status: 500,\n                statusText: \"Internal Server Error\",\n                headers: extraHeaders,\n            });\n        }\n    }\n    if (info.kind === \"directory\") {\n        if (!req.url.endsWith(\"/\")) {\n            return Response.redirect(req.url + \"/\", 301);\n        }\n        else {\n            if (await exists(join(filename, \"index.html\"))) {\n                return serveStatic(new Request(join(req.url, \"index.html\"), req), options);\n            }\n            else if (await exists(join(filename, \"index.htm\"))) {\n                return serveStatic(new Request(join(req.url, \"index.htm\"), req), options);\n            }\n            else if (options.listDir) {\n                const entries = await readAsArray(readDir(filename));\n                return renderDirectoryPage(pathname, entries, extraHeaders);\n            }\n            else {\n                return new Response(\"Forbidden\", {\n                    status: 403,\n                    statusText: \"Forbidden\",\n                    headers: extraHeaders,\n                });\n            }\n        }\n    }\n    else if (info.kind !== \"file\") {\n        return new Response(\"Forbidden\", {\n            status: 403,\n            statusText: \"Forbidden\",\n            headers: extraHeaders,\n        });\n    }\n    const rangeValue = req.headers.get(\"Range\");\n    let range;\n    if (rangeValue && info.size) {\n        try {\n            range = parseRange(rangeValue);\n        }\n        catch (_g) {\n            return new Response(\"Invalid Range header\", {\n                status: 416,\n                statusText: \"Range Not Satisfiable\",\n                headers: extraHeaders,\n            });\n        }\n    }\n    const mtime = (_e = info.mtime) !== null && _e !== void 0 ? _e : new Date();\n    const _etag = await etag(info);\n    const headers = new Headers({\n        ...extraHeaders,\n        \"Accept-Ranges\": \"bytes\",\n        \"Last-Modified\": mtime.toUTCString(),\n        \"Etag\": _etag,\n    });\n    const ifModifiedSinceValue = req.headers.get(\"If-Modified-Since\");\n    const ifNoneMatchValue = req.headers.get(\"If-None-Match\");\n    const ifMatchValue = req.headers.get(\"If-Match\");\n    let modified = true;\n    if (ifModifiedSinceValue) {\n        const date = new Date(ifModifiedSinceValue);\n        modified = Math.floor(mtime.valueOf() / 1000) > Math.floor(date.valueOf() / 1000);\n    }\n    else if (ifNoneMatchValue) {\n        modified = ifNoneMatch(ifNoneMatchValue, _etag);\n    }\n    if (!modified) {\n        return new Response(null, {\n            status: 304,\n            statusText: \"Not Modified\",\n            headers,\n        });\n    }\n    else if (ifMatchValue && range && !ifMatch(ifMatchValue, _etag)) {\n        return new Response(\"Precondition Failed\", {\n            status: 412,\n            statusText: \"Precondition Failed\",\n            headers,\n        });\n    }\n    if (/^text\\/|^application\\/(json|yaml|toml|xml|javascript)$/.test(info.type)) {\n        headers.set(\"Content-Type\", info.type + \"; charset=utf-8\");\n    }\n    else {\n        headers.set(\"Content-Type\", info.type || \"application/octet-stream\");\n    }\n    if (info.atime) {\n        headers.set(\"Date\", info.atime.toUTCString());\n    }\n    if (options.maxAge) {\n        headers.set(\"Cache-Control\", `public, max-age=${options.maxAge}`);\n    }\n    if (range) {\n        const { ranges, suffix: suffixLength } = range;\n        let start;\n        let end;\n        if (ranges.length) {\n            ({ start } = ranges[0]);\n            end = Math.min((_f = ranges[0].end) !== null && _f !== void 0 ? _f : info.size - 1, info.size - 1);\n        }\n        else {\n            start = Math.max(info.size - suffixLength, 0);\n            end = info.size - 1;\n        }\n        const data = await readFile(filename);\n        const slice = data.subarray(start, end + 1);\n        headers.set(\"Content-Range\", `bytes ${start}-${end}/${info.size}`);\n        headers.set(\"Content-Length\", String(end - start + 1));\n        return new Response(slice, {\n            status: 206,\n            statusText: \"Partial Content\",\n            headers,\n        });\n    }\n    else if (!info.size) {\n        headers.set(\"Content-Length\", \"0\");\n        return new Response(\"\", {\n            status: 200,\n            statusText: \"OK\",\n            headers,\n        });\n    }\n    else {\n        headers.set(\"Content-Length\", String(info.size));\n        return new Response(createReadableStream(filename), {\n            status: 200,\n            statusText: \"OK\",\n            headers,\n        });\n    }\n}\nasync function startServer(args) {\n    const options = parseArgs(args, {\n        alias: { p: \"port\" }\n    });\n    const port = Number.isFinite(options[\"port\"]) ? options[\"port\"] : undefined;\n    const parallel = options[\"parallel\"];\n    let config = {};\n    let fetch;\n    let filename = String(options[0] || \".\");\n    const ext = extname(filename);\n    if (/^\\.m?(js|ts)x?/.test(ext)) { // custom entry file\n        filename = resolve(filename);\n        const mod = await import(filename);\n        if (typeof mod.default === \"object\" && typeof mod.default.fetch === \"function\") {\n            config = mod.default;\n            fetch = config.fetch;\n        }\n        else {\n            throw new Error(\"The entry file must have an `export default { fetch }` statement\");\n        }\n    }\n    fetch || (fetch = (req) => serveStatic(req, {\n        fsDir: filename,\n        listDir: true,\n        // gzip: true,\n    }));\n    if (isNode || isBun) {\n        import(\"node:os\").then(async ({ availableParallelism }) => {\n            const { default: cluster } = await import(\"node:cluster\");\n            if (cluster.isPrimary && parallel) {\n                const max = typeof parallel === \"number\" ? parallel : availableParallelism();\n                const _port = port || await randomPort(8000);\n                const hostname = config.hostname || \"localhost\";\n                const secure = !!config.key && !!config.cert;\n                const workers = new Array(max).fill(null);\n                const forkWorker = (i) => {\n                    const worker = cluster.fork({\n                        HTTP_PORT: String(_port),\n                    });\n                    workers[i] = { worker, ready: false };\n                    worker.on(\"message\", (msg) => {\n                        if (msg === \"ready\") {\n                            workers[i].ready = true;\n                            if (workers.every(w => w === null || w === void 0 ? void 0 : w.ready)) {\n                                const protocol = secure ? \"https\" : \"http\";\n                                const origin = `${protocol}://${hostname}:${_port}`;\n                                console.log(`Server listening on ${origin} with ${max} workers`);\n                            }\n                        }\n                    });\n                    worker.once(\"exit\", (code) => {\n                        workers[i] = null;\n                        if (code) {\n                            forkWorker(i);\n                        }\n                    });\n                };\n                for (let i = 0; i < max; i++) {\n                    forkWorker(i);\n                }\n            }\n            else if (cluster.isWorker && process.env[\"HTTP_PORT\"]) {\n                serve({\n                    ...config,\n                    fetch,\n                    port: Number(process.env[\"HTTP_PORT\"]),\n                    type: \"classic\",\n                    onListen: (info) => {\n                        var _a, _b;\n                        (_a = config.onListen) === null || _a === void 0 ? void 0 : _a.call(config, info);\n                        (_b = process.send) === null || _b === void 0 ? void 0 : _b.call(process, \"ready\");\n                    },\n                });\n            }\n            else {\n                serve({ ...config, fetch, port, type: \"classic\" });\n            }\n        });\n    }\n    else {\n        serve({ ...config, fetch, port, type: \"classic\" });\n    }\n}\nif ((isDeno || isBun || isNode) && isMain(import.meta)) {\n    startServer(args);\n}\nelse if (isNode && process.execArgv.some(arg => arg.endsWith(\"@ayonli/jsext/http\"))) {\n    const options = parseArgs(process.execArgv, {\n        alias: { r: \"require\" },\n        lists: [\"require\", \"import\"],\n    });\n    const args = process.argv.slice(1);\n    if (args.length && (((_a = options[\"require\"]) === null || _a === void 0 ? void 0 : _a.includes(\"@ayonli/jsext/http\")) ||\n        ((_b = options[\"import\"]) === null || _b === void 0 ? void 0 : _b.includes(\"@ayonli/jsext/http\")))) {\n        startServer(args);\n    }\n}\n//# sourceMappingURL=http.js.map","/**\n * Functions for working with the network, such as connecting to a TCP server,\n * binding a UDP socket, etc.\n *\n * This module is designed to provide a unified interface to work with network\n * in Node.js, Deno, Bun (and Cloudflare Workers for limited support), based on\n * modern Web APIs. It does not work in the browser.\n *\n * NOTE: This module depends on the Web Streams API, in Node.js, it requires\n * Node.js v18.0 or above.\n * @module\n * @experimental\n */\nimport { asyncTask } from \"./async.ts\";\nimport { isBun, isDeno, isNode, isNodeLike } from \"./env.ts\";\nimport { TcpSocketStream, UdpSocket, UdpSocketStream, UnixSocketStream, } from \"./net/types.ts\";\nimport chan from \"./chan.ts\";\n/**\n * Returns the IP address of the current machine.\n *\n * NOTE: This function is not available in the browser and worker runtimes such\n * as Cloudflare Workers.\n */\nexport async function getMyIp() {\n    if (isNodeLike) {\n        const { createSocket } = await import(\"node:dgram\");\n        const socket = createSocket(\"udp4\");\n        return new Promise((resolve) => {\n            socket.connect(53, \"8.8.8.8\", () => {\n                const addr = socket.address();\n                socket.close();\n                resolve(addr.address);\n            });\n        });\n    }\n    else if (isDeno) {\n        const conn = await Deno.connect({\n            hostname: \"8.8.8.8\",\n            port: 53,\n        });\n        const addr = conn.localAddr;\n        conn.close();\n        return addr.hostname;\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\n/**\n * Returns a random port number that is available for listening.\n *\n * NOTE: This function is not available in the browser and worker runtimes such\n * as Cloudflare Workers.\n *\n * @param prefer The preferred port number to return if it is available,\n * otherwise a random port is returned.\n *\n * @param hostname The hostname to bind the port to. Default is \"0.0.0.0\", only\n * used when `prefer` is set and not `0`.\n */\nexport async function randomPort(prefer = undefined, hostname = undefined) {\n    hostname || (hostname = \"0.0.0.0\");\n    if (isDeno) {\n        try {\n            const listener = Deno.listen({\n                hostname,\n                port: prefer !== null && prefer !== void 0 ? prefer : 0,\n            });\n            const { port } = listener.addr;\n            listener.close();\n            return Promise.resolve(port);\n        }\n        catch (err) {\n            if (prefer) {\n                return randomPort(0);\n            }\n            else {\n                throw err;\n            }\n        }\n    }\n    else if (isBun) {\n        try {\n            const listener = Bun.listen({\n                hostname,\n                port: prefer !== null && prefer !== void 0 ? prefer : 0,\n                socket: {\n                    data: () => { },\n                },\n            });\n            const { port } = listener;\n            listener.stop(true);\n            return Promise.resolve(port);\n        }\n        catch (err) {\n            if (prefer) {\n                return randomPort(0);\n            }\n            else {\n                throw err;\n            }\n        }\n    }\n    else if (isNode) {\n        const { createServer, connect } = await import(\"node:net\");\n        if (prefer) {\n            // In Node.js listening on a port used by another process may work,\n            // so we don't use `listen` method to check if the port is available.\n            // Instead, we use the `connect` method to check if the port can be\n            // reached, if so, the port is open and we don't use it.\n            const isOpen = await new Promise((resolve, reject) => {\n                const conn = connect(prefer, hostname === \"0.0.0.0\" ? \"localhost\" : hostname);\n                conn.once(\"connect\", () => {\n                    conn.end();\n                    resolve(true);\n                }).once(\"error\", (err) => {\n                    if (err[\"code\"] === \"ECONNREFUSED\") {\n                        resolve(false);\n                    }\n                    else {\n                        reject(err);\n                    }\n                });\n            });\n            if (isOpen) {\n                return randomPort(0);\n            }\n            else {\n                return prefer;\n            }\n        }\n        else {\n            const server = createServer();\n            server.listen({ port: 0, exclusive: true });\n            const port = server.address().port;\n            return new Promise((resolve, reject) => {\n                server.close(err => err ? reject(err) : resolve(port));\n            });\n        }\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\nexport function connect(options) {\n    if (options.transport === \"udp\") {\n        return connectUdp(options);\n    }\n    else if (options.transport === \"unix\" || \"path\" in options) {\n        return connectUnix(options);\n    }\n    else {\n        return connectTcp(options);\n    }\n}\nasync function connectTcp(options) {\n    var _a;\n    const { tls = false, ..._options } = options;\n    if (isNode) {\n        const { createConnection } = await import(\"node:net\");\n        const { connect } = await import(\"node:tls\");\n        const _socket = tls ? connect({\n            ..._options,\n            rejectUnauthorized: false,\n        }) : createConnection({\n            host: options.hostname,\n            port: options.port,\n            localPort: 0,\n        });\n        const props = await nodeToSocket(_socket);\n        return new TcpSocketStream({\n            localAddress: {\n                hostname: _socket.localAddress || \"localhost\",\n                port: (_a = _socket.localPort) !== null && _a !== void 0 ? _a : 0,\n            },\n            remoteAddress: {\n                hostname: _socket.remoteAddress,\n                port: _socket.remotePort,\n            },\n            ...props,\n            setKeepAlive: _socket.setKeepAlive.bind(_socket),\n            setNoDelay: _socket.setNoDelay.bind(_socket),\n        });\n    }\n    else if (isDeno) {\n        const _socket = tls\n            ? await Deno.connectTls(_options)\n            : await Deno.connect(_options);\n        const { localAddr, remoteAddr } = _socket;\n        return new TcpSocketStream({\n            localAddress: {\n                hostname: localAddr.hostname,\n                port: localAddr.port,\n            },\n            remoteAddress: {\n                hostname: remoteAddr.hostname,\n                port: remoteAddr.port,\n            },\n            ...denoToSocket(_socket),\n            setKeepAlive: (keepAlive) => {\n                if (\"setKeepAlive\" in _socket) {\n                    _socket.setKeepAlive(keepAlive);\n                }\n            },\n            setNoDelay: (noDelay) => {\n                if (\"setNoDelay\" in _socket) {\n                    _socket.setNoDelay(noDelay);\n                }\n            },\n        });\n    }\n    else if (isBun) {\n        const ready = asyncTask();\n        const closed = asyncTask();\n        let readCtrl = null;\n        let writeCtrl = null;\n        const closeStreams = () => {\n            try {\n                _socket.terminate();\n            }\n            catch (_a) { }\n            try {\n                readCtrl === null || readCtrl === void 0 ? void 0 : readCtrl.close();\n            }\n            catch (_b) { }\n            try {\n                writeCtrl === null || writeCtrl === void 0 ? void 0 : writeCtrl.error(new TypeError(\"The stream is closed.\"));\n            }\n            catch (_c) { }\n        };\n        const readable = new ReadableStream({\n            start(controller) {\n                readCtrl = controller;\n            },\n            cancel(reason) {\n                reason ? closed.reject(reason) : closed.resolve();\n                closeStreams();\n            },\n        });\n        const writable = new WritableStream({\n            start(controller) {\n                writeCtrl = controller;\n            },\n            write(chunk) {\n                _socket.write(chunk);\n            },\n            close() {\n                writeCtrl.error(new TypeError(\"The stream is closed.\"));\n                _socket.shutdown();\n            },\n        });\n        const _socket = await Bun.connect({\n            ..._options,\n            tls,\n            socket: {\n                binaryType: \"uint8array\",\n                open() {\n                    ready.resolve();\n                },\n                data(_socket, data) {\n                    readCtrl.enqueue(data);\n                },\n                error(_socket, error) {\n                    try {\n                        readCtrl.error(error);\n                    }\n                    catch (_a) { }\n                    try {\n                        writeCtrl.error(error);\n                    }\n                    catch (_b) { }\n                    closed.reject(error);\n                },\n                close() {\n                    closeStreams();\n                    closed.resolve();\n                },\n            }\n        });\n        await ready;\n        return new TcpSocketStream({\n            localAddress: {\n                hostname: \"localhost\",\n                port: _socket.localPort,\n            },\n            remoteAddress: {\n                hostname: _socket.remoteAddress,\n                port: options.port,\n            },\n            readable,\n            writable,\n            closed,\n            close: closeStreams,\n            ref: () => _socket.ref(),\n            unref: () => _socket.unref(),\n            setKeepAlive: (keepAlive) => {\n                if (\"setKeepAlive\" in _socket) {\n                    _socket.setKeepAlive(keepAlive);\n                }\n            },\n            setNoDelay: (noDelay) => {\n                if (\"setNoDelay\" in _socket) {\n                    _socket.setNoDelay(noDelay);\n                }\n            },\n        });\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\nasync function connectUnix(options) {\n    const { path } = options;\n    if (isNode) {\n        const { createConnection } = await import(\"node:net\");\n        const _socket = createConnection({ path });\n        const props = await nodeToSocket(_socket);\n        return new UnixSocketStream(props);\n    }\n    else if (isDeno) {\n        const _socket = await Deno.connect({ transport: \"unix\", path });\n        return new UnixSocketStream(denoToSocket(_socket));\n    }\n    else if (isBun) {\n        const ready = asyncTask();\n        const closed = asyncTask();\n        let readCtrl = null;\n        let writeCtrl = null;\n        const closeStreams = () => {\n            try {\n                _socket.terminate();\n            }\n            catch (_a) { }\n            try {\n                readCtrl === null || readCtrl === void 0 ? void 0 : readCtrl.close();\n            }\n            catch (_b) { }\n            try {\n                writeCtrl === null || writeCtrl === void 0 ? void 0 : writeCtrl.error(new TypeError(\"The stream is closed.\"));\n            }\n            catch (_c) { }\n        };\n        const readable = new ReadableStream({\n            start(controller) {\n                readCtrl = controller;\n            },\n            cancel(reason) {\n                reason ? closed.reject(reason) : closed.resolve();\n                closeStreams();\n            },\n        });\n        const writable = new WritableStream({\n            start(controller) {\n                writeCtrl = controller;\n            },\n            write(chunk) {\n                _socket.write(chunk);\n            },\n            close() {\n                _socket.shutdown();\n            },\n        });\n        const _socket = await Bun.connect({\n            unix: path,\n            socket: {\n                binaryType: \"uint8array\",\n                open() {\n                    ready.resolve();\n                },\n                data(_socket, data) {\n                    readCtrl.enqueue(data);\n                },\n                error(_socket, error) {\n                    try {\n                        readCtrl.error(error);\n                    }\n                    catch (_a) { }\n                    try {\n                        writeCtrl.error(error);\n                    }\n                    catch (_b) { }\n                    closed.reject(error);\n                },\n                close() {\n                    closeStreams();\n                    closed.resolve();\n                },\n            }\n        });\n        await ready;\n        return new UnixSocketStream({\n            readable,\n            writable,\n            closed,\n            close: closeStreams,\n            ref: () => _socket.ref(),\n            unref: () => _socket.unref(),\n        });\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\nasync function nodeToSocket(socket) {\n    const ready = asyncTask();\n    const closed = asyncTask();\n    let readCtrl = null;\n    let writeCtrl = null;\n    const closeStreams = () => {\n        try {\n            socket.destroyed || socket.destroy();\n        }\n        catch (_a) { }\n        try {\n            readCtrl === null || readCtrl === void 0 ? void 0 : readCtrl.close();\n        }\n        catch (_b) { }\n        try {\n            writeCtrl === null || writeCtrl === void 0 ? void 0 : writeCtrl.error(new TypeError(\"The stream is closed.\"));\n        }\n        catch (_c) { }\n    };\n    const readable = new ReadableStream({\n        start(controller) {\n            readCtrl = controller;\n        },\n        cancel(reason) {\n            reason ? closed.reject(reason) : closed.resolve();\n            closeStreams();\n        },\n    });\n    const writable = new WritableStream({\n        start(controller) {\n            writeCtrl = controller;\n        },\n        write(chunk) {\n            return new Promise((resolve, reject) => {\n                socket.write(chunk, err => {\n                    err ? reject(err) : resolve();\n                });\n            });\n        },\n        close() {\n            return new Promise(resolve => {\n                socket.end(resolve);\n            });\n        },\n    });\n    socket.once(\"connect\", () => {\n        ready.resolve();\n    }).on(\"data\", data => {\n        readCtrl.enqueue(new Uint8Array(data.buffer, data.byteOffset, data.byteLength));\n    }).once(\"error\", (error) => {\n        try {\n            readCtrl.error(error);\n        }\n        catch (_a) { }\n        try {\n            writeCtrl.error(error);\n        }\n        catch (_b) { }\n        closed.reject(error);\n        ready.reject(error);\n    }).once(\"close\", (hasError) => {\n        if (!hasError) {\n            closeStreams();\n            closed.resolve();\n        }\n    });\n    await ready;\n    return {\n        readable,\n        writable,\n        closed,\n        close: () => void socket.destroy(),\n        ref: () => void socket.ref(),\n        unref: () => void socket.unref(),\n    };\n}\nfunction denoToSocket(socket) {\n    const closed = asyncTask();\n    let closeCalled = false;\n    let readCtrl = null;\n    let writeCtrl = null;\n    const closeStreams = () => {\n        try {\n            socket.close();\n        }\n        catch (_a) { }\n        try {\n            readCtrl === null || readCtrl === void 0 ? void 0 : readCtrl.close();\n        }\n        catch (_b) { }\n        try {\n            writeCtrl === null || writeCtrl === void 0 ? void 0 : writeCtrl.error(new TypeError(\"The stream is closed.\"));\n        }\n        catch (_c) { }\n    };\n    return {\n        readable: new ReadableStream({\n            start(controller) {\n                readCtrl = controller;\n            },\n            async pull(readCtrl) {\n                try {\n                    while (true) {\n                        const value = new Uint8Array(4096);\n                        const n = await socket.read(value);\n                        if (n === null) {\n                            closeStreams();\n                            closed.resolve();\n                            break;\n                        }\n                        readCtrl.enqueue(value.subarray(0, n));\n                    }\n                }\n                catch (err) {\n                    try {\n                        socket.close();\n                    }\n                    catch (_a) { }\n                    try {\n                        readCtrl.error(err);\n                    }\n                    catch (_b) { }\n                    try {\n                        writeCtrl === null || writeCtrl === void 0 ? void 0 : writeCtrl.error(err);\n                    }\n                    catch (_c) { }\n                    closeCalled ? closed.resolve() : closed.reject(err);\n                }\n            },\n            cancel(reason) {\n                reason ? closed.reject(reason) : closed.resolve();\n                closeStreams();\n            },\n        }),\n        writable: new WritableStream({\n            start(controller) {\n                writeCtrl = controller;\n            },\n            async write(chunk) {\n                await socket.write(chunk);\n            },\n            close() {\n                return socket.closeWrite();\n            },\n        }),\n        closed,\n        close: () => {\n            closeCalled = true;\n            closeStreams();\n        },\n        ref: socket.ref.bind(socket),\n        unref: socket.unref.bind(socket),\n    };\n}\nasync function connectUdp(remoteAddress) {\n    const socket = await udpSocket();\n    return socket.connect(remoteAddress);\n}\n/**\n * This function provides a unified interface to bind a UDP socket in Node.js,\n * Deno and Bun, based on modern Web APIs.\n *\n * NOTE: This function depends on the Web Streams API, in Node.js, it requires\n * Node.js v18.0 or above.\n *\n * @example\n * ```ts\n * import { udpSocket } from \"@ayonli/jsext/net\";\n *\n * const socket = await udpSocket({ port: 8080 });\n *\n * for await (const [data, addr] of socket) {\n *     console.log(`Received ${data.byteLength} bytes from ${addr.hostname}:${addr.port}`);\n * }\n * ```\n */\nexport async function udpSocket(localAddress = {}) {\n    // if (isDeno) {\n    //     const _socket = Deno.listenDatagram({\n    //         hostname: localAddress.hostname ?? \"0.0.0.0\",\n    //         port: localAddress.port ?? 0,\n    //         transport: \"udp\",\n    //     });\n    //     const addr = _socket.addr as Deno.NetAddr;\n    //     const closed = asyncTask<void>();\n    var _a;\n    //     return new UdpSocket({\n    //         localAddress: constructNetAddress({\n    //             hostname: addr.hostname,\n    //             port: addr.port,\n    //         }),\n    //         closed,\n    //         close: _socket.close.bind(_socket),\n    //         ref: () => void 0,\n    //         unref: () => void 0,\n    //         receive: async () => {\n    //             try {\n    //                 const [data, addr] = await _socket.receive();\n    //                 return [data, {\n    //                     hostname: (addr as Deno.NetAddr).hostname,\n    //                     port: (addr as Deno.NetAddr).port,\n    //                 }];\n    //             } catch (err) {\n    //                 closed.reject(err);\n    //                 try { _socket.close(); } catch { }\n    //                 throw err;\n    //             }\n    //         },\n    //         send: (data, remoteAddress) => {\n    //             return _socket.send(data, { transport: \"udp\", ...remoteAddress });\n    //         },\n    //         connect: (remoteAddress) => {\n    //             void remoteAddress;\n    //             throw new Error(\"Deno does not support UDP connection at the moment\");\n    //         },\n    //     });\n    // } else if (isNodeLike) {\n    if (isDeno || isNodeLike) {\n        const { createSocket } = await import(\"node:dgram\");\n        const _socket = createSocket(((_a = localAddress.hostname) === null || _a === void 0 ? void 0 : _a.includes(\":\")) ? \"udp6\" : \"udp4\");\n        let isConnected = false;\n        let isClosed = false;\n        const closed = asyncTask();\n        const channel = chan(Infinity);\n        await new Promise(resolve => {\n            _socket.bind(localAddress.port, localAddress.hostname, resolve);\n        });\n        _socket.on(\"message\", (data, rinfo) => {\n            channel.send([new Uint8Array(data.buffer, data.byteOffset, data.byteLength), {\n                    hostname: rinfo.address,\n                    port: rinfo.port,\n                }]).catch(() => { });\n        }).once(\"error\", err => {\n            channel.close(err);\n            closed.reject(err);\n        }).once(\"close\", () => {\n            isClosed = true;\n            channel.close();\n            closed.resolve();\n        });\n        const localAddr = _socket.address();\n        const props = {\n            localAddress: {\n                hostname: localAddr.address,\n                port: localAddr.port,\n            },\n            closed,\n            close: () => void _socket.close(),\n            ref: _socket.ref.bind(_socket),\n            unref: _socket.unref.bind(_socket),\n        };\n        return new UdpSocket({\n            ...props,\n            joinMulticast: _socket.addMembership.bind(_socket),\n            leaveMulticast: _socket.dropMembership.bind(_socket),\n            setBroadcast: _socket.setBroadcast.bind(_socket),\n            setMulticastLoopback: _socket.setMulticastLoopback.bind(_socket),\n            setMulticastTTL: _socket.setMulticastTTL.bind(_socket),\n            setTTL: _socket.setTTL.bind(_socket),\n            receive: async () => {\n                if (isConnected) {\n                    throw new TypeError(\"The socket is connected.\");\n                }\n                else if (isClosed) {\n                    throw new TypeError(\"The socket is closed.\");\n                }\n                const msg = await channel.recv();\n                if (msg) {\n                    return msg;\n                }\n                else {\n                    throw new TypeError(\"The socket is closed.\");\n                }\n            },\n            send: async (data, remoteAddress) => {\n                if (isConnected) {\n                    throw new TypeError(\"The socket is connected.\");\n                }\n                else if (isClosed) {\n                    throw new TypeError(\"The socket is closed.\");\n                }\n                return new Promise((resolve, reject) => {\n                    _socket.send(data, remoteAddress.port, remoteAddress.hostname, (err, n) => {\n                        err ? reject(err) : resolve(n);\n                    });\n                });\n            },\n            connect: (remoteAddress) => {\n                return new Promise(resolve => {\n                    isConnected = true;\n                    _socket.connect(remoteAddress.port, remoteAddress.hostname, () => {\n                        const localAddr = _socket.address();\n                        const remoteAddr = _socket.remoteAddress();\n                        let readCtrl = null;\n                        let writeCtrl = null;\n                        const closeStreams = () => {\n                            channel.close();\n                            try {\n                                _socket.close();\n                            }\n                            catch (_a) { }\n                            try {\n                                readCtrl === null || readCtrl === void 0 ? void 0 : readCtrl.close();\n                            }\n                            catch (_b) { }\n                            try {\n                                writeCtrl === null || writeCtrl === void 0 ? void 0 : writeCtrl.error(new TypeError(\"The stream is closed.\"));\n                            }\n                            catch (_c) { }\n                        };\n                        resolve(new UdpSocketStream({\n                            ...props,\n                            localAddress: {\n                                hostname: localAddr.address,\n                                port: localAddr.port,\n                            },\n                            remoteAddress: {\n                                hostname: remoteAddr.address,\n                                port: remoteAddr.port,\n                            },\n                            readable: new ReadableStream({\n                                start(controller) {\n                                    readCtrl = controller;\n                                },\n                                async pull(readCtrl) {\n                                    try {\n                                        while (true) {\n                                            const msg = await channel.recv();\n                                            if (msg === undefined) {\n                                                closeStreams();\n                                                closed.resolve();\n                                                break;\n                                            }\n                                            readCtrl.enqueue(msg[0]);\n                                        }\n                                    }\n                                    catch (err) {\n                                        channel.close(err);\n                                        try {\n                                            _socket.close();\n                                        }\n                                        catch (_a) { }\n                                        try {\n                                            readCtrl.error(err);\n                                        }\n                                        catch (_b) { }\n                                        try {\n                                            writeCtrl === null || writeCtrl === void 0 ? void 0 : writeCtrl.error(err);\n                                        }\n                                        catch (_c) { }\n                                        isClosed ? closed.resolve() : closed.reject(err);\n                                    }\n                                },\n                                cancel(reason) {\n                                    reason ? closed.reject(reason) : closed.resolve();\n                                    closeStreams();\n                                },\n                            }),\n                            writable: new WritableStream({\n                                start(controller) {\n                                    writeCtrl = controller;\n                                },\n                                write(chunk) {\n                                    return new Promise((resolve, reject) => {\n                                        _socket.send(chunk, err => {\n                                            err ? reject(err) : resolve();\n                                        });\n                                    });\n                                },\n                            }),\n                        }));\n                    });\n                });\n            },\n        });\n    }\n    else {\n        throw new Error(\"Unsupported runtime\");\n    }\n}\n//# sourceMappingURL=net.js.map","import wrap from \"./wrap.ts\";\nexport const Result = function Result(init) {\n    if (!new.target) {\n        throw new TypeError(\"Class constructor Result cannot be invoked without 'new'\");\n    }\n    const ins = this;\n    if (init.ok) {\n        Object.defineProperties(ins, {\n            ok: { value: true },\n            value: { value: init.value },\n        });\n    }\n    else {\n        Object.defineProperties(ins, {\n            ok: { value: false },\n            error: { value: init.error },\n        });\n    }\n};\nResult.prototype.unwrap = function (onError = undefined) {\n    if (this.ok) {\n        return this.value;\n    }\n    else if (onError) {\n        return onError(this.error);\n    }\n    else {\n        throw this.error;\n    }\n};\nResult.prototype.optional = function () {\n    return this.ok ? this.value : undefined;\n};\nResult.wrap = function (fn = undefined) {\n    if (typeof fn === \"function\") {\n        try {\n            const res = fn();\n            if (typeof (res === null || res === void 0 ? void 0 : res.then) === \"function\") {\n                return Promise.resolve(res)\n                    .then(value => value instanceof Result ? value : Ok(value))\n                    .catch(error => Err(error));\n            }\n            else {\n                return res instanceof Result ? res : Ok(res);\n            }\n        }\n        catch (error) {\n            return Err(error);\n        }\n    }\n    else { // as a decorator\n        return (...args) => {\n            if (typeof args[1] === \"object\") { // new ES decorator since TypeScript 5.0\n                const [fn] = args;\n                return wrap(fn, function (fn, ...args) {\n                    return Result.wrap(() => fn.call(this, ...args));\n                });\n            }\n            else {\n                const [_ins, _prop, desc] = args;\n                desc.value = wrap(desc.value, function (fn, ...args) {\n                    return Result.wrap(() => fn.call(this, ...args));\n                });\n                return;\n            }\n        };\n    }\n};\n/**\n * Constructs a successful result with the given value.\n */\nexport const Ok = (value) => new Result({ ok: true, value });\n/**\n * Constructs a failed result with the given error.\n */\nexport const Err = (error) => new Result({ ok: false, error });\n//# sourceMappingURL=result.js.map","import \"./augment.ts\";\nimport jsext from \"./index.ts\";\nimport * as archive from \"./archive.ts\";\nimport * as array from \"./array.ts\";\nimport * as _async from \"./async.ts\";\nimport * as bytes from \"./bytes.ts\";\nimport * as _class from \"./class.ts\";\nimport * as cli from \"./cli.ts\";\nimport * as collections from \"./collections.ts\";\nimport * as dialog from \"./dialog.ts\";\nimport * as encoding from \"./encoding.ts\";\nimport * as error from \"./error.ts\";\nimport * as event from \"./event.ts\";\nimport * as filetype from \"./filetype.ts\";\nimport * as fs from \"./fs.ts\";\nimport * as hash from \"./hash.ts\";\nimport * as http from \"./http.ts\";\nimport * as json from \"./json.ts\";\nimport * as math from \"./math.ts\";\nimport * as module from \"./module.ts\";\nimport * as number from \"./number.ts\";\nimport * as object from \"./object.ts\";\nimport * as path from \"./path.ts\";\nimport * as reader from \"./reader.ts\";\nimport * as result from \"./result.ts\";\nimport * as runtime from \"./runtime.ts\";\nimport * as sse from \"./sse.ts\";\nimport * as string from \"./string.ts\";\nimport * as types from \"./types.ts\";\nimport * as ws from \"./ws.ts\";\nimport { Queue } from \"./queue.ts\";\nimport { Mutex } from \"./lock.ts\";\nimport { Channel } from \"./chan.ts\";\nexport default {\n    Queue,\n    Mutex,\n    Channel,\n    ...types,\n    ...jsext,\n    archive,\n    array,\n    async: _async,\n    bytes: {\n        ...object.omit(bytes, [\"default\"]),\n        bytes: bytes.default,\n    },\n    class: _class,\n    cli,\n    collections,\n    dialog,\n    encoding,\n    error,\n    event,\n    filetype,\n    fs,\n    hash: {\n        ...object.omit(hash, [\"default\"]),\n        hash: hash.default,\n    },\n    http,\n    json,\n    math,\n    module,\n    number,\n    object,\n    path,\n    reader,\n    result,\n    runtime: {\n        ...object.omit(runtime, [\"default\"]),\n        runtime: runtime.default,\n    },\n    sse,\n    string,\n    ws,\n};\n//# sourceMappingURL=bundle.js.map","export function useColorTheme() {\n    if (typeof window.matchMedia === \"function\") {\n        const result = window.matchMedia(\"(prefers-color-scheme: dark)\");\n        const theme = result.matches ? \"dark\" : \"light\";\n        return {\n            theme,\n            onChange: (callback) => {\n                result.addEventListener(\"change\", () => {\n                    callback(result.matches ? \"dark\" : \"light\");\n                });\n            }\n        };\n    }\n    else {\n        return {\n            theme: \"light\",\n            onChange: (_) => {\n                void 0;\n            }\n        };\n    }\n}\nexport function i18n(locale) {\n    let lang = \"en\";\n    if (typeof navigator === \"object\" && typeof navigator.language === \"string\") {\n        lang = navigator.language.split(\"-\")[0];\n    }\n    return locale[lang] || locale[\"en\"];\n}\n//# sourceMappingURL=util.js.map","import { useColorTheme } from \"./util.ts\";\nconst CloseEventListeners = new WeakMap();\nconst lightBgColor = \"#fff\";\nconst darkBgColor = \"#222\";\nconst lightTextColor = \"#000\";\nconst darkTextColor = \"#fff\";\nexport default function Dialog(props, ...children) {\n    const { onCancel, onOk } = props;\n    const hasInput = children.some(node => node.querySelector(\"input\"));\n    const dialog = document.createElement(\"dialog\");\n    const { theme, onChange } = useColorTheme();\n    dialog.style.fontFamily = \"Inter,sans-serif\";\n    dialog.style.color = theme === \"light\" ? lightTextColor : darkTextColor;\n    dialog.style.fontSize = \"13px\";\n    dialog.style.width = \"450px\";\n    dialog.style.boxSizing = \"border-box\";\n    dialog.style.border = \"1px solid #ccc\";\n    dialog.style.borderRadius = \"13px\";\n    dialog.style.padding = \"1rem\";\n    dialog.style.backgroundColor = theme === \"light\" ? lightBgColor : darkBgColor;\n    dialog.style.outline = \"none\";\n    if (!hasInput) {\n        dialog.inert = true;\n    }\n    onChange((theme) => {\n        dialog.style.color = theme === \"light\" ? lightTextColor : darkTextColor;\n        dialog.style.backgroundColor = theme === \"light\" ? lightBgColor : darkBgColor;\n    });\n    const close = () => {\n        if (!dialog.returnValue || dialog.returnValue === \"Cancel\") {\n            onCancel === null || onCancel === void 0 ? void 0 : onCancel(dialog);\n        }\n        else if (dialog.returnValue === \"OK\") {\n            onOk === null || onOk === void 0 ? void 0 : onOk(dialog);\n        }\n        try {\n            document.body.removeChild(dialog);\n        }\n        catch (err) {\n            if (err[\"name\"] !== \"NotFoundError\") { // Ignore NotFoundError (in Safari)\n                throw err;\n            }\n        }\n    };\n    if (typeof dialog.close === \"function\") {\n        dialog.addEventListener(\"close\", close);\n    }\n    else { // jsdom\n        CloseEventListeners.set(dialog, close);\n    }\n    dialog.addEventListener(\"keypress\", (event) => {\n        if (event.key === \"Enter\") {\n            closeDialog(dialog, \"OK\");\n        }\n    });\n    children.forEach(child => {\n        dialog.appendChild(child);\n    });\n    requestAnimationFrame(() => {\n        if (typeof dialog.showModal === \"function\") {\n            dialog.showModal();\n        }\n        else if (typeof dialog.show === \"function\") {\n            dialog.show();\n        }\n        else {\n            dialog.open = true; // for testing with JSDOM\n        }\n        if (!hasInput) {\n            dialog.inert = false;\n            requestAnimationFrame(() => {\n                dialog.focus();\n            });\n        }\n    });\n    return dialog;\n}\nexport function closeDialog(dialog, returnValue) {\n    requestAnimationFrame(() => {\n        if (typeof dialog.close === \"function\") {\n            dialog.close(returnValue);\n        }\n        else { // for testing with JSDOM\n            dialog.open = false;\n            dialog.returnValue = returnValue;\n            try {\n                dialog.dispatchEvent(new Event(\"close\"));\n            }\n            catch (_a) {\n                const close = CloseEventListeners.get(dialog);\n                if (close) {\n                    close();\n                    CloseEventListeners.delete(dialog);\n                }\n            }\n        }\n    });\n}\n//# sourceMappingURL=Dialog.js.map","import { closeDialog } from \"./Dialog.ts\";\nimport { i18n, useColorTheme } from \"./util.ts\";\nconst lightBgColor = \"#fff\";\nconst darkBgColor = \"#222\";\nconst lightHoverBgColor = \"#f4f4f4\";\nconst darkHoverBgColor = \"#333\";\nconst locale = {\n    ar: \"إلغاء\",\n    be: \"Адмяніць\",\n    bg: \"Отказ\",\n    bn: \"বাতিল\",\n    bs: \"Otkaži\",\n    cs: \"Storno\",\n    da: \"Annuller\",\n    de: \"Abbrechen\",\n    el: \"Ακύρωση\",\n    en: \"Cancel\",\n    es: \"Cancelar\",\n    et: \"Tühista\",\n    eu: \"Ezeztatu\",\n    fa: \"لغو\",\n    fi: \"Peruuta\",\n    fr: \"Annuler\",\n    hi: \"रद्द करें\",\n    hu: \"Mégsem\",\n    hy: \"Չեղարկել\",\n    id: \"Batal\",\n    is: \"Hætta við\",\n    it: \"Annulla\",\n    iw: \"ביטול\",\n    ja: \"キャンセル\",\n    ko: \"취소\",\n    lb: \"Ofbriechen\",\n    lo: \"ຍົກເລີກ\",\n    lv: \"Atcelt\",\n    lt: \"Atšaukti\",\n    mk: \"Откажи\",\n    ml: \"റദ്ദാക്കുക\",\n    mi: \"Whakakore\",\n    mn: \"Цуцлах\",\n    my: \"ပယ်ဖျက်\",\n    ne: \"रद्द गर्नुहोस्\",\n    nl: \"Annuleren\",\n    no: \"Avbryt\",\n    pl: \"Anuluj\",\n    pt: \"Cancelar\",\n    ro: \"Anulare\",\n    ru: \"Отмена\",\n    sa: \"रद्द\",\n    sk: \"Zrušiť\",\n    sl: \"Prekliči\",\n    so: \"Kaari\",\n    sq: \"Anulo\",\n    sv: \"Avbryt\",\n    th: \"ยกเลิก\",\n    tl: \"Kanselahin\",\n    tr: \"İptal\",\n    ug: \"بىكارلاش\",\n    uk: \"Скасувати\",\n    vi: \"Hủy\",\n    zh: \"取消\",\n};\nexport default function CancelButton() {\n    const button = document.createElement(\"button\");\n    const { theme, onChange } = useColorTheme();\n    button.textContent = i18n(locale);\n    button.style.minWidth = \"80px\";\n    button.style.height = \"32px\";\n    button.style.boxSizing = \"border-box\";\n    button.style.border = \"1px solid #8ebceb\";\n    button.style.borderRadius = \"1.5rem\";\n    button.style.color = \"#006bd6\";\n    button.style.backgroundColor = theme === \"light\" ? lightBgColor : darkBgColor;\n    button.style.userSelect = \"none\";\n    button.style.fontSize = \"1em\";\n    button.style.fontWeight = \"500\";\n    button.addEventListener(\"mouseover\", () => {\n        const { theme } = useColorTheme();\n        button.style.backgroundColor = theme === \"light\" ? lightHoverBgColor : darkHoverBgColor;\n    });\n    button.addEventListener(\"mouseout\", () => {\n        const { theme } = useColorTheme();\n        button.style.backgroundColor = theme === \"light\" ? lightBgColor : darkBgColor;\n    });\n    button.addEventListener(\"click\", (event) => {\n        var _a;\n        const dialog = (_a = event.target) === null || _a === void 0 ? void 0 : _a.closest(\"dialog\");\n        closeDialog(dialog, \"Cancel\");\n    });\n    onChange((theme) => {\n        button.style.backgroundColor = theme === \"light\" ? lightBgColor : darkBgColor;\n    });\n    return button;\n}\n//# sourceMappingURL=CancelButton.js.map","export default function Footer(...children) {\n    const block = document.createElement(\"footer\");\n    block.style.display = \"flex\";\n    block.style.justifyContent = \"flex-end\";\n    block.style.alignItems = \"center\";\n    block.style.gap = \"0.5em\";\n    children.forEach(node => {\n        block.appendChild(node);\n    });\n    return block;\n}\n//# sourceMappingURL=Footer.js.map","import { useColorTheme } from \"./util.ts\";\nconst lightBgColor = \"#fff\";\nconst darkBgColor = \"#222\";\nconst lightTextColor = \"#000\";\nconst darkTextColor = \"#fff\";\nexport default function Input(props) {\n    var _a, _b;\n    const div = document.createElement(\"div\");\n    const input = document.createElement(\"input\");\n    const { theme, onChange } = useColorTheme();\n    div.style.display = \"flex\";\n    div.style.margin = \"0 0 1rem\";\n    input.autofocus = true;\n    input.style.width = \"100%\";\n    input.style.height = \"32px\";\n    input.style.boxSizing = \"border-box\";\n    input.style.border = \"1px solid #ccc\";\n    input.style.borderRadius = \"1.5rem\";\n    input.style.padding = \"0 1rem\";\n    input.style.fontSize = \"1em\";\n    input.style.color = theme === \"light\" ? lightTextColor : darkTextColor;\n    input.style.backgroundColor = theme === \"light\" ? lightBgColor : darkBgColor;\n    input.type = (_a = props.type) !== null && _a !== void 0 ? _a : \"text\";\n    input.value = (_b = props.value) !== null && _b !== void 0 ? _b : \"\";\n    onChange((theme) => {\n        input.style.color = theme === \"light\" ? lightTextColor : darkTextColor;\n        input.style.backgroundColor = theme === \"light\" ? lightBgColor : darkBgColor;\n    });\n    div.appendChild(input);\n    return div;\n}\n//# sourceMappingURL=Input.js.map","import { closeDialog } from \"./Dialog.ts\";\nimport { i18n } from \"./util.ts\";\nconst locale = {\n    ar: \"موافق\",\n    be: \"Добра\",\n    bg: \"ОК\",\n    bn: \"ঠিক আছে\",\n    bs: \"U redu\",\n    cs: \"OK\",\n    da: \"OK\",\n    de: \"OK\",\n    el: \"ΟΚ\",\n    en: \"OK\",\n    es: \"Aceptar\",\n    et: \"OK\",\n    eu: \"Ados\",\n    fa: \"باشه\",\n    fi: \"OK\",\n    fr: \"OK\",\n    hi: \"ठीक\",\n    hu: \"OK\",\n    hy: \"Լավ\",\n    id: \"OK\",\n    is: \"Í lagi\",\n    it: \"OK\",\n    iw: \"אישור\",\n    ja: \"OK\",\n    ko: \"확인\",\n    lb: \"OK\",\n    lo: \"ຕົກລົງ\",\n    lv: \"Labi\",\n    lt: \"Gerai\",\n    mk: \"Добро\",\n    ml: \"ശരി\",\n    mi: \"OK\",\n    mn: \"Зөв\",\n    my: \"အိုး\",\n    ne: \"ठिक\",\n    nl: \"OK\",\n    no: \"OK\",\n    pl: \"OK\",\n    pt: \"OK\",\n    ro: \"OK\",\n    ru: \"OK\",\n    sa: \"ठीक\",\n    sk: \"OK\",\n    sl: \"V redu\",\n    so: \"OK\",\n    sq: \"OK\",\n    sv: \"OK\",\n    th: \"ตกลง\",\n    tl: \"OK\",\n    tr: \"Tamam\",\n    ug: \"جەزملە\",\n    uk: \"OK\",\n    vi: \"OK\",\n    zh: \"确定\",\n};\nexport default function OkButton() {\n    const button = document.createElement(\"button\");\n    button.textContent = i18n(locale);\n    button.style.minWidth = \"80px\";\n    button.style.height = \"32px\";\n    button.style.boxSizing = \"border-box\";\n    button.style.borderStyle = \"none\";\n    button.style.borderRadius = \"1.5rem\";\n    button.style.color = \"#fff\";\n    button.style.backgroundColor = \"#006bd6\";\n    button.style.userSelect = \"none\";\n    button.style.fontSize = \"1em\";\n    button.style.fontWeight = \"500\";\n    button.addEventListener(\"mouseover\", () => {\n        button.style.backgroundColor = \"#0174e6\";\n    });\n    button.addEventListener(\"mouseout\", () => {\n        button.style.backgroundColor = \"#006bd6\";\n    });\n    button.addEventListener(\"click\", (event) => {\n        var _a;\n        const dialog = (_a = event.target) === null || _a === void 0 ? void 0 : _a.closest(\"dialog\");\n        closeDialog(dialog, \"OK\");\n    });\n    return button;\n}\n//# sourceMappingURL=OkButton.js.map","import { useColorTheme } from \"./util.ts\";\nconst lightColor = \"#333\";\nconst darkColor = \"#ccc\";\nexport default function Progress() {\n    const div = document.createElement(\"div\");\n    const progress = document.createElement(\"progress\");\n    const span = document.createElement(\"span\");\n    const { theme, onChange } = useColorTheme();\n    div.style.width = \"100%\";\n    div.style.display = \"flex\";\n    div.style.justifyContent = \"center\";\n    div.style.alignItems = \"center\";\n    div.style.gap = \"0.5em\";\n    progress.max = 100;\n    progress.style.width = \"100%\";\n    span.style.color = theme === \"light\" ? lightColor : darkColor;\n    span.style.fontSize = \"1em\";\n    onChange((theme) => {\n        span.style.color = theme === \"light\" ? lightColor : darkColor;\n    });\n    div.appendChild(progress);\n    div.appendChild(span);\n    return {\n        element: div,\n        setValue: (value) => {\n            progress.value = value;\n            span.textContent = `${value}%`;\n        }\n    };\n}\n//# sourceMappingURL=Progress.js.map","export default function Text(message) {\n    const text = document.createElement(\"p\");\n    text.innerHTML = message.replace(/ /g, \"&nbsp;\").replace(/\\n/g, \"<br />\");\n    text.style.margin = \"0 0 1rem\";\n    text.style.fontSize = \"1em\";\n    text.style.width = \"100%\";\n    text.style.overflowX = \"auto\";\n    return text;\n}\n//# sourceMappingURL=Text.js.map","import { getExtensions, getMIME } from \"../../filetype.ts\";\nimport { readDir } from \"../../fs/web.ts\";\nimport { fixFileType } from \"../../fs/util.ts\";\nimport { basename } from \"../../path.ts\";\nimport { readAsObjectURL } from \"../../reader.ts\";\nfunction htmlAcceptToFileFilters(accept) {\n    const groups = [];\n    for (const type of accept.split(/\\s*,\\s*/)) {\n        if (type.endsWith(\"/*\")) {\n            groups.push(type);\n        }\n        else {\n            const group = groups[groups.length - 1];\n            if (!group || typeof group === \"string\") {\n                groups.push([type]);\n            }\n            else {\n                group.push(type);\n            }\n        }\n    }\n    return groups.map(group => {\n        if (Array.isArray(group)) {\n            return group.map(type => {\n                const extensions = getExtensions(type);\n                if (!extensions.length) {\n                    return undefined;\n                }\n                else {\n                    const mime = getMIME(type) || type;\n                    return {\n                        description: \"\",\n                        accept: {\n                            [mime]: extensions,\n                        },\n                    };\n                }\n            });\n        }\n        else if (group === \"*/*\") {\n            return {\n                description: \"All Files\",\n                accept: {\n                    \"*/*\": [\"*\"],\n                }\n            };\n        }\n        else {\n            const extensions = getExtensions(group);\n            if (!extensions.length) {\n                return undefined;\n            }\n            else if (group === \"video/*\") {\n                return {\n                    description: \"Video Files\",\n                    accept: { [group]: extensions },\n                };\n            }\n            else if (group === \"audio/*\") {\n                return {\n                    description: \"Audio Files\",\n                    accept: { [group]: extensions },\n                };\n            }\n            else if (group === \"image/*\") {\n                return {\n                    description: \"Image Files\",\n                    accept: { [group]: extensions },\n                };\n            }\n            else if (group === \"text/*\") {\n                return {\n                    description: \"Text Files\",\n                    accept: { [group]: extensions },\n                };\n            }\n            else {\n                const mime = getMIME(group) || group;\n                return {\n                    description: \"\",\n                    accept: { [mime]: extensions },\n                };\n            }\n        }\n    }).flat().filter(item => !!item);\n}\nexport async function pickFile(options = {}) {\n    const { type } = options;\n    try {\n        if (options.forSave) {\n            return await globalThis[\"showSaveFilePicker\"]({\n                types: type ? htmlAcceptToFileFilters(type) : [],\n                suggestedName: options.defaultName,\n            });\n        }\n        else {\n            const [handle] = await globalThis[\"showOpenFilePicker\"]({\n                types: type ? htmlAcceptToFileFilters(type) : [],\n            });\n            return handle !== null && handle !== void 0 ? handle : null;\n        }\n    }\n    catch (err) {\n        if (err.name === \"AbortError\") {\n            return null;\n        }\n        else {\n            throw err;\n        }\n    }\n}\nexport async function pickFiles(options = {}) {\n    const { type } = options;\n    try {\n        return await globalThis[\"showOpenFilePicker\"]({\n            types: type ? htmlAcceptToFileFilters(type) : [],\n            multiple: true,\n        });\n    }\n    catch (err) {\n        if (err.name === \"AbortError\") {\n            return [];\n        }\n        else {\n            throw err;\n        }\n    }\n}\nexport async function pickDirectory() {\n    try {\n        return await globalThis[\"showDirectoryPicker\"]();\n    }\n    catch (err) {\n        if (err.name === \"AbortError\") {\n            return null;\n        }\n        else {\n            throw err;\n        }\n    }\n}\nexport async function openFile(options = {}) {\n    var _a;\n    if (typeof globalThis[\"showOpenFilePicker\"] === \"function\") {\n        const handle = await pickFile(options);\n        return handle ? await handle.getFile().then(fixFileType) : null;\n    }\n    const input = document.createElement(\"input\");\n    input.type = \"file\";\n    input.accept = (_a = options.type) !== null && _a !== void 0 ? _a : \"\";\n    return await new Promise(resolve => {\n        input.onchange = () => {\n            var _a;\n            const file = (_a = input.files) === null || _a === void 0 ? void 0 : _a[0];\n            resolve(file ? fixFileType(file) : null);\n        };\n        input.oncancel = () => {\n            resolve(null);\n        };\n        if (typeof input.showPicker === \"function\") {\n            input.showPicker();\n        }\n        else {\n            input.click();\n        }\n    });\n}\nexport async function openFiles(options = {}) {\n    if (typeof globalThis[\"showOpenFilePicker\"] === \"function\") {\n        const handles = await pickFiles(options);\n        const files = [];\n        for (const handle of handles) {\n            const file = await handle.getFile();\n            files.push(fixFileType(file));\n        }\n        return files;\n    }\n    const input = document.createElement(\"input\");\n    input.type = \"file\";\n    input.multiple = true;\n    input.accept = options.type || \"\";\n    return await new Promise(resolve => {\n        input.onchange = () => {\n            const files = input.files;\n            resolve(files ? [...files].map(fixFileType) : []);\n        };\n        input.oncancel = () => {\n            resolve([]);\n        };\n        if (typeof input.showPicker === \"function\") {\n            input.showPicker();\n        }\n        else {\n            input.click();\n        }\n    });\n}\nexport async function openDirectory() {\n    if (typeof globalThis[\"showDirectoryPicker\"] === \"function\") {\n        const dir = await pickDirectory();\n        const files = [];\n        if (!dir) {\n            return files;\n        }\n        for await (const entry of readDir(dir, { recursive: true })) {\n            if (entry.kind === \"file\") {\n                const file = await entry.handle.getFile();\n                Object.defineProperty(file, \"webkitRelativePath\", {\n                    configurable: true,\n                    enumerable: true,\n                    writable: false,\n                    value: entry.relativePath.replace(/\\\\/g, \"/\"),\n                });\n                files.push(fixFileType(file));\n            }\n        }\n        return files;\n    }\n    else {\n        const input = document.createElement(\"input\");\n        input.type = \"file\";\n        input.webkitdirectory = true;\n        return await new Promise(resolve => {\n            input.onchange = () => {\n                const files = input.files;\n                resolve(files ? [...files].map(fixFileType) : []);\n            };\n            input.oncancel = () => {\n                resolve([]);\n            };\n            if (typeof input.showPicker === \"function\") {\n                input.showPicker();\n            }\n            else {\n                input.click();\n            }\n        });\n    }\n}\nexport async function saveFile(file, options = {}) {\n    const a = document.createElement(\"a\");\n    if (file instanceof ReadableStream) {\n        const type = options.type || \"application/octet-stream\";\n        a.href = await readAsObjectURL(file, type);\n        a.download = options.name || \"Unnamed\" + (getExtensions(type)[0] || \"\");\n    }\n    else if (file instanceof File) {\n        a.href = URL.createObjectURL(file);\n        a.download = options.name || file.name || \"Unnamed\" + (getExtensions(file.type)[0] || \"\");\n    }\n    else if (file instanceof Blob) {\n        a.href = URL.createObjectURL(file);\n        a.download = options.name || \"Unnamed\" + (getExtensions(file.type)[0] || \"\");\n    }\n    else {\n        const type = options.type || \"application/octet-stream\";\n        const blob = new Blob([file], { type });\n        a.href = URL.createObjectURL(blob);\n        a.download = options.name || \"Unnamed\" + (getExtensions(type)[0] || \"\");\n    }\n    a.click();\n}\nexport async function downloadFile(url, options = {}) {\n    const src = typeof url === \"object\" ? url.href : url;\n    const name = options.name || basename(src);\n    const a = document.createElement(\"a\");\n    a.href = src;\n    a.download = name;\n    a.click();\n}\n//# sourceMappingURL=file.js.map","/**\n * The implementation of `dialog` module for the browser.\n *\n * Normally, we should just use the `dialog` module, however, if we don't want\n * to include other parts that are not needed in the browser, we can use this\n * module instead.\n * @module\n */\nimport CancelButton from \"./web/CancelButton.ts\";\nimport Dialog, { closeDialog } from \"./web/Dialog.ts\";\nimport Footer from \"./web/Footer.ts\";\nimport Input from \"./web/Input.ts\";\nimport OkButton from \"./web/OkButton.ts\";\nimport Progress from \"./web/Progress.ts\";\nimport Text from \"./web/Text.ts\";\nexport * from \"./web/file.ts\";\nexport async function alert(message) {\n    await new Promise(resolve => {\n        document.body.appendChild(Dialog({\n            onCancel: () => resolve(),\n            onOk: () => resolve(),\n        }, Text(message), Footer(OkButton())));\n    });\n}\nexport async function confirm(message) {\n    return new Promise(resolve => {\n        document.body.appendChild(Dialog({\n            onCancel: () => resolve(false),\n            onOk: () => resolve(true),\n        }, Text(message), Footer(CancelButton(), OkButton())));\n    });\n}\nexport async function prompt(message, options = {}) {\n    const { type, defaultValue } = options;\n    return new Promise(resolve => {\n        document.body.appendChild(Dialog({\n            onCancel: () => resolve(null),\n            onOk: (dialog) => {\n                const input = dialog.querySelector(\"input\");\n                resolve(input.value);\n            },\n        }, Text(message), Input({ type, value: defaultValue }), Footer(CancelButton(), OkButton())));\n    });\n}\nexport async function progress(message, fn, onAbort = undefined) {\n    const ctrl = new AbortController();\n    const signal = ctrl.signal;\n    let fallback = null;\n    const abort = !onAbort ? undefined : async () => {\n        try {\n            const result = await onAbort();\n            fallback = { value: result };\n            ctrl.abort();\n        }\n        catch (err) {\n            ctrl.abort(err);\n        }\n    };\n    const listenForAbort = !onAbort ? undefined : () => new Promise((resolve, reject) => {\n        signal.addEventListener(\"abort\", () => {\n            if (fallback) {\n                resolve(fallback.value);\n            }\n            else {\n                reject(signal.reason);\n            }\n        });\n    });\n    const text = Text(message);\n    const { element: progressBar, setValue } = Progress();\n    const dialog = Dialog({ onCancel: abort }, text);\n    const set = (state) => {\n        if (signal.aborted) {\n            return;\n        }\n        if (state.message) {\n            text.innerHTML = state.message.replace(/ /g, \"&nbsp;\").replace(/\\n/g, \"<br />\");\n        }\n        if (state.percent !== undefined) {\n            setValue(state.percent);\n        }\n    };\n    if (abort) {\n        dialog.appendChild(Footer(progressBar, CancelButton()));\n    }\n    else {\n        dialog.appendChild(progressBar);\n    }\n    document.body.appendChild(dialog);\n    let job = fn(set, signal);\n    if (listenForAbort) {\n        job = Promise.race([job, listenForAbort()]);\n    }\n    try {\n        return await job;\n    }\n    finally {\n        signal.aborted || closeDialog(dialog, \"OK\");\n    }\n}\n//# sourceMappingURL=web.js.map","import bytes, { equals } from \"../../bytes.ts\";\nimport { ControlKeys, ControlSequences, getWindowSize, lockStdin, stringWidth, writeStdoutSync, } from \"../../cli.ts\";\nconst { CTRL_C, ESC, LF } = ControlKeys;\nconst { CLR } = ControlSequences;\nconst ongoingIndicators = [\n    \"      \",\n    \"=     \",\n    \"==    \",\n    \"===   \",\n    \" ===  \",\n    \"  === \",\n    \"   ===\",\n    \"    ==\",\n    \"     =\",\n    \"      \",\n];\nexport async function handleTerminalProgress(message, fn, options) {\n    const { signal, abort, listenForAbort } = options;\n    let lastMessage = message;\n    let lastPosition = 0;\n    let lastPercent = undefined;\n    const renderSimpleBar = (position = undefined) => {\n        position !== null && position !== void 0 ? position : (position = lastPosition++);\n        const ongoingIndicator = ongoingIndicators[position];\n        writeStdoutSync(CLR);\n        writeStdoutSync(bytes(`${lastMessage} [${ongoingIndicator}]`));\n        if (lastPosition === ongoingIndicators.length) {\n            lastPosition = 0;\n        }\n    };\n    const renderPercentageBar = (percent) => {\n        const { width } = getWindowSize();\n        const percentage = percent + \"%\";\n        const barWidth = width - stringWidth(lastMessage) - percentage.length - 5;\n        const filled = \"\".padStart(Math.floor(barWidth * percent / 100), \"#\");\n        const empty = \"\".padStart(barWidth - filled.length, \"-\");\n        writeStdoutSync(CLR);\n        writeStdoutSync(bytes(`${lastMessage} [${filled}${empty}] ${percentage}`));\n    };\n    renderSimpleBar();\n    const waitingTimer = setInterval(renderSimpleBar, 200);\n    const set = (state) => {\n        if (signal.aborted) {\n            return;\n        }\n        if (state.message) {\n            lastMessage = state.message;\n        }\n        if (state.percent !== undefined) {\n            lastPercent = state.percent;\n        }\n        if (lastPercent !== undefined) {\n            renderPercentageBar(lastPercent);\n            clearInterval(waitingTimer);\n        }\n        else if (state.message) {\n            renderSimpleBar(lastPosition);\n        }\n    };\n    const nodeReader = typeof Deno === \"object\" ? null : (buf) => {\n        if (equals(buf, ESC) || equals(buf, CTRL_C)) {\n            abort === null || abort === void 0 ? void 0 : abort();\n        }\n    };\n    const denoReader = typeof Deno === \"object\" ? Deno.stdin.readable.getReader() : null;\n    if (abort) {\n        if (nodeReader) {\n            process.stdin.on(\"data\", nodeReader);\n        }\n        else if (denoReader) {\n            (async () => {\n                while (true) {\n                    try {\n                        const { done, value } = await denoReader.read();\n                        if (done || equals(value, ESC) || equals(value, CTRL_C)) {\n                            signal.aborted || abort();\n                            break;\n                        }\n                    }\n                    catch (_a) {\n                        signal.aborted || abort();\n                        break;\n                    }\n                }\n                denoReader.releaseLock();\n            })();\n        }\n    }\n    let job = fn(set, signal);\n    if (listenForAbort) {\n        job = Promise.race([job, listenForAbort()]);\n    }\n    try {\n        return await job;\n    }\n    finally {\n        writeStdoutSync(LF);\n        clearInterval(waitingTimer);\n        if (nodeReader) {\n            process.stdin.off(\"data\", nodeReader);\n        }\n        else if (denoReader) {\n            denoReader.releaseLock();\n        }\n    }\n}\nexport default async function progress(message, fn, onAbort = undefined) {\n    const ctrl = new AbortController();\n    const signal = ctrl.signal;\n    let fallback = null;\n    const abort = !onAbort ? undefined : async () => {\n        try {\n            const result = await onAbort();\n            fallback = { value: result };\n            ctrl.abort();\n        }\n        catch (err) {\n            ctrl.abort(err);\n        }\n    };\n    const listenForAbort = !onAbort ? undefined : () => new Promise((resolve, reject) => {\n        signal.addEventListener(\"abort\", () => {\n            if (fallback) {\n                resolve(fallback.value);\n            }\n            else {\n                reject(signal.reason);\n            }\n        });\n    });\n    return await lockStdin(() => handleTerminalProgress(message, fn, {\n        signal,\n        abort,\n        listenForAbort,\n    }));\n}\n//# sourceMappingURL=progress.js.map","import { extname } from \"../../../path.ts\";\nimport { lines } from \"../../../string.ts\";\nimport { run } from \"../../../cli.ts\";\nimport { getExtensions } from \"../../../filetype.ts\";\nfunction htmlAcceptToFileFilters(accept) {\n    const groups = [];\n    for (const type of accept.split(/\\s*,\\s*/)) {\n        if (type.endsWith(\"/*\")) {\n            groups.push(type);\n        }\n        else {\n            const group = groups[groups.length - 1];\n            if (!group || typeof group === \"string\") {\n                groups.push([type]);\n            }\n            else {\n                group.push(type);\n            }\n        }\n    }\n    return groups.map(group => {\n        if (Array.isArray(group)) {\n            return group.map(type => getExtensions(type).map(t => `*${t}`))\n                .flat()\n                .join(\" \");\n        }\n        else if (group === \"*/*\") {\n            return \"All Files | *\";\n        }\n        else {\n            const patterns = getExtensions(group).map(t => `*${t}`).join(\" \");\n            if (!patterns) {\n                return undefined;\n            }\n            else if (group === \"video/*\") {\n                return \"Video Files | \" + patterns;\n            }\n            else if (group === \"audio/*\") {\n                return \"Audio Files | \" + patterns;\n            }\n            else if (group === \"image/*\") {\n                return \"Image Files | \" + patterns;\n            }\n            else if (group === \"text/*\") {\n                return \"Text Files | \" + patterns;\n            }\n            else {\n                return patterns;\n            }\n        }\n    }).filter(Boolean);\n}\nexport async function linuxPickFile(title = \"\", options = {}) {\n    const { type, forSave, defaultName } = options;\n    const args = [\n        \"--file-selection\",\n    ];\n    if (title) {\n        args.push(\"--title\", title);\n    }\n    if (type) {\n        htmlAcceptToFileFilters(type).forEach(filter => {\n            args.push(\"--file-filter\", filter);\n        });\n    }\n    if (forSave) {\n        args.push(\"--save\", \"--confirm-overwrite\");\n        if (defaultName) {\n            args.push(\"--filename\", defaultName);\n            if (!type) {\n                const ext = extname(defaultName);\n                if (ext) {\n                    htmlAcceptToFileFilters(ext).forEach(filter => {\n                        args.push(\"--file-filter\", filter);\n                    });\n                }\n            }\n        }\n    }\n    const { code, stdout, stderr } = await run(\"zenity\", args);\n    if (!code) {\n        const path = stdout.trim();\n        return path || null;\n    }\n    else if (code === 1) {\n        return null;\n    }\n    else {\n        throw new Error(stderr.trim());\n    }\n}\nexport async function linuxPickFiles(title = \"\", type = \"\") {\n    const args = [\n        \"--file-selection\",\n        \"--multiple\",\n        \"--separator\", \"\\n\",\n    ];\n    if (title) {\n        args.push(\"--title\", title);\n    }\n    if (type) {\n        htmlAcceptToFileFilters(type).forEach(filter => {\n            args.push(\"--file-filter\", filter);\n        });\n    }\n    const { code, stdout, stderr } = await run(\"zenity\", args);\n    if (!code) {\n        const output = stdout.trim();\n        return output ? lines(stdout.trim()) : [];\n    }\n    else if (code === 1) {\n        return [];\n    }\n    else {\n        throw new Error(stderr.trim());\n    }\n}\nexport async function linuxPickFolder(title = \"\") {\n    const args = [\n        \"--file-selection\",\n        \"--directory\",\n    ];\n    if (title) {\n        args.push(\"--title\", title);\n    }\n    const { code, stdout, stderr } = await run(\"zenity\", args);\n    if (!code) {\n        const dir = stdout.trim();\n        return dir || null;\n    }\n    else if (code === 1) {\n        return null;\n    }\n    else {\n        throw new Error(stderr.trim());\n    }\n}\n//# sourceMappingURL=linux.js.map","export function escape(str) {\n    return str.replace(/\\\\/g, \"\\\\\\\\\").replace(/\"/g, '\\\\\"');\n}\n//# sourceMappingURL=util.js.map","import { dedent, lines } from \"../../../string.ts\";\nimport { run } from \"../../../cli.ts\";\nimport { getUTI } from \"../../../filetype.ts\";\nimport { escape } from \"../util.ts\";\nfunction htmlAcceptToAppleType(accept) {\n    return accept.split(/\\s*,\\s*/).map(getUTI).filter(Boolean).map(t => `\"${t}\"`).join(\", \");\n}\nfunction createAppleScript(mode, title = \"\", options = {}) {\n    const { type, forSave, defaultName } = options;\n    if (mode === \"file\") {\n        if (forSave) {\n            return dedent `\n                tell application (path to frontmost application as text)\n                    set myFile to choose file name${title ? ` with prompt \"${escape(title)}\"` : \"\"}\\\n                        ${defaultName ? ` default name \"${escape(defaultName)}\"` : \"\"}\n                    POSIX path of myFile\n                end\n                `;\n        }\n        else {\n            const _type = type ? htmlAcceptToAppleType(type) : \"\";\n            return dedent `\n                tell application (path to frontmost application as text)\n                    set myFile to choose file${title ? ` with prompt \"${escape(title)}\"` : \"\"}\\\n                        ${_type ? ` of type {${_type}}` : \"\"} invisibles false\n                    POSIX path of myFile\n                end\n                `;\n        }\n    }\n    else if (mode === \"files\") {\n        const _type = type ? htmlAcceptToAppleType(type) : \"\";\n        return dedent `\n            tell application (path to frontmost application as text)\n                set myFiles to choose file${title ? ` with prompt \"${escape(title)}\"` : \"\"}\\\n                    ${_type ? ` of type {${_type}}` : \"\"} invisibles false\\\n                    multiple selections allowed true\n                set theList to {}\n                repeat with aItem in myFiles\n                    set end of theList to POSIX path of aItem\n                end repeat\n                set my text item delimiters to \"\\\\n\"\n                return theList as text\n            end\n            `;\n    }\n    else {\n        return dedent `\n            tell application (path to frontmost application as text)\n                set myFolder to choose folder${title ? ` with prompt \"${escape(title)}\"` : \"\"}\\\n                    invisibles false\n                POSIX path of myFolder\n            end\n            `;\n    }\n}\nexport async function macPickFile(title = \"\", options = {}) {\n    const { code, stdout, stderr } = await run(\"osascript\", [\n        \"-e\",\n        createAppleScript(\"file\", title, options)\n    ]);\n    if (!code) {\n        const path = stdout.trim();\n        return path || null;\n    }\n    else {\n        if (stderr.includes(\"User canceled\")) {\n            return null;\n        }\n        else {\n            throw new Error(stderr.trim());\n        }\n    }\n}\nexport async function macPickFiles(title = \"\", type = \"\") {\n    const { code, stdout, stderr } = await run(\"osascript\", [\n        \"-e\",\n        createAppleScript(\"files\", title, { type })\n    ]);\n    if (!code) {\n        const output = stdout.trim();\n        return output ? lines(stdout.trim()) : [];\n    }\n    else {\n        if (stderr.includes(\"User canceled\")) {\n            return [];\n        }\n        else {\n            throw new Error(stderr.trim());\n        }\n    }\n}\nexport async function macPickFolder(title = \"\") {\n    const { code, stdout, stderr } = await run(\"osascript\", [\n        \"-e\",\n        createAppleScript(\"folder\", title)\n    ]);\n    if (!code) {\n        const dir = stdout.trim();\n        return dir || null;\n    }\n    else {\n        if (stderr.includes(\"User canceled\")) {\n            return null;\n        }\n        else {\n            throw new Error(stderr.trim());\n        }\n    }\n}\n//# sourceMappingURL=mac.js.map","import { extname } from \"../../../path.ts\";\nimport { dedent, lines } from \"../../../string.ts\";\nimport { isWSL, powershell } from \"../../../cli.ts\";\nimport { getExtensions } from \"../../../filetype.ts\";\nimport { escape } from \"../util.ts\";\nfunction htmlAcceptToFileFilter(accept) {\n    const groups = [];\n    for (const type of accept.split(/\\s*,\\s*/)) {\n        if (type.endsWith(\"/*\")) {\n            groups.push(type);\n        }\n        else {\n            const group = groups[groups.length - 1];\n            if (!group || typeof group === \"string\") {\n                groups.push([type]);\n            }\n            else {\n                group.push(type);\n            }\n        }\n    }\n    return groups.map(group => {\n        if (Array.isArray(group)) {\n            const patterns = group.map(type => getExtensions(type).map(t => `*${t}`))\n                .flat()\n                .join(\";\");\n            return patterns + \"|\" + patterns;\n        }\n        else if (group === \"*/*\") {\n            return \"All Files|*\";\n        }\n        else {\n            const patterns = getExtensions(group).map(t => `*${t}`).join(\";\");\n            if (!patterns) {\n                return undefined;\n            }\n            else if (group === \"video/*\") {\n                return \"Video Files|\" + patterns;\n            }\n            else if (group === \"audio/*\") {\n                return \"Audio Files|\" + patterns;\n            }\n            else if (group === \"image/*\") {\n                return \"Image Files|\" + patterns;\n            }\n            else if (group === \"text/*\") {\n                return \"Text Files|\" + patterns;\n            }\n            else {\n                return patterns;\n            }\n        }\n    }).filter(Boolean).join(\"|\");\n}\nfunction createPowerShellScript(mode, title = \"\", options = {}) {\n    const { type, forSave, defaultName } = options;\n    if (mode === \"file\") {\n        if (forSave) {\n            let filter = type ? htmlAcceptToFileFilter(type) : \"\";\n            if (!filter && defaultName) {\n                const ext = extname(defaultName);\n                ext && (filter = htmlAcceptToFileFilter(ext));\n            }\n            return dedent `\n                Add-Type -AssemblyName System.Windows.Forms\n                $saveFileDialog = [System.Windows.Forms.SaveFileDialog]::new()\n                $saveFileDialog.Title = \"${escape(title)}\"\n                $saveFileDialog.FileName = \"${defaultName ? escape(defaultName) : \"\"}\"\n                $saveFileDialog.Filter = \"${filter}\"\n                if ($saveFileDialog.ShowDialog() -eq 'OK') {\n                    $saveFileDialog.FileName\n                }\n                `;\n        }\n        else {\n            const filter = type ? htmlAcceptToFileFilter(type) : \"\";\n            return dedent `\n                Add-Type -AssemblyName System.Windows.Forms\n                $openFileDialog = [System.Windows.Forms.OpenFileDialog]::new()\n                $openFileDialog.Title = \"${escape(title)}\"\n                $openFileDialog.Filter = \"${filter}\"\n                $openFileDialog.Multiselect = $false\n                $openFileDialog.ShowDialog() | Out-Null\n                $openFileDialog.FileName\n                `;\n        }\n    }\n    else if (mode === \"files\") {\n        const filter = type ? htmlAcceptToFileFilter(type) : \"\";\n        return dedent `\n            Add-Type -AssemblyName System.Windows.Forms\n            $openFileDialog = [System.Windows.Forms.OpenFileDialog]::new()\n            $openFileDialog.Title = \"${escape(title)}\"\n            $openFileDialog.Filter = \"${filter}\"\n            $openFileDialog.Multiselect = $true\n            $openFileDialog.ShowDialog() | Out-Null\n            $openFileDialog.FileNames -join \"\\n\"\n            `;\n    }\n    else {\n        return dedent `\n            Add-Type -AssemblyName System.Windows.Forms\n            $folderBrowserDialog = [System.Windows.Forms.FolderBrowserDialog]::new()\n            $folderBrowserDialog.Description = \"${escape(title)}\"\n            $folderBrowserDialog.ShowDialog() | Out-Null\n            $folderBrowserDialog.SelectedPath\n            `;\n    }\n}\nfunction refinePath(path) {\n    if (isWSL()) {\n        return \"/mnt/\"\n            + path.replace(/\\\\/g, \"/\").replace(/^([a-z]):/i, (_, $1) => $1.toLowerCase());\n    }\n    return path;\n}\nexport async function windowsPickFile(title = \"\", options = {}) {\n    const { code, stdout, stderr } = await powershell(createPowerShellScript(\"file\", title, options));\n    if (!code) {\n        const path = stdout.trim();\n        return path ? refinePath(path) : null;\n    }\n    else {\n        throw new Error(stderr);\n    }\n}\nexport async function windowsPickFiles(title = \"\", type = \"\") {\n    const { code, stdout, stderr } = await powershell(createPowerShellScript(\"files\", title, { type }));\n    if (!code) {\n        const output = stdout.trim();\n        return output ? lines(stdout.trim()).map(refinePath) : [];\n    }\n    else {\n        throw new Error(stderr);\n    }\n}\nexport async function windowsPickFolder(title = \"\") {\n    const { code, stdout, stderr } = await powershell(createPowerShellScript(\"folder\", title));\n    if (!code) {\n        const dir = stdout.trim();\n        return dir ? refinePath(dir) : null;\n    }\n    else {\n        throw new Error(stderr);\n    }\n}\n//# sourceMappingURL=windows.js.map","import { asyncTask } from \"../../async.ts\";\nimport { isWSL, which } from \"../../cli.ts\";\nimport { createProgressEvent } from \"../../event.ts\";\nimport { readDir, readFileAsFile, writeFile } from \"../../fs.ts\";\nimport { fixFileType } from \"../../fs/util.ts\";\nimport { as, pick } from \"../../object.ts\";\nimport { basename, join } from \"../../path.ts\";\nimport { platform } from \"../../runtime.ts\";\nimport progress from \"./progress.ts\";\nimport { linuxPickFile, linuxPickFiles, linuxPickFolder } from \"./file/linux.ts\";\nimport { macPickFile, macPickFiles, macPickFolder } from \"./file/mac.ts\";\nimport { windowsPickFile, windowsPickFiles, windowsPickFolder } from \"./file/windows.ts\";\nexport async function pickFile(options = {}) {\n    const _platform = platform();\n    if (_platform === \"darwin\") {\n        return await macPickFile(options.title, {\n            type: options.type,\n            forSave: options === null || options === void 0 ? void 0 : options.forSave,\n            defaultName: options === null || options === void 0 ? void 0 : options.defaultName,\n        });\n    }\n    else if (_platform === \"windows\" || isWSL()) {\n        return await windowsPickFile(options.title, {\n            type: options.type,\n            forSave: options === null || options === void 0 ? void 0 : options.forSave,\n            defaultName: options === null || options === void 0 ? void 0 : options.defaultName,\n        });\n    }\n    else if (_platform === \"linux\" || await which(\"zenity\")) {\n        return await linuxPickFile(options.title, {\n            type: options.type,\n            forSave: options === null || options === void 0 ? void 0 : options.forSave,\n            defaultName: options === null || options === void 0 ? void 0 : options.defaultName,\n        });\n    }\n    throw new Error(\"Unsupported platform\");\n}\nexport async function pickFiles(options = {}) {\n    const _platform = platform();\n    if (_platform === \"darwin\") {\n        return await macPickFiles(options.title, options.type);\n    }\n    else if (_platform === \"windows\" || isWSL()) {\n        return await windowsPickFiles(options.title, options.type);\n    }\n    else if (_platform === \"linux\" || await which(\"zenity\")) {\n        return await linuxPickFiles(options.title, options.type);\n    }\n    throw new Error(\"Unsupported platform\");\n}\nexport async function pickDirectory(options = {}) {\n    const _platform = platform();\n    if (_platform === \"darwin\") {\n        return await macPickFolder(options.title);\n    }\n    else if (_platform === \"windows\" || isWSL()) {\n        return await windowsPickFolder(options.title);\n    }\n    else if (_platform === \"linux\" || await which(\"zenity\")) {\n        return await linuxPickFolder(options.title);\n    }\n    throw new Error(\"Unsupported platform\");\n}\nexport async function openFile(options) {\n    let filename = await pickFile(options);\n    if (filename) {\n        return await readFileAsFile(filename);\n    }\n    else {\n        return null;\n    }\n}\nexport async function openFiles(options = {}) {\n    const filenames = await pickFiles(options);\n    return await Promise.all(filenames.map(path => readFileAsFile(path)));\n}\nexport async function openDirectory(options = {}) {\n    const dirname = await pickDirectory(options);\n    if (dirname) {\n        const files = [];\n        for await (const entry of readDir(dirname, { recursive: true })) {\n            if (entry.kind === \"file\") {\n                const path = join(dirname, entry.relativePath);\n                const file = await readFileAsFile(path);\n                Object.defineProperty(file, \"webkitRelativePath\", {\n                    configurable: true,\n                    enumerable: true,\n                    writable: false,\n                    value: entry.relativePath.replace(/\\\\/g, \"/\"),\n                });\n                files.push(fixFileType(file));\n            }\n        }\n        return files;\n    }\n    else {\n        return [];\n    }\n}\nexport async function saveFile(file, options = {}) {\n    var _a;\n    const { title } = options;\n    let filename;\n    if (typeof Blob === \"function\" && file instanceof Blob) {\n        filename = await pickFile({\n            title,\n            type: options.type || file.type,\n            forSave: true,\n            defaultName: options.name || ((_a = as(file, File)) === null || _a === void 0 ? void 0 : _a.name),\n        });\n    }\n    else {\n        filename = await pickFile({\n            title,\n            type: options.type,\n            forSave: true,\n            defaultName: options.name,\n        });\n    }\n    if (filename) {\n        await writeFile(filename, file, pick(options, [\"signal\"]));\n    }\n}\nexport async function downloadFile(url, options = {}) {\n    var _a;\n    const src = typeof url === \"object\" ? url.href : url;\n    const name = options.name || basename(src);\n    const dest = await pickFile({\n        title: options.title,\n        type: options.type,\n        forSave: true,\n        defaultName: name,\n    });\n    if (!dest) // user canceled\n        return;\n    const task = asyncTask();\n    let signal = (_a = options.signal) !== null && _a !== void 0 ? _a : null;\n    let result;\n    let updateProgress;\n    if (options.showProgress) {\n        const ctrl = new AbortController();\n        signal = ctrl.signal;\n        result = progress(\"Downloading...\", async (set) => {\n            updateProgress = set;\n            return await task;\n        }, () => {\n            ctrl.abort();\n            throw new Error(\"Download canceled\");\n        });\n    }\n    else {\n        result = task;\n    }\n    const res = await fetch(src, { signal });\n    if (!res.ok) {\n        throw new Error(`Failed to download: ${src}`);\n    }\n    const size = parseInt(res.headers.get(\"Content-Length\") || \"0\", 10);\n    let stream = res.body;\n    if (options.onProgress || options.showProgress) {\n        const { onProgress } = options;\n        let loaded = 0;\n        const transform = new TransformStream({\n            transform(chunk, controller) {\n                controller.enqueue(chunk);\n                loaded += chunk.byteLength;\n                if (onProgress) {\n                    try {\n                        onProgress === null || onProgress === void 0 ? void 0 : onProgress(createProgressEvent(\"progress\", {\n                            lengthComputable: !!size,\n                            loaded,\n                            total: size !== null && size !== void 0 ? size : 0,\n                        }));\n                    }\n                    catch (_a) {\n                        // ignore\n                    }\n                }\n                if (updateProgress && size) {\n                    updateProgress({\n                        percent: loaded / size,\n                    });\n                }\n            },\n        });\n        stream = stream.pipeThrough(transform);\n    }\n    writeFile(dest, stream, { signal: signal }).then(() => {\n        task.resolve();\n    }).catch(err => {\n        task.reject(err);\n    });\n    await result;\n}\n//# sourceMappingURL=file.js.map","import bytes, { concat, equals } from \"../../bytes.ts\";\nimport { chars } from \"../../string.ts\";\nimport { ControlKeys, ControlSequences, NavigationKeys, isTypingInput, moveLeftBy, moveRightBy, readStdin, writeStdout, } from \"../../cli.ts\";\nconst { BS, CTRL_A, CTRL_C, CTRL_E, CR, DEL, ESC, LF } = ControlKeys;\nconst { UP, DOWN, LEFT, RIGHT } = NavigationKeys;\nconst { CLR_RIGHT } = ControlSequences;\nfunction getMasks(mask, length) {\n    return new Array(length).fill(mask).join(\"\");\n}\nexport default async function question(message, options = {}) {\n    const { defaultValue = \"\", mask } = options;\n    const buf = [];\n    let cursor = 0;\n    await writeStdout(bytes(message));\n    if (defaultValue) {\n        const _chars = chars(defaultValue);\n        buf.push(..._chars);\n        cursor += _chars.length;\n        if (mask === undefined) {\n            await writeStdout(bytes(defaultValue));\n        }\n        else if (mask) {\n            await writeStdout(bytes(getMasks(mask, _chars.length)));\n        }\n    }\n    while (true) {\n        const input = await readStdin();\n        if (!input.length || equals(input, UP) || equals(input, DOWN)) {\n            continue;\n        }\n        else if (equals(input, LEFT)) {\n            if (cursor > 0) {\n                const char = buf[--cursor];\n                if (mask === undefined) {\n                    await moveLeftBy(char);\n                }\n                else if (mask) {\n                    await moveLeftBy(mask);\n                }\n            }\n        }\n        else if (equals(input, RIGHT)) {\n            if (cursor < buf.length) {\n                const char = buf[cursor++];\n                if (mask === undefined) {\n                    await moveRightBy(char);\n                }\n                else if (mask) {\n                    await moveRightBy(mask);\n                }\n            }\n        }\n        else if (equals(input, CTRL_A)) {\n            const left = buf.slice(0, cursor);\n            if (left.length) {\n                cursor = 0;\n                if (mask === undefined) {\n                    await moveLeftBy(left.join(\"\"));\n                }\n                else if (mask) {\n                    await moveLeftBy(getMasks(mask, left.length));\n                }\n            }\n        }\n        else if (equals(input, CTRL_E)) {\n            const right = buf.slice(cursor);\n            if (right.length) {\n                cursor = buf.length;\n                if (mask === undefined) {\n                    await moveRightBy(right.join(\"\"));\n                }\n                else if (mask) {\n                    await moveRightBy(getMasks(mask, right.length));\n                }\n            }\n        }\n        else if (equals(input, ESC) || equals(input, CTRL_C)) {\n            await writeStdout(LF);\n            return null;\n        }\n        else if (equals(input, CR) || equals(input, LF)) {\n            await writeStdout(LF);\n            return buf.join(\"\");\n        }\n        else if (equals(input, BS) || equals(input, DEL)) {\n            if (cursor > 0) {\n                cursor--;\n                const [char] = buf.splice(cursor, 1);\n                const rest = buf.slice(cursor);\n                if (mask === undefined) {\n                    await moveLeftBy(char);\n                    await writeStdout(CLR_RIGHT);\n                    if (rest.length) {\n                        const output = rest.join(\"\");\n                        await writeStdout(bytes(output));\n                        await moveLeftBy(output);\n                    }\n                }\n                else if (mask) {\n                    await moveLeftBy(mask);\n                    await writeStdout(CLR_RIGHT);\n                    if (rest.length) {\n                        const output = getMasks(mask, rest.length);\n                        await writeStdout(bytes(output));\n                        await moveLeftBy(output);\n                    }\n                }\n            }\n        }\n        else if (isTypingInput(input)) {\n            const _chars = chars(String(input));\n            if (cursor === buf.length) {\n                buf.push(..._chars);\n                cursor += _chars.length;\n                if (mask === undefined) {\n                    await writeStdout(input);\n                }\n                else if (mask) {\n                    await writeStdout(bytes(getMasks(mask, _chars.length)));\n                }\n            }\n            else {\n                buf.splice(cursor, 0, ..._chars);\n                cursor += _chars.length;\n                if (mask === undefined) {\n                    const rest = buf.slice(cursor).join(\"\");\n                    await writeStdout(concat(input, bytes(rest)));\n                    await moveLeftBy(rest);\n                }\n                else if (mask) {\n                    const output = getMasks(mask, _chars.length);\n                    const rest = getMasks(mask, buf.slice(cursor).length);\n                    await writeStdout(bytes(output + rest));\n                    await moveLeftBy(rest);\n                }\n            }\n        }\n    }\n}\n//# sourceMappingURL=question.js.map","import { escape } from \"./util.ts\";\nimport { dedent } from \"../../string.ts\";\nimport { platform } from \"../../runtime.ts\";\nimport { isWSL, lockStdin, powershell, run, which } from \"../../cli.ts\";\nimport question from \"./question.ts\";\nfunction createAppleScript(message) {\n    return dedent `\n        tell application (path to frontmost application as text)\n            display dialog \"${escape(message)}\" with title \"Alert\" buttons {\"OK\"} default button \"OK\"\n        end\n        `;\n}\nfunction createPowerShellScript(message) {\n    return dedent `\n        Add-Type -AssemblyName PresentationFramework\n        [System.Windows.MessageBox]::Show(\"${escape(message)}\", \"Alert\")\n        `;\n}\nexport default async function alert(message, options = {}) {\n    if ((options === null || options === void 0 ? void 0 : options.gui) && platform() === \"darwin\") {\n        const { code, stderr } = await run(\"osascript\", [\n            \"-e\",\n            createAppleScript(message)\n        ]);\n        if (code) {\n            throw new Error(stderr);\n        }\n    }\n    else if ((options === null || options === void 0 ? void 0 : options.gui) && (platform() === \"windows\" || isWSL())) {\n        const { code, stderr } = await powershell(createPowerShellScript(message));\n        if (code) {\n            throw new Error(stderr);\n        }\n    }\n    else if ((options === null || options === void 0 ? void 0 : options.gui) && (platform() === \"linux\" || await which(\"zenity\"))) {\n        const args = [\n            \"--info\",\n            \"--title\", \"Alert\",\n            \"--width\", \"365\",\n        ];\n        if (message) {\n            args.push(\"--text\", message);\n        }\n        const { code, stderr } = await run(\"zenity\", args);\n        if (code && code !== 1) {\n            throw new Error(stderr);\n        }\n    }\n    else {\n        await lockStdin(() => question(message + \" [Enter] \"));\n    }\n}\n//# sourceMappingURL=alert.js.map","import { escape } from \"./util.ts\";\nimport { dedent } from \"../../string.ts\";\nimport { platform } from \"../../runtime.ts\";\nimport { isWSL, lockStdin, powershell, run, which } from \"../../cli.ts\";\nimport question from \"./question.ts\";\nfunction createAppleScript(message) {\n    return dedent `\n        tell application (path to frontmost application as text)\n            display dialog \"${escape(message)}\" with title \"Confirm\"\\\n                buttons {\"Cancel\", \"OK\"} default button \"OK\"\n        end\n        `;\n}\nfunction createPowerShellScript(message) {\n    return dedent `\n        Add-Type -AssemblyName PresentationFramework\n        [System.Windows.MessageBox]::Show(\"${escape(message)}\", \"Confirm\", \"YesNo\")\n        `;\n}\nexport default async function confirm(message, options = {}) {\n    if ((options === null || options === void 0 ? void 0 : options.gui) && platform() === \"darwin\") {\n        const { code, stderr } = await run(\"osascript\", [\n            \"-e\",\n            createAppleScript(message)\n        ]);\n        if (code) {\n            if (stderr.includes(\"User canceled\")) {\n                return false;\n            }\n            else {\n                throw new Error(stderr);\n            }\n        }\n        else {\n            return true;\n        }\n    }\n    else if ((options === null || options === void 0 ? void 0 : options.gui) && (platform() === \"windows\" || isWSL())) {\n        const { code, stdout, stderr } = await powershell(createPowerShellScript(message));\n        if (code) {\n            throw new Error(stderr);\n        }\n        else {\n            return stdout.trim() === \"Yes\" ? true : false;\n        }\n    }\n    else if ((options === null || options === void 0 ? void 0 : options.gui) && (platform() === \"linux\" || await which(\"zenity\"))) {\n        const args = [\n            \"--question\",\n            \"--title\", \"Confirm\",\n            \"--width\", \"365\",\n        ];\n        if (message) {\n            args.push(\"--text\", message);\n        }\n        const { code, stderr } = await run(\"zenity\", args);\n        if (!code) {\n            return true;\n        }\n        else if (code === 1) {\n            return false;\n        }\n        else {\n            throw new Error(stderr);\n        }\n    }\n    else {\n        const answer = await lockStdin(() => question(message + \" [Y/n] \"));\n        const ok = answer === null || answer === void 0 ? void 0 : answer.toLowerCase().trim();\n        return ok === \"\" || ok === \"y\" || ok === \"yes\";\n    }\n}\n//# sourceMappingURL=confirm.js.map","import { escape } from \"./util.ts\";\nimport { dedent } from \"../../string.ts\";\nimport { platform } from \"../../runtime.ts\";\nimport { isWSL, lockStdin, powershell, run, which } from \"../../cli.ts\";\nimport question from \"./question.ts\";\nfunction createAppleScript(message, defaultValue = \"\", password = false) {\n    return dedent `\n        tell application (path to frontmost application as text)\n            set response to display dialog \"${escape(message)}\" with title \"Prompt\"\\\n                default answer \"${escape(defaultValue)}\"${password ? \" hidden answer true\" : \"\"}\n            return text returned of response\n        end\n        `;\n}\nfunction createPowerShellScript(message, defaultValue = \"\", password = false) {\n    return dedent `\n        Add-Type -AssemblyName System.Windows.Forms\n        $form = New-Object System.Windows.Forms.Form\n        $form.Text = 'Prompt'\n        $form.Size = New-Object System.Drawing.Size(450,175)\n        $form.StartPosition = 'CenterScreen'\n        $form.FormBorderStyle = 'FixedDialog'\n        $form.Font = New-Object System.Drawing.Font('Aria', 10)\n        $form.AutoScaleMode = 'Dpi'\n        $form.MaximizeBox = $false\n        $form.MinimizeBox = $false\n        \n        $label = New-Object System.Windows.Forms.Label\n        $label.Location = New-Object System.Drawing.Point(17,20)\n        $label.Size = New-Object System.Drawing.Size(400,30)\n        $label.Text = \"${escape(message)}\"\n        $form.Controls.Add($label)\n        \n        $textBox = New-Object System.Windows.Forms.TextBox\n        $textBox.Location = New-Object System.Drawing.Point(17,50)\n        $textBox.Size = New-Object System.Drawing.Size(400,30)\n        $textBox.UseSystemPasswordChar = ${password ? \"$true\" : \"$false\"}\n        $textBox.Text = \"${escape(defaultValue)}\"\n        $form.Controls.Add($textBox)\n        \n        $cancelButton = New-Object System.Windows.Forms.Button\n        $cancelButton.Location = New-Object System.Drawing.Point(232,90)\n        $cancelButton.Size = New-Object System.Drawing.Size(87,27)\n        $cancelButton.Text = 'Cancel'\n        $cancelButton.DialogResult = [System.Windows.Forms.DialogResult]::Cancel\n        $cancelButton.FlatStyle = 'System'\n        $form.Controls.Add($cancelButton)\n        \n        $okButton = New-Object System.Windows.Forms.Button\n        $okButton.Location = New-Object System.Drawing.Point(330,90)\n        $okButton.Size = New-Object System.Drawing.Size(87,27)\n        $okButton.Text = 'OK'\n        $okButton.DialogResult = [System.Windows.Forms.DialogResult]::OK\n        $okButton.FlatStyle = 'System'\n        $form.Controls.Add($okButton)\n        \n        $form.AcceptButton = $okButton\n        $form.CancelButton = $cancelButton\n        $form.Add_Shown({$textBox.Select()})\n        \n        $result = $form.ShowDialog()\n        \n        if ($result -eq [System.Windows.Forms.DialogResult]::OK)\n        {\n            $textBox.Text\n        }\n        elseif ($result -eq [System.Windows.Forms.DialogResult]::Cancel)\n        {\n            throw 'User canceled'\n        }\n        `;\n}\nexport default async function prompt(message, options = {}) {\n    if ((options === null || options === void 0 ? void 0 : options.gui) && platform() === \"darwin\") {\n        const { code, stdout, stderr } = await run(\"osascript\", [\n            \"-e\",\n            createAppleScript(message, options.defaultValue, options.type === \"password\")\n        ]);\n        if (code) {\n            if (stderr.includes(\"User canceled\")) {\n                return null;\n            }\n            else {\n                throw new Error(stderr);\n            }\n        }\n        else {\n            return stdout.trim();\n        }\n    }\n    else if ((options === null || options === void 0 ? void 0 : options.gui) && (platform() === \"windows\" || isWSL())) {\n        const { code, stdout, stderr } = await powershell(createPowerShellScript(message, options.defaultValue, options.type === \"password\"));\n        if (code) {\n            if (stderr.includes(\"User canceled\")) {\n                return null;\n            }\n            else {\n                throw new Error(stderr);\n            }\n        }\n        else {\n            return stdout.trim();\n        }\n    }\n    else if ((options === null || options === void 0 ? void 0 : options.gui) && (platform() === \"linux\" || await which(\"zenity\"))) {\n        const args = [\n            \"--entry\",\n            \"--title\", \"Prompt\",\n            \"--width\", \"450\",\n        ];\n        if (message) {\n            args.push(\"--text\", message);\n        }\n        if (options.defaultValue) {\n            args.push(\"--entry-text\", options.defaultValue);\n        }\n        if (options.type === \"password\") {\n            args.push(\"--hide-text\");\n        }\n        const { code, stdout, stderr } = await run(\"zenity\", args);\n        if (!code) {\n            return stdout.trim();\n        }\n        else if (code === 1) {\n            return null;\n        }\n        else {\n            throw new Error(stderr);\n        }\n    }\n    else {\n        return await lockStdin(() => question(message + \" \", options));\n    }\n}\n//# sourceMappingURL=prompt.js.map"],"names":["_a","equals","arr1","arr2","length","i","includeSlice","arr","slice","limit","subLimit","j","startsWith","prefix","preLimit","endsWith","suffix","sufLimit","offset","split","delimiter","chunks","push","ctor","constructor","from","chunk","size","Math","ceil","Array","idx","globalThis","Event","type","eventInitDict","this","bubbles","cancelable","cancelBubble","composed","currentTarget","defaultPrevented","eventPhase","NONE","isTrusted","returnValue","target","timeStamp","Date","now","srcElement","AT_TARGET","BUBBLING_PHASE","CAPTURING_PHASE","undefined","composedPath","preventDefault","stopImmediatePropagation","stopPropagation","initEvent","EventTarget","listeners","addEventListener","callback","options","_b","once","removeEventListener","stack","l","splice","dispatchEvent","event","Object","defineProperties","configurable","value","listener","call","err","setTimeout","encoder","TextEncoder","asUint8Array","data","bytes","encode","Uint8Array","ArrayBuffer","isView","buffer","byteOffset","byteLength","encodeHex","Buffer","toString","reduce","str","byte","padStart","decodeHex","hex","parseInt","base64Chars","encodeBase64","result","decodeBase64","base64","buf","binString","atob","charCodeAt","sum","values","avg","product","_round","round","precision","factor","defaultEncoder","defaultDecoder","TextDecoder","ByteArray","text","toJSON","encoding","_data","decode","copy","src","dest","subarray","set","concat","arrays","map","is","alloc","compare","ele1","ele2","_equals","len","compressible","floor","_arr1","Uint32Array","_arr2","includesSlice","_includesSlice","indexOfSlice","start","max","s","_startsWith","_endsWith","_split","_chunk","EMOJI_CHAR","RegExp","_chars","chars","str1","str2","random","count","sub","capitalize","all","regex","replace","match","toUpperCase","toLowerCase","hyphenate","_","$1","$2","Intl","Segmenter","segment","x","words","matches","flat","lines","truncate","position","left","right","_trim","String","prototype","trim","_trimEnd","trimEnd","_trimStart","trimStart","indexOf","substring","stripEnd","stripStart","dedent","isArray","acc","cur","oldLines","newLines","indent","line","join","_bytes","isAscii","printableOnly","test","isEmoji","every","char","isFloat","Number","isNaN","isFinite","isNumeric","strict","BigInt","isBetween","min","range","step","sequence","serial","loop","MAX_SAFE_INTEGER","id","_dedent","_count","_capitalize","_hyphenate","_words","_lines","_truncate","_stripEnd","_stripStart","_byteLength","_isAscii","_isEmoji","isClass","Boolean","Symbol","includes","name0","name","isSubclassOf","ctor1","ctor2","first","last","remove","rand","item","unique","Set","uniqueBy","fn","Map","key","has","shuffle","orderBy","order","items","sort","a","b","reverse","groupBy","groups","list","get","keyBy","record","partition","predicate","rest","hasOwn","obj","hasOwnProperty","hasOwnMethod","method","_c","proto","getPrototypeOf","getOwnPropertyDescriptor","patch","sources","source","Reflect","ownKeys","pick","keys","omit","keptKeys","filter","Error","forEach","as","TypeError","_type","primitiveMap","string","number","bigint","boolean","symbol","valueOf","typeOf","_d","isValid","NaN","isPlainObject","doCompare","description","_first","_last","_random","ele","another","_unique","_uniqueBy","_shuffle","toShuffled","toReversed","toSorted","_orderBy","_groupBy","_keyBy","_partition","CompareTwoTypes","ComparNonComparable","CompareNaN","localeCompare","compareTo","aKeys","bKeys","k","getPrototypeBy","prop","isEqual","parents","_parents","bytesEquals","aSource","flags","aFlags","lastIndex","aLastIndex","bSource","bFlags","bLastIndex","aName","message","aMessage","aStack","cause","aCause","errors","aErrors","aRest","bName","bMessage","bStack","bCause","bErrors","bRest","URL","href","URLSearchParams","Headers","aSetCookies","getSetCookie","bSetCookies","some","v","aEntries","bEntries","FormData","Storage","sanitize","deep","removeNulls","removeEmptyStrings","removeEmptyObjects","removeArrayItems","process","depth","create","sortKeys","getOwnPropertyNames","getOwnPropertySymbols","flatKeys","maxDepth","carrier","flatArrayIndices","path","filterEntries","fromEntries","entries","mapEntries","transformer","partitionEntries","invert","for","isBrowserWindow","window","document","matchMedia","isServiceWorker","ServiceWorkerGlobalScope","isSharedWorker","SharedWorkerGlobalScope","isDedicatedWorker","DedicatedWorkerGlobalScope","isDeno","Deno","version","deno","isBun","Bun","isNodeLike","versions","node","isNode","isNodeBelow14","isMainThread","abort","disabled","argv","WorkerGlobalScope","createErrorEvent","_e","_f","_g","_h","ErrorEvent","filename","lineno","colno","error","createCloseEvent","CloseEvent","code","reason","wasClean","createProgressEvent","ProgressEvent","lengthComputable","loaded","total","createCustomEvent","CustomEvent","detail","parseUserAgent","ua","runtime","platform","mobile","raw","matchAll","extra","identity","osInfo","find","safari","chrome","firefox","opera","edge","duckDuckGo","weChat","dingTalk","bun","index","findIndex","next","fsSupport","tsSupport","worker","execArgv","arg","FileSystemHandle","navigator","userAgent","WorkerLocation","location","WellknownPlatforms","build","os","ENV","env","val","toObject","unrefTimer","timer","unref","shutdownListeners","rejectionListeners","customInspect","addShutdownListener","shutdownListener","async","exit","console","addSignalListener","on","addUnhandledRejectionListener","_runtime","fireEvent","promise","isREPL","$0","refTimer","ref","Exception","super","defineProperty","enumerable","writable","asyncTask","resolve","reject","Promise","res","rej","assign","abortable","task","signal","asyncIterator","then","abortableAsyncIterable","aborted","aTask","handleAbort","it","race","catch","done","select","createTimeoutError","ms","DOMException","timeout","after","allSettled","status","sleep","until","ongoing","setInterval","clearInterval","tasks","controllers","ctrl","AbortController","abortWith","_parent","parent","AbortSignal","clearTimeout","inverse","BiMap","toStringTag","iterable","getKey","hasValue","deleteValue","delete","clear","CiMap","callbackfn","thisArg","iterator","fromObject","isAggregateError","toErrorEvent","callSite","lastIndexOf","end","fromErrorEvent","shouldPatchStack","isDOMException","AggregateError","typeRegistry","parseAs","JSON","parse","fromJSON","date","typeRecords","ins","_value","Pipeline","pipe","args","Int8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array","SharedArrayBuffer","Blob","AsyncFunction","GeneratorFunction","AsyncGeneratorFunction","TypedArray","isIteratorLike","isGenerator","isIterableIterator","hasGeneratorSpecials","isAsyncGenerator","isAsyncIterableIterator","return","throw","Thenable","_source","onfulfilled","onrejected","processIterator","fulfilled","e","rejected","ThenableGenerator","ThenableAsyncGenerator","ThenableGeneratorFunction","anonymous","apply","__proto__","_try","returns","input","wrap","wrapper","wrapped","bind","mergeIfNotExists","mergeSuper","props","setProp","mergeHierarchy","mixin","_super","desc","setPrototypeOf","Function","Cache","registry","dispose","idGenerator","Channel","capacity","producers","consumers","state","RangeError","send","consume","shift","recv","produce","close","channel","bufSize","queueSize","chan","Queue","handler","bufferSize","errorHandler","onError","_queue","_mutex","_unlocked","Mutex","lock","Lock","_a$6","mutex","ReferenceError","unlock","queue","isNotQuery","isVolume","isWindowsPath","isPosixPath","isFsPath","isUrl","isFileUrl","protocol","isAbsolute","host","pathname","search","hash","origin","segments","decodeURI","volume","_path","query","stripFileProtocol","extractSegmentsForComparison","caseInsensitive","ignoreFileProtocol","paths","subs","path1","path2","sep","cwd","_paths","_segment","p","pop","_sep","_cwd","dirname","_dirname","basename","_basename","extname","base","toFileUrl","toFsPath","url","fileUrlToFsPath","contains","normalize","UTIMap","getUTI","uti","getMIME","mime","getExtensions","types","t","ensureFsTarget","wrapFsError","errName","getErrorName","errCode","rawOp","op","fixDirEntry","entry","relativePath","fixFileType","file","ext","makeTree","dir","addPathProp","nodes","walk","store","kind","childEntries","directChildren","indirectChildren","_entry","children","rootName","rooEntry","handle","resolveHomeDir","import","homedir","isFunction","resolveByteStream","reader","ReadableStream","getReader","mode","pull","controller","request","view","byobRequest","ReadableStreamBYOBReader","read","respondWithNewView","respond","enqueue","releaseLock","cancel","asAsyncIterable","resolveAsyncIterable","toAsyncIterable","eventMap","Infinity","handleMessage","handleClose","handleBrowserErrorEvent","ev","msgDesc","errDesc","closeDesc","cleanup","es","eventName","msgListener","_close","ws","onmessage","onerror","onclose","msgEvent","errEvent","closeEvent","MessageEvent","closeListener","dataEvent","off","toReadableStream","resolveReadableStream","readable","TransformStream","stream","pipeTo","readAsArray","readAsArrayBuffer","arrayBuffer","concatBytes","readAsObjectURL","createObjectURL","blob","readAsText","streams","current","iterables","readAsBlob","readAsDataURL","readAsJSON","getDirHandle","recursive","root","storage","getDirectory","getDirectoryHandle","getFileHandle","dirPath","stat","info","getFile","mtime","lastModified","atime","birthtime","uid","gid","isBlockDevice","isCharDevice","isFIFO","isSocket","mkdir","exists","readDir","readDirHandle","copyInBrowser","copyFileHandleToFileHandle","copyFileHandleToDirHandle","copyDirHandleToDirHandle","oldParent","oldName","oldDir","oldErr","oldFile","newParent","newName","newDir","newErr","newFile","move","removeEntry","srcFile","destFile","createWritable","writer","newSubDir","createFileHandleWritableStream","keepExistingData","append","seek","EOL","_j","_k","_l","_m","_o","_p","_q","_r","_s","_t","webStat","followSymlink","lstat","isDirectory","isSymlink","isFifo","fs","isSymbolicLink","isCharacterDevice","webMakeDir","ensureDir","webReadDir","readdir","withFileTypes","readFile","webReadFile","readFileAsText","readFileAsFile","webReadFileAsFile","File","writeFile","write","webWriteFile","writeTextFile","createNodeWritableStream","flag","chmod","utimes","utime","createReadableStream","webCreateReadableStream","open","createReadStream","destroy","createWritableStream","webCreateWritableStream","WritableStream","createWriteStream","chown","webCopy","isDirSrc","isDirDest","_oldPath","_newPath","copyFile","link","symbolic","_stat","symlink","readLink","readlink","readTree","tree","webRemove","rm","rmdir","unlink","rename","oldPath","newPath","webRename","webTruncate","writeLines","lineEndings","eol","crlf","content","urlCache","getObjectURL","mimeType","cache","fetch","ok","headers","interop","module","mod","moduleKeys","defaultKeys","isMain","importMeta","urlExt","importCache","wasmCache","importScript","_url","script","createElement","setAttribute","onload","head","appendChild","importStylesheet","rel","importWasm","imports","WebAssembly","Module","instantiate","exports","instantiateStreaming","instance","webImportWasm","Response","moduleCache","sanitizeModuleId","_id","channelStore","isChannelMessage","msg","channelId","handleChannelMessage","writers","wrapChannel","channelWrite","wireChannel","counter","workerIdCounter","gcTimer","workerPool","remoteTasks","getMaxParallelism","hardwareConcurrency","availableParallelism","cpus","isCallResponse","getModuleDir","importMetaPath","path.extname","path.resolve","path.dirname","path.endsWith","createWorker","adapter","parallel","getWorkerEntry","workerEntry","require","pathToFileURL","__filename","_documentCurrentScript","tagName","baseURI","path.join","_filename","path.toFsPath","path.cwd","path.isUrl","fork","stdio","serialization","workerId","pid","Worker","threadId","handleWorkerMessage","poolRecord","taskId","unwrapReturnValue","generate","handleWorkerClose","acquireWorker","maxWorkers","lastAccess","getWorker","_worker","terminate","idealItems","ideal","add","wrapArgs","transferable","postMessage","taskIdCounter","safeRemoteCall","req","createLocalCall","getReturns","resolveModule","modId","baseUrl","gen","extractBaseUrl","stackTrace","captureStackTrace","trace","Proxy","createRemoteCall","_args","finally","parallel$1","workerPools","workerConsumerQueue","run","busy","kill","release","keepAlive","terminated","remainItems","removeAllListeners","handleErrorEvent","handleCloseEvent","iterate","run$2","warnedRecord","emitWarning","forFn","tip","lineNum","warning","warn","jsext","try","func","callbacks","defer","cb","mixins","throttle","duration","noWait","handleCall","pending","expires","debounce","reducer","delay","hasKey","_cache","getResolvers","_tasks","deprecate","lineOffset","workerd","fastly","unknown","_stream","_bodyUsed","FileTypes","HEADER_LENGTH","USTarFileHeaderFieldLengths","checksum","typeflag","linkname","magic","uname","gname","devmajor","devminor","padding","initialChecksum","FilenameTooLongError","toFixedOctal","num","trimBytes","parseHeader","header","decoder","field","getChecksum","createEntry","headerInfo","owner","group","_entries","Tarball","constructEntry","body","getTime","c","formatHeader","webkitRelativePath","retrieve","copy1","copy2","tee","oldEntry","newEntry","iter","treeView","paddingSize","bodyUsed","concatStreams","gzip","CompressionStream","pipeThrough","load","DecompressionStream","tarball","lastChunk","writtenBytes","outer","_header","fileSize","leftBytes","ControlKeys","NavigationKeys","FunctionKeys","ControlSequences","tar","_dest","FileSystemFileHandle","baseDir","output","untar","FileSystemDirectoryHandle","totalWrittenBytes","totalBytes","onProgress","_options","getWriter","isWindows","restoreStats","TAB","LF","CR","BS","DEL","ESC","CTRL_C","CTRL_A","CTRL_E","UP","DOWN","LEFT","RIGHT","HOME","END","PAGE_UP","PAGE_DOWN","INSERT","DELETE","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","CLR","CLR_RIGHT","CLR_LEFT","CLR_DOWN","CLR_UP","CLR_SCREEN","HIDE_CURSOR","SHOW_CURSOR","MOUSE_ON","MOUSE_OFF","MOUSE_WHEEL_ON","MOUSE_WHEEL_OFF","PASTE_ON","PASTE_OFF","WRAP_ON","WRAP_OFF","ALT_BUFFER_ON","ALT_BUFFER_OFF","PowerShellCommands","isFullWidth","isWide","NonTypingKeys","isTTY","stdin","isTerminal","charWidth","codePointAt","stringWidth","stdinMutex","lockStdin","setRaw","isPaused","resume","setRawMode","addListener","pause","readStdin","removeListener","writeStdout","stdout","writeStdoutSync","writeSync","moveLeftBy","moveRightBy","isTypingInput","getWindowSize","width","columns","height","rows","innerWidth","innerHeight","consoleSize","isWSL","osRelease","parseValue","parseKeyValue","noCoercion","parseArgs","alias","lists","_key","quote","cmd","isWslPs","spawn","child","stderr","powershell","command","which","edit","_platform","vscode","notepad","editor","sudo","gui","exec","title","_stdout","alert","default","alert$1","confirm","confirm$1","downloadFile","openDirectory","openFile","openFiles","pickDirectory","pickFile","pickFiles","progress","onAbort","progress$1","prompt","defaultValue","mask","prompt$1","saveFile","toBytes","toBytesAsync","CRC32_TABLE","table","crc","sha1","crypto","subtle","digest","sha256","sha512","hmac","algorithm","keyBuffer","importKey","dataBytes","sign","nodeHash","createHash","update","_sha256","adler32","previous","bin","crc32","_hmac","binary","createHmac","md5","_sha1","_sha512","setReadonly","getReadonly","fixStringTag","lastEventId","ports","initMessageEvent","SSEMarkClosed","_closed","_request","_response","_writer","_lastEventId","_reconnectionTime","_retry","_timer","_controller","_onopen","_onerror","_onmessage","EventEndpoint","isNodeRequest","reconnectionTime","resInit","closed","statusText","Connection","_this","setHeader","writeHead","_readable","response","sendEvent","buildMessage","eventId","noReconnect","readAndProcessResponse","handlers","onEnd","isMessage","onId","time","onRetry","onData","EventSource","withCredentials","readyState","CONNECTING","onopen","OPEN","CLOSED","connect","Accept","Request","credentials","tryReconnect","_event","pow","inspect","colors","EventConsumer","locked","retry","constructNetAddress","addr","family","hostname","_hostname","_port","_http","HttpServer","impl","secure","defaultOnListen","port","log","onListen","http","getTimers","timeEnd","createTimingFunctions","ctx","createRequestContext","remoteAddress","remoteAddr","_handle","withHeaders","_onError","patchTimingMetrics","server","bunBind","requestIP","address","websocket","bunListener","bindings","listenFetchEvent","_ctx","waitUntil","ready","force","stop","_server","pendingRequests","pendingWebSockets","shutdown","finished","closeAllConnections","sanitizeTimers","timers","_timers","metrics","timeStart","createEventEndpoint","events","upgradeWebSocket","upgrade","serverName","Server","client","respondWith","withWeb","nReq","nRes","socket","remotePort","toWebRequest","init","referrer","duplex","errored","headersSent","toNodeResponse","nodeRes","isCompressible","re","removeHeader","etag","httpVersion","_a$3","parseCookie","nameValue","params","part","cookie","param","domain","maxAge","httpOnly","sameSite","partitioned","stringifyCookie","toUTCString","parseCookies","cookies","stringifyCookies","getCookies","parseAccepts","weight","parseFloat","parseRange","unit","ranges","parsed","ifMatch","ifNoneMatch","tag","parseBasicAuth","parts","scheme","username","password","HTTP_METHODS","parseMessage","headerEnd","headerLines","SyntaxError","lineBreak","bodyBytes","lineEnd","isInteger","chunkStart","chunkEnd","_ws","WebSocketConnection","handleError","WebSocket","initWebSocketStream","wss","binaryType","extensions","closeCode","WebSocketStream","opened","protocols","_errored","_handler","_clients","_httpServer","_wsServer","_connTasks","WebSocketServer","idleTimeout","perMessageDeflate","upgradeHeader","clients","Upgrade","WsServer","noServer","wsServer","handleUpgrade","isBinary","connTasks","toWebSocketStream","toISOString","randomPort","prefer","listen","createServer","isOpen","conn","exclusive","serve","cert","tls","reqListener","createSecureServer","allowHTTP1","serveStatic","extraHeaders","fsDir","urlPrefix","decodeURIComponent","listDir","renderDirectoryPage","unshift","listHtml","redirect","rangeValue","_etag","Etag","ifModifiedSinceValue","ifNoneMatchValue","ifMatchValue","modified","suffixLength","startServer","config","cluster","isPrimary","workers","fill","forkWorker","HTTP_PORT","w","isWorker","r","getCookie","parseContentType","charset","boundary","parseRequest","_body","parseResponse","_status","statusTexts","setCookie","setFilename","disposition","encodeURIComponent","stringifyRequest","stringifyResponse","suggestResponseType","accepts","accept","acceptAll","contentType","fetchDest","destination","xhr","verifyBasicAuth","verify","auth","Result","unwrap","optional","_ins","_prop","Ok","Err","bundle","archive","array","_async","object.omit","bytes.default","class","_class","cli","collections","dialog","filetype","hash.default","json","math","object","runtime.default","sse","useColorTheme","theme","onChange","i18n","locale","lang","language","CloseEventListeners","WeakMap","lightBgColor","darkBgColor","lightTextColor","darkTextColor","Dialog","onCancel","onOk","hasInput","querySelector","style","fontFamily","color","fontSize","boxSizing","border","borderRadius","backgroundColor","outline","inert","removeChild","closeDialog","requestAnimationFrame","showModal","show","focus","lightHoverBgColor","darkHoverBgColor","ar","be","bg","bn","bs","cs","da","de","el","en","et","eu","fa","fi","fr","hi","hu","hy","iw","ja","ko","lb","lo","lv","lt","mk","ml","mi","mn","my","ne","nl","no","pl","pt","ro","ru","sa","sk","sl","so","sq","sv","th","tl","tr","ug","uk","vi","zh","CancelButton","button","textContent","minWidth","userSelect","fontWeight","closest","Footer","block","display","justifyContent","alignItems","gap","OkButton","borderStyle","lightColor","darkColor","Text","innerHTML","margin","overflowX","htmlAcceptToFileFilters","forSave","suggestedName","defaultName","multiple","onchange","files","oncancel","showPicker","click","handles","webkitdirectory","download","fallback","listenForAbort","element","progressBar","setValue","Progress","div","span","job","percent","Input","autofocus","ongoingIndicators","handleTerminalProgress","lastPercent","lastMessage","lastPosition","renderSimpleBar","ongoingIndicator","waitingTimer","nodeReader","denoReader","percentage","barWidth","filled","empty","renderPercentageBar","patterns","escape","htmlAcceptToAppleType","createAppleScript","htmlAcceptToFileFilter","createPowerShellScript","refinePath","macPickFile","windowsPickFile","linuxPickFile","macPickFiles","windowsPickFiles","linuxPickFiles","macPickFolder","windowsPickFolder","linuxPickFolder","updateProgress","showProgress","transform","filenames","getMasks","question","cursor","answer"],"mappings":"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BkmC,EAAiB+C,UAAYjpC,MAAM,QAEnCkmC,EAAiBgD,SAAWlpC,MAAM,QAElCkmC,EAAiBiD,SAAWnpC,MAAM,QAElCkmC,EAAiBkD,OAASppC,MAAM,QAEhCkmC,EAAiBmD,WAAarpC,MAAM,QAEpCkmC,EAAiBoD,YAActpC,MAAM,UAErCkmC,EAAiBqD,YAAcvpC,MAAM,UAErCkmC,EAAiBsD,SAAWxpC,MAAM,YAElCkmC,EAAiBuD,UAAYzpC,MAAM,YAEnCkmC,EAAiBwD,eAAiB1pC,MAAM,YAExCkmC,EAAiByD,gBAAkB3pC,MAAM,YAEzCkmC,EAAiB0D,SAAW5pC,MAAM,YAElCkmC,EAAiB2D,UAAY7pC,MAAM,YAEnCkmC,EAAiB4D,QAAU9pC,MAAM,SAEjCkmC,EAAiB6D,SAAW/pC,MAAM,SAElCkmC,EAAiB8D,cAAgBhqC,MAAM,YAEvCkmC,EAAiB+D,eAAiBjqC,MAAM,WAC3C,CArCD,CAqCGkmC,KAAqBA,GAAmB,CAAE,IACtC,MAAMgE,GAAqB,CAC9B,KACA,OACA,MACA,KACA,QACA,MACA,QACA,OACA,MACA,MACA,MACA,MACA,OACA,UACA,OACA,KACA,MACA,MACA,OACA,OACA,MACA,MACA,OACA,MACA,OACA,MACA,OACA,OACA,QACA,OACA,QACA,OACA,OACA,KACA,KACA,UACA,KACA,KACA,MACA,MACA,KACA,MACA,MACA,MACA,MACA,MACA,KACA,MACA,KACA,KACA,MACA,KACA,MACA,QACA,MACA,OACA,MACA,KACA,KACA,OACA,IACA,UACA,MACA,MACA,MACA,KACA,OACA,QACA,OACA,OACA,MACA,MACA,OACA,MACA,OACA,KACA,KACA,MAAO,OACP,KAAM,QACN,UACA,KACA,QACA,OACA,KACA,KACA,MACA,MACA,KACA,MACA,QACA,MACA,KACA,MACA,KACA,OACA,KACA,QACA,MACA,IACA,MACA,OACA,OACA,KACA,MACA,MACA,KACA,MACA,KACA,QACA,MACA,MACA,MACA,KACA,MACA,OACA,OACA,KACA,OACA,OACA,OACA,MACA,OACA,OACA,MACA,KACA,SACA,MACA,OACA,MG1NSC,YAAelkC,GACX,QAANA,GAAgBA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,MAEhEmkC,OAAUnkC,GACZA,GAAK,MAAUA,GAAK,MAAgB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAgBA,GAAK,MAAUA,GAAK,MAAgB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAgBA,GAAK,MAAUA,GAAK,MAAgB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,OAANA,GAAsB,QAANA,GAAsB,QAANA,GAAsB,QAANA,GAAgBA,GAAK,OAAUA,GAAK,OAAgB,QAANA,GAAgBA,GAAK,OAAUA,GAAK,OAAgB,QAANA,GAAsB,QAANA,GAAsB,QAANA,GAAsB,QAANA,GAAsB,QAANA,GAAsB,QAANA,GAAgBA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAUA,GAAK,OAAWA,GAAK,OAAiB,QAANA,GAAuB,QAANA,GAAiBA,GAAK,OAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAiB,SAANA,GAAuB,SAANA,GAAiBA,GAAK,QAAWA,GAAK,QAAiB,SAANA,GAAiBA,GAAK,QAAWA,GAAK,QAAiB,SAANA,GAAiBA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAiB,SAANA,GAAuB,SAANA,GAAuB,SAANA,GAAiBA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAiB,SAANA,GAAuB,SAANA,GAAiBA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAiB,SAANA,GAAiBA,GAAK,QAAWA,GAAK,QAAiB,SAANA,GAAiBA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAiB,SAANA,GAAuB,SAANA,GAAuB,SAANA,GAAuB,SAANA,GAAiBA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAiB,SAANA,GAAiBA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAiB,SAANA,GAAuB,SAANA,GAAiBA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAiB,SAANA,GAAiBA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAAK,QAAWA,GAA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"}