!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["@ayonli/jsext"]=t()}(this,(function(){"use strict";var e="undefined"!=typeof document?document.currentScript:null;function t(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function r(e,t){const r=[],n=e.length;let o=0;for(let i=0;i<n;i++)e[i]===t&&(r.push(e.slice(o,i)),o=i+1);if(o<n)r.push(e.slice(o,n));else if(o===n){const t=e.constructor;"function"==typeof t.from?r.push(t.from([])):r.push(new t([]))}return r}function n(e,t){const r=e.length,n=Math.ceil(r/t),o=new Array(n);let i=0,s=0;for(;i<r;)o[s]=e.slice(i,i+t),i+=t,s++;return o}const o=new TextEncoder;function*i(e,t,r=1,n=!1){let o=e;for(;;)if(yield o,o>=t){if(!n)break;o=e}else o+=r}function s(e,r){return e instanceof Uint8Array&&r instanceof Uint8Array&&t(e,r)}function l(e,t){return r(e,t)}function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function u(e,t){return t.reduce(((t,r)=>(r in e&&void 0!==e[r]&&(t[r]=e[r]),t)),{})}function c(e,t){const r=Reflect.ownKeys(e).filter((e=>!t.includes(e))),n=u(e,r);return e instanceof Error&&["name","message","cause"].forEach((r=>{t.includes(r)||void 0===e[r]||a(n,r)||(n[r]=e[r])})),n}String.compare=function(e,t){return e<t?-1:e>t?1:0},String.random=function(e){const t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";let r="";for(;0<e--;){r+=t[Math.floor(62*Math.random())]}return r},String.prototype.count=function(e){return function(e,t){return t?e?e.split(t).length-1:0:e.length+1}(String(this),e)},String.prototype.capitalize=function(e){return function(e,t){const r=t?/\w+/g:/\w+/;return e.replace(r,(e=>e[0].toUpperCase()+e.slice(1).toLowerCase()))}(String(this),e)},String.prototype.hyphenate=function(){return String(this).replace(/(\S)\s+(\S)/g,((e,t,r)=>t+"-"+r))},String.prototype.words=function(){return function(e){const t=e.match(/\w+/g);return t?[...t]:[]}(String(this))},String.prototype.chunk=function(e){return function(e,t){return n(e,t)}(String(this),e)},String.prototype.truncate=function(e){return function(e,t){return t<=0?"":t>=e.length?e:(t-=3,e.slice(0,t)+"...")}(String(this),e)},String.prototype.byteLength=function(){return e=String(this),o.encode(e).byteLength;var e},Number.isFloat=function(e){return!("number"!=typeof e||Number.isNaN(e)||Number.isFinite(e)&&e%1==0)},Number.isNumeric=function(e){const t=typeof e;if("number"===t||"bigint"===t)return!0;if("string"===t){if(!Number.isNaN(e))return!0;try{return BigInt(e),!0}catch(e){return!1}}return!1},Number.isBetween=function(e,[t,r]){return e>=t&&e<=r},Number.random=function(e,t){return e+Math.floor(Math.random()*(t-e+1))},Number.sequence=i,Array.prototype.first=function(){return this[0]},Array.prototype.last=function(){return this[this.length-1]},Array.prototype.count=function(e){return function(e,t){let r=0;for(let n=0;n<e.length;n++)e[n]===t&&r++;return r}(this,e)},Array.prototype.equals=function(e){return t(this,e)},Array.prototype.split=function(e){return r(this,e)},Array.prototype.chunk=function(e){return n(this,e)},Array.prototype.uniq=function(){return[...new Set(this)]},Array.prototype.shuffle=function(){return function(e){for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e}(this)},Array.prototype.toShuffled=function(){return this.slice().shuffle()},Array.prototype.toReversed||(Array.prototype.toReversed=function(){return this.slice().reverse()}),Array.prototype.toSorted||(Array.prototype.toSorted=function(e){return this.slice().sort(e)}),Array.prototype.orderBy=function(e,t="asc"){return function(e,t,r="asc"){const n=e.slice();return n.sort(((e,r)=>{if("object"!=typeof e||"object"!=typeof r||!e||!r||Array.isArray(e)||Array.isArray(r))return-1;const n=e[t],o=r[t];return void 0===n||void 0===o?-1:"number"==typeof n&&"number"==typeof o?n-o:"string"==typeof n&&"string"==typeof o||"bigint"==typeof n&&"bigint"==typeof o?n<o?-1:1:-1})),"desc"===r&&n.reverse(),n}(this,e,t)},Array.prototype.groupBy=function(e,t=Object){return function(e,t,r=Object){if(r===Map){const r=new Map;for(let n=0;n<e.length;n++){const o=e[n],i=t(o,n),s=r.get(i);s?s.push(o):r.set(i,[o])}return r}{const r={};for(let n=0;n<e.length;n++){const o=e[n],i=t(o,n),s=r[i];s?s.push(o):r[i]=[o]}return r}}(this,e,t)},Uint8Array.compare=function(e,t){if(e===t)return 0;for(let r=0;r<e.length;r++){const n=e[r],o=t[r];if(void 0===o)return 1;if(n<o)return-1;if(n>o)return 1}return e.length<t.length?-1:0},Uint8Array.prototype.equals=function(e){return s(this,e)},Uint8Array.prototype.split=function(e){return l(this,e)},Uint8Array.prototype.chunk=function(e){return function(e,t){return n(e,t)}(this,e)},Object.hasOwn||(Object.hasOwn=a),Object.hasOwnMethod||(Object.hasOwnMethod=function(e,t){var r;const n=Object.getPrototypeOf(e);return!(!n||!a(n,t))&&"function"==typeof(null===(r=Object.getOwnPropertyDescriptor(n,t))||void 0===r?void 0:r.value)}),Object.patch=function(e,...t){for(const r of t)for(const t of Reflect.ownKeys(r))a(e,t)&&void 0!==e[t]||(e[t]=r[t]);return e},Object.pick=u,Object.omit=c,Object.as=function(e,t){if("function"!=typeof t)throw new TypeError("type must be a valid constructor");let r;const n={string:String,number:Number,bigint:BigInt,boolean:Boolean,symbol:Symbol};return e instanceof t?[String,Number,Boolean].includes(t)?e.valueOf():e:(r=typeof e)&&n[r]===t?e:null},Object.isValid=function(e){return!(null==e||Object.is(e,NaN)||e instanceof Date&&"Invalid Date"===e.toString())},Math.sum=function(...e){return e.reduce(((e,t)=>e+t),0)},Math.avg=function(...e){return Math.sum(...e)/e.length},Math.product=function(...e){var t;return e.slice(1).reduce(((e,t)=>e*t),null!==(t=e[0])&&void 0!==t?t:0)},Promise.timeout=async function(e,t){return await Promise.race([e,new Promise(((e,r)=>setTimeout((()=>{r(new Error(`operation timeout after ${t}ms`))}),t)))])},Promise.after=async function(e,t){const[r]=await Promise.allSettled([e,new Promise((e=>setTimeout(e,t)))]);if("fulfilled"===r.status)return r.value;throw r.reason},Promise.sleep=async function(e){return new Promise((t=>setTimeout(t,e)))},Promise.until=async function(e){void 0===globalThis.setImmediate&&(globalThis.setImmediate=e=>setTimeout(e,0));do{await new Promise(globalThis.setImmediate)}while(0==await e())};const f=Symbol("inverse");class d extends Map{get[Symbol.toStringTag](){return"BiMap"}constructor(e=null){if(super(),this[f]=new Map,e)for(const[t,r]of e)this.set(t,r)}set(e,t){return super.set(e,t),this[f].set(t,e),this}getKey(e){return this[f].get(e)}hasValue(e){return this[f].has(e)}deleteValue(e){if(this[f].has(e)){const t=this[f].get(e);return super.delete(t),this[f].delete(e),!0}return!1}clear(){super.clear(),this[f].clear()}}const p=Symbol("internal");class h{get[Symbol.toStringTag](){return"CiMap"}get size(){return this[p].size}constructor(e=null){if(this[p]=new Map,e)for(const[t,r]of e)this.set(t,r)}set(e,t){const r=String(e).toLowerCase();return this[p].set(r,{key:e,value:t}),this}get(e){var t;const r=String(e).toLowerCase();return null===(t=this[p].get(r))||void 0===t?void 0:t.value}has(e){const t=String(e).toLowerCase();return this[p].has(t)}delete(e){const t=String(e).toLowerCase();return this[p].delete(t)}clear(){this[p].clear()}*entries(){for(const{key:e,value:t}of this[p].values())yield[e,t]}*keys(){for(const{key:e}of this[p].values())yield e}*values(){for(const{value:e}of this[p].values())yield e}forEach(e,t){this[p].forEach((({key:t,value:r})=>{e(r,t,this)}),t)}[Symbol.iterator](){return this.entries()}}globalThis.BiMap=d,globalThis.CiMap=h;class y extends Error{constructor(e,t=0){super(e),this.code=0,"number"==typeof t?this.code=t:(t.cause&&Object.defineProperty(this,"cause",{configurable:!0,enumerable:!1,writable:!0,value:t.cause}),t.code&&(this.code=t.code))}}function v(e){return c(e,[])}function m(e){return"object"==typeof e&&null!==e&&"function"==typeof e.next}function b(e){return function(e){return m(e)&&"function"==typeof e[Symbol.iterator]}(e)&&g(e)}function w(e){return function(e){return m(e)&&"function"==typeof e[Symbol.asyncIterator]}(e)&&g(e)}function g(e){return"function"==typeof e.return&&"function"==typeof e.throw}function j(e){return"function"==typeof e}Object.defineProperty(y.prototype,"name",{configurable:!0,enumerable:!1,writable:!0,value:"Exception"}),globalThis.Exception=y,Error.toObject=v,Error.fromObject=function(e){var t;let r=globalThis[e.name];r||(r="Exception"===e.name?y:Error);const n=Object.create(r.prototype,{message:{configurable:!0,enumerable:!1,writable:!0,value:null!==(t=e.message)&&void 0!==t?t:""}});return n.name!==e.name&&Object.defineProperty(n,"name",{configurable:!0,enumerable:!1,writable:!0,value:e.name}),void 0!==e.stack&&Object.defineProperty(n,"stack",{configurable:!0,enumerable:!1,writable:!0,value:e.stack}),null!=e.cause&&Object.defineProperty(n,"cause",{configurable:!0,enumerable:!1,writable:!0,value:e.cause}),Reflect.ownKeys(e).filter((e=>!["name","message","stack","cause"].includes(e))).forEach((t=>{n[t]=e[t]})),n},Error.prototype.toJSON=function(){return v(this)},Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator"));const E=new Map;function k(e,t,r=!1){const n=Reflect.ownKeys(t);for(const o of n)"constructor"!=o&&(r?o in e||S(e,t,o):a(e,o)||S(e,t,o));return e}function O(e,t,r=!1){k(e.prototype,t.prototype,r);const n=Object.getPrototypeOf(t);n.name&&O(e,n,!0)}function S(e,t,r){const n=Object.getOwnPropertyDescriptor(t,r);n?Object.defineProperty(e,r,n):e[r]=t[r]}function P(e,t=void 0){var r;if(j(e[Symbol.asyncIterator]))return e;const n={ended:!1,error:null,queue:[],consumers:[],next(){return new Promise(((e,t)=>{this.error&&!this.ended?(t(this.error),this.ended=!0):this.ended&&!this.queue.length?e({value:void 0,done:!0}):this.queue.length>0?e({value:this.queue.shift(),done:!1}):this.consumers.push({resolve:e,reject:t})}))}},o=e=>{var t;n.consumers.length>0?null===(t=n.consumers.shift())||void 0===t||t.resolve({value:e,done:!1}):n.queue.push(e)},i=()=>{let e;for(n.ended=!0;e=n.consumers.shift();)e.resolve({value:void 0,done:!0})},s=e=>{n.error=e,n.consumers.length>0&&(n.consumers.forEach((t=>{t.reject(e)})),n.consumers=[])},l=e=>{let t;t=e instanceof ErrorEvent?e.error||new Error(e.message):new Error("something went wrong",{cause:e}),s(t)},a=Object.getPrototypeOf(e),u=Object.getOwnPropertyDescriptor(a,"onmessage");if((null==u?void 0:u.set)&&j(e.close)){const n=Object.getOwnPropertyDescriptor(a,"onerror"),s=Object.getOwnPropertyDescriptor(a,"onclose");let c;if((null==t?void 0:t.event)&&"message"!==(null==t?void 0:t.event)&&j(e.addEventListener)){const r=e,n=t.event,i=e=>{o(e.data)};r.addEventListener(n,i),c=()=>{r.removeEventListener(n,i)}}else u.set.call(e,(e=>{o(e.data)})),c=()=>{var t;null===(t=u.set)||void 0===t||t.call(e,null)};if(null===(r=null==n?void 0:n.set)||void 0===r||r.call(e,l),null==s?void 0:s.set)s.set.call(e,(()=>{var t,r;i(),null===(t=s.set)||void 0===t||t.call(e,null),null===(r=null==n?void 0:n.set)||void 0===r||r.call(e,null),null==c||c()}));else if(!(null==s?void 0:s.set)&&j(e.close)){const t=e,r=t.close;t.close=function(){var o;r.call(t),i(),t.close=r,null===(o=null==n?void 0:n.set)||void 0===o||o.call(e,null),null==c||c()}}}else if(j(e.send)&&j(e.close)){const t=e;t.onmessage=e=>{o(e.data)},t.onerror=l,t.onclose=()=>{i(),t.onclose=null,t.onerror=null,t.onmessage=null}}else if(j(e.addEventListener)){const r=e,n=(null==t?void 0:t.message)||"message",s=(null==t?void 0:t.error)||"error",a=(null==t?void 0:t.close)||"close",u=e=>{e instanceof MessageEvent&&o(e.data)};r.addEventListener(n,u),r.addEventListener(s,l),r.addEventListener(a,(function e(){i(),r.removeEventListener(a,e),r.removeEventListener(n,u),r.removeEventListener(s,l)}))}else{if(!j(e.on))throw new TypeError("the input source cannot be read as an AsyncIterable object");{const r=e;let n,l,a;"object"==typeof process&&e===process?(n="message",l="uncaughtException",a="exit"):j(e.send)&&j(e.kill)||j(e.postMessage)&&j(e.terminate)||j(e.postMessage)&&j(e.close)?(n="message",l="error",a="exit"):(n=(null==t?void 0:t.data)||"data",l=(null==t?void 0:t.error)||"error",a=(null==t?void 0:t.close)||"close"),r.on(n,o),r.once(l,s),r.once(a,(()=>{i(),r.off(n,o),r.off(n,s)}))}}return{[Symbol.asyncIterator]:()=>n}}var x;const A="object"==typeof process&&!!(null===(x=process.versions)||void 0===x?void 0:x.node),M=i(1,Number.MAX_SAFE_INTEGER,1,!0);let T=[];const L=[];const I=async function(){}.constructor,U=async function*(){}.constructor,N={try:function e(t,...r){if(j(t))try{return e(t.apply(void 0,r))}catch(e){return[e,void 0]}let n=t;return w(n)?async function*(){let e,t;for(;;)try{const{done:r,value:o}=await n.next(e);if(r){t=o;break}e=yield Promise.resolve([null,o])}catch(e){yield Promise.resolve([e,void 0]);break}return[null,t]}():b(n)?function*(){let e,t;for(;;)try{const{done:r,value:o}=n.next(e);if(r){t=o;break}e=yield[null,o]}catch(e){yield[e,void 0];break}return[null,t]}():j(null==n?void 0:n.then)?(n=n.then((e=>[null,e])),Promise.resolve(n).catch((e=>[e,void 0]))):[null,n]},func:function(e){return function(...t){var r;const n=[],o=e=>{n.push(e)};let i;try{const r=e.call(this,o,...t);if(w(r)){const e=async function*(){var e;let t;for(;;)try{const{done:e,value:n}=await r.next(t);if(e){i={value:n,error:null};break}t=yield Promise.resolve(n)}catch(e){i={value:void 0,error:e};break}for(let t=n.length-1;t>=0;t--)await(null===(e=n[t])||void 0===e?void 0:e.call(n));if(i.error)throw i.error;return i.value}();return e}if(b(r)){const e=function*(){var e;let t;for(;;)try{const{done:e,value:n}=r.next(t);if(e){i={value:n,error:null};break}t=yield n}catch(e){i={value:void 0,error:e};break}for(let t=n.length-1;t>=0;t--)null===(e=n[t])||void 0===e||e.call(n);if(i.error)throw i.error;return i.value}();return e}if("function"==typeof(null==r?void 0:r.then))return Promise.resolve(r).then((e=>({value:e,error:null}))).catch((e=>({value:void 0,error:e}))).then((async e=>{var t;for(let e=n.length-1;e>=0;e--)await(null===(t=n[e])||void 0===t?void 0:t.call(n));if(e.error)throw e.error;return e.value}));i={value:r,error:null}}catch(e){i={value:void 0,error:e}}for(let e=n.length-1;e>=0;e--)null===(r=n[e])||void 0===r||r.call(n);if(i.error)throw i.error;return i.value}},wrap:function(e,t){const r=function(...r){return t.call(this,e,...r)};return Object.defineProperty(r,"name",Object.getOwnPropertyDescriptor(e,"name")),Object.defineProperty(r,"length",Object.getOwnPropertyDescriptor(e,"length")),Object.defineProperty(r,"toString",{configurable:!0,enumerable:!1,writable:!0,value:e.toString.bind(e)}),r},throttle:function(e,t){const r="number"==typeof t?null:t.for,n="number"==typeof t?t:t.duration,o=function(t,...r){var o;if(t.result&&Date.now()<(null!==(o=t.expires)&&void 0!==o?o:0)){if(t.result.error)throw t.result.error;return t.result.value}try{const o=e.call(this,...r);return t.result={value:o},t.expires=Date.now()+n,o}catch(e){throw t.result={error:e},t.expires=Date.now()+n,e}};if(r){let e=E.get(r);return e||(e={for:r},E.set(r,e)),function(...t){return o.call(this,e,...t)}}{const e={for:null};return function(...t){return o.call(this,e,...t)}}},mixins:function(e,...t){const r={ctor:null};r.ctor=class extends e{};for(const e of t)if("function"==typeof e)O(r.ctor,e);else{if(!e||"object"!=typeof e)throw new TypeError("mixin must be a constructor or an object");k(r.ctor.prototype,e)}return r.ctor},isSubclassOf:function(e,t){return"function"==typeof e&&"function"==typeof t&&e.prototype instanceof t},read:P,run:async function t(r,n=void 0,o=void 0){var i,s;const l={type:"ffi",script:r,baseUrl:"",fn:(null==o?void 0:o.fn)||"default",args:null!=n?n:[]};"object"==typeof Deno?l.baseUrl="file://"+Deno.cwd()+"/":A?l.baseUrl="file://"+process.cwd()+"/":"object"==typeof location&&(l.baseUrl=location.href);const a=[];let u,c,f,d,p,h,y=null,v=()=>Promise.resolve(void 0);const m=(null==o?void 0:o.timeout)?setTimeout((()=>{const e=new Error(`operation timeout after ${o.timeout}ms`);c?c.reject(e):y=e,v()}),o.timeout):null,b=e=>{var t;if(e&&"object"==typeof e&&"string"==typeof e.type){if("error"===e.type)return w(e.error);"return"===e.type?((null==o?void 0:o.keepAlive)?(null==h||h(),L.length&&(null===(t=L.shift())||void 0===t||t())):v(),c?c.resolve(e.value):u={value:e.value}):"yield"===e.type&&(e.done?b({type:"return",value:e.value}):f?j(f.dispatchEvent)?f.dispatchEvent(new MessageEvent("message",{data:e.value})):f.emit("data",e.value):a.push(e.value))}},w=e=>{c?c.reject(e):f?j(f.dispatchEvent)?f.dispatchEvent(new MessageEvent("error",{data:e})):f.emit("error",e):y=e},g=()=>{var e;p&&(T=T.filter((e=>e!==p)),L.length&&(null===(e=L.shift())||void 0===e||e())),c?c.resolve(void 0):f?j(f.dispatchEvent)?f.dispatchEvent(new MessageEvent("close")):f.emit("close"):y||u||(u={value:void 0})};if(A){let s=null==o?void 0:o.workerEntry;if(!s){const t=await import("path"),{fileURLToPath:r}=await import("url"),n=t.dirname(r("undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:e&&e.src||new URL("index.js",document.baseURI).href));s=["cjs","esm"].includes(t.basename(n))?t.join(t.dirname(n),"bundle","worker.mjs"):t.join(n,"worker.mjs")}if("child_process"===(null==o?void 0:o.adapter)){let e,i=!0;if(p=T.find((e=>"child_process"===e.adapter&&!e.busy)),p)e=p.worker,d=p.workerId,p.busy=!0;else{if(!(T.length<16))return new Promise((e=>{L.push(e)})).then((()=>t(r,n,o)));{const{fork:t}=await import("child_process"),r=parseInt(process.version.slice(1))<14;e=t(s,{stdio:"inherit",serialization:r?"advanced":"json"}),d=e.pid,i=await new Promise((t=>{e.once("exit",(()=>{y&&t(!1)})),e.once("message",(()=>{e.removeAllListeners("exit"),t(!0)}))})),i&&T.push(p={workerId:d,worker:e,adapter:"child_process",busy:!0})}}h=()=>{e.off("message",b),p&&(p.busy=!1)},v=()=>Promise.resolve(void e.kill(1)),i&&(e.send(l),e.on("message",b),e.once("error",w),e.once("exit",g))}else{let e,a=!0;if(p=T.find((e=>"worker_threads"===e.adapter&&!e.busy)),p)e=p.worker,d=p.workerId,p.busy=!0;else{if(!(T.length<16))return new Promise((e=>{L.push(e)})).then((()=>t(r,n,o)));{const{Worker:t}=await import("worker_threads");e=new t(s),d=null!==(i=e.threadId)&&void 0!==i?i:M.next().value,a=await new Promise((t=>{e.once("exit",(()=>{y&&t(!1)})),e.once("online",(()=>{e.removeAllListeners("exit"),t(!0)}))})),a&&T.push(p={workerId:d,worker:e,adapter:"worker_threads",busy:!0})}}h=()=>{e.off("message",b),p&&(p.busy=!1)},v=async()=>{await e.terminate()},a&&(e.postMessage(l),e.on("message",b),e.once("error",w),e.once("messageerror",w),e.once("exit",g))}}else{let i;if(p=T.find((e=>"worker_threads"===e.adapter&&!e.busy)),p)i=p.worker,d=p.workerId,p.busy=!0;else{if(!(T.length<16))return new Promise((e=>{L.push(e)})).then((()=>t(r,n,o)));{let t;if("object"==typeof Deno)t=[...("undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:e&&e.src||new URL("index.js",document.baseURI).href).split("/").slice(0,-1),"worker-web.mjs"].join("/");else{const e=(null==o?void 0:o.workerEntry)||"https://raw.githubusercontent.com/ayonli/jsext/main/bundle/worker-web.mjs",r=await fetch(e);let n;if(null===(s=r.headers.get("content-type"))||void 0===s?void 0:s.startsWith("application/javascript"))n=await r.blob();else{const e=await r.arrayBuffer();n=new Blob([new Uint8Array(e)],{type:"application/javascript"})}t=URL.createObjectURL(n)}i=new Worker(t,{type:"module"}),d=M.next().value,T.push(p={workerId:d,worker:i,adapter:"worker_threads",busy:!0})}}h=()=>{i.onmessage=null,p&&(p.busy=!1)},v=async()=>{await Promise.resolve(i.terminate()),g()},i.postMessage(l),i.onmessage=e=>b(e.data),i.onerror=e=>b(e.error||new Error(e.message)),i.onmessageerror=()=>{w(new Error("unable to deserialize the message"))}}return{workerId:d,async abort(){m&&clearTimeout(m),await v()},result:async()=>await new Promise(((e,t)=>{y?t(y):u?e(u.value):c={resolve:e,reject:t}})),async*iterate(){if(c)throw new Error("result() has been called");if(u)throw new TypeError("the response is not iterable");if("function"==typeof MessageEvent&&"function"==typeof EventTarget){f=new EventTarget,a.length&&(async()=>{let e;for(await Promise.resolve(null);e=a.shift();)f.dispatchEvent(new MessageEvent("message",{data:e}))})().catch(console.error);for await(const e of P(f))yield e}else{const{EventEmitter:e}=await import("events");f=new e,a.length&&(async()=>{let e;for(await Promise.resolve(null);e=a.shift();)f.emit("data",e)})().catch(console.error);for await(const e of P(f))yield e}}}},example:function e(t,r=void 0){const n={};return Error.captureStackTrace(n,e),async function(...e){let o=t.toString().split("\n").slice(1,-1),i=o.findIndex((e=>"// output:"===e.trim().toLowerCase()));if(-1===i)return;if(i+=1,o=o.slice(i),-1!==o.findIndex((e=>"// output:"===e.trim().toLowerCase())))throw new Error("there can only be one output comment in the example");let s=[];for(let e of o){if(e=e.trimStart(),!e.startsWith("//"))throw new Error("the output comment must be at the end of the example");s.push(e.slice(3))}const l=[...s];s=[];for(let e=l.length-1;e>=0;e--)""!==l[e]&&s.push(l[e]);s.reverse();const a=await import("node:assert"),{Writable:u}=await import("node:stream"),{Console:c}=await import("node:console"),f=[],d=new TextDecoder,p=new u({write(e,t,r){f.push(e),r()}}),h=new c(p),y=t.call(this,h,...e);"function"==typeof(null==y?void 0:y.then)&&await y,await new Promise((e=>p.end((()=>e())))),await(async()=>{var e;const t=f.map((e=>d.decode(e))).join("\n").replace(/[\n]+$/,""),o=s.join("\n");try{if(a.ok(t===o,`\nexpected:\n${o}\n\ngot:\n${t}`),!(null==r?void 0:r.suppress))for(const e of f)"object"==typeof Deno?await Deno.stdout.write(e):"object"==typeof process&&await new Promise((t=>process.stdout.write(e,(()=>t()))))}catch(t){throw Object.defineProperty(t,"stack",{configurable:!0,writable:!0,enumerable:!1,value:t.stack+"\n"+(null===(e=n.stack)||void 0===e?void 0:e.split("\n").slice(1).join("\n"))}),t}})()}}};return globalThis.AsyncFunction=I,globalThis.AsyncGeneratorFunction=U,N}));
//# sourceMappingURL=index.js.map
