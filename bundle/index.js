!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["@ayonli/jsext"]=t()}(this,(function(){"use strict";var e="undefined"!=typeof document?document.currentScript:null;function t(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function r(e,t){const r=[],n=e.length;let o=0;for(let i=0;i<n;i++)e[i]===t&&(r.push(e.slice(o,i)),o=i+1);if(o<n)r.push(e.slice(o,n));else if(o===n){const t=e.constructor;"function"==typeof t.from?r.push(t.from([])):r.push(new t([]))}return r}function n(e,t){const r=e.length,n=Math.ceil(r/t),o=new Array(n);let i=0,s=0;for(;i<r;)o[s]=e.slice(i,i+t),i+=t,s++;return o}function o(e){if("function"!=typeof e)return!1;if([String,Number,Boolean,BigInt,Symbol].includes(e))return!1;if(void 0===e.prototype)return!1;if(e.prototype.constructor!==e)return!1;const t=e.toString();if("class"===t.slice(0,5))return!0;const r=e.name[0];return!!(r&&r>="A"&&r<="Z"&&t.includes("[native code]"))}function i(e,t){return"function"==typeof e&&"function"==typeof t&&e.prototype instanceof t}function s(e,t,r=!1){const n=Reflect.ownKeys(t);for(const o of n)"constructor"!==o&&(r?o in e||c(e,t,o):u(e,o)||c(e,t,o));return e}function a(e,t,r=!1){s(e.prototype,t.prototype,r);const n=Object.getPrototypeOf(t);n.name&&a(e,n,!0)}function c(e,t,r){const n=Object.getOwnPropertyDescriptor(t,r);n?Object.defineProperty(e,r,n):e[r]=t[r]}function l(e,...t){const r={ctor:null};r.ctor=class extends e{};for(const e of t)if("function"==typeof e)a(r.ctor,e);else{if(!e||"object"!=typeof e)throw new TypeError("mixin must be a constructor or an object");s(r.ctor.prototype,e)}return r.ctor}function u(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function f(e,t){return t.reduce(((t,r)=>(r in e&&void 0!==e[r]&&(t[r]=e[r]),t)),{})}function p(e,t){const r=Reflect.ownKeys(e).filter((e=>!t.includes(e))),n=f(e,r);return e instanceof Error&&["name","message","stack","cause"].forEach((r=>{t.includes(r)||void 0===e[r]||u(n,r)||(n[r]=e[r])})),n}function d(e,t){if("function"!=typeof t)throw new TypeError("type must be a valid constructor");let r;const n={string:String,number:Number,bigint:BigInt,boolean:Boolean,symbol:Symbol};return e instanceof t?[String,Number,Boolean].includes(t)?e.valueOf():e:(r=typeof e)&&n[r]===t?e:null}function h(e){return!(null==e||Object.is(e,NaN)||e instanceof Date&&"Invalid Date"===e.toString())}function y(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return null===t||t.constructor===Object}function m(...e){return e.reduce(((e,t)=>e+t),0)}const v=new TextEncoder,w=new TextDecoder;class g extends Uint8Array{toString(){return function(e,t="utf8"){var r,n;return"hex"===t?"function"==typeof Buffer?(null!==(r=d(e,Buffer))&&void 0!==r?r:Buffer.from(e)).toString("hex"):e.reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),""):"base64"===t?"function"==typeof Buffer?(null!==(n=d(e,Buffer))&&void 0!==n?n:Buffer.from(e)).toString("base64"):btoa(w.decode(e)):"function"==typeof Buffer&&e instanceof Buffer?e.toString("utf8"):w.decode(e)}(this)}toJSON(){return{type:"ByteArray",data:Array.from(this)}}}function b(e){return new g("string"==typeof e?v.encode(e).buffer:e)}const k=j;function S(e){return b(e)}function j(e){return"function"==typeof(null===Intl||void 0===Intl?void 0:Intl.Segmenter)?Array.from((new Intl.Segmenter).segment(e)).map((e=>e.segment)):Array.from(e)}const E=String.prototype.trim,O=String.prototype.trimEnd,P=String.prototype.trimStart;function x(e,t=""){return t?A(I(e,t),t):E.call(e)}function A(e,t=""){if(t){let r=e.length;for(;r--&&-1!==t.indexOf(e[r]););return e.substring(0,r+1)}return O.call(e)}function I(e,t=""){if(t){let r=0;do{}while(-1!==t.indexOf(e[r])&&++r);return e.substring(r)}return P.call(e)}function N(e,t){return e.endsWith(t)?e.slice(0,-t.length):e}function D(e,t){return e+Math.floor(Math.random()*(t-e+1))}function M(e=!1){return L(1,Number.MAX_SAFE_INTEGER,1,e)}function*L(e,t,r=1,n=!1){let o=e;for(;;)if(yield o,(o+=r)>t){if(!n)break;o=e}}function T(e,t=!1){if(!e.length)return;if(1===e.length)return t?e.splice(0,1)[0]:e[0];const r=D(0,e.length-1);return t?e.splice(r,1)[0]:e[r]}function B(e,t,r="asc"){const n=e.slice();return"function"==typeof t?B(n.map(((e,r)=>({key:t(e,r),value:e}))),"key",r).map((({value:e})=>e)):(n.sort(((e,r)=>{if("object"!=typeof e||"object"!=typeof r||!e||!r||Array.isArray(e)||Array.isArray(r))return-1;const n=e[t],o=r[t];return void 0===n||void 0===o?-1:"number"==typeof n&&"number"==typeof o?n-o:"string"==typeof n&&"string"==typeof o||"bigint"==typeof n&&"bigint"==typeof o?n<o?-1:1:-1})),"desc"===r&&n.reverse(),n)}function R(e){return"function"==typeof e}function W(e){"object"==typeof e&&"function"==typeof e.unref?e.unref():"object"==typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e)}async function U(e){return new Promise((t=>setTimeout(t,e)))}String.compare=function(e,t){return e<t?-1:e>t?1:0},String.random=function(e,t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"){const r=k(t);let n="";for(;0<e--;){n+=r[Math.floor(Math.random()*r.length)]}return n},String.prototype.count=function(e){return function(e,t){return t?e?e.split(t).length-1:0:e.length+1}(String(this),e)},String.prototype.capitalize=function(e){return function(e,t){const r=t?/\w+/g:/\w+/;return e.replace(r,(e=>e[0].toUpperCase()+e.slice(1).toLowerCase()))}(String(this),e)},String.prototype.hyphenate=function(){return String(this).replace(/(\S)\s+(\S)/g,((e,t,r)=>t+"-"+r))},String.prototype.bytes=function(){return S(String(this))},String.prototype.chars=function(){return j(String(this))},String.prototype.words=function(){return function(e){const t=e.match(/\w+/g);return t?[...t].map((e=>e.split("_"))).flat():[]}(String(this))},String.prototype.lines=function(){return String(this).split(/\r?\n/)},String.prototype.chunk=function(e){return function(e,t){return n(e,t)}(String(this),e)},String.prototype.truncate=function(e){return function(e,t){return t<=0?"":t>=e.length?e:(t-=3,e.slice(0,t)+"...")}(String(this),e)},String.prototype.trim=function(e=""){return x(String(this),e)},String.prototype.trimEnd=function(e=""){return A(String(this),e)},String.prototype.trimStart=function(e=""){return I(String(this),e)},String.prototype.stripEnd=function(e){return N(String(this),e)},String.prototype.stripStart=function(e){return function(e,t){return e.startsWith(t)?e.slice(t.length):e}(String(this),e)},String.prototype.byteLength=function(){return b(String(this)).byteLength},String.prototype.isAscii=function(e=!1){return function(e,t=!1){return t?/^[-~]+$/.test(e):/^[\x00-\x7E]+$/.test(e)}(String(this),e)},Number.isFloat=function(e){return!("number"!=typeof e||Number.isNaN(e)||Number.isFinite(e)&&e%1==0)},Number.isNumeric=function(e,t=!1){const r=typeof e;if(t)return"number"===r&&!Number.isNaN(e);if("bigint"===r)return!0;if("number"===r)return!Number.isNaN(e);if("string"===r&&e)try{return BigInt(e),!0}catch(t){return!Number.isNaN(Number(e))}return!1},Number.isBetween=function(e,[t,r]){return e>=t&&e<=r},Number.random=D,Number.range=function(e,t,r=1){return L(e,t,r)},Number.serial=M,Number.sequence=L,Array.prototype.first=function(){return this[0]},Array.prototype.last=function(){return(e=this).length>0?e[e.length-1]:void 0;var e},Array.prototype.random=function(e=!1){return T(this,e)},Array.prototype.count=function(e){return function(e,t){let r=0;for(let n=0;n<e.length;n++)e[n]===t&&r++;return r}(this,e)},Array.prototype.equals=function(e){return t(this,e)},Array.prototype.split=function(e){return function(e,t){return r(e,t)}(this,e)},Array.prototype.chunk=function(e){return function(e,t){return n(e,t)}(this,e)},Array.prototype.uniq=function(){return[...new Set(this)]},Array.prototype.uniqBy=function(e){return function(e,t){const r=new Map;for(let n=0;n<e.length;n++){const o=e[n],i=t(o,n);r.has(i)||r.set(i,o)}return[...r.values()]}(this,e)},Array.prototype.shuffle=function(){return function(e){for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e}(this)},Array.prototype.toShuffled=function(){return this.slice().shuffle()},Array.prototype.toReversed||(Array.prototype.toReversed=function(){return this.slice().reverse()}),Array.prototype.toSorted||(Array.prototype.toSorted=function(e){return this.slice().sort(e)}),Array.prototype.orderBy=function(e,t="asc"){return B(this,e,t)},Array.prototype.groupBy=function(e,t=Object){return function(e,t,r=Object){if(r===Map||i(r,Map)){const n=new r;for(let r=0;r<e.length;r++){const o=e[r],i=t(o,r),s=n.get(i);s?s.push(o):n.set(i,[o])}return n}{const r={};for(let n=0;n<e.length;n++){const o=e[n],i=t(o,n),s=r[i];s?s.push(o):r[i]=[o]}return r}}(this,e,t)},Array.prototype.keyBy=function(e,t=Object){return function(e,t,r=Object){if(r===Map||i(r,Map)){const n=new r;for(let r=0;r<e.length;r++){const o=e[r],i=t(o,r);n.set(i,o)}return n}{const r={};for(let n=0;n<e.length;n++){const o=e[n];r[t(o,n)]=o}return r}}(this,e,t)},Uint8Array.copy=function(e,t){return e.length>t.length&&(e=e.subarray(0,t.length)),t.set(e),e.length},Uint8Array.concat=function(...e){const t=m(...e.map((e=>e.length))),r=new(0,e[0].constructor)(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r},Uint8Array.compare=function(e,t){if(e===t)return 0;for(let r=0;r<e.length;r++){const n=e[r],o=t[r];if(void 0===o)return 1;if(n<o)return-1;if(n>o)return 1}return e.length<t.length?-1:0},Uint8Array.prototype.equals=function(e){return function(e,r){if(e.length<1e3)return t(e,r);if(e===r)return!0;if(e.length!==r.length)return!1;const n=e.length,o=Math.floor(n/4),i=new Uint32Array(e.buffer,0,o),s=new Uint32Array(r.buffer,0,o);for(let t=4*o;t<n;t++)if(e[t]!==r[t])return!1;for(let e=0;e<i.length;e++)if(i[e]!==s[e])return!1;return!0}(this,e)},Uint8Array.prototype.split=function(e){return function(e,t){return r(e,t)}(this,e)},Uint8Array.prototype.chunk=function(e){return function(e,t){return n(e,t)}(this,e)},Object.hasOwn||(Object.hasOwn=u),Object.hasOwnMethod||(Object.hasOwnMethod=function(e,t){var r;const n=Object.getPrototypeOf(e);return!(!n||!u(n,t))&&"function"==typeof(null===(r=Object.getOwnPropertyDescriptor(n,t))||void 0===r?void 0:r.value)}),Object.patch=function(e,...t){for(const r of t)for(const t of Reflect.ownKeys(r))u(e,t)&&void 0!==e[t]||(e[t]=r[t]);return e},Object.pick=f,Object.omit=p,Object.as=d,Object.typeOf=function(e){var t,r;if(void 0===e)return"undefined";if(null===e)return"null";const n=typeof e;return"function"===n?o(e)?"class":"function":"object"===n?null!==(r=null===(t=Object.getPrototypeOf(e))||void 0===t?void 0:t.constructor)&&void 0!==r?r:Object:n},Object.isValid=h,Object.isPlainObject=y,Object.sanitize=function(e,t=!1,r={}){const{removeNulls:n,removeEmptyStrings:o,removeEmptyObjects:i,removeArrayItems:s}=r;return function e(r,a){if("string"==typeof r)return r.trim();if(Array.isArray(r)){const c=!a||t?r.map((t=>e(t,a+1))):r;return s?c.filter((e=>null===e?!n:""===e?!o:!!h(e)&&("object"!=typeof e||(Array.isArray(e)?e.length>0||!i:!y(e)||(Reflect.ownKeys(e).length>0||!i))))):c}return y(r)&&(!a||t)?Reflect.ownKeys(r).reduce(((t,s)=>{const c=e(r[s],a+1);return null===c?n||(t[s]=c):""===c?o||(t[s]=c):h(c)&&("object"!=typeof c?t[s]=c:Array.isArray(c)?(c.length>0||!i)&&(t[s]=c):y(c)?(Reflect.ownKeys(c).length>0||!i)&&(t[s]=c):t[s]=c),t}),r.constructor?{}:Object.create(null)):r}(e,0)},Object.sortKeys=function(e,t=!1){return function e(r,n){return y(r)?!n||t?[...Object.getOwnPropertyNames(r).sort(),...Object.getOwnPropertySymbols(r)].reduce(((t,o)=>(t[o]=e(r[o],n+1),t)),r.constructor?{}:Object.create(null)):r:Array.isArray(r)&&(!n||t)?r.map((t=>e(t,n+1))):r}(e,0)},Object.flatKeys=function(e,t=1,r={}){var n;const o=t,i=e.constructor?{}:Object.create(null),s=null!==(n=null==r?void 0:r.flatArrayIndices)&&void 0!==n&&n;return y(e)||Array.isArray(e)&&s?(function e(t,r,n){n===o?i[r]=t:Array.isArray(t)&&n?s?t.forEach(((t,o)=>{e(t,r?`${r}.${o}`:String(o),r?n+1:n)})):i[r]=t:y(t)||Array.isArray(t)&&!n?Reflect.ownKeys(t).forEach((o=>{const s=t[o];"symbol"==typeof o?0===n&&(i[o]=s):e(s,r?`${r}.${o}`:o,r?n+1:n)})):i[r]=t}(e,"",0),i):e},Math.sum=m,Math.avg=function(...e){return m(...e)/e.length},Math.product=function(...e){var t;return e.slice(1).reduce(((e,t)=>e*t),null!==(t=e[0])&&void 0!==t?t:0)},Promise.timeout=async function(e,t){return await Promise.race([e,new Promise(((e,r)=>W(setTimeout((()=>{r(new Error(`operation timeout after ${t}ms`))}),t))))])},Promise.after=async function(e,t){const[r]=await Promise.allSettled([e,new Promise((e=>setTimeout(e,t)))]);if("fulfilled"===r.status)return r.value;throw r.reason},Promise.sleep=U,Promise.until=async function(e){for(;!1===await e();)await U(0)};const $=Symbol("inverse");class _ extends Map{get[Symbol.toStringTag](){return"BiMap"}constructor(e=null){if(super(),this[$]=new Map,e)for(const[t,r]of e)this.set(t,r)}set(e,t){return super.set(e,t),this[$].set(t,e),this}getKey(e){return this[$].get(e)}hasValue(e){return this[$].has(e)}deleteValue(e){if(this[$].has(e)){const t=this[$].get(e);return super.delete(t),this[$].delete(e),!0}return!1}clear(){super.clear(),this[$].clear()}}class C extends Map{get[Symbol.toStringTag](){return"CiMap"}constructor(e=null){if(super(),e)for(const[t,r]of e)this.set(t,r)}set(e,t){const r=String(e).toLowerCase();return super.set(r,{key:e,value:t}),this}get(e){var t;const r=String(e).toLowerCase();return null===(t=super.get(r))||void 0===t?void 0:t.value}has(e){const t=String(e).toLowerCase();return super.has(t)}delete(e){const t=String(e).toLowerCase();return super.delete(t)}*entries(){for(const{key:e,value:t}of super.values())yield[e,t]}*keys(){for(const{key:e}of super.values())yield e}*values(){for(const{value:e}of super.values())yield e}forEach(e,t){super.forEach((({key:t,value:r})=>{e(r,t,this)}),t)}[Symbol.iterator](){return this.entries()}}globalThis.BiMap=_,globalThis.CiMap=C;class z extends Error{constructor(e,t=0){super(e),this.code=0,"number"==typeof t?this.code=t:"string"==typeof t?Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,writable:!0,value:t}):(t.name&&Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,writable:!0,value:t.name}),t.cause&&Object.defineProperty(this,"cause",{configurable:!0,enumerable:!1,writable:!0,value:t.cause}),t.code&&(this.code=t.code))}}function F(e){e instanceof Error||!e.name||!e.message||(e=K(e,Error));const t={"@@type":e.constructor.name,...p(e,["toString","toJSON","__callSiteEvals"])};return"AggregateError"===t["@@type"]&&Array.isArray(t.errors)&&(t.errors=t.errors.map((e=>e instanceof Error?F(e):e))),t}function K(e,t=void 0){var r,n;if(!(null==e?void 0:e.name))return null;let o;t||(t=globalThis[e["@@type"]||e.name]||globalThis[e.name]),t||(t="Exception"===e["@@type"]?z:Error),o="DOMException"===t.name&&"function"==typeof DOMException?new t(null!==(r=e.message)&&void 0!==r?r:"",e.name):Object.create(t.prototype,{message:{configurable:!0,enumerable:!1,writable:!0,value:null!==(n=e.message)&&void 0!==n?n:""}}),o.name!==e.name&&Object.defineProperty(o,"name",{configurable:!0,enumerable:!1,writable:!0,value:e.name}),void 0!==e.stack&&Object.defineProperty(o,"stack",{configurable:!0,enumerable:!1,writable:!0,value:e.stack}),null!=e.cause&&Object.defineProperty(o,"cause",{configurable:!0,enumerable:!1,writable:!0,value:e.cause});return Reflect.ownKeys(e).filter((e=>!["@@type","name","message","stack","cause"].includes(e))).forEach((t=>{var r;null!==(r=o[t])&&void 0!==r||(o[t]=e[t])})),V(o)&&Array.isArray(o.errors)&&(o.errors=o.errors.map((e=>y(e)?K(e):e))),o}Object.defineProperty(z.prototype,"name",{configurable:!0,enumerable:!1,writable:!0,value:"Exception"});const q="object"==typeof navigator&&/Firefox|Safari/.test(navigator.userAgent);function J(e){if(e.error instanceof Error)return e.error;let t,r=!1;if(e.error&&"object"==typeof e.error&&e.error.name&&e.error.message)t=K(e.error,Error),r=!t.stack;else{if(!e.message)return null;t=new Error(e.message),r=!0}if(r){let r="";e.filename&&(r=q?"@"+e.filename:`Error: ${e.message}\n    at ${e.filename}`,e.lineno&&(r+=":"+e.lineno),e.colno&&(r+=":"+e.colno)),Object.defineProperty(t,"stack",{configurable:!0,enumerable:!1,writable:!0,value:r})}return t}function G(e){return"function"==typeof DOMException&&e instanceof DOMException||e instanceof Error&&"DOMException"===e.constructor.name}function V(e){return"function"==typeof AggregateError&&e instanceof AggregateError||e instanceof Error&&"AggregateError"===e.constructor.name}globalThis.Exception=z,Error.toObject=F,Error.fromObject=K,Error.toErrorEvent=function(e,t="error"){let r="",n=0,o=0;if(e.stack){const t=e.stack.split("\n").map((e=>e.trim()));let i=t.find((e=>e.startsWith("at ")));if(i?i=i.slice(3):(i=t.find((e=>e.includes("@")&&e.length>1)))&&(i=i.slice(i.indexOf("@")+1)),i){let e=i.lastIndexOf("("),t=0;-1!==e&&(e+=1,t=i.indexOf(")",e),i=i.slice(e,t));const s=i.match(/:(\d+):(\d+)$/);s&&(r=i.slice(0,s.index),n=parseInt(s[1]),o=parseInt(s[2]))}}return new ErrorEvent(t,{error:e,message:e.message,filename:r,lineno:n,colno:o})},Error.fromErrorEvent=J,Error.prototype.toJSON=function(){return F(this)};const H=new Map;function Z(e,t){if(null==e)return null;if("function"==typeof t.fromJSON)return t.fromJSON(e);if("boolean"==typeof e)return t===Boolean?e:null;if("number"==typeof e){if(t===Number)return e;if(t!==BigInt)return null;try{return BigInt(e)}catch(e){return null}}else if("string"==typeof e){if(t===String)return e;if(t===Date){const t=new Date(e);return h(t)?t:null}if(t!==BigInt)return null;try{return BigInt(e)}catch(e){return null}}else if(Array.isArray(e)){if(t===Array)return e;if(t.prototype instanceof Array)return t.from(e);if("function"!=typeof t.prototype[Symbol.iterator]||"function"!=typeof t.from)return null;try{return t.from(e)}catch(e){return null}}else{if([String,Number,Boolean,Date,Array].includes(t))return null;{if("Buffer"===e.type&&Array.isArray(e.data))if("function"==typeof Buffer&&t===Buffer)try{return Buffer.from(e.data)}catch(e){return null}else{if("function"!=typeof t.prototype[Symbol.iterator]||"function"!=typeof t.from)return null;try{return t.from(e.data)}catch(e){return null}}else if("ByteArray"===e.type&&Array.isArray(e.data))try{return b(e.data)}catch(e){return null}const r=Object.getOwnPropertyNames(e),n=Object.values(e);if(!r.slice(0,50).map(Number).every((e=>!Number.isNaN(e)))||!n.slice(0,50).map(Number).every((e=>!Number.isNaN(e)))||"function"!=typeof t.prototype[Symbol.iterator]||"function"!=typeof t.from){if(t.prototype instanceof Error){const r=K(e);if(r){const n=H.get(t.prototype);if(n)for(const t of Reflect.ownKeys(e)){const o=n[t];o&&(r[t]=Z(e[t],o))}}return r}{const r=Object.create(t.prototype),n=H.get(t.prototype);if(n)for(const t of Reflect.ownKeys(e)){const o=n[t];r[t]=o?Z(e[t],o):e[t]}else Object.assign(r,e);return r}}try{return t.from(Object.values(e))}catch(e){return null}}}}function X(e){return"object"==typeof e&&null!==e&&"function"==typeof e.next}function Q(e){return function(e){return X(e)&&"function"==typeof e[Symbol.iterator]}(e)&&ee(e)}function Y(e){return function(e){return X(e)&&"function"==typeof e[Symbol.asyncIterator]}(e)&&ee(e)}function ee(e){return"function"==typeof e.return&&"function"==typeof e.throw}JSON.parseAs=function(e,t){return Z(JSON.parse(e),t)},JSON.as=Z,JSON.type=function(e){return(t,r)=>{const n=H.get(t);n?n[r]=e:H.set(t,{[r]:e})}},Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")),Symbol.asyncIterator||Object.defineProperty(Symbol,"asyncIterator",{value:Symbol("Symbol.asyncIterator")});const te=Symbol("GeneratorSource"),re=Symbol("GeneratorStatus"),ne=Symbol("GeneratorResult");class oe{constructor(e){this[te]=e,this[re]="suspended",this[ne]=void 0}then(e,t){let r;var n;return void 0===this[te]||"closed"===this[re]?r=Promise.resolve(this[ne]):"erred"===this[re]?r=Promise.reject(this[te]):"function"==typeof this[te].then?r=Promise.resolve(this[te]):"function"==typeof this[te].next?(n=this[te],r=new Promise(((e,t)=>{function r(e){try{i(n.next(e))}catch(e){t(e)}}function o(e){var r;try{i(null===(r=n.throw)||void 0===r?void 0:r.call(n,e))}catch(e){t(e)}}function i(t){Promise.resolve(t).then((t=>{t.done?e(t.value):new Promise((e=>{e(t.value)})).then(r,o)}))}i(n.next())}))):r=Promise.resolve(this[te]),this[re]="closed",r.then((e=>this[ne]=e)).then(e,t)}catch(e){return Promise.resolve(this).then(null,e)}}class ie extends oe{next(...e){const t=e[0];let r;if(void 0===this[te]||"closed"===this[re])r={value:void 0,done:!0};else{if("erred"===this[re])return this.throw(this[te]);r="function"==typeof this[te].next?this[te].next(t):{value:this[te],done:!0}}return!0===r.done&&(this[re]="closed",this[ne]=r.value),r}return(e){return this[re]="closed",this[ne]=e,this[te]&&"function"==typeof this[te].return?this[te].return(e):{value:e,done:!0}}throw(e){if(this[re]="closed",this[te]&&"function"==typeof this[te].throw)return this[te].throw(e);throw e}[Symbol.iterator](){return this}}class se extends oe{next(...e){const t=e[0];let r;return r=void 0===this[te]||"closed"===this[re]?Promise.resolve({value:void 0,done:!0}):"function"==typeof this[te].next?Promise.resolve(this[te].next(t)):Promise.resolve(this[te]).then((e=>({value:e,done:!0}))),r.then((e=>(!0===e.done&&(this[re]="closed",this[ne]=e.value),e)))}return(e){return this[re]="closed",Promise.resolve(e).then((e=>(this[ne]=e,this[te]&&"function"==typeof this[te].return?Promise.resolve(this[te].return(e)):Promise.resolve({value:e,done:!0}))))}throw(e){return this[re]="closed",this[te]&&"function"==typeof this[te].throw?Promise.resolve(this[te].throw(e)):Promise.reject(e)}[Symbol.asyncIterator](){return this}}const ae=function(e){if(!(this instanceof ae))return new ae(e);function t(...t){try{const n=e.apply(this,t);return"function"==typeof n.then||null!==(r=n)&&"object"==typeof r&&"function"==typeof r.next&&"function"==typeof r.return&&"function"==typeof r.throw&&"function"==typeof r[Symbol.asyncIterator]?new se(n):new ie(n)}catch(e){return Object.assign(new ie(e),{[re]:"erred"})}var r}return t.prototype=ae,t.__proto__=this,t};function ce(e,...t){if(R(e))try{return ce(e.apply(void 0,t))}catch(e){return[e,void 0]}let r=e;return r instanceof se?(r=r.then((e=>[null,e])),Promise.resolve(r).catch((e=>[e,void 0]))):Y(r)?async function*(){let e,t;for(;;)try{const{done:n,value:o}=await r.next(e);if(n){t=o;break}e=yield Promise.resolve([null,o])}catch(e){yield Promise.resolve([e,void 0]);break}return[null,t]}():Q(r)?function*(){let e,t;for(;;)try{const{done:n,value:o}=r.next(e);if(n){t=o;break}e=yield[null,o]}catch(e){yield[e,void 0];break}return[null,t]}():R(null==r?void 0:r.then)?(r=r.then((e=>[null,e])),Promise.resolve(r).catch((e=>[e,void 0]))):[null,r]}function le(e,t){const r=function(...r){return t.call(this,e,...r)};return Object.defineProperty(r,"name",Object.getOwnPropertyDescriptor(e,"name")),Object.defineProperty(r,"length",Object.getOwnPropertyDescriptor(e,"length")),Object.defineProperty(r,"toString",{configurable:!0,enumerable:!1,writable:!0,value:e.toString.bind(e)}),r}ae.create=function(e){return new ae(e)},Object.setPrototypeOf(ae,Function),Object.setPrototypeOf(ae.prototype,Function.prototype),ae.create;const ue=new Map;const fe=new Map;var pe;const de=Symbol.for("id"),he="object"==typeof Deno,ye="object"==typeof Bun,me=!he&&!ye&&"object"==typeof process&&!!(null===(pe=process.versions)||void 0===pe?void 0:pe.node),ve=me&&parseInt(process.version.slice(1))<14;me&&parseInt(process.version.slice(1));const we=/^(\.[\/\\]|\.\.[\/\\]|[a-zA-Z]:|\/)/,ge=!(me&&process.argv.includes("--worker-thread"))&&(ye?Bun.isMainThread:"undefined"==typeof WorkerGlobalScope);var be;void 0===Symbol.dispose&&Object.defineProperty(Symbol,"dispose",{value:Symbol("Symbol.dispose")});const ke=M(!0);class Se{constructor(e=0){if(this[be]=ke.next().value,this.buffer=[],this.producers=[],this.consumers=[],this.error=null,this.state=1,e<0)throw new RangeError("the capacity of a channel must not be negative");this.capacity=e}send(e){if(1!==this.state)throw new Error("the channel is closed");if(this.consumers.length){const t=this.consumers.shift();return Promise.resolve(t(null,e))}return this.capacity&&this.buffer.length<this.capacity?(this.buffer.push(e),Promise.resolve(void 0)):new Promise((t=>{this.producers.push((()=>{if(this.capacity){const r=this.buffer.shift();return this.buffer.push(e),t(),r}return t(),e}))}))}recv(){if(this.buffer.length){const e=this.buffer.shift();return 2!==this.state||this.buffer.length||(this.state=0),Promise.resolve(e)}if(this.producers.length){const e=this.producers.shift();return 2!==this.state||this.producers.length||(this.state=0),Promise.resolve(e())}if(0===this.state)return Promise.resolve(void 0);if(this.error){const{error:e}=this;return this.state=0,this.error=null,Promise.reject(e)}return 2===this.state?(this.state=0,Promise.resolve(void 0)):new Promise(((e,t)=>{this.consumers.push(((r,n)=>{2!==this.state||this.consumers.length||(this.state=0),r?t(r):e(n)}))}))}close(e=null){if(1!==this.state)return;let t;for(this.state=2,this.error=e;t=this.consumers.shift();)t(e,void 0)}[(be=de,Symbol.asyncIterator)](){const e=this;return{async next(){const t=e.buffer.length,r=e.producers.length;return{value:await e.recv(),done:0===e.state&&!t&&!r}}}}[Symbol.dispose](){this.close()}push(e){return this.send(e)}pop(){return this.recv()}}function je(e=0){return new Se(e)}class Ee{constructor(e,t=0){this.channel=je(t),(async()=>{var t;for await(const r of this.channel)try{await e.call(void 0,r)}catch(e){null===(t=this.errorHandler)||void 0===t||t.call(this,e)}})().catch((e=>{var t;null===(t=this.errorHandler)||void 0===t||t.call(void 0,e)}))}push(e){return this.channel.send(e)}close(){var e;null===(e=this.channel)||void 0===e||e.close()}onError(e){this.errorHandler=e}[Symbol.dispose](){this.close()}}var Oe;void 0===Symbol.dispose&&Object.defineProperty(Symbol,"dispose",{value:Symbol("Symbol.dispose")});const Pe=Symbol.for("queue"),xe=Symbol.for("value"),Ae=Symbol.for("mutex"),Ie=Symbol.for("unlocked");class Ne{constructor(e){this[Oe]=[],this[xe]=e}async lock(){await new Promise((e=>{this[Pe].length?this[Pe].push(e):(this[Pe].push(e),e())}));const e=Object.create(Ne.Lock.prototype);return e[Ae]=this,e}}Oe=Pe,function(e){var t;class r{constructor(e){this[t]=!1,this[Ae]=e}get value(){if(this[Ie])throw new ReferenceError("trying to access data after unlocked");return this[Ae][xe]}set value(e){if(this[Ie])throw new ReferenceError("trying to access data after unlocked");this[Ae][xe]=e}unlock(){this[Ie]=!0;const e=this[Ae][Pe];e.shift();const t=e[0];t?t():De.hasValue(this[Ae])&&De.deleteValue(this[Ae])}[(t=Ie,Symbol.dispose)](){this.unlock()}}e.Lock=r}(Ne||(Ne={}));const De=new _;const Me=new Map;function Le(e,t=!1){let r="";if("function"==typeof e){let t=e.toString(),n=7,o=t.lastIndexOf("import(");if(-1===o&&(n=8,o=t.lastIndexOf("require(")),-1===o)throw new TypeError("the given script is not a dynamic import expression");{o+=n;const e=t.indexOf(")",o);r=x(t.slice(o,e)," '\"'")}}else r=e;return(me||ye)&&we.test(r)&&(/\.[cm]?(js|ts|)x?$/.test(r)?me&&(r.endsWith(".ts")?r=r.slice(0,-3)+".js":r.endsWith(".mts")?r=r.slice(0,-4)+".mjs":r.endsWith(".cts")?r=r.slice(0,-4)+".cjs":r.endsWith(".tsx")&&(r=r.slice(0,-4)+".js")):r+=ye?".ts":".js"),we.test(r)||t||(r="./"+r),r}async function Te(e){var t;const r=await fetch(e);let n;if(null===(t=r.headers.get("content-type"))||void 0===t?void 0:t.includes("/javascript"))n=await r.blob();else{const e=await r.arrayBuffer();n=new Blob([new Uint8Array(e)],{type:"application/javascript"})}return URL.createObjectURL(n)}const Be=new Map;function Re(e){return e&&"object"==typeof e&&["send","close"].includes(e.type)&&"number"==typeof e.channelId}async function We(e){const t=Be.get(e.channelId);if(t)if("send"===e.type)await t.raw.send(e.value);else if("close"===e.type){const{value:r,channelId:n}=e;t.raw.close(r),Be.delete(n),ge&&t.writers.length>1&&t.writers.forEach((e=>{e("close",r,n)}))}}function Ue(e,t){return function(e,t){const r=e[de];if(Be.has(r))Be.get(r).writers.push(t);else{const n=e.send.bind(e),o=e.close.bind(e);Be.set(r,{channel:e,raw:{send:n,close:o},writers:[t],counter:0}),Object.defineProperties(e,{send:{configurable:!0,writable:!0,value:async e=>{const t=Be.get(r);if(t){if(1!==t.channel.state)throw new Error("the channel is closed");const n=t.writers[t.counter++%t.writers.length];await Promise.resolve(n("send",e,r))}}},close:{configurable:!0,writable:!0,value:(e=null)=>{const t=Be.get(r);if(t){Be.delete(r);const n=t.channel;t.writers.forEach((t=>{t("close",e,r)})),Object.defineProperties(n,{send:{configurable:!0,writable:!0,value:t.raw.send},close:{configurable:!0,writable:!0,value:t.raw.close}}),n.close(e)}}}})}}(e,t),{"@@type":"Channel","@@id":e[de],capacity:e.capacity}}function $e(e){return"?"!==e[0]&&"#"!==e[0]}function _e(e,t=!1){return t?/^[a-z]:$/i.test(e):/^[a-z]:(\\)?$/i.test(e)}function Ce(e){return/^[a-z]:/i.test(e)&&"://"!==e.slice(1,4)}function ze(e){return/^\//.test(e)}function Fe(e){return/^[a-z](([a-z\-]+)?:\/\/\S+|[a-z\-]+:\/\/$)/i.test(e)||function(e){return/^file:((\/\/|\/)\S+|\/?$)/i.test(e)}(e)}function Ke(e){return/^file:(\/\/)?$/i.test(e)}function qe(e){return ze(e)||Ce(e)||Fe(e)}function Je(e){if(e){if(Fe(e)){const{protocol:t,host:r,pathname:n,search:o,hash:i}=new URL(e);let s=t+"//"+r;if(Ke(s)&&(s+="/"),"/"===n)return o&&i?[s,o,i]:o?[s,o]:i?[s,i]:[s];{const e=x(n,"/").split(/[/\\]+/);return o&&i?[s,...e,o,i]:o?[s,...e,o]:i?[s,...e,i]:[s,...e]}}if(Ce(e)){const[t,r,...n]=Je("file:///"+e.replace(/[/\\]+/g,"/"));return[r+"\\",...n]}if(ze(e)){const[t,...r]=Je("file://"+e.replace(/[/\\]+/g,"/"));return["/",...r]}{e=e.replace(/[/\\]+/g,"/");const[t,r]=e.split("?");if(r){const e=t?A(t,"/").split("/"):[],[n,o]=r.split("#");return o?[...e,"?"+n,"#"+o]:[...e,"?"+n]}{const[t,r]=e.split("#"),n=t?A(t,"/").split("/"):[];return r?[...n,"#"+r]:n}}}return[]}function Ge(e){return e.replace(/^file:\/\/(localhost)?\/?([a-z]:)/i,"$2").replace(/^file:\/?([a-z]:)/i,"$1").replace(/^file:\/\/(localhost)?\//i,"/").replace(/^file:\//i,"/")}function Ve(e,t,r={}){const{result:n,paths:o,subs:i}=function(e,t,r={}){r.caseInsensitive&&(e=e.toLowerCase(),t=t.toLowerCase()),r.ignoreFileProtocol&&(e=Ge(e),t=Ge(t));const n=Je(e).filter($e),o=Je(t).filter($e);return n.length<o.length?{result:!1,paths:[],subs:[]}:(r.caseInsensitive||(n.forEach(((e,t)=>{_e(e)&&(n[t]=e.toLowerCase())})),o.forEach(((e,t)=>{_e(e)&&(o[t]=e.toLowerCase())}))),o.length?{result:void 0,paths:n,subs:o}:{result:!0,paths:n,subs:o})}(e,t,r);if(void 0!==n)return n;for(let e=i.length-1,t=o.length-1;e>=0;e--,t--)if(i[e]!==o[t])return!1;return!0}const He=(()=>{var e,t;if("object"==typeof Deno&&"string"==typeof(null===(e=Deno.build)||void 0===e?void 0:e.os)){if("windows"===Deno.build.os)return"\\"}else if("object"==typeof process&&(null===(t=process.versions)||void 0===t?void 0:t.node)&&"win32"===process.platform)return"\\";return"/"})();function Ze(){if("object"==typeof Deno&&"function"==typeof Deno.cwd)return Deno.cwd();if("object"==typeof process&&"function"==typeof process.cwd)return process.cwd();if("object"==typeof location&&location.origin)return location.origin+("/"===location.pathname?"":location.pathname);throw new Error("Unable to determine the current working directory.")}function Xe(...e){let t=[];for(let r=0;r<e.length;r++){const n=e[r];n&&(qe(n)&&(t=[]),t.push(n))}const r=[];for(let e=0;e<t.length;e++){let n=t[e];for(const e of Je(n))".."===e?!r.length||r.every((e=>".."===e))?r.push(".."):(r.length>2||2===r.length&&!qe(r[1])||1===r.length&&!qe(r[0]))&&r.pop():e&&"."!==e&&r.push(e)}if(!r.length)return".";const n=r[0],o=Fe(n)||ze(n)?"/":Ce(n)?"\\":He;let i="";for(let e=0;e<r.length;e++){const t=r[e];i&&"?"!==t[0]&&"#"!==t[0]?_e(t)?i?i+=t+"/":i=t:i+=(i.endsWith(o)?"":o)+x(t,"/\\"):i+=t}return/^file:\/\/\/[a-z]:$/i.test(i)?i+"/":i}function Qe(...e){e=e.filter((e=>""!==e));const t=Ze();return e.length?(e=qe(e[0])?e:[t,...e],Xe(...e)):t}function Ye(e){if(Fe(e)){const{protocol:t,host:r,pathname:n}=new URL(e),o=t+"//"+r,i=Ye(n);return"/"===i?Ke(o)?o+"/":o:o+i}{const t=Je(e).filter($e),r=t.pop();return t.length?Xe(...t):"/"===r?"/":_e(r,!0)?r+"\\":_e(r)?r:"."}}function et(e,t=""){if(Fe(e)){const{pathname:r}=new URL(e);return et(r,t)}{const r=Je(e).filter($e).pop();return!r||"/"===r||_e(r)?"":t?N(r,t):r}}function tt(e){const t=et(e),r=t.lastIndexOf(".");return-1===r?"":t.slice(r)}const rt=M(!0);let nt,ot=[];const it=new Map,st=(async()=>{if(me){const e=await import("os");return"function"==typeof e.availableParallelism?e.availableParallelism():e.cpus().length}return"object"==typeof navigator&&navigator.hardwareConcurrency?navigator.hardwareConcurrency:8})();function at(e){return e&&"object"==typeof e&&["return","yield","error","gen"].includes(e.type)}function ct(e){if(".ts"===tt(e))return Qe(e,"../../..");let t=Ye(e);return Ve(t,"jsext/bundle")?Ye(t):Qe(t,"../../..")}async function lt(t){let{adapter:r="worker_threads",parallel:n}=t;const o=await async function(t={}){if(me||ye){if(t.workerEntry)return t.workerEntry;const{fileURLToPath:r}=await import("url"),n=r("undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:e&&e.src||new URL("index.js",document.baseURI).href);if(n===process.argv[1]){const e=Xe(Ze(),"node_modules/@ayonli/jsext");return ye?".ts"===tt(n)?Xe(e,"worker.ts"):Xe(e,"bundle/worker.mjs"):Xe(e,"bundle/worker-node.mjs")}{const e=ct(n);return ye?".ts"===tt(n)?Xe(e,"worker.ts"):Xe(e,"bundle/worker.mjs"):Xe(e,"bundle/worker-node.mjs")}}if(he)return t.workerEntry?t.workerEntry:("undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:e&&e.src||new URL("index.js",document.baseURI).href).includes("jsr.io")?"jsr:@ayonli/jsext/worker.ts":Xe(ct("undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:e&&e.src||new URL("index.js",document.baseURI).href),"/worker.ts");if(t.workerEntry)return Fe(t.workerEntry)?await Te(t.workerEntry):t.workerEntry;{const e="https://ayonli.github.io/jsext/bundle/worker.mjs";return await Te(e)}}(n);if(me||ye){if("child_process"===r){const{fork:e}=await import("child_process"),t=e(o,["--worker-thread"],{stdio:"inherit",serialization:ve?"json":"advanced"}),r=t.pid;return await new Promise(((e,r)=>{t.once("error",r),t.once("message",(()=>{t.off("error",r),e()}))})),{worker:t,workerId:r,kind:"node_process"}}if(me){const{Worker:e}=await import("worker_threads"),t=new e(o,{argv:["--worker-thread"]}),r=t.threadId;return await new Promise(((e,r)=>{t.once("error",r),t.once("online",(()=>{t.off("error",r),e()}))})),{worker:t,workerId:r,kind:"node_worker"}}{const e=new Worker(o,{type:"module"}),t=rt.next().value;return await new Promise(((t,r)=>{e.onerror=e=>{r(new Error(e.message||"unable to start the worker"))},e.addEventListener("open",(()=>{e.onerror=null,t()}))})),{worker:e,workerId:t,kind:"bun_worker"}}}return{worker:new Worker(o,{type:"module"}),workerId:rt.next().value,kind:"web_worker"}}function ut(e,t,r){var n,o,i,s;if(Re(r))We(r);else if(at(r)&&r.taskId){const a=it.get(r.taskId);if(!a)return;if("return"===r.type||"error"===r.type){if("error"===r.type){const e=y(r.error)&&null!==(n=K(r.error))&&void 0!==n?n:r.error;e instanceof Error&&(e.message.includes("not be cloned")||(null===(o=e.stack)||void 0===o?void 0:o.includes("not be cloned")))&&Object.defineProperty(e,"stack",{configurable:!0,enumerable:!1,writable:!0,value:(e.stack?e.stack+"\n    ":"")+`at ${a.fn} (${a.module})`}),a.resolver?(a.resolver.reject(e),a.channel&&a.channel.close()):a.channel?a.channel.close(e):a.error=e}else{const e=ht(r.value);a.resolver?a.resolver.resolve(e):a.result={value:e},a.channel&&a.channel.close()}e.tasks.delete(r.taskId),e.tasks.size||!me&&!ye||t.unref()}else if("yield"===r.type){const n=ht(r.value);null===(i=a.channel)||void 0===i||i.send({value:n,done:r.done}),r.done&&ut(e,t,{type:"return",value:n,taskId:r.taskId})}else"gen"===r.type&&(null===(s=a.generate)||void 0===s||s.call(a))}}function ft(e,t){for(const r of e.tasks){e.tasks.delete(r);const n=it.get(r);n&&(n.resolver?(n.resolver.reject(t),n.channel&&n.channel.close()):n.channel?n.channel.close(t):n.error=t)}ot=ot.filter((t=>t!==e))}async function pt(e,t){const r=t.maxWorkers||await st;let n=ot.find((e=>!e.tasks.size));n?n.lastAccess=Date.now():ot.length<r?(ot.push(n={getWorker:(async()=>{const e=(await lt({parallel:t})).worker,r=ut.bind(void 0,n,e),o=ft.bind(void 0,n);if(me)e.on("message",r).on("error",o);else if(ye){const t=e;t.onmessage=e=>r(e.data),t.onerror=()=>t.terminate(),t.addEventListener("close",(e=>{o(new Error(e.reason+" ("+e.code+")"))}))}else{const t=e;t.onmessage=e=>r(e.data),t.onerror=e=>{var r;t.terminate(),o(null!==(r=J(e))&&void 0!==r?r:new Error("worker exited"))}}return e})(),tasks:new Set,lastAccess:Date.now()}),nt||(nt=setInterval((()=>{const e=Date.now(),t=[];ot=ot.filter((r=>{const n=!r.tasks.size&&e-r.lastAccess>=1e4;return n&&t.push(r),!n})),t.forEach((async e=>{const t=await e.getWorker;await t.terminate()}))}),1e3),me||ye?nt.unref():he&&Deno.unrefTimer(nt))):(n=ot[e%ot.length],n.lastAccess=Date.now()),n.tasks.add(e);const o=await n.getWorker;return(me||ye)&&o.ref(),o}function dt(e,t){const r=[];return e=e.map((e=>{if(e instanceof Se)return Ue(e,((e,r,n)=>{t.then((t=>{if("function"==typeof t.postMessage)try{t.postMessage({type:e,value:r,channelId:n})}catch(t){if("close"!==e||!String(t).includes("Worker has been terminated"))throw t}else t.send({type:e,value:r,channelId:n})}))}));if(e instanceof z||G(e)||V(e))return F(e);if(e instanceof ArrayBuffer)r.push(e);else if(y(e))for(const t of Object.getOwnPropertyNames(e)){const n=e[t];n instanceof ArrayBuffer?r.push(n):(n instanceof z||G(n)||V(n))&&(e[t]=F(n))}else Array.isArray(e)&&(e=e.map((e=>e instanceof ArrayBuffer?(r.push(e),e):e instanceof z||G(e)||V(e)?F(e):e)));return e})),{args:e,transferable:r}}function ht(e){return!y(e)||"Exception"!==e["@@type"]&&"DOMException"!==e["@@type"]&&"AggregateError"!==e["@@type"]?e:K(e)}const yt=M(!0);async function mt(e,t,r,n){try{e.postMessage(t,r)}catch(t){throw it.delete(n),"function"==typeof e.unref&&e.unref(),t}}function vt(e,t,r){const n=async function(e,t){let r;if(me||ye){const{fileURLToPath:n}=await import("url"),o=t?n(new URL(e,t).href):e;r=await import(o)}else{const n=new URL(e,t).href;if(r=Me.get(n),!r)if(he)r=await import(n),Me.set(n,r);else try{r=await import(n),Me.set(n,r)}catch(e){if(!String(e).includes("Failed"))throw e;{const e=await Te(n);r=await import(e),Me.set(n,r)}}}return"object"==typeof r.default&&void 0!==r.default.default&&(r=r.default),r}(e).then((e=>e[t](...r)));return new se({then:(e,t)=>n.then(e,t),async next(e){const t=await n;return await t.next(e)},async return(e){const t=await n;return await t.return(e)},throw:async e=>(await n).throw(e)})}function wt(e){var t,r,n;let o=e.split("\n");const i=o.findIndex((e=>"Error"===e));let s,a;if(-1!==i&&(o=o.slice(i)),s=(null===(t=o[0])||void 0===t?void 0:t.startsWith("Error"))?o[2]:o[1],s){let e=s.lastIndexOf("("),t=0;-1!==e?(e+=1,t=s.indexOf(")",e),s=s.slice(e,t)):s.startsWith("    at ")?s=s.slice(7):"object"==typeof location&&(e=null!==(n=null===(r=s.match(/(https?|file):/))||void 0===r?void 0:r.index)&&void 0!==n?n:-1,e>0&&(s=s.slice(e))),a=s.replace(/:\d+:\d+$/,""),/^(https?|file):/.test(a)||(a=we.test(a)?"file://"+a:he?"file://"+Deno.cwd()+"/":me||ye?"file://"+process.cwd()+"/":"object"==typeof location?location.href:"")}return a}function gt(e){let t,r=Le(e,!0);if(we.test(r))if("function"==typeof Error.captureStackTrace){const e={};Error.captureStackTrace(e),t=wt(e.stack)}else{t=wt(new Error("").stack)}return t&&(r=new URL(r,t).href),new Proxy(Object.create(null),{get:(e,t)=>{if(Reflect.has(e,t))return e[t];if("symbol"==typeof t)return;const n={[t]:(...e)=>ge?function(e,t,r){const n=yt.next().value;it.set(n,{module:e,fn:t});let o=pt(n,gt);const{args:i,transferable:s}=dt(r,o);return o=o.then((async r=>(await mt(r,{type:"call",module:e,fn:t,args:i,taskId:n},s,n),r))),new se({then(e,t){const r=it.get(n);return r.error?(it.delete(n),null==t?void 0:t(r.error)):r.result?(it.delete(n),null==e?void 0:e(r.result.value)):o.then((()=>new Promise(((e,t)=>{r.resolver={resolve:t=>{it.delete(n),e(t)},reject:e=>{it.delete(n),t(e)}}})))).then(e,t)},async next(e){var t;const r=it.get(n);if(r.error){const e=r.error;throw it.delete(n),e}if(r.result){const e=r.result.value;return it.delete(n),{value:e,done:!0}}{null!==(t=r.channel)&&void 0!==t||(r.channel=je(1/0));const i=await o;r.generate||await new Promise((e=>{r.generate=e}));const{args:s,transferable:a}=dt([e],o);return await mt(i,{type:"next",args:s,taskId:n},a,n),await r.channel.recv()}},async return(e){it.delete(n);const t=await o,{args:r,transferable:i}=dt([e],o);return await mt(t,{type:"return",args:r,taskId:n},i,n),{value:e,done:!0}},async throw(e){it.delete(n);const t=await o;throw await mt(t,{type:"throw",args:[e],taskId:n},s,n),e}})}(r,t,e):vt(r,t,e)};return n[t]}})}!function(e){e.maxWorkers=void 0,e.workerEntry=void 0}(gt||(gt={}));var bt=gt;const kt=new Map;let St;const jt=[];async function Et(e,t,r){var n;const o=Et.maxWorkers||bt.maxWorkers||await st,i=(null==r?void 0:r.fn)||"default";let s,a=Le(e);he?s="file://"+Deno.cwd()+"/":me||ye?we.test(a)&&(s="file://"+process.cwd()+"/"):"object"==typeof location&&(s=location.href),s&&(a=new URL(a,s).href);const c={type:"call",module:a,fn:i,args:null!=t?t:[]},l=(null==r?void 0:r.adapter)||"worker_threads",u=null!==(n=kt.get(l))&&void 0!==n?n:kt.set(l,[]).get(l);let f=u.find((e=>!e.busy));if(f)f.busy=!0,f.lastAccess=Date.now();else{if(!(u.length<o))return new Promise((e=>{jt.push(e)})).then((()=>Et(a,t,r)));u.push(f={getWorker:lt({parallel:bt,adapter:l}),adapter:l,busy:!0,lastAccess:Date.now()}),St||(St=setInterval((()=>{kt.forEach(((e,t)=>{const r=Date.now(),n=[];kt.set(t,e.filter((e=>{const t=!e.busy&&r-e.lastAccess>=1e4;return t&&n.push(e),!t}))),n.forEach((async e=>{const{worker:t}=await e.getWorker;"function"==typeof t.terminate?await t.terminate():t.kill()}))}))}),1e3),me||ye?St.unref():he&&Deno.unrefTimer(St))}let p,d,h,m,v,w=null,g=()=>Promise.resolve(void 0);const b=(null==r?void 0:r.timeout)?setTimeout((async()=>{const e=new Error(`operation timeout after ${r.timeout}ms`);w=e,await g(),S(e,!0)}),r.timeout):null;b&&W(b);const k=async e=>{var t,n;if(Re(e))await We(e);else if(at(e))if(b&&clearTimeout(b),"return"===e.type||"error"===e.type){if("error"===e.type){const r=y(e.error)&&null!==(t=K(e.error))&&void 0!==t?t:e.error;r instanceof Error&&(r.message.includes("not be cloned")||(null===(n=r.stack)||void 0===n?void 0:n.includes("not be cloned"))||r.message.includes("Do not know how to serialize"))&&Object.defineProperty(r,"stack",{configurable:!0,enumerable:!1,writable:!0,value:(r.stack?r.stack+"\n    ":"")+`at ${i} (${a})`}),w=r}else p={value:ht(e.value)};(null==r?void 0:r.keepAlive)||await g(),S(null,!(null==r?void 0:r.keepAlive))}else if("yield"===e.type){const t=ht(e.value);e.done?k({type:"return",value:t}):null==h||h.send(t)}},S=(e,t=!1)=>{var r,n,o;if(b&&clearTimeout(b),t){if(f){const e=null===(n=kt.get(l))||void 0===n?void 0:n.filter((e=>e!==f));(null==e?void 0:e.length)?kt.set(l,e):kt.delete(l),jt.length&&(null===(o=jt.shift())||void 0===o||o())}}else null==v||v(),jt.length&&(null===(r=jt.shift())||void 0===r||r());e&&(null!=w||(w=e)),w?d?(d.reject(w),h&&h.close()):h&&(w instanceof Error?h.close(w):"string"==typeof w?h.close(new Error(w)):h.close(new Error("unknown error",{cause:w}))):(null!=p||(p={value:void 0}),d&&d.resolve(p.value),h&&h.close())},j=async(e,t,n=[])=>{try{"function"==typeof e.postMessage?e.postMessage(t,n):await new Promise(((r,n)=>{e.send(t,(e=>{e?n(e):r()}))}))}catch(t){throw"function"==typeof e.unref&&e.unref(),w=t,(null==r?void 0:r.keepAlive)||await g(),S(null,!(null==r?void 0:r.keepAlive)),t}};if(me||ye)if("child_process"===l){const e=await f.getWorker,t=e.worker;if(m=e.workerId,t.ref(),t.on("message",k),t.once("exit",((e,t)=>{w||p||S(new Error(`worker exited (${null!=e?e:t})`),!0)})),v=()=>{t.unref(),t.off("message",k),t.removeAllListeners("exit"),f&&(f.busy=!1)},g=()=>Promise.resolve(void t.kill(1)),w)throw await g(),w;const{args:r}=dt(c.args,Promise.resolve(t));c.args=r,await j(t,c)}else if(me){const e=await f.getWorker,t=e.worker,r=e=>{w||p||S(e,!0)};if(m=e.workerId,t.ref(),t.on("message",k),t.once("error",r),v=()=>{t.unref(),t.off("message",k),t.off("error",r),f&&(f.busy=!1)},g=async()=>{await t.terminate()},w)throw await g(),w;const{args:n,transferable:o}=dt(c.args,Promise.resolve(t));c.args=n,await j(t,c,o)}else{const e=await f.getWorker,t=e.worker,r=e=>{w||p||S(new Error(e.reason+" ("+e.code+")"),!0)};if(m=e.workerId,t.ref(),t.onmessage=e=>k(e.data),t.onerror=()=>{t.terminate()},t.addEventListener("close",r),v=()=>{t.unref(),t.onmessage=null,t.onerror=null,t.removeEventListener("close",r),f&&(f.busy=!1)},g=()=>Promise.resolve(t.terminate()),w)throw await g(),w;const{args:n,transferable:o}=dt(c.args,Promise.resolve(t));c.args=n,await j(t,c,o)}else{const e=await f.getWorker,t=e.worker;if(m=e.workerId,t.onmessage=e=>k(e.data),t.onerror=e=>{var r;w||p||(t.terminate(),S(null!==(r=J(e))&&void 0!==r?r:new Error("worker exited"),!0))},v=()=>{t.onmessage=null,t.onerror=null,f&&(f.busy=!1)},g=()=>Promise.resolve(t.terminate()),w)throw await g(),w;const{args:r,transferable:n}=dt(c.args,Promise.resolve(t));c.args=r,await j(t,c,n)}return{workerId:m,async abort(e=void 0){b&&clearTimeout(b),e?w=e:p={value:void 0},await g(),S(null,!0)},result:async()=>await new Promise(((e,t)=>{w?t(w):p?e(p.value):d={resolve:e,reject:t}})),iterate(){if(d)throw new Error("result() has been called");if(p)throw new TypeError("the response is not iterable");return h=je(1/0),{[Symbol.asyncIterator]:h[Symbol.asyncIterator].bind(h)}}}}!function(e){e.maxWorkers=void 0,e.workerEntry=void 0}(Et||(Et={})),Object.defineProperties(Et,{workerEntry:{set(e){bt.workerEntry=e},get:()=>bt.workerEntry}});var Ot=Et;const Pt="object"==typeof Bun,xt=new Map;function At(e,t,r,n,o){var i;if(!n||!xt.has(t)){let s={};"function"==typeof Error.captureStackTrace?Error.captureStackTrace(s,t):s=new Error("");let a=s.stack.split("\n");const c=a.findIndex((e=>"Error"===e));-1!==c&&(a=a.slice(c));let l=null===(i=a[o])||void 0===i?void 0:i.trim(),u=`${e} is deprecated`;if(r&&(u+=", "+r),l){let e=l.indexOf("(");if(-1!==e){e+=1;const t=l.indexOf(")",e);l=l.slice(e,t)}u+=" ("+l+")"}console.warn("DeprecationWarning:",u),n&&xt.set(t,!0)}}const It=async function(){}.constructor,Nt=async function*(){}.constructor,Dt={_try:ce,try:ce,func:function(e){return function(...t){var r;const n=[],o=e=>{n.push(e)};let i;try{const r=e.call(this,o,...t);if(Y(r)){const e=async function*(){var e;let t;for(;;)try{const{done:e,value:n}=await r.next(t);if(e){i={value:n,error:null};break}t=yield Promise.resolve(n)}catch(e){i={value:void 0,error:e};break}for(let t=n.length-1;t>=0;t--)await(null===(e=n[t])||void 0===e?void 0:e.call(n));if(i.error)throw i.error;return i.value}();return e}if(Q(r)){const e=function*(){var e;let t;for(;;)try{const{done:e,value:n}=r.next(t);if(e){i={value:n,error:null};break}t=yield n}catch(e){i={value:void 0,error:e};break}for(let t=n.length-1;t>=0;t--)null===(e=n[t])||void 0===e||e.call(n);if(i.error)throw i.error;return i.value}();return e}if("function"==typeof(null==r?void 0:r.then))return Promise.resolve(r).then((e=>({value:e,error:null}))).catch((e=>({value:void 0,error:e}))).then((async e=>{var t;for(let e=n.length-1;e>=0;e--)await(null===(t=n[e])||void 0===t?void 0:t.call(n));if(e.error)throw e.error;return e.value}));i={value:r,error:null}}catch(e){i={value:void 0,error:e}}for(let e=n.length-1;e>=0;e--)null===(r=n[e])||void 0===r||r.call(n);if(i.error)throw i.error;return i.value}},wrap:le,throttle:function(e,t){const r="number"==typeof t?null:t.for,n="number"==typeof t?t:t.duration,o="number"!=typeof t&&!!(null==t?void 0:t.noWait),i=function(t,...r){var i;if(t.result&&(t.pending&&o||Date.now()<(null!==(i=t.expires)&&void 0!==i?i:0))){if(t.result.error)throw t.result.error;return t.result.value}if(t.pending)return t.pending;try{const i=e.call(this,...r);if("function"==typeof(null==i?void 0:i.then)){if(t.pending=Promise.resolve(i).finally((()=>{t.result={value:t.pending},t.pending=void 0,t.expires=Date.now()+n})),o&&t.result){if(t.result.error)throw t.result.error;return t.result.value}return t.pending}return t.result={value:i},t.expires=Date.now()+n,i}catch(e){throw t.result={error:e},t.expires=Date.now()+n,e}};if(null==r||""===r){const e={for:null};return function(...t){return i.call(this,e,...t)}}{let e=ue.get(r);return e||(e={for:r},ue.set(r,e)),function(...t){return i.call(this,e,...t)}}},debounce:function(e,t,r=void 0){const n="number"==typeof t?t:t.delay,o="number"==typeof t?null:t.for,i=null!=o&&""!==o;let s=i?fe.get(o):void 0;s||(s={for:o,tasks:[],data:void 0,timer:void 0},i&&fe.set(o,s));const a=s;return async function(t){return"function"==typeof r&&void 0!==a.data?a.data=r(a.data,t):a.data=t,a.timer&&clearTimeout(a.timer),a.timer=setTimeout((()=>{const t=a.tasks,r=a.data;a.tasks=[],a.data=void 0,i&&fe.delete(o);const n=e=>{t.forEach((({resolve:t})=>t(e)))},s=e=>{t.forEach((({reject:t})=>t(e)))};try{const t=e.call(this,r);"function"==typeof(null==t?void 0:t.then)?t.then(n,s):n(t)}catch(e){s(e)}}),n),await new Promise(((e,t)=>{a.tasks.push({resolve:e,reject:t})}))}},queue:function(e,t=0){return new Ee(e,t)},lock:async function(e){let t=De.get(e);return t||De.set(e,t=new Ne(void 0)),await t.lock()},read:function(e,t=void 0){var r;if(R(e[Symbol.asyncIterator]))return e;if("function"==typeof ReadableStream&&e instanceof ReadableStream){const t=e.getReader();return{[Symbol.asyncIterator]:async function*(){try{for(;;){const{done:e,value:r}=await t.read();if(e)break;yield r}}finally{t.releaseLock()}}}}const n=je(1/0),o=n.send.bind(n),i=n.close.bind(n),s=e=>{let t;t=e instanceof ErrorEvent?e.error||new Error(e.message):new Error("something went wrong",{cause:e}),i(t)},a=Object.getPrototypeOf(e),c=Object.getOwnPropertyDescriptor(a,"onmessage");if((null==c?void 0:c.set)&&R(e.close)){const n=Object.getOwnPropertyDescriptor(a,"onerror"),l=Object.getOwnPropertyDescriptor(a,"onclose");let u;if((null==t?void 0:t.event)&&"message"!==(null==t?void 0:t.event)&&R(e.addEventListener)){const r=e,n=t.event,i=e=>{o(e.data)};r.addEventListener(n,i),u=()=>{r.removeEventListener(n,i)}}else c.set.call(e,(e=>{o(e.data)})),u=()=>{var t;null===(t=c.set)||void 0===t||t.call(e,null)};if(null===(r=null==n?void 0:n.set)||void 0===r||r.call(e,s),null==l?void 0:l.set)l.set.call(e,(()=>{var t,r;i(),null===(t=l.set)||void 0===t||t.call(e,null),null===(r=null==n?void 0:n.set)||void 0===r||r.call(e,null),null==u||u()}));else if(!(null==l?void 0:l.set)&&R(e.close)){const t=e,r=t.close;t.close=function(){var o;r.call(t),i(),t.close=r,null===(o=null==n?void 0:n.set)||void 0===o||o.call(e,null),null==u||u()}}}else if(R(e.send)&&R(e.close)){const t=e;t.onmessage=e=>{o(e.data)},t.onerror=s,t.onclose=()=>{i(),t.onclose=null,t.onerror=null,t.onmessage=null}}else if(R(e.addEventListener)){const r=e,n=(null==t?void 0:t.message)||"message",a=(null==t?void 0:t.error)||"error",c=(null==t?void 0:t.close)||"close",l=e=>{e instanceof MessageEvent&&o(e.data)};r.addEventListener(n,l),r.addEventListener(a,s),r.addEventListener(c,(function e(){i(),r.removeEventListener(c,e),r.removeEventListener(n,l),r.removeEventListener(a,s)}))}else{if(!R(e.on))throw new TypeError("the input source cannot be read as an AsyncIterable object");{const r=e;let n,s,a;"object"==typeof process&&e===process?(n="message",s="uncaughtException",a="exit"):R(e.send)&&R(e.kill)||R(e.postMessage)&&R(e.terminate)||R(e.postMessage)&&R(e.close)?(n="message",s="error",a="exit"):(n=(null==t?void 0:t.data)||"data",s=(null==t?void 0:t.error)||"error",a=(null==t?void 0:t.close)||"close"),r.on(n,o),r.once(s,i),r.once(a,(()=>{i(),r.off(n,o),r.off(s,i)}))}}return{[Symbol.asyncIterator]:n[Symbol.asyncIterator].bind(n)}},readAll:async function(e){const t=[];for await(const r of e)t.push(r);return t},chan:je,parallel:bt,run:Ot,example:function e(t,r=void 0){const n={};return Error.captureStackTrace(n,e),async function(...e){let o=t.toString().split("\n").slice(1,-1),i=o.findIndex((e=>"// output:"===e.trim().toLowerCase()));if(-1===i)return;if(i+=1,o=o.slice(i),-1!==o.findIndex((e=>"// output:"===e.trim().toLowerCase())))throw new Error("there can only be one output comment in the example");let s=[];for(let e of o){if(e=e.trimStart(),!e.startsWith("//"))throw new Error("the output comment must be at the end of the example");if(e[2]&&" "!==e[2])throw new Error("the output comment must start with '// '");s.push(e.slice(3))}const a=[...s];s=[];for(let e=a.length-1;e>=0;e--)""!==a[e]&&s.push(a[e]);s.reverse();const c=await import("node:assert"),{Writable:l}=await import("node:stream"),{Console:u}=await import("node:console"),f=[],p=new TextDecoder,d=new l({write(e,t,r){f.push(e),r()}}),h=new u(d),y=t.call(this,h,...e);"function"==typeof(null==y?void 0:y.then)&&await y,await new Promise((e=>d.end((()=>e())))),await(async()=>{var e;const t=f.map((e=>p.decode(e))).join("\n").replace(/[\n]+$/,""),o=s.join("\n");try{if(c.ok(t===o,`\nexpected:\n${o}\n\ngot:\n${t}`),!(null==r?void 0:r.suppress))for(const e of f)"object"==typeof Deno?await Deno.stdout.write(e):"object"==typeof process&&await new Promise((t=>{process.stdout.write(e,(()=>t()))}))}catch(t){throw Object.defineProperty(t,"stack",{configurable:!0,writable:!0,enumerable:!1,value:t.stack+"\n"+(null===(e=n.stack)||void 0===e?void 0:e.split("\n").slice(1).join("\n"))}),t}})()}},deprecate:function(e,...t){var r,n,o,i;if("function"==typeof e){const o=null!==(r=t[0])&&void 0!==r?r:"",i=null!==(n=t[1])&&void 0!==n&&n;return le(e,(function e(t,...r){return At(t.name+"()",e,o,i,Pt?1:2),t.apply(this,r)}))}return At(e,t[0],null!==(o=t[1])&&void 0!==o?o:"",null!==(i=t[2])&&void 0!==i&&i,1)},isClass:o,isSubclassOf:i,mixin:l,mixins:l};return globalThis.AsyncFunction=It,globalThis.AsyncGeneratorFunction=Nt,Dt}));
//# sourceMappingURL=index.js.map
